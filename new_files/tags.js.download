var StyleMixin={init:function(){this.on('mount',function(){this.styleblock=document.getElementById('riot-dynamic-styles');if(!this.styleblock){this.styleblock=document.createElement('style');this.styleblock.setAttribute('id','riot-dynamic-styles');this.styleblock.type='text/css';document.body.appendChild(this.styleblock);}
this.sheet=this.styleblock.sheet;});},addCSSRule:function(selector,rules,idndex){if(this.sheet&&"insertRule"in this.sheet){this.sheet.insertRule(selector+"{"+rules+"}",this.sheet.cssRules.length);}
else if(this.sheet&&"addRule"in this.sheet){this.sheet.addRule(selector,package-inputrules,this.sheet.cssRules.length);}},editCSSRule:function(index,selector,rules){this.sheet.deleteRule(index);this.addCSSRule(selector,rules,this.sheet.cssRules.length);},updateCSSRule:function(selector,rules){var ruleIndex=-1;if(!this.sheet)
return;var theRules=this.sheet.cssRules?this.sheet.cssRules:this.sheet.rules;for(var i=0;i<theRules.length;i++){if(theRules[i].selectorText===selector){ruleIndex=i;break;}}
if(ruleIndex===-1){this.addCSSRule(selector,rules,this.sheet.cssRules.length);}
else{this.editCSSRule(ruleIndex,selector,rules);}}}
riot.mixin('promise',{promise:new function(){riot.observable(this);var self=this;this.get=function(url){var request=new XMLHttpRequest();request.promise=riot.observable();request.open('GET',url,true);request.onload=function(){var json;try{json=JSON.parse(request.responseText);}catch(e){json={};}
if(request.status>=200&&request.status<400)
request.promise.trigger('complete',{success:true,text:request.responseText,json:json});else
request.promise.trigger('complete',{success:false,text:request.responseText,json:json});};request.onerror=function(){request.promise.trigger('complete',{success:false,text:"connection error"});};request.send();return request.promise;};this.setdata=function(url,type,data,store,trigger,retries,promise){var request=new XMLHttpRequest();if(promise==undefined){app["loading"+store]="loading";site.trigger(trigger+'-loading');window.consolelog(trigger+"-loading : Started ");request.promise=riot.observable();}else{request.promise=promise;}
request.open(type,url,true);var timeout=500;request.onload=function(){var json;try{json=JSON.parse(request.responseText);}catch(e){json={};}
if(request.readyState===4&&request.status===200){if(store!=undefined&&store!==""){app[store]=json;window.SessionSave("app",app);}
window.consolelog("Data Success for "+store+" - "+trigger+'-loading-success');request.promise.trigger('complete',{success:true,text:request.responseText,json:json});site.trigger(trigger+'-loading-success',json,true);app["loading"+store]=undefined;site.trigger(trigger,json,true);}
else{if(retries===0){request.promise.trigger('complete',{success:false,text:request.responseText,json:json});site.trigger(trigger+"-loading-fail",json,false);app["loading"+store]=undefined;site.trigger(trigger,json,false);var trackData={};trackData.Result=json;trackData.URL=url;trackData.Type=type;trackData.Store=store+" - "+trigger+"-loading-fail";site.trigger("track-api-retry-fail",trackData);}else{setTimeout(function(){self.setdata(url,type,data,store,trigger,retries-1,request.promise);},timeout);}}};request.send(data);return request.promise;}
this.all=function(){var completed=[],isArr=Array.isArray(arguments[0]);var args=isArr?arguments[0]:arguments;var narg=args.length,entries=0;for(var i=0;i<narg;i++){args[i].index=i;args[i].one('complete',function(a){completed[this.index]=a;if(++entries===narg)
self.trigger.apply(null,['complete'].concat(isArr?[completed]:completed));});}
return self;}
return this;}});riot.mixin('loader',{loadscript:function(scriptSrc,callback){var head=document.querySelector('head');var selector="script[src='"+scriptSrc+"']";var script=document.querySelector(selector);if(script==undefined){script=document.createElement('script');script.type='text/javascript';script.src=scriptSrc;head.appendChild(script);}
if(script.callbacks==undefined)
script.callbacks=[];script.callbacks.push(callback);script.doCallbacks=function(){script.callbacks.forEach(function(c,i){c();});}
script.onload=function(){script.doCallbacks();}
script.onreadystatechange=function(){if(this.readyState==='complete'){script.doCallbacks();}}}});riot.mixin('tracker',{track:function(action,data,result){}})
riot.tag2('navigate','<a href="{document.querySelector(\'router\').getBasePath()+opts.to}" onclick="{navigateToRoute}"><yield></yield></a>','','',function(opts){var self=this;this.navigateToRoute=function(e){e.preventDefault();riot.route(self.opts.to,self.opts.title||null,self.opts.replace?true:false);}});riot.tag2('route','<yield></yield>','','',function(opts){this.on('mount',function(e){if(Object.keys(this.tags).length===0){this.parent&&this.parent.setRoute&&this.parent.setRoute(this.opts.path,this.opts.component);}});this.setRoute=function(path,component){this.parent&&this.parent.setRoute&&this.parent.setRoute(this.opts.path+path,component);}});riot.tag2('router','<div ref="riotcontainer" class="route-container"><yield></yield></div><div ref="riotroot" class="riot-root"></div>','','',function(opts){var self=this;var $appRoot=null;var currTag=null;var _isRouteRendedered=false;var routeParams={};function unmountCurrRoute(){if(currTag&&currTag.unmount){currTag.unmount();}}
function createRouteWithTagName(tagName){var tag='<'+tagName+' class="route-'+tagName+'"></'+tagName+'>';unmountCurrRoute();$appRoot.innerHTML=tag;var mountedTag=false;try{if(typeof window==='undefined'){$appRoot.innerHTML=riot.render(tagName,routeParams);}else{mountedTag=riot.mount(tagName+'.route-'+tagName,routeParams);}}
catch(e){console.log(e);}
if(!mountedTag||mountedTag.length===0){site.trigger('tagNotFound',tagName);if(self.opts['onTagnotfound']&&self.opts['onTagnotfound']instanceof Function){self.opts['onTagnotfound'](tagName);}}
else{site.trigger('routeChanged',tagName);app.currentroute=tagName;if(self.opts['onRoutechange']&&self.opts['onRoutechange']instanceof Function){self.opts['onRoutechange'](tagName);}
currTag=mountedTag[0];}}
function changeRoute(newRoute){if(typeof(newRoute)==='string'){createRouteWithTagName(newRoute);}else if(newRoute instanceof Function){var result=newRoute();if(typeof(result)==='string'){createRouteWithTagName(newRoute);}else if(result instanceof Promise){result.then(function(tagName){createRouteWithTagName(tagName);});}}}
this.setRoute=function(path,component){(function(path,component){var tokenRegExp=/:([a-z]*)/ig;var params=path.match(tokenRegExp);var param1=function(param){return param.length>0?param.substring(1):''}
params=params&&params.map(param1(param))||params;path=path.replace(tokenRegExp,'*');if(typeof window==='undefined'&&!_isRouteRendedered){var serverSidePath=new RegExp(path.replace(/\*/g,'([^/?#]+?)').replace(/\.\./g,'.*')+'$');var loc=self.opts.location||self.parent&&self.parent.opts.location;if(serverSidePath.test(loc)){var matches=loc.match(serverSidePath)
matches.length&&matches.shift();routeParams={};params&&params.forEach(function(param,index){routeParams[param]=matches[index];});_isRouteRendedered=true;changeRoute(component);}}else if(typeof window!=='undefined'){route(path,function(){routeParams={};params&&params.forEach(function(param,index){routeParams[param]=arguments[index];});changeRoute(component);});route.start(true);}})(path,component)}
this.on('mount',function(e){if(!this.opts.showRoutes){var routeContainer=this.refs.riotcontainer;routeContainer.remove&&routeContainer.remove();}
$appRoot=this.refs.riotroot;this.opts.baseRoute&&route.base(this.opts.baseRoute);this.root.getBasePath=function(){return self.opts.baseRoute||'#';}});});riot.tag2('tag-channel-shows','<section class="watch-section package-shows {sectionClasses}" id="{attrtarget}" if="{display && model.items}"><div class="tabs-section"><div class="heading-area pt-4 pb-1"><div class="container"><div class="row"><yield></yield></div></div></div><div class="bg-holder slide-holder"><div class="show-slider-holder" if="{model.items}"><div class="show-slider slide-item"><div class="slide" each="{show, index in model.items}" if="{show.thumbnailImagePaths && show.thumbnailImagePaths.THUMB}"><div class="scene"><div class="card my-2" showtitle="{show.title}"><div class="card-face front"><div class="body-wrap"><div class="img-head-area"><div class="inner-mask" riot-style="background-image: url(\'{show.thumbnailImagePaths.THUMB}\')"></div><img class="hidden" riot-src="{show.thumbnailImagePaths.THUMB}" alt="{show.title} cover"></div><div class="content p-3"><div><h2>{show.title}</h2><p if="{show.longSynopsis}">{truncate(show.longSynopsis,65, 65)}</p></div><div><ul class="meta-hold"><li if="{show.rating != \'\'}"><span class="ico icon-ico-pg"></span><span class="text">{show.rating}</span></li><li if="{show.year}"><span class="ico icon-ico-movietype"></span><span class="text">{show.year}</span></li><li if="{show.startDateTime != \'\'}"><span class="ico icon-ico-time"></span><span class="text">{(⁗0⁗ + new Date(show.startDateTime).getHours()).slice(-2) + ⁗:⁗ + (⁗0⁗ + new Date(show.startDateTime).getMinutes()).slice(-2)}</span></li></ul></div></div></div></div></div></div></div></div></div></div></div></section>','tag-channel-shows,[riot-tag="tag-channel-shows"],[data-is="tag-channel-shows"]{ visibility: visible; }','',function(opts){var self=this;self.model={};self.display=true;self.loaded=false;self.apiloaded=false;self.domain=opts.apidomain;self.channelTags=opts.packagechannelurl;self.sectionClasses=opts.sectionclasses?opts.sectionclasses:'mh-60';self.attrTarget=opts.attrtarget?opts.attrtarget:'';self.date=new Date();self.todaysdate=self.date.getFullYear()+"-"+(self.date.getMonth()+1)+"-"+self.date.getDate();self.truncate=function(string,length,mobilelength){if($(window).width()>=768){if(string.length<=length){return string;}
return string.substring(0,length)+'...';}
else{if(string.length<=mobilelength){return string;}
return string.substring(0,mobilelength)+'...';}};self.on('before-mount',function(){if(app[self.channelTags+self.todaysdate]!=undefined){self.model=app[self.channelTags+self.todaysdate];}
else{self.tempUrl=opts.apidomain+"/selfservice/epgapi/?schedule/schedulesByTag;date="+self.todaysdate+";channelTags="+self.channelTags+";view=Compact";site.trigger("setdata",self.tempUrl,"GET","","pack"+opts.packagename+self.todaysdate,"pack"+opts.packagename+self.todaysdate,10);}});self.on('mount',function(){if(app[self.channelTags+self.todaysdate]!=undefined){self.model=app[self.channelTags+self.todaysdate];}
else{self.tempUrl=opts.apidomain+"/selfservice/epgapi/?schedule/schedulesByTag;date="+self.todaysdate+";channelTags="+self.channelTags+";view=Compact";site.trigger("setdata",self.tempUrl,"GET","","pack"+opts.packagename+self.todaysdate,"pack"+opts.packagename+self.todaysdate,10);}});site.on("pack"+opts.packagename+self.todaysdate+"-loading-success",function(data,result){if(result){self.model=data;self.update();setTimeout(function(){self.intitsliders();},50);}else{console.log("failed to get "+opts.packagename+" data",data);}});site.on("makeslideactive",function(slidename){if(slidename==opts.packagename){if(!self.display){self.display=true;self.update();if(!self.loaded){self.loaded;self.intitsliders();}}}else{self.display=false;self.update();}});self.intitsliders=function(){$(self.root).find('.show-slider-holder').each(function(){var $holder=jQuery(this);if($holder.hasClass("initialised")){}
else{$(".watch-section .slick-slide").addClass("slick-active");$holder.addClass("initialised")
var $container=$holder.closest('.slide-holder');var $slickSlider=$holder.find('.show-slider');var disabledClass='slick-disabled';var initialClass='initial-state';var fakePrevBtn=jQuery('<button class="fake-slick-prev slick-arrow"><span class="icon-ico-arrow-next"></span></button>');var fakeNextBtn=jQuery('<button class="fake-slick-next slick-arrow"><span class="icon-ico-arrow-next"></span></button>');$container.addClass(initialClass);$holder.append(fakePrevBtn);$holder.append(fakeNextBtn);$slickSlider.on('init',function(e,slick){});$slickSlider.slick({slidesToScroll:5,slidesToShow:5,prevArrow:'<button class="slick-prev"><span class="icon-ico-arrow-next"></span></button>',nextArrow:'<button class="slick-next"><span class="icon-ico-arrow-next"></span></button>',appendArrows:$holder,infinite:false,waitForAnimate:false,responsive:[{breakpoint:2100,settings:{slidesToShow:5,slidesToScroll:5,}},{breakpoint:1600,settings:{slidesToShow:5,slidesToScroll:5,}},{breakpoint:1200,settings:{slidesToShow:4,slidesToScroll:4,}},{breakpoint:768,settings:{slidesToShow:2,slidesToScroll:2,}},{breakpoint:560,settings:{slidesToShow:1,slidesToScroll:1,}}],});$slickSlider.on('beforeChange',function(event,slick,currentSlide,nextSlide){var flippedSlides=slick.$slides.filter('.is-flipped');if(flippedSlides.length){flippedSlides.find('.is-flipped').removeClass('is-flipped')
flippedSlides.removeClass('is-flipped');}});$slickSlider.on('afterChange',function(event,slick,currentSlide){});$slickSlider.on('swipe',function(event,slick,direction){if(direction==='left'){event.preventDefault();if($container.hasClass(initialClass)){$container.removeClass(initialClass);if(slick.currentSlide>0){$container.removeClass(initialClass);setTimeout(function(){$slickSlider.slick('slickGoTo',0,true)},1)}}}
if(direction==='right'){if(slick.currentSlide===0){$container.addClass(initialClass);}}});$holder.on('click','.fake-slick-next',function(e){e.preventDefault();var $btnPrev=$holder.find('.slick-prev');if($btnPrev.hasClass(disabledClass)){$container.removeClass(initialClass);}});$holder.on('click','.fake-slick-prev',function(e){e.preventDefault();var $btnPrev=$holder.find('.slick-prev');if($btnPrev.hasClass(disabledClass)){$container.addClass(initialClass);}});}});}});riot.tag2('tag-channels-no','<span if="{channels != undefined}"> {getchannelsCount()} </span>','','',function(opts){var self=this;self.on('before-mount',function(){if(app["allchannels"]!=undefined){app.allchannels.entities.sort(function(a,b){return a.properties.ChannelNumber-b.properties.ChannelNumber});var availchannels=app.allchannels.entities.filter(item=>item.properties.ChannelPackages.length>-1);if(self.opts.package!=undefined){var availchannelsforSelectedPack=availchannels.filter(item=>item.properties.ChannelPackages.includes(parseInt(self.opts.package.properties.Id)));var unavailchannelsforSelectedPack=availchannels.filter(item=>!item.properties.ChannelPackages.includes(parseInt(self.opts.package.properties.Id)));var allavailunavailchannels=availchannelsforSelectedPack.concat(unavailchannelsforSelectedPack);app.allchannels.entities=[];app.allchannels.entities=allavailunavailchannels;self.channels=app["allchannels"];}else{app.allchannels.entities=availchannels;self.channels=app["allchannels"];}
self.channels=app["allchannels"];}
else{site.trigger("setdata",window.culture+"/channels/ujson?descendants=Channel&select=channelName,ChannelGenre,ChannelPackages,ChannelLogo,AudioChannel,ChannelNumber&resolveToIds=ChannelGenre,ChannelPackages&resolveMedia=ChannelLogo"+window.cdv,"GET","","allchannels","allchannels",10);}});self.on('mount',function(){});site.on("allchannels"+"-loading-success",function(data,result){if(result){self.channels=data;self.update();}else{console.log("failed to get channel data",data);}});self.getchannelsCount=function(){if(opts.package&&app.allchannels&&app.allchannels.entities){self.packageid=parseInt(opts.package.properties.Id);var filtered=_.filter(app.allchannels.entities,function(x){return!x.properties.AudioChannel&&_.indexOf(x.properties.ChannelPackages,self.packageid)>-1});this.root.innerHTML=filtered.length;}}});riot.tag2('tag-background-image','<div class="bg-image-holder banner-img" ref="imgHolder"><img alt="image" class="background-image" riot-src="{compiledsrc}{sfx}" style="opacity: 0"></div>','tag-background-image { visibility: visible; }','',function(opts){var self=this;self.bgSrc=opts.bgsrc;self.sfx="";if(!opts.noresize){function getLargest(layouts){var mean=0;Object.keys(layouts).forEach(function(k,i){if(layouts[k].max>=max&&layouts[k].min<=max){mean=layouts[k].mean;}});return mean;}
self.parallax=opts.parallax?opts.parallax:false;var layouts={lg:{max:9999,min:1200,mean:1600},md:{max:1199,min:992,mean:1000},sm:{max:991,min:768,mean:800},xs:{max:767,min:1,mean:600}};var w=$(document).width();var h=$(window).height();var max=w>h?w:h;var min=max*(9/16);var o="l";var proportion=(9/16);if(opts.orientation){if(opts.orientation==="landscape"){o="l";}
else if(opts.orientation==="portrait"){o="p";}
else{o=w>h?"l":"p";}}
else{o=w>h?"l":"p";}
max=getLargest(layouts);if(opts.keepratio==="true"){if(o==="l")
self.sfx="?width="+max;else
self.sfx="?height="+max;}
else{if(o==="l")
self.sfx="?anchor=center&mode=crop&width="+max+"&height="+min;else
self.sfx="?anchor=center&mode=crop&width="+min+"&height="+max;}}
var bgpos="";self.compiledsrc=self.opts.bgsrc.replace("&amp;","&");if(opts.imagepos==="right"){}
self.on("mount",function(){if(opts.parallax){$(self.refs.imgHolder).parallax({imageSrc:opts.bgsrc.replace("&amp;","&")}).addClass("par-container");}
else{$(self.refs.imgHolder).attr('style','background-color: transparent; background-image: url("'+self.bgSrc.replace("&amp;","&")+self.sfx+'")'+bgpos);}
setTimeout(function(){$(self.refs.imgHolder).addClass('fadeIn');},200);});});riot.tag2('tag-compare-packages','<section class="pt-7 pb-0 compare-header"> <div class="container"> <yield></yield> <div if="{dstvApp.DualCurrency == \'on\' && dstvApp.DualCurrencyCountryList.includes(dstvApp.countryabbreviation) && !notDualCurrency}" class="currencyToggle"><span class="currencyWord">Currency</span><label class="switch"><input onclick={onCurrencyToggle} class="switch-input" type="checkbox" checked /><span class="switch-label" data-on="USD" data-off="ETB"></span><span class="switch-handle"></span> </label></div> </div></section><section class="pb-4 pt-0"> <div class="container"> <div class="row pb-2 pt-5 change-package compare-packages"> <div class="col-xs-12"> <ul if="{packagesList}" class="packages"> <li each="{package, index in packagesList}"> <div class="compare"> <div> <div class="package-block" onclick="{() => selectpackage(package);}"> <div class="package-image img-bg" if="{package.properties.ProductImage != \'\'}" riot-style="background-image: url({package.properties.ProductImage})"></div> <div class="package-image img-bg" if="{package == undefined || package.properties.ProductImage == \'\'}"></div> <div class="package-name "> {package.properties.PackageName.replace(\'DStv \',\'\')} </div> <div class="pricebar" style="margin-top:-7px"> <div class="channels" if="{package}">{package.properties.ChannelCount} {langTranslateApp.pkgSliderChannels}</div> <div class="pack-price" if="{package.properties.Price && !app.dualCurrencyApplicable && !notDualCurrency}">{dstvApp.countrycurrency.toUpperCase() +" "+ package.properties.Price + package.properties.PriceLetter}</div> <div class="pack-price" if="{package.properties.Price && app.dualCurrencyApplicable && !notDualCurrency}">{dstvApp.countrycurrency.toUpperCase() +" "+ package.properties.localPrice.price + package.properties.PriceLetter}</div> <div class="pack-price" if="{package.properties.Price && notDualCurrency}">{dstvApp.countrycurrency.toUpperCase() +" "+ package.properties.Price + package.properties.PriceLetter}</div> </div> <span class="icon-Tick_large check-select {\'selected\' : selected1 == package || selected2 == package} "></span> </div> </div> </div> </li> </ul> <h1 class="page-header" if="{addOnList && addOnList.length}" >{langTranslateApp.addonpackages}</h1> <ul class="packages"> <li each="{package, index in addOnList}"> <div class="compare"> <div> <div class="package-block" onclick="{() => selectpackage(package);}"> <div class="package-image img-bg" if="{package.properties.ProductImage != \'\'}" riot-style="background-image: url({package.properties.ProductImage})"></div> <div class="package-image img-bg" if="{package == undefined || package.properties.ProductImage == \'\'}"></div> <div class="package-name "> {package.properties.PackageName.replace(\'DStv \',\'\')} </div> <div class="pricebar" style="margin-top:-7px"> <div class="channels" if="{package}">{package.properties.ChannelCount} {langTranslateApp.pkgSliderChannels}</div> <div class="pack-price" if="{package.properties.Price && !app.dualCurrencyApplicable && !notDualCurrency}">{dstvApp.countrycurrency.toUpperCase() +" "+ package.properties.Price + package.properties.PriceLetter}</div> <div class="pack-price" if="{package.properties.Price && app.dualCurrencyApplicable && !notDualCurrency}">{dstvApp.countrycurrency.toUpperCase() +" "+ package.properties.localPrice.price + package.properties.PriceLetter}</div> <div class="pack-price" if="{package.properties.Price && notDualCurrency}">{dstvApp.countrycurrency.toUpperCase() +" "+ package.properties.Price + package.properties.PriceLetter}</div> </div> <span class="icon-Tick_large check-select {\'selected\' : selected1 == package || selected2 == package} "></span> </div> </div> </div> </li> </ul> </div> </div> </div></section><section class="bg-dark compare-packs" id="comaparesection" if="{selected1 || selected2}"> <div class="container"> <div class="row"> <div class="col-sm-6" if=""> <div if="{selected1 != undefined}"> <div class="package-block"> <div class="package-image img-bg" if="{selected1.properties.ProductImage != \'\'}" riot-style="background-image: url({selected1.properties.ProductImage})"> <div class="package-logo"><img riot-src="{selected1.properties.PackageLogo}"></div> </div> <div class="pricebar" style="margin-top:-7px"> <div class="channels" if="{selected1}">{selected1.properties.ChannelCount} {langTranslateApp.pkgSliderChannels}</div> <div class="pack-price" if="{selected1.properties.Price && !app.dualCurrencyApplicable && !notDualCurrency}">{dstvApp.countrycurrency.toUpperCase() + " " + selected1.properties.Price + selected1.properties.PriceLetter}</div> <div class="pack-price" if="{selected1.properties.Price && app.dualCurrencyApplicable && !notDualCurrency}">{dstvApp.countrycurrency.toUpperCase() + " " + selected1.properties.localPrice.price + selected1.properties.PriceLetter}</div> <div class="pack-price" if="{selected1.properties.Price && notDualCurrency}">{dstvApp.countrycurrency.toUpperCase() + " " + selected1.properties.Price + selected1.properties.PriceLetter}</div> </div> <div class="package-details"> <div> <tag-raw class="tag-row" content="{selected1.properties.Description}"></tag-raw> </div> <div if="{selected1.properties.ProductMoreLink && selected1.properties.ProductMoreLink != \'\'}"><a href="{selected1.properties.ProductMoreLink}" class="btn btn-default btn-rounded anim-btn" riot-style="background-color: {selected1.properties.PackageColor}"><span class="anim-span"></span>{langTranslateApp.comparePkgFindOutMore}</a></div> </div> </div> </div> </div> <div class="col-sm-6"> <div if="{selected2 != undefined}"> <div class="package-block"> <div class="package-image img-bg" if="{selected2.properties.ProductImage != \'\'}" riot-style="background-image: url({selected2.properties.ProductImage})"> <div class="package-logo"><img riot-src="{selected2.properties.PackageLogo}"></div> </div> <div class="pricebar"> <div class="channels" if="{selected2}">{selected2.properties.ChannelCount} {langTranslateApp.pkgSliderChannels}</div> <div class="pack-price" if="{selected2.properties.Price && !app.dualCurrencyApplicable && !notDualCurrency}">{dstvApp.countrycurrency.toUpperCase() + " " + selected2.properties.Price + selected2.properties.PriceLetter}</div> <div class="pack-price" if="{selected2.properties.Price && app.dualCurrencyApplicable && !notDualCurrency}">{dstvApp.countrycurrency.toUpperCase() + " " + selected2.properties.localPrice.price + selected2.properties.PriceLetter}</div> <div class="pack-price" if="{selected2.properties.Price && notDualCurrency}">{dstvApp.countrycurrency.toUpperCase() + " " + selected2.properties.Price + selected2.properties.PriceLetter}</div> </div> <div class="package-details "> <div class="content-comp"> <tag-raw content="{selected2.properties.Description}"> </div> </tag-raw> <div if="{selected2.properties.ProductMoreLink && selected2.properties.ProductMoreLink != \'\'}"><a href="{selected2.properties.ProductMoreLink}" class="btn btn-default btn-rounded anim-btn" riot-style="background-color: {selected2.properties.PackageColor}"><span class="anim-span"></span>{langTranslateApp.comparePkgFindOutMore}</a></div> </div> </div> </div> </div> </div> <div class="text-center compare-channels-heding"> {langTranslateApp.compareCh} </div> <div class="text-center"><a href="#main-scroll" class="next nextbounce animatedbounce" onclick="() => slideToElement(#compare-channels);" ><span class="fa fa-angle-down"></span></a></div> </div></section><section class="compare-channels mb-10" id="main-scroll" if="{selected1 || selected2}"> <div class="container"> <div class="row"> <div class="col-sm-12"> <div class="tableheadings"> <table class="table" if="{selected1 || selected2}"> <tr> <th colspan="2">{langTranslateApp.pkgSliderChannels}</th> <th class="has-channel" if="{selected1}"><span>{selected1.properties.PackageName.replace(\'DStv \',\'\')}</span></th> <th class="has-channel" if="{selected2}"><span>{selected2.properties.PackageName.replace(\'DStv \',\'\')}</span></th> </tr> <tr class="hide-all"> <td class="channel-logo"></td> <td class="channel-name"></td> <td class="has-channel" if="{selected1}"><span></span></td> <td class="has-channel" if="{selected2}"><span></span></td> </tr> </table> </div> <div class=""> <div class="accordion-area"> <div class="panel-group" id="channels-group"> <div class="panel panel-default" each="{genre, i in allchannelgenres.entities}"> <a data-toggle="collapse" data-parent="#channels-group" href="#{genre.properties.UrlName}" class="panel-heading uppercase collapsed" aria-expanded="true">{genre.properties.GenreName}</a> <div id="{genre.properties.UrlName}" class="panel-collapse collapse {\'in\' : i == 0}" aria-expanded="true" style=""> <div class="panel-body"> <div class="content p-xs-0"> <table class="table channels-table" if="{channels && channels.entities}"> <tr each="{channel in channels.entities}" if="{_.indexOf(channel.properties.ChannelGenre, parseInt(genre.properties.Id)) > -1 && (_.indexOf(channel.properties.ChannelPackages, parseInt(selected1.properties.Id)) > -1 || _.indexOf(channel.properties.ChannelPackages, parseInt(selected2.properties.Id)) > -1)}"> <td class="channel-logo"><img riot-src="{channel.properties.ChannelLogo}"></td> <td class="channel-name">{channel.properties.ChannelName} ({channel.properties.ChannelNumber})</td> <td class="has-channel" if="{selected1}"><span class="{_.indexOf(channel.properties.ChannelPackages, parseInt(selected1.properties.Id)) > -1 ? \'icon-Tick_large\' : \'icon-Close_large not\'} "></span></td> <td class="has-channel" if="{selected2}"><span class="{_.indexOf(channel.properties.ChannelPackages, parseInt(selected2.properties.Id)) > -1 ? \'icon-Tick_large\' : \'icon-Close_large not\'} "></span></td> </tr> </table> </div> </div> </div> </div> </div> </div> </div> </div> </div> </div></section><br>','tag-compare-packages,[riot-tag="tag-compare-packages"],[data-is="tag-compare-packages"]{ visibility: visible; }','',function(opts){var self=this;self.model={};self.storedData="comparepackages";self.dualCurrencyPackages="dualCurrencyPackages";var arrayDualCurrencyContries=[];var arrayDualCurrencies=[];self.notDualCurrency=false;if(dstvApp.countryabbreviation=='mu')
self.notDualCurrency=true;self.on('before-mount',function(){console.log('Compare package started')
if(self.storedData&&app[self.storedData]!=undefined){console.log('Compare package - packages loaded alredy')
var data=app[self.storedData];self.model=data;self.filterAddOns();}
else{console.log('Compare package - package loading started')
site.trigger("setdata",window.culture+"/packages/ujson?descendants=Package&where=canCompare%20eq%20true&select=code,description,Name,newPrice,packageColor,Id,packageLogo,productMoreLink,packageName,price,productImage,productDetail,description,currency,channelCount,PriceLetter,canCompare&resolvemedia=productImage,packageLogo&cdv="+window.cdv,"GET","",self.storedData,self.storedData,1);}
if(app["allchannels"]!=undefined&&!window.reloadData){app.allchannels.entities.sort(function(a,b){return a.properties.ChannelNumber-b.properties.ChannelNumber});var availchannels=app.allchannels.entities.filter(item=>item.properties.ChannelPackages.length>-1);var unavailchannels=app.allchannels.entities.filter(item=>!item.properties.ChannelPackages.length);var allavailunavailchannels=availchannels.concat(unavailchannels);app.allchannels.entities=[];app.allchannels.entities=allavailunavailchannels;self.channels=app["allchannels"];}
else{site.trigger("setdata",window.culture+"/channels/ujson?descendants=Channel&select=channelName,ChannelGenre,ChannelPackages,ChannelLogo,AudioChannel,ChannelNumber&resolveToIds=ChannelGenre,ChannelPackages&resolveMedia=ChannelLogo"+window.cdv,"GET","","allchannels","allchannels",10);}
if(app["allchannelgenres"]!=undefined&&!window.reloadData){self.allchannelgenres=app["allchannelgenres"];}});self.on('mount',function(){setTimeout(function(){self.setSameHeight('.package-image')},200);if(dstvApp.DualCurrency=='on'&&dstvApp.DualCurrencyCountryList.includes(dstvApp.countryabbreviation)&&app.dualCurrencyApplicable!==undefined&&app.dualCurrencyApplicable==true&&dstvApp.countryabbreviation!=='mu'){var setToggleSwitch=function(){$('#toggleSwitch').addClass('jcf-label-active');$('.jcf-checkbox').removeClass('jcf-checked').addClass('jcf-unchecked');$('.switch-input').prop('checked',false);let currencyToggleStatus=$('.switch-input').prop('checked');site.factory.SetCurrency(currencyToggleStatus,dstvApp.countryabbreviation);self.update();};setTimeout(setToggleSwitch,50);}
else if(dstvApp.DualCurrency=='on'&&dstvApp.DualCurrencyCountryList.includes(dstvApp.countryabbreviation)&&app.dualCurrencyApplicable!==undefined&&app.dualCurrencyApplicable==false){var setToggleSwitch=function(){$('#toggleSwitch').removeClass('jcf-label-active');$('.jcf-checkbox').removeClass('jcf-unchecked').addClass('jcf-checked');$('.switch-input').prop('checked',true);let currencyToggleStatus=$('.switch-input').prop('checked');site.factory.SetCurrency(currencyToggleStatus,dstvApp.countryabbreviation);self.update();};setTimeout(setToggleSwitch,50);}else{console.log('Not Dual Currency');}
if(dstvApp.countryabbreviation!=='mu'){self.addDualPackagesToObject();}})
self.selectpackage=function(packageValue){if(self.selected1==packageValue||self.selected2==packageValue){if(self.selected1==packageValue){self.selected1=undefined;}
else{self.selected2=undefined;}}
else{if(self.selected1==undefined){self.selected1=packageValue;}
else if(self.selected1!=undefined&&self.selected2==undefined){self.selected2=packageValue;}}
self.message="";self.state="processing";self.update();if(self.selected1!=undefined&&self.selected2!=undefined){slideToElement('#comaparesection');$('.panel-group').on('shown.bs.collapse',function(){var panel=$(this).find('.in');var prevObjPos=panel.prevObject?panel.prevObject.offset().top:panel.offset().top
$('html, body').animate({scrollTop:panel.offset().top-150},500);});$('#channels-group').find('div[class="panel-collapse collapse in"]').prev('a').attr('class','panel-heading uppercase')}
$(".compare .package-block").click(function(){var src=$('.package-logo img').attr('src').split("/");var imgname=src[3];var srcimg=$.trim(imgname);var img="logo_greatwallmdpi.svg";var img1=$.trim(img);var frech_tounch="layer-2.png";var frech_tounchimg=$.trim(frech_tounch);if(srcimg!=img1){$(".package-logo img").addClass("greatwall-icon");}else{$(".package-logo img").addClass("icon");}
if(srcimg==frech_tounchimg){$(".package-logo img").addClass("frechimg");}else{$(".package-logo img").addClass("icon");}});setTimeout(function(){self.setSameHeight('.package-details')},200);setTimeout(function(){self.setSameHeight('.package-logo')},200);self.ShowHideChannelCategories();}
self.ShowHideChannelCategories=function(){if(self.selected1!=undefined&&self.selected2!=undefined){$('.panel.panel-default').map((index,tbody)=>{if($(tbody).hasClass('hidden'))
$(tbody).removeClass('hidden')})
$('.panel.panel-default table tbody').map((index,tbody)=>{var tbody=$(tbody)
if(tbody.children().length==0){$(tbody.parents()[4]).addClass('hidden')}})}}
site.on(self.storedData+"-loading-success",function(data,result){if(result){self.model=data;self.filterAddOns();self.update();setTimeout(function(){self.setSameHeight('.package-image')},200);}
else{window.consolelog("umbraco comparepackages data failed");}});site.on(self.dualCurrencyPackages+"-loading-success",function(data,result){if(result){self.addDualPackagesToObject();self.update();setTimeout(function(){self.setSameHeight('.package-image')},200);}
else{window.consolelog("umbraco comparepackages data failed");}});site.on("allchannels-loading-success",function(data,result){if(result){self.channels=data;self.update();}else{console.log("failed to get channel data",data);}});site.on("allchannelgenres"+"-loading-success",function(data,result){if(result){self.allchannelgenres=data;self.update();}else{console.log("failed to get channel genres data",data);}});self.setSameHeight=function(item){var theseItems=$(item);var maxHeight=0;$(theseItems).css("height","auto");if($(window).width()>=768){theseItems.each(function(){maxHeight=Math.max(maxHeight,$(this).outerHeight());});theseItems.css({height:maxHeight+'px'});}};self.filterAddOns=function(){self.allPackagesData=self.model.entities;self.addOnList=self.allPackagesData.filter((entity)=>{return dstvApp.AddonPackages.includes(entity.properties.Code)});self.packagesList=self.model.entities.filter((entity)=>{return!dstvApp.AddonPackages.includes(entity.properties.Code)});if(dstvApp.countryabbreviation!=='mu'){self.addDualPackagesToObject();}
self.update();}
self.findDualCountryAndCurrencies=function(){for(var i=0;i<dstvApp.DualCurrenciesList.length;i++){var split=dstvApp.DualCurrenciesList[i].split("-");arrayDualCurrencyContries.push(split[0]);arrayDualCurrencies.push(split[1]);}}
self.onCurrencyToggle=function(e){self.findDualCountryAndCurrencies();let currencyToggleStatus=e.currentTarget.checked;if(currencyToggleStatus!==undefined){site.factory.SetCurrency(currencyToggleStatus,dstvApp.countryabbreviation);}
self.setDualCurrencyFlag();};self.setDualCurrencyFlag=function(){console.log('On setDualCurrencyFlag');self.findDualCountryAndCurrencies();if(arrayDualCurrencies.includes(dstvApp.countrycurrency.toLowerCase())){app.dualCurrencyApplicable=true;window.SessionSave("app",app);}
else{app.dualCurrencyApplicable=false;window.SessionSave("app",app);}}
self.addDualPackagesToObject=function(){if(dstvApp.DualCurrency=='on'&&dstvApp.DualCurrencyCountryList.includes(dstvApp.countryabbreviation)&&app["dualCurrencyPackages"]!=undefined){self.dualCurrencyPackages=app["dualCurrencyPackages"];if((self.packagesList&&self.packagesList!=='undefined')&&(self.dualCurrencyPackages&&self.dualCurrencyPackages!=='undefined')){for(var i=0;i<self.packagesList.length;i++)
{try{let packageCode=self.packagesList[i].properties.Code;let dualCurrencyArray=dstvApp.DualCurrenciesList.filter(item=>item.includes(dstvApp.countryabbreviation));let dualCurrency=dualCurrencyArray[0].split('-')[1];let dualCurrencyPackagePrice=self.dualCurrencyPackages.entities.filter(a=>a.properties.PackageCode.toLowerCase()===packageCode.toLowerCase())[0].properties.Price;self.packagesList[i].properties.localPrice={'currency':dualCurrency,'price':dualCurrencyPackagePrice};}
catch(e){}}}
if((self.addOnList&&self.addOnList!=='undefined')&&(self.dualCurrencyPackages&&self.dualCurrencyPackages!=='undefined')){for(var i=0;i<self.addOnList.length;i++)
{try{let packageCode=self.addOnList[i].properties.Code;let dualCurrencyArray=dstvApp.DualCurrenciesList.filter(item=>item.includes(dstvApp.countryabbreviation));let dualCurrency=dualCurrencyArray[0].split('-')[1];let dualCurrencyPackagePrice=self.dualCurrencyPackages.entities.filter(a=>a.properties.PackageCode.toLowerCase()===packageCode.toLowerCase())[0].properties.Price;self.addOnList[i].properties.localPrice={'currency':dualCurrency,'price':dualCurrencyPackagePrice};}
catch(e){}}}}}});riot.tag2('tag-addon-packages','<section class="pt-7 pb-4 compare-header"> <div class="container "> <yield></yield> <div if="{dstvApp.DualCurrency == \'on\' && dstvApp.DualCurrencyCountryList.includes(dstvApp.countryabbreviation) && !notDualCurrency}" class="currencyToggle"><span class="currencyWord">Currency</span><label class="switch"><input onclick={onCurrencyToggle} class="switch-input" type="checkbox" checked /><span class="switch-label" data-on="USD" data-off="ETB"></span><span class="switch-handle"></span> </label></div> </div></section><section class="bg-dark compare-packs" style="padding-top:90px !important;" id="comaparesection" if="{selected1 || selected2}"> <div class="container"> <div class="row"> <div class="col-sm-6" if=""> <div if="{selected1 != undefined}"> <div class="package-block decoder-package-block"> <div class="package-image img-bg" if="{selected1.properties.ProductImage != \'\'}" riot-style="background-image: url({selected1.properties.ProductImage})"> <div class="package-logo"><img riot-src="{selected1.properties.PackageLogo}"></div> </div> <div class="pricebar" style="margin-top:-7px"> <div class="channels" if="{selected1}"> <tag-channels-no package="{selected1}"></tag-channels-no> {langTranslateApp.pkgSliderChannels} </div> <div class="pack-price" if="{selected1.properties.Price && !app.dualCurrencyApplicable && !notDualCurrency}">{dstvApp.countrycurrency.toUpperCase() +" "+ selected1.properties.Price + selected1.properties.PriceLetter}</div> <div class="pack-price" if="{selected1.properties.Price && app.dualCurrencyApplicable && !notDualCurrency}">{dstvApp.countrycurrency.toUpperCase() +" "+ selected1.properties.localPrice.price + selected1.properties.PriceLetter}</div> <!--Below node is for Mauritius - not to be treated as Dual currency--> <div class="pack-price" if="{selected1.properties.Price && app.dualCurrencyApplicable && notDualCurrency}">{dstvApp.countrycurrency.toUpperCase() +" "+ selected1.properties.Price + selected1.properties.PriceLetter}</div> </div> <div class="package-details"> <div> <tag-raw class="tag-row" content="{selected1.properties.Description}"></tag-raw> </div> <div if="{selected1.properties.ProductMoreLink && selected1.properties.ProductMoreLink != \'\'}"><a href="{selected1.properties.ProductMoreLink}" class="btn btn-default btn-rounded anim-btn" riot-style="background-color: {selected1.properties.PackageColor}"><span class="anim-span"></span>{langTranslateApp.comparePkgFindOutMore}</a></div> </div> </div> </div> </div> <div class="col-sm-6"> <div if="{selected2 != undefined}"> <div class="package-block decoder-package-block"> <div class="package-image img-bg" if="{selected2.properties.ProductImage != \'\'}" riot-style="background-image: url({selected2.properties.ProductImage})"> <div class="package-logo"><img riot-src="{selected2.properties.PackageLogo}"></div> </div> <div class="pricebar" style="margin-top:-7px"> <div class="channels" if="{selected2}"> <tag-channels-no package="{selected2}"></tag-channels-no> {langTranslateApp.pkgSliderChannels} </div> <div class="pack-price" if="{selected2.properties.Price && !app.dualCurrencyApplicable && !notDualCurrency}">{dstvApp.countrycurrency.toUpperCase() +" "+ selected2.properties.Price + selected2.properties.PriceLetter}</div> <div class="pack-price" if="{selected2.properties.Price && app.dualCurrencyApplicable && !notDualCurrency}">{dstvApp.countrycurrency.toUpperCase() +" "+ selected2.properties.localPrice.price + selected2.properties.PriceLetter}</div> <!--Below node is for Mauritius - not to be treated as Dual currency--> <div class="pack-price" if="{selected2.properties.Price && app.dualCurrencyApplicable && notDualCurrency}">{dstvApp.countrycurrency.toUpperCase() +" "+ selected2.properties.Price + selected2.properties.PriceLetter}</div> </div> <div class="package-details "> <div class="content-comp"> <tag-raw content="{selected2.properties.Description}"> </div> </tag-raw> <div if="{selected2.properties.ProductMoreLink && selected2.properties.ProductMoreLink != \'\'}"><a href="{selected2.properties.ProductMoreLink}" class="btn btn-default btn-rounded anim-btn" riot-style="background-color: {selected2.properties.PackageColor}"><span class="anim-span"></span>{langTranslateApp.comparePkgFindOutMore}</a></div> </div> </div> </div> </div> </div> <div class="text-center compare-channels-heding">{langTranslateApp.compareCh}</div> </div></section><section class="compare-channels mb-10" if="{selected1 || selected2}"> <div class="container"> <div class="row"> <div class="col-sm-12"> <div class="tableheadings"> <table class="table" if="{selected1 || selected2}"> <tr> <th colspan="2">{langTranslateApp.pkgSliderChannels}</th> <th class="has-channel" if="{selected1}"><span>{selected1.properties.PackageName.replace(\'DStv \',\'\')}</span></th> <th class="has-channel" if="{selected2}"><span>{selected2.properties.PackageName.replace(\'DStv \',\'\')}</span></th> </tr> <tr class="hide-all"> <td class="channel-logo"></td> <td class="channel-name"></td> <td class="has-channel" if="{selected1}"><span></span></td> <td class="has-channel" if="{selected2}"><span></span></td> </tr> </table> </div> <div class=""> <div class="accordion-area"> <div class="panel-group" id="channels-group"> <div class="panel panel-default" each="{genre, i in allchannelgenres.entities}"> <a data-toggle="collapse" data-parent="#channels-group" href="#{genre.properties.UrlName}" class="panel-heading uppercase" aria-expanded="true">{genre.properties.GenreName}</a> <div id="{genre.properties.UrlName}" class="panel-collapse collapse {\'in\' : i == 0}" aria-expanded="false" style=""> <div class="panel-body"> <div class="content p-xs-0"> <table class="table channels-table" if="{channels && channels.entities}"> <tr each="{channel in channels.entities}" if="{_.indexOf(channel.properties.ChannelGenre, parseInt(genre.properties.Id)) > -1}"> <td class="channel-logo"><img riot-src="{channel.properties.ChannelLogo}"></td> <td class="channel-name">{channel.properties.ChannelNumber} - {channel.properties.ChannelName}</td> <td class="has-channel" if="{selected1}"><span class="{_.indexOf(channel.properties.ChannelPackages, parseInt(selected1.properties.Id)) > -1 ? \'icon-Tick_large\' : \'icon-Close_large not\'} "></span></td> <td class="has-channel" if="{selected2}"><span class="{_.indexOf(channel.properties.ChannelPackages, parseInt(selected2.properties.Id)) > -1 ? \'icon-Tick_large\' : \'icon-Close_large not\'} "></span></td> </tr> </table> </div> </div> </div> </div> </div> </div> </div> </div> </div> </div></section><br>','tag-compare-packages,[riot-tag="tag-compare-packages"],[data-is="tag-compare-packages"]{ visibility: visible; }','',function(opts){var self=this;self.model={};self.storedData="addonpackages";self.AddonPackageCodes=["ASIA3KU","GWALLE36","FRN15E36","ASIAE36","FTAPLE","FRN7E36","FRN15E36","PRWE36","ASIANE36","NNJ2E36","PORTKU"];self.notDualCurrency=false;if(dstvApp.countryabbreviation=='mu')
self.notDualCurrency=true;self.on('before-mount',function(){if(self.storedData&&app[self.storedData]!=undefined){site.trigger("showLoader")
var data=app[self.storedData];self.model=data;self.filterAddOns();}
else{site.trigger("setdata","/packages/ujson?descendants=Package&where=canCompare%20eq%20true&select=code,description,Name,newPrice,packageColor,Id,packageLogo,packageName,price,productImage,productDetail,description,currency,channelCount,PriceLetter,canCompare&resolvemedia=productImage,packageLogo"+window.cdv,"GET","",self.storedData,self.storedData,10);}
if(app["allchannels"]!=undefined){self.channels=app["allchannels"];}
else{site.trigger("setdata",window.culture+"/channels/ujson?descendants=Channel&select=channelName,ChannelGenre,ChannelPackages,ChannelLogo,AudioChannel,ChannelNumber&resolveToIds=ChannelGenre,ChannelPackages&resolveMedia=ChannelLogo"+window.cdv,"GET","","allchannels","allchannels",10);}
if(app["allchannelgenres"]!=undefined){self.allchannelgenres=app["allchannelgenres"];}
else{site.trigger("setdata","/channel-genres/ujson?descendants=ChannelGenre&select=Id,GenreName,UrlName"+window.cdv,"GET","","allchannelgenres","allchannelgenres",10);}});self.on('mount',function(){let arrayDualCurrencyContries=[];let arrayDualCurrencies=[];for(var i=0;i<dstvApp.DualCurrenciesList.length;i++){var split=dstvApp.DualCurrenciesList[i].split("-");arrayDualCurrencyContries.push(split[0]);arrayDualCurrencies.push(split[1]);}
self.onCurrencyToggle=function(e){let currencyToggleStatus=e.currentTarget.checked;if(currencyToggleStatus!==undefined){site.factory.SetCurrency(currencyToggleStatus,dstvApp.countryabbreviation);}
self.setDualCurrencyFlag();};self.setDualCurrencyFlag=function(){console.log('On setDualCurrencyFlag : After Currency Toggle');if(arrayDualCurrencies.includes(dstvApp.countrycurrency.toLowerCase())){app.dualCurrencyApplicable=true;window.SessionSave("app",app);}
else{app.dualCurrencyApplicable=false;window.SessionSave("app",app);}}
self.setDualCurrencyFlag();if(dstvApp.DualCurrency=='on'&&dstvApp.DualCurrencyCountryList.includes(dstvApp.countryabbreviation)&&app["dualCurrencyPackages"]!=undefined&&!window.reloadData){self.dualCurrencyPackages=app["dualCurrencyPackages"];if((self.model&&self.model!=='undefined')&&(self.dualCurrencyPackages&&self.dualCurrencyPackages!=='undefined')){for(var i=0;i<self.model.entities.length;i++)
{try{let packageCode=self.model.entities[i].properties.Code;let dualCurrencyArray=dstvApp.DualCurrenciesList.filter(item=>item.includes(dstvApp.countryabbreviation));let dualCurrency=dualCurrencyArray[0].split('-')[1];let dualCurrencyPackagePrice=self.dualCurrencyPackages.entities.filter(a=>a.properties.PackageCode.toLowerCase()===packageCode.toLowerCase())[0].properties.Price;self.model.entities[i].properties.localPrice={'currency':dualCurrency,'price':dualCurrencyPackagePrice};}
catch(e){}}}
if((self.addOnList&&self.addOnList!=='undefined')&&(self.dualCurrencyPackages&&self.dualCurrencyPackages!=='undefined')){for(var i=0;i<self.addOnList.length;i++)
{try{let packageCode=self.addOnList[i].properties.Code;let dualCurrencyArray=dstvApp.DualCurrenciesList.filter(item=>item.includes(dstvApp.countryabbreviation));let dualCurrency=dualCurrencyArray[0].split('-')[1];let dualCurrencyPackagePrice=self.dualCurrencyPackages.entities.filter(a=>a.properties.PackageCode.toLowerCase()===packageCode.toLowerCase())[0].properties.Price;self.addOnList[i].properties.localPrice={'currency':dualCurrency,'price':dualCurrencyPackagePrice};}
catch(e){}}}}
self.update();})
self.filterAddOns=function(){self.model.entities=self.model.entities.filter((entity)=>{return dstvApp.AddonPackages.includes(entity.properties.Code)});console.log('entities:',self.model.entities);if(self.model.entities.length>0||self.model.entities.length==undefined)
{console.log('entities:',self.model.entities);self.selected1=self.model.entities[0];self.selected2=self.model.entities[1];if(dstvApp.countryabbreviation=='ao'){self.selected1=self.model.entities[1];self.selected2=self.model.entities[2];}
self.message="";self.state="processing";self.update();site.trigger("hideLoader")
setTimeout(function(){$('.panel-group').on('shown.bs.collapse',function(){var panel=$(this).find('.in');$('html, body').animate({scrollTop:panel.offset().top-150},500);});},1000)}
else
{location.href=window.culture+langTranslateApp.subMenuGetComparePackagesLink;}}
self.selectpackage=function(packageValue){if(self.selected1==packageValue||self.selected2==packageValue){if(self.selected1==packageValue){self.selected1=undefined;}
else{self.selected2=undefined;}}
else{if(self.selected1==undefined){self.selected1=packageValue;}
else if(self.selected1!=undefined&&self.selected2==undefined){self.selected2=packageValue;}}
self.message="";self.state="processing";self.update();if(self.selected1!=undefined&&self.selected2!=undefined){slideToElement('#comaparesection');$('#channels-group').find('div[class="panel-collapse collapse in"]').prev('a').attr('class','panel-heading uppercase');}
$(".compare .package-block").click(function(){var src=$('.package-logo img').attr('src').split("/");var imgname=src[3];var srcimg=$.trim(imgname);var img="logo_greatwallmdpi.svg";var img1=$.trim(img);if(srcimg!=img1){$(".package-logo img").addClass("greatwall-icon");}else{$(".package-logo img").addClass("icon");}});setTimeout(function(){self.setSameHeight('.package-details')},200);setTimeout(function(){self.setSameHeight('.package-logo')},200);}
site.on("addonpackages-loading-success",function(data,result){if(result){self.model=data;self.filterAddOns();}
else{window.consolelog("umbraco comparepackages data failed");}});site.on("addonpackages",function(data,result){if(result){self.model=data;self.filterAddOns();}else{console.log("failed to get data",data);}});site.on("allchannels"+"-loading-success",function(data,result){if(result){self.channels=data;self.update();}else{console.log("failed to get channel data",data);}});site.on("allchannelgenres"+"-loading-success",function(data,result){if(result){self.allchannelgenres=data;self.update();}else{console.log("failed to get channel genres data",data);}});self.setSameHeight=function(item){var theseItems=$(item);var maxHeight=0;$(theseItems).css("height","auto");if($(window).width()>=768){theseItems.each(function(){maxHeight=Math.max(maxHeight,$(this).outerHeight());});theseItems.css({height:maxHeight+'px'});}};});riot.tag2('tag-decoders-list','<section class="pt-7 decoddr-compare compare-header"><div class="container "><yield></yield></div><p if="{!hideSelectionSection}" class="selectDecoderText container">{langTranslateApp.selectDecoderText1}<strong>{langTranslateApp.selectDecoderText2}</strong>{langTranslateApp.selectDecoderText3}</p></section><section class="pb-4 pt-0" if="{!hideSelectionSection}"><div class="container"><div class="row pb-2 change-package compare-packages"><div class="col-xs-12"><ul if="{model}" class="decoder-list packages"><li each="{package, index in model.entities}"><div class="compare"><div><div class="package-block" onclick="{() => selectdecoder(package);}"><div class="package-image img-bg" if="{package.properties.ProductImage != \'\'}" riot-style="background-image: url({package.properties.ProductImage})"></div><div class="package-image img-bg" if="{package == undefined || package.properties.ProductImage == \'\'}"></div><div class="package-name ">{package.properties.PackageName.replace(\'DStv \',\'\')}</div><div class="pricebar" style="margin-top:-7px"><div class="pack-price" if="{package.properties.Price}">{currency.toUpperCase() +" "+ package.properties.Price + package.properties.PriceLetter}</div></div> <span class="icon-Tick_large check-select {\'selected\' : selected1 == package || selected2 == package} "></span> </div></div></div></li></ul></div></div></div></section><section class="bg-dark compare-packs" style="padding-top:90px !important;" id="comaparesection" if="{selected1 || selected2}"><div class="container"><div class="row"><div class="col-sm-6" if=""><div if="{selected1 != undefined}"><div class="package-block decoder-package-block"><div class="package-image img-bg" if="{selected1.properties.ProductImage != \'\'}" riot-style="background-image: url({selected1.properties.ProductImage}); min-height: 300px!important;"><div class="package-logo" style="font-size: 24px;font-weight: 100;">{selected1.properties.Name}</div></div><div class="pricebar" style="margin-top:-32px" if="{selected1.properties.Price}"><div class="pack-price" if="{selected1.properties.Price}">{currency.toUpperCase() +" "+ selected1.properties.Price + selected1.properties.PriceLetter} ({langTranslateApp.onceOff})</div></div><div class="package-details"><div><tag-raw class="tag-row" content="{selected1.properties.Description}"></tag-raw></div><div if="{selected1.properties.ProductMoreLink && selected1.properties.ProductMoreLink != \'\'}"><a href="{selected1.properties.ProductMoreLink}" class="btn btn-default btn-rounded anim-btn" riot-style="background-color: {selected1.properties.PackageColor}"><span class="anim-span"></span>{langTranslateApp.comparePkgFindOutMore}</a></div></div></div></div></div><div class="col-sm-6"><div if="{selected2 != undefined}"><div class="package-block decoder-package-block"><div class="package-image img-bg" if="{selected2.properties.ProductImage != \'\'}" riot-style="background-image: url({selected2.properties.ProductImage}); min-height: 300px!important;"><div class="package-logo" style="font-size: 24px;font-weight: 100;">{selected2.properties.Name}</div></div><div class="pricebar" style="margin-top:-32px" if="{selected2.properties.Price}"><div class="pack-price" if="{selected2.properties.Price}">{currency.toUpperCase() +" "+ selected2.properties.Price + selected2.properties.PriceLetter} ({langTranslateApp.onceOff})</div></div><div class="package-details "><div class="content-comp"><tag-raw content="{selected2.properties.Description}"></div></tag-raw><div if="{selected2.properties.ProductMoreLink && selected2.properties.ProductMoreLink != \'\'}"><a href="{selected2.properties.ProductMoreLink}" class="btn btn-default btn-rounded anim-btn" riot-style="background-color: {selected2.properties.PackageColor}"><span class="anim-span"></span>{langTranslateApp.comparePkgFindOutMore}</a></div></div></div></div></div></div><div class="text-center compare-channels-heding">{langTranslateApp.pkgSliderFeature}</div></div></section><main id="main" roll="main" class="single-package-page"><div class="grid-section"><div><div class="row clearfix"><div class="col-md-12 column"><div style="background-position:50%;"><section class="mh-100 bg-white text-w-icons-section mh-60"><div class="container not-mobile" style="top: 0px;"><div><div class="row"><div class="col-sm-8 col-sm-push-2 col-xs-12 col-xs-push-0 text-center"><div class="row"><div><div class="bg-icon-holder"><div class="inline-block desc"> <strong> <h1>{langTranslateApp.decoderFeatureHardw}</h1> </strong> </div></div></div></div></div><div class="col-md-8 col-md-push-2 col-sm-10 col-sm-push-1 col-xs-12 col-xs-push-0 text-center"><div class="text-holder p-3 p-sm-2"><h4></h4> <p>{langTranslateApp.decoderFeatureDescr}</p><p>{langTranslateApp.hdSingleViewThe} <strong>{langTranslateApp.decoderExplora}</strong> {langTranslateApp.decoderExploraDescr}</p><p>{langTranslateApp.hdSingleViewThe} <strong>{langTranslateApp.hdSingleView}</strong> {langTranslateApp.hdSingleViewDesc}</p></div></div></div></div></div></section><section class="compare-channels mb-10" id="main-scroll" if="{selected1 || selected2}"><div class="container"><div class="row"><div class="col-sm-12"><div class="tableheadings"><table class="table" if="{selected1 || selected2}"><tr><th colspan="2">{langTranslateApp.decoderListHeaderFeatures}</th><th class="has-channel" if="{selected1}"><span>{selected1.properties.PackageName.replace(\'DStv \',\'\')}</span></th><th class="has-channel" if="{selected2}"><span>{selected2.properties.PackageName.replace(\'DStv \',\'\')}</span></th></tr><tr class="hide-all"><td class="channel-logo"></td><td class="channel-name"></td><td class="has-channel" if="{selected1}"><span></span></td><td class="has-channel" if="{selected2}"><span></span></td></tr></table></div><div class=""><div class="accordion-area"><div class="panel-group" id="channels-group"><div class="panel-body"><div class="content p-xs-0"><table class="table channels-table" if="{decoderfeatures && decoderfeatures.entities}"><tr each="{decoderfeature in decoderfeatures.entities}" if="_.indexOf(decoderfeature.properties.AssociatedDecoders, parseInt(selected1.properties.Id)) > -1}"><td class="channel-name">{decoderfeature.properties.FeatureName}</td><td class="has-channel" if="{selected1}"><span class="{_.indexOf(decoderfeature.properties.AssociatedDecoders, parseInt(selected1.properties.Id)) > -1 ? \'icon-Tick_large\' : \'icon-Close_large not\'} "></span></td><td class="has-channel" if="{selected2}"><span class="{_.indexOf(decoderfeature.properties.AssociatedDecoders, parseInt(selected2.properties.Id)) > -1 ? \'icon-Tick_large\' : \'icon-Close_large not\'} "></span></td></tr></table></div></div></div></div></div></div></div></div></section></div></div></div></div></div></main>','tag-compare-packages,[riot-tag="tag-compare-packages"],[data-is="tag-compare-packages"]{ visibility: visible; }','',function(opts){var self=this;self.model={};self.storedData="comparedecoders";self.storedFeaturesData="alldecoderfeatures";self.hideSelectionSection=false;self.on('before-mount',function(){if(app.comparedecoders!=undefined&&!window.reloadData){site.trigger("showLoader")
var data=app.comparedecoders;self.model=data;self.filterDecoders();}
else{site.trigger("setdata",window.culture+"/decoders/ujson?descendants=Decoder&select=code,decoderModelNumber,decoderName,productImage&resolvemedia=ProductImage&cdv="+window.cdv,"GET","",self.storedData,self.storedData,10);}
if(app.alldecoderfeatures!=undefined&&!window.reloadData){var availfeatures=app.alldecoderfeatures.entities.filter(item=>item.properties.AssociatedDecoders.length>-1);var unavailfeatures=app.alldecoderfeatures.entities.filter(item=>!item.properties.AssociatedDecoders.length);var allavailunavailfeatures=availfeatures.concat(unavailfeatures);app.alldecoderfeatures.entities=[];app.alldecoderfeatures.entities=allavailunavailfeatures;self.decoderfeatures=app["alldecoderfeatures"];}
else{site.trigger("setdata",window.culture+"/decoder-features-list/ujson?descendants=decoderFeatures&select=featureName,canCompare,featureCode,associatedDecoders&resolveToIds=associatedDecoders&cdv="+window.cdv,"GET","",self.storedFeaturesData,self.storedFeaturesData,3);}
self.currency=dstvApp.countrycurrency;if(dstvApp.DualCurrencyCountryList.includes(dstvApp.countryabbreviation)){let dualCurrencyArray=dstvApp.DualCurrenciesList.filter(item=>item.includes(dstvApp.countryabbreviation));self.currency=dualCurrencyArray[0].split('-')[1];}});self.on('mount',function(){});self.filterDecoders=function(){self.model.entities=self.model.entities.filter(entity=>entity.properties.CanCompare);if(self.model.entities.length>0)
{self.message="";self.state="processing";self.update();site.trigger("hideLoader")
if(self.model.entities.length==2){self.selected1=self.model.entities[0];self.selected2=self.model.entities[1];self.hideSelectionSection=true;}
else if(self.model.entities.length==1){self.selected1=self.model.entities[0];self.hideSelectionSection=true;}}
else
{location.href="/decoders-list/";}}
self.selectdecoder=function(decoderValue){if(self.selected1==decoderValue||self.selected2==decoderValue){if(self.selected1==decoderValue){self.selected1=undefined;}
else{self.selected2=undefined;}}
else{if(self.selected1==undefined){self.selected1=decoderValue;}
else if(self.selected1!=undefined&&self.selected2==undefined){self.selected2=decoderValue;}}
self.message="";self.state="processing";self.update();if(self.selected1!=undefined&&self.selected2!=undefined){slideToElement('#comaparesection');}
setTimeout(function(){self.setSameHeight('.package-details')},200);setTimeout(function(){self.setSameHeight('.package-logo')},200);}
site.on("comparedecoders-loading-success",function(data,result){if(result){self.model=data;self.filterDecoders();self.update();}
else{window.consolelog("umbraco comparedecoders data failed");}});site.on("alldecoderfeatures-loading-success",function(data,result){if(result){var availfeatures=data.entities.filter(item=>item.properties.AssociatedDecoders.length>-1);var unavailfeatures=data.entities.filter(item=>!item.properties.AssociatedDecoders.length);var allavailunavailfeatures=availfeatures.concat(unavailfeatures);app.alldecoderfeatures.entities=[];app.alldecoderfeatures.entities=allavailunavailfeatures;self.decoderfeatures=app["alldecoderfeatures"];self.update();}
else{window.consolelog("umbraco alldecoderfeatures data failed");}});site.on("decoders",function(data,result){if(result){self.model=data;self.filterDecoders();}else{console.log("failed to get data",data);}});self.setSameHeight=function(item){var theseItems=$(item);var maxHeight=0;$(theseItems).css("height","auto");if($(window).width()>=768){theseItems.each(function(){maxHeight=Math.max(maxHeight,$(this).outerHeight());});theseItems.css({height:maxHeight+'px'});}};});riot.tag2('tag-compare-slider','<section class="package-section {opts.sectionclass}"> <yield from="header"></yield> <div class="package-slider homepage-package-slider {dstvApp.countryabbreviation}-homepage-package-slider" if="{model}"> <div class="slide" each="{package, index in model.entities}"> <div class="scene"> <div class="card {\'is-selected\' : selected1 == package || selected2 == package}" packagename="{package.properties.Name}"> <div class="card-face front" riot-style="background-color:{package.properties.PackageColor}"> <div class="bg-holder" if="{package.properties.ProductImage != \'\'}" riot-style="background-image:url({apidomain + package.properties.ProductImage})"></div> <div class="bg-holder" if="{package == undefined || package.properties.ProductImage == \'\'}"></div> <div class="desc"> <div class="heading heading-white"><i class="icon-pack {package.properties.Code == \'GWALLE36\'?\'icon-GreatWall\' : \'icon-\' + package.properties.Code}"></i></div> <strong riot-style="color:{\'#ffffff\'}"><span class="channelNoStyle">{package.properties.ChannelCount} </span></strong><span class="channelWordStyle" riot-style="color:{\'#ffffff\'}">{langTranslateApp.pkgSliderChannels}</span> <div class="text"> <p style="color:#ffffff"> <tag-raw content="{package.properties.Description}" style="display:block"></tag-raw> </p> </div> </div> <div if="{!app.dualCurrencyApplicable}" class="packageCard-Footer" riot-style="background-image:url({apidomain + package.properties.ProductImage})"> <div class="lowholdFooter"><span class="currencyPkgFooter" >{dstvApp.countrycurrency.toUpperCase()}</span><span class="pricePkgFooter" >{package.properties.Price}</span><span class="priceLetterPkgFooter"> { package.properties.PriceLetter}</span><span class="btn-view btn-view-white viewMoreBtnPkgFooter" >{langTranslateApp.pkgSliderViewMore}</span><button class="mobViewMoreBtnPkgFooter bg-gradient-45 arrow-font-color" tabindex="0"><span class="icon-ico-arrow-next"></span></button></div> </div> <div if="{app.dualCurrencyApplicable}" class="packageCard-Footer" riot-style="background-image:url({apidomain + package.properties.ProductImage})"> <div class="lowholdFooter"><span if="{!notDualCurrency}" class="currencyPkgFooter" >{package.properties.localPrice.currency.toUpperCase()}</span><span if="{!notDualCurrency}" class="pricePkgFooter" >{package.properties.localPrice.price}</span><span if="{notDualCurrency}" class="currencyPkgFooter" >{dstvApp.countrycurrency.toUpperCase()}</span><span if="{notDualCurrency}" class="pricePkgFooter" >{package.properties.Price}</span><span class="priceLetterPkgFooter"> { package.properties.PriceLetter}</span><span class="btn-view btn-view-white viewMoreBtnPkgFooter" >{langTranslateApp.pkgSliderViewMore}</span><button class="mobViewMoreBtnPkgFooter bg-gradient-45 arrow-font-color" tabindex="0"><span class="icon-ico-arrow-next"></span></button></div> </div> </div> <div class="card-face back" riot-style="background-color:{package.properties.PackageColor}"> <div class="bg-holder" riot-style="background-image:url({apidomain + package.properties.ProductImage}); opacity: 0.6"></div> <div class="bg-holder" if="{package == undefined || package.properties.ProductImage == \'\'}"></div> <div class="desc"> <div class="body-wrap" riot-style="color:{\'#ffffff\'}"> <span riot-style="color:{\'#ffffff\'}" class="back-title">{langTranslateApp.pkgSliderFeature}</span> <tag-raw-cardback content="{package.properties.PackageFeatures}"></tag-raw-cardback> </div> <div class="low-hold"><a href="{package.properties.ProductMoreLink}" class="btn-view track_compareslider btn-getitnow-white" riot-style="color:{\'#000000\'}">{langTranslateApp.pkgSliderGetItNow}</a></div> </div> </div> </div> </div> </div> </div> <yield from="footer"></yield></section>','tag-compare-slider,[riot-tag="tag-compare-slider"],[data-is="tag-compare-slider"]{ visibility: visible; }','',function(opts){var self=this;self.model={};self.dualcurrencymodel={};self.storedData="comparepackages";self.storedDualCurrencyData="dualCurrencyPackages";self.apidomain="";self.slidersrun=false;self.mixin("tracker");self.currency=opts.currency;self.sliderHeaderHtml='';self.notDualCurrency=false;if(dstvApp.countryabbreviation=='mu')
self.notDualCurrency=true;self.on('before-mount',function(){if(!app[self.storedData])
site.trigger("setdata",window.culture+opts.comparepackages,"GET","",self.storedData,self.storedData,10);else{self.model=app[self.storedData];self.doOperation();}
if(!self.notDualCurrency){if(!app[self.storedDualCurrencyData]&&dstvApp.DualCurrencyCountryList.includes(dstvApp.countryabbreviation))
site.trigger("setdata",window.culture+"/dual-currency-packages/ujson?descendants=dualCurrencyPackage&select=packageName,packageCode,Currency,price&cdv="+window.cdv,"GET","","dualCurrencyPackages","dualCurrencyPackages",3);else{self.dualcurrencymodel=app[self.storedDualCurrencyData];self.modifyPackageSliderData();}}});self.on('mount',function(){setTimeout(function(){if(self.model.properties){self.runsliderJQ();}
self.setSameHeight('.package-image');},200);if(dstvApp.DualCurrencyCountryList.includes(dstvApp.countryabbreviation)&&!self.notDualCurrency){self.modifyPackageSliderData();}})
self.modifyPackageSliderData=function(){if(self.model.entities&&self.model.entities.length>0){for(var i=0;i<self.model.entities.length;i++)
{try{let packageCode=self.model.entities[i].properties.Code;let dualCurrencyArray=dstvApp.DualCurrenciesList.filter(item=>item.includes(dstvApp.countryabbreviation));let dualCurrency=dualCurrencyArray[0].split('-')[1];let dualCurrencyPackagePrice=self.dualcurrencymodel.entities.filter(a=>a.properties.PackageCode.toLowerCase()===packageCode.toLowerCase())[0].properties.Price;self.model.entities[i].properties.localPrice={'currency':dualCurrency,'price':dualCurrencyPackagePrice};}
catch(e){console.log('Error on modifying Package model');}}}}
self.selectpackage=function(packageValue){if(self.selected1==packageValue||self.selected2==packageValue){if(self.selected1==packageValue){self.selected1=undefined;}
else{self.selected2=undefined;}}
else{if(self.selected1==undefined){self.selected1=packageValue;}
else if(self.selected1!=undefined&&self.selected2==undefined){self.selected2=packageValue;}}
self.message="";self.state="processing";self.update();setTimeout(function(){self.setSameHeight('.package-details')},200);setTimeout(function(){self.setSameHeight('.package-logo')},200);}
site.on(self.storedData+"-loading-success",function(data,result){if(result){self.model=data;self.doOperation();}
else{window.consolelog("umbraco home comparepackages data failed");}});self.doOperation=function(){self.update();setTimeout(function(){if(self.model.properties){self.runsliderJQ();}
initFlipClass();self.setSameHeight('.package-image');},200);}
site.on("allchannels"+"-loading-success",function(data,result){if(result){self.channels=data;self.update();}else{console.log("failed to get channel data",data);}});self.setSameHeight=function(item){var theseItems=$(item);var maxHeight=0;$(theseItems).css("height","auto");if($(window).width()>=768){theseItems.each(function(){maxHeight=Math.max(maxHeight,$(this).outerHeight());});theseItems.css({height:maxHeight+'px'});}};self.runsliderJQ=function(){var $slickSlider=jQuery(".homepage-package-slider");if(!self.slidersrun&&!($slickSlider.hasClass('slick-initialized'))){self.slidersrun=true;$slickSlider.slick({rows:1,slidesToScroll:1,slidesToShow:2,prevArrow:'<button class="slick-prev"><span class="icon-ico-arrow-next"></span></button>',nextArrow:'<button class="slick-next"><span class="icon-ico-arrow-next"></span></button>',infinite:false,variableWidth:true,responsive:[{breakpoint:1367,settings:{slidesToShow:2,slidesToScroll:1,variableWidth:true,}},{breakpoint:992,settings:{slidesToShow:2,slidesToScroll:1,variableWidth:false,}},{breakpoint:600,settings:{slidesToShow:1,slidesToScroll:1,variableWidth:false,centerMode:true,}}]});}
$slickSlider.on('beforeChange',function(event,slick,currentSlide,nextSlide){var flippedSlides=slick.$slides.filter('.is-flipped');if(flippedSlides.length){flippedSlides.find('.is-flipped').removeClass('is-flipped')
flippedSlides.removeClass('is-flipped');}});initFlipClass();}});riot.tag2('tag-decoder-slider','<section class="package-section {opts.sectionclass}"> <yield from="header"></yield> <div class="package-slider homepage-decoder-slider {dstvApp.countryabbreviation}-homepage-decoder-slider " if="{model}"> <div class="slide" each="{package, index in model.entities}"> <div class="scene"> <div class="card {\'is-selected\' : selected1 == package || selected2 == package}" packagename="{package.properties.Name}"> <div class="card-face front" riot-style="background-color:{package.properties.PackageColor}"> <div class="bg-holder" if="{package.properties.ProductImage != \'\'}" riot-style="background-image:url(/cdn-cgi/image/width=434,quality=70{apidomain + package.properties.AdditionalProductImage})"></div> <div class="bg-holder" if="{package == undefined || package.properties.ProductImage == \'\'}"></div> <div class="desc"> <div class="heading heading-white">{package.properties.Name}</div> <strong riot-style="color:{\'#ffffff\'}"></strong> <div class="text"> <p style="color:#ffffff"> <tag-raw content="{package.properties.Description}" style="display:block"></tag-raw> </p> </div> </div> <div class="packageCard-Footer" riot-style="background-image:url({apidomain + package.properties.AdditionalProductImage})"> <div class="lowholdFooter"><span class="currencyPkgFooter" if="{package.properties.Price}" >{currency.toUpperCase()}</span><span class="pricePkgFooter" if="{package.properties.Price}">{package.properties.Price}</span><span class="priceLetterPkgFooter"> { package.properties.PriceLetter}</span><span class="btn-view btn-view-white viewMoreBtnPkgFooter">{langTranslateApp.pkgSliderViewMore}</span><button class="mobViewMoreBtnPkgFooter bg-gradient-45 arrow-font-color" tabindex="0"><span class="icon-ico-arrow-next"></span></button></div> </div> </div> <div class="card-face back" riot-style="background-color:{package.properties.PackageColor}"> <div class="bg-holder" riot-style="background-image:url({apidomain + package.properties.AdditionalProductImage}); opacity: 0.6"></div> <div class="bg-holder" if="{package == undefined || package.properties.ProductImage == \'\'}"></div> <div class="desc"> <div class="body-wrap" riot-style="color:{\'#ffffff\'}"> <span riot-style="color:{\'#ffffff\'}" class="back-title">{langTranslateApp.pkgSliderFeature}</span> <tag-raw-cardback content="{package.properties.PackageFeatures}"></tag-raw-cardback> </div> <div class="low-hold"><a href="{package.properties.ProductMoreLink}" class="btn-view track_compareslider btn-getitnow-white" riot-style="color:{\'#000000\'}">{langTranslateApp.pkgSliderGetItNow}</a></div> </div> </div> </div> </div> </div> </div> <yield from="footer"></yield></section>','tag-decoder-slider,[riot-tag="tag-decoder-slider"],[data-is="tag-decoder-slider"]{ visibility: visible; }','',function(opts){var self=this;self.model={};self.storedData="homecomparedecoders";self.apidomain="";self.slidersrun=false;self.mixin("tracker");self.currency=opts.currency;self.hideCurrency=!(window.culture==='/en-zw');self.on('before-mount',function(){site.trigger("setdata",window.culture+opts.comparedecoders,"GET","",self.storedData,self.storedData,10);});self.on('mount',function(){})
self.selectpackage=function(packageValue){if(self.selected1==packageValue||self.selected2==packageValue){if(self.selected1==packageValue){self.selected1=undefined;}
else{self.selected2=undefined;}}
else{if(self.selected1==undefined){self.selected1=packageValue;}
else if(self.selected1!=undefined&&self.selected2==undefined){self.selected2=packageValue;}}
self.message="";self.state="processing";self.update();setTimeout(function(){self.setSameHeight('.package-details')},200);setTimeout(function(){self.setSameHeight('.package-logo')},200);}
site.on(self.storedData+"-loading-success",function(data,result){if(result){self.model=data;self.update();setTimeout(function(){if(self.model.properties){self.runslider();}
initFlipClass();self.setSameHeight('.package-image');},200);}
else{window.consolelog("umbraco home comparepackages data failed");}});site.on("allchannels"+"-loading-success",function(data,result){if(result){self.channels=data;self.update();}else{console.log("failed to get channel data",data);}});self.setSameHeight=function(item){var theseItems=$(item);var maxHeight=0;$(theseItems).css("height","auto");if($(window).width()>=768){theseItems.each(function(){maxHeight=Math.max(maxHeight,$(this).outerHeight());});theseItems.css({height:maxHeight+'px'});}};self.runslider=function(){var $slickSlider=jQuery('.homepage-decoder-slider');self.slidersrun=true;$slickSlider.not('.slick-initialized').slick({rows:1,slidesToScroll:1,slidesToShow:2,prevArrow:'<button class="slick-prev"><span class="icon-ico-arrow-next"></span></button>',nextArrow:'<button class="slick-next"><span class="icon-ico-arrow-next"></span></button>',infinite:false,variableWidth:true,responsive:[{breakpoint:1367,settings:{slidesToShow:2,slidesToScroll:1,variableWidth:true,}},{breakpoint:992,settings:{slidesToShow:2,slidesToScroll:1,variableWidth:false,}},{breakpoint:600,settings:{slidesToShow:1,slidesToScroll:1,variableWidth:false,centerMode:true,}}]});$slickSlider.on('beforeChange',function(event,slick,currentSlide,nextSlide){var flippedSlides=slick.$slides.filter('.is-flipped');if(flippedSlides.length){flippedSlides.find('.is-flipped').removeClass('is-flipped')
flippedSlides.removeClass('is-flipped');}});initFlipClass();}
self.currency=dstvApp.countrycurrency;if(dstvApp.DualCurrencyCountryList.includes(dstvApp.countryabbreviation)){let dualCurrencyArray=dstvApp.DualCurrenciesList.filter(item=>item.includes(dstvApp.countryabbreviation));self.currency=dualCurrencyArray[0].split('-')[1];}});riot.tag2('tag-decoder-detail','<yield></yield><div if="{model}"><div if="{opts.view == \'changepackage\'}"><div class="decoder-block"><div class="decoder-header"><span class="decoder-name"><span if="{decoderNameState == \'normal\'}">{decoderName}</span><input type="text" value="{decoderName}" ref="DeviceName" name="DeviceName" required="required" if="{decoderNameState == \'editing\'}"><input type="hidden" value="{opts.decoder.properties.serialNumber.value}" name="SerialNumber" if="{decoderNameState == \'editing\'}"></span><span class="edit-decoder"><a href="#" onclick="{editDecoderName}" if="{decoderNameState == \'normal\' && decoderNameLoading == \'\'}"><span class="ti ti-pencil"></span></a><a href="#" onclick="{changedDecoderName}" if="{decoderNameState == \'editing\'}"><span class="icon-Tick_large confirm-change"></span></a></span></div><div class="decoder-details" onclick="{() => parent.changeddec(opts.decoder.properties.serialNumber.value)}"><p><strong>S/N. </strong>{opts.decoder.properties.serialNumber.value}<br><strong>{langTranslateApp.pkgSmartcardNumber}. </strong>{opts.decoder.properties.linkedSmartcardSerialNumber.value}<br><strong>Address. </strong><span class="decoder-address">{decoderaddress}</span></p><div class="decoder-image"><img if="{currentDecoder && currentDecoder.properties.ProductImage != \'#\'}" riot-src="{currentDecoder.properties.ProductImage}"><img riot-src="{model.links[1].href}" if="{model.links && model.links.length >= 2 && (currentDecoder == undefined || currentDecoder && currentDecoder.properties.ProductImage == \'#\')}"></div><span class="icon-Tick_large check-select"></span></div></div></div><div class="row" if="{opts.view == \'changepackage-tileview\'}"><div class="col-xs-12"><div class="decoder-block row" onclick="{() => parent.changeddec(opts.decoder.properties.serialNumber.value)}"><div class="decoder-header col-sm-6 col-xs-12 text-center"><div class="decoder-image inline-block" if="{currentDecoder && currentDecoder.properties.ProductImage != \'#\'}" riot-style="background-image:url({currentDecoder.properties.ProductImage});"></div><div class="decoder-image inline-block" riot-style="background-image: url({model.links[1].href});" if="{model.links && model.links.length >= 2 && (currentDecoder == undefined || currentDecoder && currentDecoder.properties.ProductImage == \'#\')}"></div></div><div class="decoder-details col-sm-6 col-xs-12"><span class="decoder-name"><span if="{decoderNameState == \'normal\'}">{decoderName}</span></span><p><strong>S/N. </strong>{opts.decoder.properties.serialNumber.value}<br><strong>{langTranslateApp.pkgSmartcardNumber}. </strong>{opts.decoder.properties.linkedSmartcardSerialNumber.value}<br><strong>Address. </strong><span class="decoder-address">{decoderaddress}</span></p></div><div class="align-bottom"><div class="col-xs-12 decoder-details bottom-select text-center"><div class="inline-block relative checkselect-holder"><span class="icon-Tick_large check-select"></span> Select this device </div></div></div></div></div></div></div>','tag-decoder-detail,[riot-tag="tag-decoder-detail"],[data-is="tag-decoder-detail"]{ visibility: visible; }','',function(opts){var self=this;self.currentDecoder=undefined;self.mixin("tracker");self.model={};self.storedData=undefined;self.storedUmbracoDecoders="umbracodecoders";self.decoderName="Loading...";self.decoderNameState="normal";self.decoderNameLoading="loading";if(opts.decoder!=undefined){self.storedData=opts.decoder.properties.model.value+"-details";}
self.on('before-mount',function(){if(self.storedData&&app[self.storedData]!=undefined){var data=app[self.storedData];self.model=data;}
else{site.trigger("setdata",app.url+"product-details/"+opts.decoder.properties.model.value,"GET","",self.storedData,self.storedData,10);}
if(opts.decoder.properties.serialNumber.value&&app[opts.decoder.properties.serialNumber.value]!=undefined){self.decoderdetail=app[opts.decoder.properties.serialNumber.value];if(app[opts.decoder.properties.serialNumber.value]&&app[opts.decoder.properties.serialNumber.value].entities){app[opts.decoder.properties.serialNumber.value].entities.forEach(function(o,i){if(o.class!==undefined&&o.class[0]==="address"){self.decoderaddress=o.properties.buildingName.value+" "+o.properties.unitNumber.value+" "+o.properties.street.value+", "+o.properties.suburb.value+", "+o.properties.city.value+", "+o.properties.province.value+", "+o.properties.postalCode.value;self.update();}});}}
else{site.trigger("setdata",app.url+"decoders/"+opts.decoder.properties.serialNumber.value,"GET","",opts.decoder.properties.serialNumber.value,opts.decoder.properties.serialNumber.value,10);}
if(self.storedUmbracoDecoders&&app[self.storedUmbracoDecoders]!=undefined){self.umbracodecoders=app[self.storedUmbracoDecoders];self.currentDecoder=_.findWhere(app.umbracodecoders.entities,{title:opts.decoder.properties.model.value});}
self.getDecoderName();});site.on("umbracodecoders-loading-success",function(data,result){if(result){self.umbracodecoders=app[self.storedUmbracoDecoders];self.currentDecoder=_.findWhere(app.umbracodecoders.entities,{title:opts.decoder.properties.model.value});}
else{window.consolelog("umbraco decoders failed");}});site.on(self.storedData,function(data,result){if(result){self.model=data;self.update();}else{console.log("failed to get data",data);}});site.on(opts.decoder.properties.serialNumber.value+"-loading-success",function(data,result){if(result){self.decoderdetail=result;if(app[opts.decoder.properties.serialNumber.value]&&app[opts.decoder.properties.serialNumber.value].entities){app[opts.decoder.properties.serialNumber.value].entities.forEach(function(o,i){if(o.class!==undefined&&o.class[0]==="address"){self.decoderaddress=o.properties.buildingName.value+" "+o.properties.unitNumber.value+" "+o.properties.street.value+", "+o.properties.suburb.value+", "+o.properties.city.value+", "+o.properties.province.value+", "+o.properties.postalCode.value;self.update();}});}}
else{window.consolelog("umbraco decoder detail failed");}});self.getDecoderName=function(){$.ajax({type:"GET",url:app.url+"decoders/"+opts.decoder.properties.serialNumber.value+"/device-name-update",success:function(response){if(response.properties.deviceName.value!==""){self.decoderName=response.properties.deviceName.value;}else{self.decoderName=(opts.decoder.properties.accountFriendlyName&&opts.decoder.properties.accountFriendlyName.value?opts.decoder.properties.accountFriendlyName.value:opts.decoder.properties.model.value);}
self.decoderNameLoading="";self.update();}});}
self.editDecoderName=function(e){e.preventDefault();self.decoderNameState="editing";self.track("change-decoder-name",{result:"clicked pencil",currentName:self.decoderName,decoderaddress:self.decoderaddress,serialNumber:self.opts.decoder.properties.serialNumber.value,smartcard:self.opts.decoder.properties.linkedSmartcardSerialNumber.value});self.update();}
self.changedDecoderName=function(e){e.preventDefault();var deviceName=self.refs.DeviceName.value;var details={"SerialNumber":opts.decoder.properties.serialNumber.value,"DeviceName":deviceName};$.ajax({type:"POST",data:JSON.stringify(details),url:app.url+"decoders/"+opts.decoder.properties.serialNumber.value+"/device-name-update",success:function(response){self.decoderName=deviceName;self.decoderNameState="normal";self.track("change-decoder-name",{result:response.properties.status.value,newName:deviceName,serialNumber:self.opts.decoder.properties.serialNumber.value});self.update();},error:function(response){self.decoderNameState="normal";self.track("change-decoder-name",{result:response.properties&&response.properties.status.value?response.properties.status.value:"error",message:response.Message,serialNumber:self.opts.decoder.properties.serialNumber.value});self.update();}});}});riot.tag2('tag-faq-slider','<div class="faq-box-slider soft-shadow mb-3"><div data-ref="cycleslide" id="faq-box-slider-container" class="branch-holder" data-cycle-fx="{opts.slidereffect}" data-cycle-slides="> div" data-cycle-timeout="{opts.sliderspeed}" data-cycle-prev=".nav-paddle.left" data-cycle-next=".nav-paddle.right"><div class="branch" each="{items}"><div class="box"><span class="quote">“</span><div><div class="text"><p>{Question}</p></div></div></div><div class="text-link text-center v-align-bottm pb-3"><a href="{Url}" class="link display-block mb-0">FAQs</a><span>{Category}</span></div></div></div><span if="{display}" class="nav-paddle left soft-shadow"></span><span if="{display}" class="nav-paddle right soft-shadow"></span></div>','tag-faq-slider,[riot-tag="tag-faq-slider"],[data-is="tag-faq-slider"]{ visibility: visible; }','',function(opts){var self=this;self.display=false;self.items={};self.on("mount",function(){$.getJSON(window.culture+"/umbraco/api/RandomFaq/GetRandomFaqs/?itemcount=5",function(data){self.items=data;if(self.items.length>1){self.display=true;self.update();$(self.refs.cycleslide).cycle();};});});});riot.tag2('tag-form','<form ref="form"><yield></yield><div if="{opts.properties && opts.formview == \'true\'}"><div each="{item, name in opts.properties}"><div data-is="tag-input" type="{item.editable == false || (item.type == \'select\' && item.selectFrom == undefined) ? \'hidden\' : item.type}" validation="{item.validation}" cls="{parent.opts.inputclass}" value="{item.value}" label="{name.camelToTitleCase()}" error="{item.error}" name="{name}" if="{item.type != \'select\' || item.editable == false || (item.type == \'select\' && item.selectFrom == undefined)}"></div><div data-is="tag-select" type="{item.type}" selectoptions="{item.selectFrom}" processaccountnumbers="{parent.opts.processaccountnumbers}" validation="{item.validation}" error="{item.error}" cls="{parent.opts.selectclass}" label="{name.camelToTitleCase()}" defaultoption="Select {name.camelToTitleCase()}" value="{item.value}" name="{name}" if="{item.type == \'select\' && item.editable != false && item.selectFrom != undefined}"></div></div></div><table class="table" if="{opts.properties && opts.formview == \'false\'}"><tr each="{item, name in opts.properties}"><td>{name.camelToTitleCase()}</td><td>{item.value}</td></tr></table></form>','','',function(opts){var self=this;self.mixin("loader");this.on('route',function(){this.message='now loading...';console.log(self.opts.properties);});self.on('mount',function(){var thisform=self.refs.form;self.validator=$(thisform).validate({ignore:".ignore",errorPlacement:function(error,element){error.appendTo($(element).siblings("span.error-holder"));},invalidHandler:function(event,validator){var errors=validator.numberOfInvalids();if(errors){if(validator.errorList[0].element.closest("li")&&!(validator.errorList[0].element.closest("li").className.indexOf("active")>-1)){var accordianurl=validator.errorList[0].element.closest("li").dataset.url;riot.route(accordianurl.replace('#',''));validator.errorList[0].element.focus();}
else{validator.errorList[0].element.focus();}}
self.inactiveAccordion();},onfocusout:function(element){$(element).valid();self.inactiveAccordion()},onkeyup:function(element){if($(element).hasClass("error")){$(element).valid();self.inactiveAccordion()}}});$(document).ready(function(){$(".secure-input").keypress(function(e){if(e.which!=8&&e.which!=0&&(e.which<48||e.which>57)){$("#errmsg").html("Digits Only").show().fadeOut("slow");return false;}});});var cCode=dstvApp.countryabbreviation;$.validator.addMethod("CheckPhoneFormat",function(value,element){if(cCode=='zm'){return value.trim().match(/^$|^(((260))\d{9})$/);}
else if(cCode=='ke'){return value.trim().match(/^$|^(((254))\d{9})$/);}
else if(cCode=='ng'){return value.trim().match(/^$|^(((234))\d{10})$/);}
else if(cCode=='ug'){return value.trim().match(/^$|^(((256))\d{9})$/);}
else if(cCode=='gh'){return value.trim().match(/^$|^(((233))\d{9})$/);}
else if(cCode=='ao'){return value.trim().match(/^$|^(((244))\d{9})$/);}
else if(cCode=='mz'){return value.trim().match(/^$|^(((258))\d{9})$/);}
else if(cCode=='zw'){return value.trim().match(/^$|^(((263))\d{9})$/);}
else if(cCode=='tz'){return value.trim().match(/^$|^(((255))\d{9})$/);}
else if(cCode=='na'){return value.trim().match(/^$|^(((264))\d{9})$/);}},"...");$(thisform).find("input, select, .checkbox-option, .radio-option").on('keyup blur touchstart mouseup',function(){var invalidFields=false;setTimeout(function(){$(thisform).find('input[required]').each(function(i,v){if($(v).val().length<=0){invalidFields=true;}});$(thisform).find('select[required]').each(function(i,v){let selectedVal=$(v).find(":selected").val();if(selectedVal&&selectedVal.length<=0){invalidFields=true;}});$(thisform).find('input[type=checkbox]').each(function(i,v){var req=$(v).attr('required');if(typeof req!==typeof undefined&&req!==false&&$(v).is(":checked")==false){invalidFields=true;}});if($(thisform).find(':input.error').length>0){invalidFields=true;}},500)});});self.inactiveAccordion=function(){setTimeout(function(){$(".accordion-details li").removeClass("invalid");$('.accordion-details li:has(select.error,input.error)').addClass('invalid');},1000)}});riot.tag2('tag-generic','<yield></yield><section class="bg-dark"><div class="container"><div></div></div></section><section class="" if="{model}"><div class="container"><h3>Generic Form</h3><p class="pb-3">Class : {model.class.join(\'-\')}</p><div data-is="tag-form" properties="{model.properties}" formview="true"></div><div class="action-buttons mt-5"><span each="{item in model.actions}"><a href="{site.factory.DisplayUrl(item, app.url)}" data-href="{item.href}" onclick="{parent.actionclick}" class="btn btn-default btn-sm {item.class[0]} {item.method == \'GET\' ? \'get-btn\':\'post-btn\'}" route="{item.class[0]}">{item.class.join(⁗-⁗)}</a></span></div><div class="link-buttons mt-5"><span each="{item in model.links}"><a href="{site.factory.DisplayUrl(item, app.url)}" data-href="{item.href}" onclick="{parent.linkclick}" class="btn btn-link">{item.rel.join(⁗-⁗)}</a></span></div><div class="entity-buttons mt-5"><recurse items="{model.entities}" if="{model.entities}"></recurse></div></div></section>','tag-generic { visibility: visible; } tag-generic .form-control { color: #00aeee; margin-top: 80px; } tag-generic label { display: block; position: absolute; top: -25px; left: 12px; }','',function(opts){var self=this;self.model={};site.on('routeChanged',function(e){console.log(e);if(e==='tag-generic'){console.log("app",e,window.location.hash.Replace('-','_').substr(window.location.hash.lastIndexOf('/')+1));var data=window.location.hash.Replace('-','_').substr(window.location.hash.Replace('-','_').lastIndexOf('/')+1);self.model=app[data];if(self.model==undefined){console.log("no data found app."+data);route("");}else{}}});self.on("*",function(e){console.log("self",e);})
self.on("before-mount",function(e){var data=window.location.hash.substr(window.location.hash.lastIndexOf('/')+1);self.model=app[data];console.log("app",e,window.location.hash.substr(window.location.hash.lastIndexOf('/')+1));})
self.on("mount",function(){self.update();})
self.fetchdataroute=function(url,successroute,errorroute){site.trigger("getdataroute",url,"",successroute,errorroute);}
self.fetchdata=function(url){site.trigger("getdata",url,self.successCallback,self.errorCallback);}
self.successRouteCallback=function(data,router){console.log(data,router);var d=router.substr(router.lastIndexOf('/')+1);app[d]=data;route(router);}
self.successCallback=function(data){self.model=data;self.update();}
self.errorCallback=function(error){console.log(error);}
self.linkclick=function(e){e.preventDefault();var url=e.currentTarget.dataset.href.Replace('https','http');switch(e.item.item.rel.join('_').Replace('-','_')){case "update_personal_details":self.fetchdataroute(url,"/customers/"+app.customernumber+"/updatepersonaldetails","update-personal-details/error");break;default:console.log("route-not-specified");self.fetchdataroute(url,"/generic/"+e.item.item.rel.join('_').Replace('-','_'),"/generic/error");break;}}
self.actionclick=function(e){e.preventDefault();var url=e.currentTarget.dataset.href.Replace('https','http').replace('estimatedQuote=False','estimatedQuote=True');if(e.item.item.method!=undefined&&e.item.item.method==="POST"&&e.item.item.title!="Validate"){self.postdata(url,self.model);}
else if(e.item.item.title=="Validate"){self.validatedata(url,self.model);}
else{switch(e.item.item.class.join('_').Replace('-','_')){case "update_personal_details":self.fetchdataroute(url,"/customers/"+app.customernumber+"/updatepersonaldetails","update_personal_details/error");break;case "cancel":history.back();break;default:console.log("route-not-specified");self.fetchdataroute(url,"/generic/"+e.item.item.class.join('_').Replace('-','_'),"/generic/error");break;}}}
self.postdata=function(url,model){site.factory.setPropertyModel(model,self.tags["tag-form"].refs.form.elements);site.trigger("postdata",url,"POST",model,self.successPostCallback,self.errorPostCallback);}
self.validatedata=function(url,model){site.factory.setPropertyModel(model,self.tags["tag-form"].refs.form.elements);site.trigger("postdata",url,"POST",model,self.successValidateCallback,self.errorValidateCallback);}
self.successPostCallback=function(data){self.model=data;self.update();console.log(data);}
self.errorPostCallback=function(error){var temp2="";console.log(error);}
self.successValidateCallback=function(data){console.log(data);}
self.errorValidateCallback=function(error){var temp2="";console.log(error);}});riot.tag2('tag-getdata','<yield></yield>','','',function(opts){var self=this;this.mixin('promise');self.mixin('tracker');self.on("mount",function(){$('input[name="serialNumber"]').attr("maxlength","10");var errormessage='';var message='';var validationflag=false;if(dstvApp.MultiLanguageCountryList.includes(dstvApp.countryabbreviation)&&!app.loggedin){$('#langDropdown').show();}
if(dstvApp.MultiLanguageCountryList.includes(dstvApp.countryabbreviation)&&!app.loggedin){$('#langDropdownMobile').show();}
if(app.loggedin&&window.reloadData){site.trigger("logout");window.location.reload();return 0;}
if(app.loggedin){if(window.location.pathname==window.culture||window.location.pathname==window.culture+"/")
$('#dashBoardHomeNav').css('display','none')}
if(app.loggedin){$('.fix-error-menu').css({'display':'block'});}
var newWindowWidth=$(window).width();if(newWindowWidth<678){let waitingInterval=setInterval(function(){console.log('waiting for appflayer...'+new Date().getTime())
if($('#af-smart-banner')[0]){clearInterval(waitingInterval)
$('#header').css('top','70px');$('#af-smart-banner').css('position','fixed');$('.afb-close-accessibility-overlay').click(function(){$('#header').css('top','0px');})}},200);setTimeout(function(){clearInterval(waitingInterval);},5000)}
$('#loginLinkLabel').click(function(e){e.preventDefault();let returnURL=window.location.href.includes(dstvApp.DstvThanksURL)?dstvApp.DstvThanksURL:undefined;riot.mount('tag-sign-in',{returnURL:returnURL});});$('#payment-trans-his').click(function(e){e.preventDefault();riot.mount('tag-transactionhistory-modal-popup',{showmodal:true})});self.date=new Date();self.todaysdate=self.date.getFullYear()+"-"+(self.date.getMonth()+1)+"-"+self.date.getDate()+"-"+self.date.getHours()+"-"+self.date.getMinutes()+"-"+self.date.getSeconds();if(app.dictionary==undefined){}
if(app.errorcodelist==undefined||window.reloadData){let errorCodeNode=dstvApp.language=='Portuguese'?'gerir-códigos-de-erro':'manage-error-codes';site.trigger("setdata",window.culture+"/"+errorCodeNode+"/ujson?descendants=ErrorCode&select=code,errorCodeDetail,errorCodeHowToFix,errorCodeName,isResetable,resetCode,headerImage,Name,Url&resolvemedia=headerImage&cdv="+window.cdv,"GET","","errorcodelist","errorcodelist",3);}
if(app.clearerrorcodes==undefined){site.trigger('clearerrorcodes-loading-success')}
if(app.umbracopackages==undefined){site.trigger("setdata",window.culture+"/packages/ujson?descendants=Package&select=code,description,Name,newPrice,packageColor,packageLogo,packageName,price,Id,productImage,currency,channelCount,PriceLetter,canCompare&resolvemedia=productImage&cdv="+window.cdv,"GET","","umbracopackages","umbracopackages",3);}
if(app.comparepackages==undefined||window.reloadData){site.trigger("setdata",window.culture+"/packages/ujson?descendants=Package&where=canCompare%20eq%20true&select=code,description,Name,newPrice,packageColor,Id,packageLogo,productMoreLink,packageName,price,productImage,productDetail,description,currency,channelCount,PriceLetter,packageFeatures,canCompare&resolvemedia=productImage,packageLogo&cdv="+self.todaysdate,"GET","","comparepackages","comparepackages",3);}
if(app.comparedecoders==undefined||window.reloadData){site.trigger("setdata",window.culture+"/decoders/ujson?descendants=Package&where=canCompare%20eq%20true&select=code,description,Name,newPrice,packageColor,Id,packageLogo,productMoreLink,packageName,price,productImage,productDetail,description,canCompare,priceLetter&resolvemedia=productImage,packageLogo&cdv="+self.todaysdate,"GET","","comparedecoders","comparedecoders",3);}
if(app.alldecoderfeatures==undefined||window.reloadData){site.trigger("setdata",window.culture+"/decoder-features-list/ujson?descendants=decoderFeatures&select=featureName,canCompare,featureCode,associatedDecoders&resolveToIds=associatedDecoders&cdv="+self.todaysdate,"GET","","alldecoderfeatures","alldecoderfeatures",3);}
if(app.addonpackages==undefined||window.reloadData){site.trigger("setdata",window.culture+"/packages/ujson?descendants=Package&where=canCompare%20eq%20true&select=code,description,Name,newPrice,packageColor,Id,packageLogo,productMoreLink,packageName,price,productImage,productDetail,description,currency,channelCount,PriceLetter,canCompare&resolvemedia=productImage,packageLogo&cdv="+window.cdv,"GET","","addonpackages","addonpackages",3);}
if(app.allchannels==undefined||window.reloadData){site.trigger("setdata",window.culture+"/channels/ujson?descendants=Channel&select=channelName,ChannelGenre,ChannelPackages,ChannelLogo,AudioChannel,ChannelNumber,IsDraft&resolveToIds=ChannelGenre,ChannelPackages&resolveMedia=ChannelLogo&cdv="+window.cdv,"GET","","allchannels","allchannels",3);}
if(app.allchannelgenres==undefined||window.reloadData||app.allchannelgenres.entities==undefined){let channelNode='channel-genres';switch(dstvApp.countryabbreviation){case 'ng':channelNode='channel-genre-ng';break;case 'bw':channelNode='channel-genre-bw';break;case 'gh':channelNode='channel-genre-gh';break;case 'mw':channelNode='channel-genre-mw';break;case 'ke':channelNode='channel-genre-ke';break;case 'sz':channelNode='channel-genre-sz';break;case 'mu':channelNode='channel-genre-mu';break;case 'cd':channelNode='channel-genre-cd';break;case 'tz':channelNode='channel-genre-tz';break;case 'na':channelNode='channel-genre-na';break;case 'et':channelNode='channel-genre-et';break;case 'ug':channelNode='channel-genre-ug';break;case 'mz':channelNode=dstvApp.languageAbbreviation=='pt'?'channel-genre-mz-pt':'channel-genre-mz-en';break;default:channelNode=dstvApp.languageAbbreviation=='pt'?'channel-genre-pt':'channel-genres';}
let originUrl=window.location.origin+"/"+channelNode+"/ujson?descendants=ChannelGenre&select=Id,GenreName,UrlName&cdv="+window.cdv;site.trigger("setdata",originUrl,"GET","","allchannelgenres","allchannelgenres",3);}
if(app.loggedin&&(app.smartcards==undefined||app.smartcards.length==0)){site.trigger('loadcustomerdata');}
if((app.dualCurrencyPackages==undefined||window.reloadData)&dstvApp.DualCurrency.toLowerCase()==='on'&dstvApp.DualCurrencyCountryList.includes(dstvApp.countryabbreviation)){site.trigger("setdata",window.culture+"/dual-currency-packages/ujson?descendants=dualCurrencyPackage&select=packageName,packageCode,Currency,price&cdv="+self.todaysdate,"GET","","dualCurrencyPackages","dualCurrencyPackages",3);}});self.on("mount",function(){var payerrormessage='';var message='';var validationflag=false;$(".make-secure-pay .make-pay-btn").click(function(){var countryPayDropdown=$('select[name="countrypaydropdown"]').find(":selected").val().toUpperCase();var smartcardNumberPay=$.trim($('input[name="inputpay"]').val());var language='English';var country='Zambia';var exceptionCode='';if(countryPayDropdown==""&&smartcardNumberPay==""){payerrormessage="Please Enter SmartCard Number";payerrormessages="Please Select Country";$("<span id='errmsg'>"+payerrormessage+"</span>").insertAfter(".secure-in-sec");$("<span id='errmsg' class='countmsferror'>"+payerrormessages+"</span>").insertAfter(".dropdown");$('input[name="inputpay"]').focus(function(){$("#errmsg").remove();});setTimeout(function(){$(".countmsferror").remove();},4500);}
else if(smartcardNumberPay==""){payerrormessage="Please Enter SmartCard Number";$("<span id='errmsg'>"+payerrormessage+"</span>").insertAfter(".secure-in-sec");$('input[name="inputpay"]').focus(function(){$("#errmsg").remove();});}
else if(!$.isNumeric(smartcardNumberPay)){payerrormessage=" Please Enter digit Only in Smartcard Number";$("<span id='errmsg'>"+payerrormessage+"</span>").insertAfter(".secure-in-sec");$('input[name="inputpay"]').focus(function(){$("#errmsg").remove();});}
else if(smartcardNumberPay.length<10){payerrormessage="  Entered SmartCard Number less than 10 digit, Please Enter 10 digit Valid SmartCard Number ";$("<span id='errmsg'>"+payerrormessage+"</span>").insertAfter(".secure-in-sec");$('input[name="inputpay"]').focus(function(){$("#errmsg").remove();});}
else if(smartcardNumberPay.length>10){payerrormessage=" Entered SmartCard Number greater than 10 digit, Please Enter 10 digit Valid SmartCard Number ";$("<span id='errmsg'>"+payerrormessage+"</span>").insertAfter(".secure-in-sec");$('input[name="inputpay"]').focus(function(){$("#errmsg").remove();});}
else if(countryPayDropdown==""){payerrormessage="Please Select your Country";$("<span id='errmsg'>"+payerrormessage+"</span>").insertAfter(".dropdown");setTimeout(function(){$("#errmsg").remove();},3000);}
else{alert("PASS");}});$("#logoutLink").click(function(){site.trigger('logout');if(window.location.href.includes('/dstv-thanks')||window.location.href.includes('/reward-list')){window.location=dstvApp.DstvThanksURL;}else{window.location.href=window.location.origin+window.culture;}});if(app.loggedin){$('#loginLinkLabel').hide();$('#loginPopup').show();$('#loginPopupText').html(app.customername);}
else{$('#loginPopup').hide();$('#loginLinkLabel').show();}
$(".get-payment").click(function(){window.location=window.culture+"/ways-to-pay";});if(dstvApp.Dstvthanksfaqscountry.includes(dstvApp.country.toLowerCase())){$(".dstvthanks-faq-button").addClass("hidden");}
else{$(".dstvthanks-faq-button").addClass('');}
window.RewardFunction=function(e){console.log('Checking token...')
var DStvThanksURL="";let culture=dstvApp.countryabbreviation;e.preventDefault();if(app.loggedin){console.log('Generating rewards token...')
var Surname=app.customercontactdetails.Surname;console.log(Surname);var d=new Date();var month=d.getMonth()+1;var day=d.getDate();var year=d.getFullYear();var hours=d.getHours();var minutes=d.getMinutes();var seconds=d.getSeconds();var date=year+""+month+""+day+""+hours+""+minutes+""+seconds;var todaysCurrentTime=date;var smartcard=app.smartcard;var urlEazyTokenAPI="https://eazydstvthanksapi.dstvafrica.com/api/EazyToken";$.ajax({type:'POST',url:urlEazyTokenAPI,crossDomain:true,contentType:'application/json',data:JSON.stringify({"SurName":Surname,"SmartcardNumber":smartcard,"SourceDomain":culture.toUpperCase(),"msisdn":"","CurrentDateTime":todaysCurrentTime}),success:function(response,textStatus,xhr){console.log(response);window.open("https://thanks.dstvafrica.com/Account/DstvLogin?urlstring="+response);},error:function(response,errorThrown){console.log(errorThrown);},complete:function(){}})}
else{window.open("https://thanks.dstvafrica.com/?ref="+culture);}}
var country=dstvApp.country;$("input.contactus-submit").unbind("click").bind('click',function(){$(this).unbind('click');var contactUsDto={FirstName:$("input.contactus-name").val(),Surname:$("input.contactus-surname").val(),CellPhoneNumber:$("input.contactus-contactno").val(),Email:$("input.contactus-email").val(),Smartcardnumber:$("input.contactus-smartcardno").val(),Natureofenquiry:$("#NatureOfEnquiry.contactus-dropdown").val(),Comment:$("#Message.contactus-mesage").val(),QueryType:'Contact Us',AppRoute:window.location.href,Country:country}
site.trigger('showLoader',{messageHeader:"Loading",messageBody:""});var loc=window.location;var baseUrl=loc.protocol+"//"+loc.hostname+(loc.port?":"+loc.port:"");var url=baseUrl+"/umbraco/Api/LeadsForm/SaveContactUsFormData";site.trigger("sendFeedback",url,"POST",contactUsDto,self.SaveContactUsSuccess,self.SaveContactUsError);});self.SaveContactUsSuccess=function(data){site.trigger('hideLoader');}
self.SaveContactUsError=function(data){site.trigger('hideLoader');}
$("input.businessform-submit").click(function(){var businessLeadsDto={FirstName:$("#Name.businessform-name").val(),Surname:$("#Surname.businessform-surname").val(),CellPhoneNumber:$("#ContactNumber.businessform-contactno").val(),Email:$("#Email.businessform-email").val(),SmartcardNumber:$("#SmartCardNumber.businessform-smartcard").val(),NatureOfEnquiry:$("#NatureofEnquiry.businessform-dropdown").val(),Comment:$("#Message.businessform-message").val(),RequestType:$("#RequestType.businessform-customerdropdown").val(),BusinessName:$("input.businessform-businessname").val(),QueryType:'DStv Business',AppRoute:window.location.href,Country:country}
site.trigger('showLoader',{messageHeader:"Loading",messageBody:""});var loc=window.location;var baseUrl=loc.protocol+"//"+loc.hostname+(loc.port?":"+loc.port:"");var url=baseUrl+"/umbraco/Api/LeadsForm/SaveBusinessLeadsFormData";site.trigger("sendFeedback",url,"POST",businessLeadsDto,self.SaveBusinessLeadsSuccess,self.SaveBusinessLeadsError);});self.SaveBusinessLeadsSuccess=function(data){site.trigger('hideLoader');}
self.SaveBusinessLeadsError=function(data){site.trigger('hideLoader');}
$("input.decoder-submit").click(function(e){var url=$(location).attr('href');var parts=url.split("/");var querytype="";if(parts[3]===window.culture.split('/')[1]){querytype=parts[4]}else{querytype=parts[3]}
var decoderLeadsDto={FirstName:$(".package-popup-overlay input#Name.decoder-name").val(),Email:$(".package-popup-overlay input#Email.decoder-email").val()||'noemail@available.com',CellphoneNumber:$(".package-popup-overlay  input#ContactNumber.decoder-contactno").val(),Surname:'NA',RequestType:$(".package-popup-overlay #RequestType.decoder-request").val(),SmartcardNumber:$(".package-popup-overlay input#SmartCardNumber.decoder-smartcard").val(),Comment:$(".package-popup-overlay #Message.decoder-message").val()||'NA',NatureOfEnquiry:$(".package-popup-overlay #NatureofEnquiry.decoder-enquiry").val(),QueryType:querytype,AppRoute:window.location.href,Country:country}
site.trigger('showLoader',{messageHeader:"Loading",messageBody:""});var loc=window.location;var baseUrl=loc.protocol+"//"+loc.hostname+(loc.port?":"+loc.port:"");var url=baseUrl+"/umbraco/Api/LeadsForm/SavePackageDecoderLeadsFormData";site.trigger("sendFeedback",url,"POST",decoderLeadsDto,self.SavePackageDecoderSuccess,self.SavePackageDecoderError);});self.SavePackageDecoderSuccess=function(data){console.log('SavePackageDecoderSuccess'+data);site.trigger('hideLoader');}
self.SavePackageDecoderError=function(data){console.log('SavePackageDecoderError'+data);site.trigger('hideLoader');}
$('#langSelector').change(function(){let selectedLang=$(this).val();window.location.href=`/${selectedLang}-${dstvApp.countryabbreviation}`;})
$('#langSelectorMobile').change(function(){let selectedLang=$(this).val();window.location.href=`/${selectedLang}-${dstvApp.countryabbreviation}`;})});site.on("connectlogin",function(sdata){if(sdata.CustomerNumber===app.customernumber&&app.loggedin){}else{site.trigger("loggedin",sdata);}});site.on("connectlogout",function(){site.trigger("logout");});site.on('logout',function(){localStorage.clear();app.decoders=undefined;app.smartcard=undefined;app.smartcards=undefined;app[app.customernumber]=undefined;app.linkdecoder=undefined;app.holidayviewing={};app.alldecodersloaded=undefined;app.contactdetails=undefined;app.duepaymentaccounts=undefined;app.holidayaccountnumbers=undefined;app.holidaydecodersdata=undefined;app.customernumber="";app.boxofficeaccountnumbers=undefined;app.residentialaccountnumbers=undefined;app.showmaxData=undefined;app.loggedin=undefined;app.customername=undefined;app.eazySigninParam=undefined;app.primaryaccountnumber=undefined;app.accounts=undefined;app.customercontactdetails=undefined;app.customeraddressdetails=undefined;app.suburbsbycity=undefined;app.addressdetails=undefined;app.allcitieslist=undefined;app.finalcitieslist=undefined;app.paymentduedetails=undefined;app.provincelist=undefined;app.boxOfficeMovies=undefined;app.showMaxDetails=undefined;app.topUpAmountList=undefined;app.connection=undefined;app.customerDetails=undefined;app.deadlineTime=undefined;window.SessionRemove("app");window.SessionRemove("app.decoders");window.SessionRemove("app.linkdecoder");window.SessionRemove("app.holidayviewing");window.SessionRemove("app.alldecodersloaded");window.SessionRemove("app.contactdetails");window.SessionRemove("app.duepaymentaccounts");window.SessionRemove("app.holidayaccountnumbers");window.SessionRemove("app.holidaydecodersdata");window.SessionRemove("app.boxofficeaccountnumbers");window.SessionRemove("app.residentialaccountnumbers");window.SessionRemove("app.customernumber");window.SessionRemove("app.primaryaccountnumber");window.SessionRemove("app.showmaxData");window.SessionRemove("app.accounts");window.SessionRemove("app.customercontactdetails");window.SessionRemove("app.customeraddressdetails");window.SessionRemove("app.suburbsbycity");window.SessionRemove("app.addressdetails");window.SessionRemove("app.allcitieslist");window.SessionRemove("app.finalcitieslist");window.SessionRemove("app.paymentduedetails");window.SessionRemove("app.provincelist");window.SessionRemove("app.boxOfficeMovies");window.SessionRemove("app.showMaxDetails");window.SessionRemove("app.topUpAmountList");window.SessionRemove("app.connection");window.SessionRemove("app.customerDetails");window.SessionRemove("app.deadlineTime");site.trigger("loggedout");self.update();});site.on("loadcustomerdata",function(data){var requiredquerystring=`?dataSource=${dstvApp.country}&customerNumber=${app.customernumber}`;var commonquerystring=`&vendorCode=${dstvApp.vendorcode}&businessUnit=${dstvApp.businessunit}&interfaceType=${dstvApp.interfacetype}&language=${dstvApp.language}&ipAddress=`;var newcommonquerystring=`&vendorCode=${dstvApp.vendorcode}&language=${dstvApp.language}&ipAddress=&businessUnit=${dstvApp.businessunit}`;var getproductsurl=`Product/GetProducts${requiredquerystring}${commonquerystring}`;var getcontactdetailsurl=`Customer/GetCustomerDetailsByCustomerNumber${requiredquerystring}${commonquerystring}&currencyCode=${dstvApp.countrycurrency}`;var getaddressdetailsurl=`Address/GetAddresses${requiredquerystring}${newcommonquerystring}`;var getprovincelisturl=`Province/GetProvince?dataSource=${dstvApp.country}${newcommonquerystring}`;var activetenuredetailsurl=`ActiveTenure/GetCustomerActiveTenureDetails${requiredquerystring}&smartCardNumber=&language=${dstvApp.language}&ipAddress=`;self.promise.all(self.promise.setdata(dstvApp.url+activetenuredetailsurl,"GET","","activetenuredetails","activetenuredetails",3)).one("complete",function(a,b,c,d,e){setTimeout(function(){self.all=[a,b,c,d,e];site.trigger("customerloaded",self.all,true);},500);self.update();if(site.requiredInitializeDashboard){var waitingInterval=setInterval(function(){console.log('waiting...'+new Date().getTime())
if(app.loadedpackages){clearInterval(waitingInterval)
console.log('initializeDashboard.....')
site.initializeDashboard();}},500);}});})
site.on("loadcitiessuburb",function(data){var newcommonquerystring=`&vendorCode=${dstvApp.vendorcode}&language=${dstvApp.language}&ipAddress=&businessUnit=${dstvApp.businessunit}`;var getcitieslisturl=`Province/GetCityByProvince?dataSource=${dstvApp.country}&country=${dstvApp.country}&province=${app.customeraddressdetails.Province}&citySearchPattern=&${newcommonquerystring}`;var getsuburbbycitylisturl=`City/GetSuburbByCity?dataSource=${dstvApp.country}&country=${dstvApp.country}&province=${app.customeraddressdetails.Province}&city=${app.customeraddressdetails.City}&vendorCode=${dstvApp.vendorcode}&language=${dstvApp.language}&ipAddress=&businessUnit=${dstvApp.businessunit}`;self.promise.all(self.promise.setdata(dstvApp.url+getcitieslisturl,"GET","","allcitieslist","allcitieslist",3),self.promise.setdata(dstvApp.url+getsuburbbycitylisturl,"GET","","suburbsbycity","suburbsbycity",3)).one("complete",function(a,b){self.update();});})
site.on("customerloaded",function(data,result){self.track("customerloaded",app);});site.on("decoders-loading-success",function(data,result){if(result){self.decoderArray=[];app.activedecoders=[];app.allactivepremiumpackages=[];app.allpackagesonactivedecoders=[];app.allpackagesoninactivedecoders=[];app.allactivepackagesonactivedecoders=[];app.allsuspendedpremiumpackages=[];app.alldisconectedpremiumpackages=[];app["busyloadingdecoders"]=true;if(app.decoders!=undefined&&app.decoders.entities!=undefined){app.decoders.entities[0].entities.forEach(function(o,i){if(!_.contains(o.class,'inactive')){self.decoderArray.push(self.promise.setdata(app.url+"decoders/"+o.properties.linkedSmartcardSerialNumber.value+"/clearerrorcode","GET","","ce"+o.properties.linkedSmartcardSerialNumber.value,"ce"+o.properties.linkedSmartcardSerialNumber.value,3));app.activedecoders.push(o);if(o.entities){o.entities.forEach(function(p,index){if(_.contains(p.class,'package')){p.entities.forEach(function(x,y){app.allpackagesonactivedecoders.push(x);if(x.properties.status.value==langTranslateApp.dashActive){app.allactivepackagesonactivedecoders.push(x);}
if(x.properties.name.value=='PRM'&&x.properties.status.value==langTranslateApp.dashActive){app.allactivepremiumpackages.push(x);}
if(x.properties.name.value=='PRM'&&x.properties.status.value=='Suspended'&&x.properties.chargePeriod.value=='12'){app.allsuspendedpremiumpackages.push(x);}
if(x.properties.name.value=='PRM'&&x.properties.status.value=='Disconnected'){app.alldisconectedpremiumpackages.push(x);}});}});}}
if(_.contains(o.class,'inactive')){if(o.entities){o.entities.forEach(function(p,index){if(_.contains(p.class,'package')){p.entities.forEach(function(x,y){app.allpackagesoninactivedecoders.push(x);if(x.properties.name.value=='PRM'&&x.properties.status.value=='Suspended'&&x.properties.chargePeriod.value=='12'){app.allsuspendedpremiumpackages.push(x);}
if(x.properties.name.value=='PRM'&&x.properties.status.value=='Disconnected'){app.alldisconectedpremiumpackages.push(x);}});}});}}
app.loadedpackages=true;site.trigger("allpackages-loading-success");});self.promise.all(self.decoderArray).one('complete',function(){self.update();app.alldecodersloaded=true;app["busyloadingdecoders"]=false;site.trigger("alldecodersloaded",app.decoders);site.trigger('hideLoader');});}}
else{window.consolelog("decoders failed");}})
site.on("smartcards-loading-success",function(data,result){if(result){app.decoders=[];app.smartcards=[]
if(Array.isArray(data)){data.map((prod)=>{if(prod.IsSmartCard)
app.smartcards.push({ModelUserKey:prod.ModelUserKey,ModelDescription:prod.ModelDescription,SerialNumber:prod.SerialNumber,ProductUserKey:prod.ProductUserKey,ProductDescription:prod.ProductDescription,Status:prod.Status,PsNumber:prod.PsNumber,Services:prod.Services.sort((x,y)=>{return x.PsNumber-y.PsNumber}),HardwareLinkNumber:prod.HardwareLinkNumber})
else
app.decoders.push({ModelUserKey:prod.ModelUserKey,ModelDescription:prod.ModelDescription,SerialNumber:prod.SerialNumber,ProductUserKey:prod.ProductUserKey,ProductDescription:prod.ProductDescription,Status:prod.Status,PsNumber:prod.PsNumber})})
app.loadedpackages=true;app.alldecodersloaded=true;window.SessionSave("app",app);self.update();site.trigger("allpackages-loading-success");site.trigger("alldecodersloaded",app.smartcards);site.trigger('hideLoader');}}
else{window.consolelog("decoders failed");}})
site.on('clearerrorcodes-loading-success',function(){app.clearerrorcodes={"class":["x-form","prelogin-clearErrorCodes"],"properties":{"serialNumber":{"value":"","title":"Serial Number","type":"text","validations":{"required":{"message":"A smartcard number is required","value":true}},"key":"serialNumber"},"surname":{"title":"Surname","type":"text","validations":{"mandatory":{"errorText":"A surname is required","isMandatory":true},"minLength":{"errorText":"Surname should be at least 2 characters","length":2}},"key":"surname"},"errorCode":{"value":"e16","title":"Error","editable":"true","type":"select","key":"errorCode","selectFrom":[{"value":"e16","displayValue":"E16","allowedError":"false"},{"displayValue":"E30","value":"e30","allowedError":"false"},{"displayValue":"E32","value":"e32","allowedError":"false"}]}},"links":[{"rel":["self"],"href":"https://www.dstv.co.za/selfservice/api/zaf/decoders/clearerrorcode/e16?processId=f6e12dc5-6b67-44d7-b263-e44811a22f37&sessionId=1ef2ceef-362f-4d23-992c-d93ff70493f3"}],"actions":[{"class":["next"],"title":"Next","method":"POST","href":"https://www.dstv.co.za/selfservice/api/zaf/decoders/clearerrorcode/e16?processId=f6e12dc5-6b67-44d7-b263-e44811a22f37&sessionId=1ef2ceef-362f-4d23-992c-d93ff70493f3","type":"application/json"}]};window.SessionSave("app.clearerrorcodes",app.clearerrorcodes);})
site.on("contactdetails-loading-success",function(data,result){if(result){var customercontactdetails={"Title":app.contactdetails.customerDetails.salutation,"FirstName":app.contactdetails.customerDetails.FirstName,"Surname":app.contactdetails.customerDetails.surname,"EmailAddress":app.contactdetails.customerDetails.emailAddress,"MobileTel":app.contactdetails.customerDetails.cellNumber,"HomeTel":app.contactdetails.customerDetails.homeTelephone,"WorkTel":app.contactdetails.customerDetails.workTelephone,"FaxTel":app.contactdetails.customerDetails.faxNumber};app.customercontactdetails=customercontactdetails;app.loadedcontactdetails=true;window.SessionSave('app.customercontactdetails',app.customercontactdetails);self.update();site.trigger('hideLoader');}
else{}})
site.on("addressdetails-loading-success",function(data,result){if(result&&app.addressdetails!==null&&app.addressdetails!==undefined){var customeraddressdetails={"Country":app.addressdetails[0].country,"Province":app.addressdetails[0].province,"City":app.addressdetails[0].bigCity,"Suburb":app.addressdetails[0].smallCity,"HouseNumber":app.addressdetails[0].houseNumber,"Street":app.addressdetails[0].street,"PostalCode":app.addressdetails[0].postalCode};app.customeraddressdetails=customeraddressdetails;app.loadedaddressdetails=true;window.SessionSave('app.customeraddressdetails',app.customeraddressdetails);self.update();site.trigger('hideLoader');site.trigger('loadcitiessuburb')}
else{app.customeraddressdetails={};app.loadedaddressdetails=true;}})
site.on("allcitieslist-loading-success",function(data,result){if(result){app.finalcitieslist={CityList:{}};app.finalcitieslist.CityList=app.allcitieslist.CityList;app.loadedcitieslist=true;window.SessionSave('app.finalcitieslist',app.finalcitieslist);self.update();setTimeout(function(){riot.update();},700)}
else{}})
site.on('loadsuburb',function(data){var selectedProvince=data.Province;var selectedCity=data.City;var isfirstload=data.FirstLoad;var getsuburbbycitylisturl=`City/GetSuburbByCity?dataSource=${dstvApp.country}&country=${dstvApp.country}&province=${selectedProvince}&city=${selectedCity}&vendorCode=${dstvApp.vendorcode}&language=${dstvApp.language}&ipAddress=&businessUnit=${dstvApp.businessunit}`;self.promise.all(self.promise.setdata(dstvApp.url+getsuburbbycitylisturl,"GET","","suburbsbycity","suburbsbycity",3)).one("complete",function(a){site.trigger('hideLoader');var ddlSuburb=document.getElementById("ddlSuburb");if(app.customeraddressdetails.Suburb.length==0){ddlSuburb.selectedIndex=0;$('[label="Suburb"] .jcf-select-text span').text('Select Suburb');}
else{ddlSuburb.selectedIndex=app.suburbsbycity.SuburbPostalCodeList.indexOf(app.suburbsbycity.SuburbPostalCodeList.find(x=>x.Suburb.toUpperCase()===app.customeraddressdetails.Suburb.toUpperCase()))+1;if(isfirstload){$('[label="Suburb"] .jcf-select-text span').text('Select Suburb');}
else{$('[label="Suburb"] .jcf-select-text span').text('Select Suburb');}}
site.trigger('hideLoader');$("#ddlSuburb").focus();$("#ddlSuburb")[0].selectedIndex=-1;$("#ddlSuburb").val("");site.trigger('loadsuburb-success');});})
site.on("accounts-loading-success",function(){window.consolelog('GOT ACCOUNTS');site.trigger('getholidayhomesdata');});site.on("getholidayhomesdata",function(){window.consolelog('FETCHING HOLIDAY ACCOUNTS');app.holidayaccountnumbers=[];app.residentialaccountnumbers=[];app.boxofficeaccountnumbers=[];site.trigger("setdata",app.url+"customers/"+app.customernumber+"/linkdecoder","GET","","linkdecoder","linkdecoder",3);if(app.accounts!=undefined&&app.accounts.entities!=undefined){app.accounts.entities.forEach(function(o,i){if(o.properties.type.value==="Holiday Homes"){app.holidayaccountnumbers.push(o.properties.number.value);}
if(o.properties.type.value==="Residential General"){app.residentialaccountnumbers.push(o.properties.number.value);}
if(o.properties.type.value==="Box Office"){app.boxofficeaccountnumbers.push(o.properties.number.value);}});if(app.holidayaccountnumbers.length>0){app.holidayviewing={};app.holidayviewing.any=false;app.holidayviewing.decoders=[];for(var i=0;i<app.holidayaccountnumbers.length;i++){site.trigger("setdata",app.url+"decoders?accountNumber="+app.holidayaccountnumbers[i],"GET","","holidaydecodersdata"+app.holidayaccountnumbers[i],"holidaydecodersdata",10);window.consolelog('HAS HOLIDAY ACCOUNT : '+app.holidayaccountnumbers[i]);}}
else{window.consolelog('HAS NO HOLIDAY ACCOUNT');site.trigger("noholidaydecodersdata");}}else{window.consolelog('NO USABLE ACCOUNTS FOUND');site.trigger("noholidaydecodersdata");}});site.on("alldecodersloaded",function(data){self.update()});site.on("holidaydecodersdata-loading-success",function(data,success){if(success){window.consolelog("GOT SOME HOLIDAY DECODERS : STARTING TO PROCESS");if(data.entities&&data.entities[0].entities){var setofdecoders=[];data.entities[0].entities.forEach(function(o,i){setofdecoders[i]={status:o.class[1],serialNumber:o.properties.serialNumber.value,model:o.properties.model.value,linkedSmartcardSerialNumber:o.properties.linkedSmartcardSerialNumber.value,remainingViewingDays:o.properties.remainingViewingDays.value,switchBackDate:o.properties.switchBackDate.value,hasswitching:true,hasactivating:true,isChildDevice:o.properties.isChildDevice.value};if((setofdecoders[i].hasswitching||setofdecoders[i].hasactivating)){app.holidayviewing.any=true;}
app.holidayviewing.decoders.push(setofdecoders[i]);});var holidaypromise=[];setofdecoders.forEach(function(o,i){holidaypromise.push(self.promise.setdata(app.url+"decoders/"+o.serialNumber,"GET","",o.serialNumber,o.serialNumber,3));});app.holidayviewing.requiresupdating=false;self.promise.all(holidaypromise).one('complete',function(x,y,z){self.decoders=[x,y,z];self.update();app.allholidaydecodersloaded=true;site.trigger("allholidaydecodersloaded",app.holidayviewing.decoders);site.trigger('hideLoader');});}else{window.consolelog("FAILED TO GET HOLIDAY DECODERS - LIST EMPTY");site.trigger("allholidaydecodersloaded");site.trigger("noholidaydecodersdata");}}else{window.consolelog("FAILED TO GET HOLIDAY DECODERS");site.trigger("noholidaydecodersdata");}})
site.on("setdata",function(url,type,data,store,trigger,retries){self.promise.all(self.promise.setdata(url,type,data,store,trigger,retries)).one('complete',function(a){});});});riot.tag2('tag-google-map-marker','<yield></yield>','','',function(opts){});riot.tag2('tag-google-map','<yield></yield><div class="map-holder interact"><div id="{opts.mapname}" class="g-map" style="width:100%;"></div></div>','tag-google-map { visibility: visible; display: block; } tag-google-map .g-map,[riot-tag="tag-google-map"] .g-map,[data-is="tag-google-map"] .g-map{ margin: 0; padding: 0; width: 100%; height: 100%; }','',function(opts){$(".branch-holder").cycle();function loadMapScript(src,initCallback,tagId){try{var script=document.createElement('script');script.setAttribute('id','gmap_script');script.type='text/javascript';window[tagId]=initCallback;document.body.appendChild(script);script.src=src+tagId;}catch(e){console.log("failed to append google map script");return false;}
return true;}
var self=this;self.markers=[];self.mapAttached=false;self.on('mount',function(){if(!document.getElementById('gmap_script')){self.initialize=function(){if(self.mapAttached){self.initMap();}};self.mapAttached=loadMapScript('//maps.googleapis.com/maps/api/js?key='+opts.apikey+'&libraries=places&v=3&language='+opts.language+'&callback=',self.initialize,"cback");}
self.LoadInstallerCities();});self.longitude=opts.lng?opts.lng:"100.644";self.latitude=opts.lat?opts.lat:"-40.397";self.marker=opts.marker?opts.marker:"/img/map_marker_sml.png";self.markerheight=opts.markerheight?parseInt(opts.markerheight):30;self.markerwidth=opts.markerwidth?parseInt(opts.markerwidth):25;self.zoom=opts.zoom||8;self.map={};self.latlng=[];self.winHeight=$(window).height();var stylesArray=[{"featureType":"water","elementType":"geometry.fill","stylers":[{"color":"#91d3fc"}]},{"featureType":"transit","stylers":[{"color":"#23a7fa"},{"visibility":"off"}]},{"featureType":"road.highway","elementType":"geometry.stroke","stylers":[{"visibility":"on"},{"color":"#b3b3b3"}]},{"featureType":"road.highway","elementType":"geometry.fill","stylers":[{"color":"#ffffff"}]},{"featureType":"road.local","elementType":"geometry.fill","stylers":[{"visibility":"on"},{"color":"#ffffff"},{"weight":1.8}]},{"featureType":"road.local","elementType":"geometry.stroke","stylers":[{"color":"#d7d7d7"}]},{"featureType":"poi","elementType":"geometry.fill","stylers":[{"visibility":"on"},{"color":"#efefef"}]},{"featureType":"administrative","elementType":"geometry","stylers":[{"color":"#d3edfe"}]},{"featureType":"road.arterial","elementType":"geometry.fill","stylers":[{"color":"#ffffff"}]},{"featureType":"road.arterial","elementType":"geometry.fill","stylers":[{"color":"#ffffff"}]},{"featureType":"landscape","elementType":"geometry.fill","stylers":[{"visibility":"on"},{"color":"#efefef"}]},{"featureType":"road","elementType":"labels.text.fill","stylers":[{"color":"#23a7fa"}]},{"featureType":"administrative","elementType":"labels.text.fill","stylers":[{"visibility":"on"},{"color":"#23a7fa"}]},{"featureType":"poi","elementType":"labels.icon","stylers":[{"visibility":"off"}]},{"featureType":"poi","elementType":"labels","stylers":[{"visibility":"off"}]},{"featureType":"road.arterial","elementType":"geometry.stroke","stylers":[{"color":"#23a7fa"}]},{"featureType":"road","elementType":"labels.icon","stylers":[{"visibility":"off"}]},{},{"featureType":"poi","elementType":"geometry.fill","stylers":[{"color":"#efefef"}]}];self.initMap=function(){console.log("Delaers&Installers :  Maps-started-initialize");var mapLatLng=new google.maps.LatLng(self.latitude,self.longitude);var geocoder=new google.maps.Geocoder();var mapOptions={zoom:parseInt(self.zoom),center:mapLatLng,mapTypeId:google.maps.MapTypeId.ROADMAP,styles:stylesArray,zoom:15,};self.map=new google.maps.Map(document.getElementById(opts.mapname),mapOptions);self.markerImg={url:self.marker,size:new google.maps.Size(self.markerwidth,self.markerheight),scaledSize:new google.maps.Size(self.markerwidth,self.markerheight),origin:new google.maps.Point(0,0),anchor:new google.maps.Point(self.markerwidth/2,self.markerheight-self.markerheight/5)};self.infoWindow=new google.maps.InfoWindow({pixelOffset:new google.maps.Size(-80,0)});self.filterValue='';var input=document.getElementById('pac-input');if(input){var destinations=[];self.entities=[];self.isDealer=true;self.isInstaller=true;var customDiv=document.createElement('div');customDiv.setAttribute("id","custom-constrols");customDiv.setAttribute("class","col-sm-12 col-xs-12");var button=document.getElementById('search-input');button.setAttribute("class","col-sm-12 col-xs-12");input.setAttribute("class","col-sm-10 col-xs-10");var inputDiv=document.createElement('div');inputDiv.setAttribute("class","inner-addon left-addon");var searchButton=document.createElement('button');searchButton.setAttribute("class","col-sm-2 col-xs-2");var inputicon=document.createElement('i');inputicon.setAttribute("class","icon-ico-search");searchButton.appendChild(inputicon);searchButton.addEventListener('click',function(){console.log('icon clicked')
self.divClean();var places=$("#pac-input").val().trim();if(places.length==0){return;}
self.loadDealersInstallers(true,places);})
inputDiv.appendChild(searchButton);inputDiv.appendChild(input);customDiv.appendChild(inputDiv);customDiv.appendChild(button);var allswitch=document.createElement('div');allswitch.setAttribute("id","allswitch");allswitch.setAttribute("class","col-sm-12 col-xs-12");var dealerInput=document.createElement('button');var dealer=document.createElement('div');var installer=document.createElement('div');var dealerLabel=document.createElement('span');var installerInput=document.createElement('button');var installerLabel=document.createElement('span');dealer.setAttribute("id","dealer");installer.setAttribute("id","installer");dealer.setAttribute("class","col-sm-6 col-xs-6");installer.setAttribute("class","col-sm-6 col-xs-6");dealerInput.setAttribute("id","switchdealer");dealerInput.setAttribute("type","button");dealerInput.setAttribute("aria-pressed","true");dealerInput.setAttribute("data-toggle","button");dealerInput.setAttribute("class","btn dealer btn-toggle active");dealerInput.setAttribute("autocomplete","off");dealerInput.innerHTML='<div class="handle"></div>';dealerLabel.setAttribute("class","dealer-text");dealerLabel.setAttribute("id","switch-dealer");installerInput.setAttribute("id","switchinstaller");installerInput.setAttribute("type","button");installerInput.setAttribute("aria-pressed","true");installerInput.setAttribute("data-toggle","button");installerInput.setAttribute("class","btn installer btn-toggle active");installerInput.setAttribute("autocomplete","off");installerInput.innerHTML='<div class="handle"></div>';installerLabel.setAttribute("class","installer-text");installerLabel.setAttribute("id","switch-installer");dealerLabel.innerHTML=langTranslateApp.mapDealer;installerLabel.innerHTML=langTranslateApp.mapInstaller;if(!(dstvApp.noDealersCountryList).includes(dstvApp.countryabbreviation)){dealer.appendChild(dealerLabel);dealer.appendChild(dealerInput);}
if(!(dstvApp.noInstallersCountryList).includes(dstvApp.countryabbreviation)){installer.appendChild(installerLabel);installer.appendChild(installerInput);}
allswitch.appendChild(dealer);allswitch.appendChild(installer);customDiv.appendChild(allswitch);dealerInput.addEventListener('click',function(){self.divClean();self.isDealer=!self.isDealer;self.resultDiv(self.entities);});installerInput.addEventListener('click',function(){self.divClean();self.isInstaller=!self.isInstaller;self.resultDiv(self.entities);});button.addEventListener('click',function(){self.divClean();if(navigator.geolocation){navigator.geolocation.getCurrentPosition(function(position){var lat=position.coords.latitude;var lng=position.coords.longitude;urlGoogleAPI="https://maps.googleapis.com/maps/api/geocode/json?latlng="+lat+","+lng+"&sensor=true&key="+opts.apikey;var latLng=new google.maps.LatLng(lat,lng);self.map.setZoom(17);self.map.panTo(latLng);var position=new google.maps.LatLng(lat,lng);var marker=new google.maps.Marker({map:self.map,position:position,title:'Hello!! You are here!',markername:'Hello!! You are here!',optimized:false});$.ajax({type:'POST',url:urlGoogleAPI,success:function(response,textStatus,xhr){var res=response.results[0].address_components.filter((x)=>{if(x.types.includes('locality'))
return x;})
self.getData(res[0].short_name);},error:function(response,errorThrown){console.log(errorThrown);},complete:function(){}})});}else{}});self.divClean=function(){var div=document.getElementById('results-div');if(div){div.remove();document.getElementById('map-markers').innerHTML='';self.markers.forEach(function(marker){marker.setMap(null);});self.markers=[];}}
self.getData=function(short_name){self.showLoader();let dealerSearchResult=self.searchInResponse(self.installerDealersList,short_name)
let installerSearchResult=self.searchInResponse(self.installersList,short_name)
self.entities=dealerSearchResult;self.entities=self.entities.concat(installerSearchResult)
self.entities=self.entities.sort(function(x,y){return x.title&&x.title.localeCompare(y.title)});self.resultDiv(self.entities);self.hideLoader();}
self.searchInResponse=function(list,short_name){if(!list)return[];short_name=short_name.toLowerCase();return list.filter((x)=>{if(x.properties.PhysicalAddress.toLowerCase().includes(short_name)||x.properties.City==short_name)
return x;})}
self.searchInstallerInResponse=function(list,short_name){if(!list)return[];short_name=short_name.toLowerCase();return list.filter((x)=>{if(x.properties.PhysicalAddress.toLowerCase().includes(short_name)||x.properties.City.toLowerCase==short_name)
return x;})}
self.showLoader=function(){$('#dealersLoader').show();}
self.hideLoader=function(){$('#dealersLoader').hide();}
var myCustom=document.getElementById('all-custom');myCustom.appendChild(customDiv);self.resultSlide=function(entities){var markers='';var google_map_div=document.getElementById('map-markers');var faq_box_slider=document.createElement('div');faq_box_slider.setAttribute("class","faq-box-slider soft-shadow mb-3");var branch_holder=document.createElement('div');branch_holder.setAttribute("class","branch-holder");branch_holder.setAttribute("style","margin-top: -370px; overflow: hidden;");branch_holder.setAttribute("data-ref","cycleslide");branch_holder.setAttribute("data-cycle-fx","scrollHorz");branch_holder.setAttribute("data-cycle-slides","> div");branch_holder.setAttribute("data-cycle-timeout","0");branch_holder.setAttribute("data-cycle-prev",".nav-paddle.icon-ico-arrow-next.left-soft-shadow");branch_holder.setAttribute("data-cycle-next",".nav-paddle.icon-ico-arrow-next.right-soft-shadow");var nav_paddle_left=document.createElement('span');nav_paddle_left.setAttribute("class","nav-paddle icon-ico-arrow-next left-soft-shadow");var nav_paddle_right=document.createElement('span');nav_paddle_right.setAttribute("class","nav-paddle icon-ico-arrow-next right-soft-shadow");nav_paddle_left.addEventListener("click",function(){var allBranches=$(".branch-holder").children("div.branch").not(".cycle-sentinel");var currentActive=$(".branch.cycle-slide-active").not(".cycle-sentinel");var previous=currentActive[0].previousElementSibling;var target;if(previous==null||$(previous).hasClass("nav-paddle")||$(previous).hasClass("cycle-sentinel")){target=allBranches.last();}else{target=$(previous);}
if(target!=null){target.addClass("active");$(".card.results").removeClass("selected-card");console.log(target[0].id,';;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;')
$("#card-results-"+target[0].id).addClass('selected-card');currentActive.removeClass("active");var targetLatLong=target.data("latlong").split(',');let vName=target.attr('name')
let lat=targetLatLong[0]
let lang=targetLatLong[1]
let address=target.attr('location');let vendorType=target.attr('type');let takeMeThere=$(target).find('a.takeMeThere')[0];let takeMeThereID=undefined;if(takeMeThere)
takeMeThereID=takeMeThere.getAttribute('id');self.onVendorClickShowMarker(vName,address,vendorType,lat,lang,takeMeThereID);}});nav_paddle_right.addEventListener("click",function(){var allBranches=$(".branch-holder").children("div.branch").not(".cycle-sentinel");var currentActive=$(".branch.cycle-slide-active").not(".cycle-sentinel");var next=currentActive[0].nextElementSibling;var target;if(next==null||$(next).hasClass("nav-paddle")||$(next).hasClass("cycle-sentinel")){target=allBranches.first();}else{target=$(next);}
if(target!=null){target.addClass("active");$(".card.results").removeClass("selected-card");$("#card-results-"+target[0].id).addClass('selected-card');currentActive.removeClass("active");var targetLatLong=target.data("latlong").split(',');let vName=target.attr('name')
let lat=targetLatLong[0]
let lang=targetLatLong[1]
let address=target.attr('location');let vendorType=target.attr('type');let takeMeThere=$(target).find('a.takeMeThere')[0];let takeMeThereID=undefined;if(takeMeThere)
takeMeThereID=takeMeThere.getAttribute('id');self.onVendorClickShowMarker(vName,address,vendorType,lat,lang,takeMeThereID);}});var zindex=100;entities.forEach(function(branch,index){var activeClass="";var slideClass="";var opecity=""
var isInstaller=branch.properties.BranchCategory.toLowerCase().search('installer')>=0;var map_url=branch.properties.MapLocation?"https://www.google.com/maps/dir/Current+Location/":"#"
if(index===0){activeClass="active";opecity="opacity: 1;"}
var m2fStart=new Date('2019-03-05T07:00:00');var m2fEnd=new Date('2019-03-05T19:00:00');var satStart=new Date(branch.properties.Saturday.Start);var satEnd=new Date(branch.properties.Saturday.End);var sunStart=new Date(branch.properties.Sunday.Start);var sunEnd=new Date(branch.properties.Sunday.End);var name=branch.properties.Name.replace(/&/g," and ").replace(/ /g,"-").replace(/'/g,"").replace(/\./g,"").replace(/\(/g,"-").replace(/\)/g,"-");var location=jQuery(branch.properties.PhysicalAddress).text();var type=isInstaller?"installer":"dealer";var colorClass=isInstaller?"installer-custom":branch.properties.BranchCategory.toLowerCase().search('dealer')>=0?"dealer-custom":""
var footerButton=isInstaller?'<a href="Tel:'+branch.properties.Telephone+'"  class="btn btn-default btn-rounded mb-0 installer-background text-center">'+langTranslateApp.tradingHoursCallInstaller+'</a></div>':branch.properties.BranchCategory.toLowerCase().search('dealer')>=0?'<a id="takeMeThere'+index+'"  href="'+map_url+'" target="_blank" class="takeMeThere btn btn-default btn-rounded mb-0 dealer-background">'+langTranslateApp.tradingHoursTakeMeThere+'</a>':''
footerButton='<div class="col-md-12 col-sm-12 text-center" style="margin-top:0px !important">'+footerButton+'</div>';var tel2=branch.properties.Tel&&branch.properties.Tel.length>5?'<p class="mb-2 tel text-center"><a style="display:block" class="'+colorClass+'" href="Tel:'+branch.properties.Tel+'">Tel 2: '+branch.properties.Tel+'</a></p>':''
var telephone=branch.properties.Telephone&&branch.properties.Telephone.length>5?'<p class="mb-2 tel text-center"><a style="display:block" class="'+colorClass+'" href="Tel:'+branch.properties.Telephone+'">Tel:'+branch.properties.Telephone+'</a></p>':''
var mobile=branch.properties.Telephone&&branch.properties.Telephone.length>5?'<p class="mb-2 tel text-center"><a style="display:block" class="'+colorClass+'" href="Mob:'+branch.properties.Telephone+'">Mob:'+branch.properties.Telephone+'</a></p>':''
var email=branch.properties.Email&&branch.properties.Email.length>5?'<p class="mb-2 tel text-center"><a style="display:block" class="'+colorClass+'" href="Email:'+branch.properties.Email+'">Email:'+branch.properties.Email+'</a></p>':''
let installerProvinceHTML='';if(isInstaller)
if((branch.properties.Province.includes("Province"))&&(window.culture=="/pt-ao")){var splitProvince=branch.properties.Province;splitProvince=splitProvince.replace("Province"," ");splitProvince=langTranslateApp.tradingHoursProvinceDe+" "+splitProvince;installerProvinceHTML=`<div class="installer-custom text-center"><p><strong>${langTranslateApp.tradingHoursProvince} : </strong><span> ${splitProvince||'NA'}</span></p></div>`}
else{installerProvinceHTML=`<div class="installer-custom text-center"><p><strong>${langTranslateApp.tradingHoursProvince} : </strong><span> ${branch.properties.Province||'NA'}</span></p></div>`}
markers+='<div id="'+index+'" name="'+branch.properties.Name.replace(/'/g,"")+'" class="branch '+activeClass+' marker-'+name+'  cycle-slide '+slideClass+'" data-latlong="'+branch.properties.MapLocation.Latitude+','+branch.properties.MapLocation.Longitude+','+branch.properties.MapLocation.Zoom+'" style="position: static; top: 0px; left: 0px; z-index: '+zindex+'; '+opecity+' display: block;" location="'+location+'" type="'+type+'"><h3 class="'+colorClass+'">'+branch.properties.Name+'</h3><div class=" '+colorClass+'"><h4 class="text-center">'+langTranslateApp.tradingHoursLocation+'</h4><h4 id="location-'+index+'" class="locations"></h4></div><div class="'+colorClass+' text-center">'+branch.properties.PhysicalAddress+'</div>'+installerProvinceHTML+'<h4 class="text-center">'+langTranslateApp.tradingHours+'</h4><div class="row"><div class="col-md-6 col-sm-6 trading-hours header">'+langTranslateApp.tradingHoursMondayFriday+':</div><div class="col-md-6 col-sm-6 trading-hours body '+colorClass+'">'+self.getHours(m2fStart)+':'+self.getMinutes(m2fStart)+' - '+self.getHours(m2fEnd)+':'+self.getMinutes(m2fEnd)+'</div></div><div class="row"><div class="col-md-6 col-sm-6 trading-hours header">'+langTranslateApp.tradingHoursSaturday+':</div><div class="col-md-6 col-sm-6 trading-hours body '+colorClass+'">'+self.getHours(m2fStart)+':'+self.getMinutes(m2fStart)+' - '+self.getHours(m2fEnd)+':'+self.getMinutes(m2fEnd)+'</div></div><div class="row"><div class="col-md-6 col-sm-6 trading-hours header">'+langTranslateApp.tradingHoursSunday+':</div><div class="col-md-6 col-sm-6 trading-hours body '+colorClass+'">'+self.getHours(m2fStart)+':'+self.getMinutes(m2fStart)+' - '+self.getHours(m2fEnd)+':'+self.getMinutes(m2fEnd)+'</div></div><p class="tradding-message text-center">'+langTranslateApp.tradingHoursMessage+'</p>'+telephone+tel2+mobile+tel2+email+footerButton+'</div>';zindex-=1;});if(entities.length>0){branch_holder.innerHTML=markers;faq_box_slider.appendChild(branch_holder);faq_box_slider.appendChild(nav_paddle_left);faq_box_slider.appendChild(nav_paddle_right);google_map_div.appendChild(faq_box_slider);$('.branch-holder').cycle();$('.find-dealer-installer-landing .faq-box-slider.soft-shadow.mb-3').hide();}
self.onVendorClickShowMarker=function(name,address,vendorType,lat,lang,takeMeThereID){if(name.indexOf(' ')>-1)
name=name.replace(/ /g,'-');if(lat&&lang&&lat!=='null'&&lang!=='null'&&lat!=='0'&&lang!=='0'){var latLng=new google.maps.LatLng(lat,lang);self.map.setZoom(17);self.map.panTo(latLng);}
else{console.log('Finding location for...')
console.log('Name : '+name);console.log('Address :'+address)
geocoder.geocode({'address':address},function(results,status){if(status==google.maps.GeocoderStatus.OK){let newLat=results[0].geometry.location.lat();let newLgn=results[0].geometry.location.lng();let data={"opts":{"lat":newLat,"lng":newLgn,"type":vendorType,"title":name+' : @ '+newLat+','+newLgn,"markername":newLat+','+newLgn+','+name.replace(/&/g," and ").replace(/ /g,"-").replace(/'/g,"").replace(/\./g,"").replace(/\(/g,"-").replace(/\)/g,"-")}}
self.addMarkerCustom(data);self.map.setZoom(17);self.map.panTo(new google.maps.LatLng(newLat,newLgn));if(takeMeThereID){let oldHref=$("#"+takeMeThereID).attr("href");$("#"+takeMeThereID).attr("href",oldHref+""+newLat+","+newLgn)}}
else{alert("Can't find the location, Try again")
console.log('Unable to find location');}});}}}
self.getHours=function(date){var hours=date.getHours();return hours>9?hours:'0'+hours;}
self.getMinutes=function(date){var minutes=date.getMinutes();return minutes>9?minutes:'0'+minutes;}
self.resultMarkers=function(entities){entities.forEach(function(branch,index){var data={"opts":{"lat":branch.properties.MapLocation.Latitude,"lng":branch.properties.MapLocation.Longitude,"type":branch.properties.BranchCategory.toLowerCase().search('installer')>=0?'installer':'dealer',"title":branch.title+' : @ '+branch.properties.MapLocation.Latitude+','+branch.properties.MapLocation.Longitude,"markername":branch.properties.MapLocation.Latitude+','+branch.properties.MapLocation.Longitude+','+branch.properties.Name.replace(/&/g," and ").replace(/ /g,"-").replace(/'/g,"").replace(/\./g,"").replace(/\(/g,"-").replace(/\)/g,"-")}}
self.addMarkerCustom(data);});}
self.resultDiv=function(entities){var title='';var results=[];if((dstvApp.noInstallersCountryList).includes(dstvApp.countryabbreviation)){self.isInstaller=false;}
var dealers=entities.filter((x)=>{if(x.properties.BranchCategory.toLowerCase().search('dealer')>=0)
return x;})
var installers=entities.filter((x)=>{if(x.properties.BranchCategory.toLowerCase().search('installer')>=0)
return x;})
if(self.isInstaller&&self.isDealer){if(!(dstvApp.noDealersCountryList).includes(dstvApp.countryabbreviation)&&!(dstvApp.noInstallersCountryList).includes(dstvApp.countryabbreviation))
title=dealers.length+' '+langTranslateApp.searchResultResults+' <span class="dealer-custom">'+langTranslateApp.searchResultDealers+'</span> '+langTranslateApp.searchResultAnd+' '+installers.length+' <span class="installer-custom">'+langTranslateApp.searchResultInstallers+'</span> <i id="view-icon-both" class="fa fa-angle-down"></i>';else if(!(dstvApp.noInstallersCountryList).includes(dstvApp.countryabbreviation))
title=installers.length+' '+langTranslateApp.searchResultResults+' <span class="installer-custom">'+langTranslateApp.searchResultInstallers+'</span> <i id="view-icon-both" class="fa fa-angle-down"></i>';else
title=dealers.length+' '+langTranslateApp.searchResultResults+' <span class="dealer-custom">'+langTranslateApp.searchResultDealers+'</span> ';results=entities;}else if(!self.isInstaller&&self.isDealer){if(window.culture=="/pt-ao"){title=dealers.length+' <span class="dealer-custom"> '+langTranslateApp.searchResultResults+'</span> '+langTranslateApp.searchResultDealers+'<i id="view-icon" class="fa fa-angle-down"></i>';}
else{if(!(dstvApp.noDealersCountryList).includes(dstvApp.countryabbreviation))
title=dealers.length+' <span class="dealer-custom">'+langTranslateApp.searchResultDealers+'</span> '+langTranslateApp.searchResultResults+' <i id="view-icon" class="fa fa-angle-down"></i>';else if(!(dstvApp.noInstallersCountryList).includes(dstvApp.countryabbreviation))
title="0"+' <span class="installer-custom">'+langTranslateApp.searchResultInstallers+'</span> '+langTranslateApp.searchResultResults+' <i id="view-icon" class="fa fa-angle-down"></i>';else
title="";}
results=dealers}else if(self.isInstaller&&!self.isDealer){title=installers.length+' <span class="installer-custom">'+langTranslateApp.searchResultInstallers+'</span> '+langTranslateApp.searchResultResults+' <i id="view-icon" class="fa fa-angle-down"></i>';results=installers}else if(!self.isInstaller&&!self.isDealer){title='0 Result';}
var centerControlDiv=document.createElement('div');centerControlDiv.setAttribute("id","results-div");centerControlDiv.setAttribute("class","col-md-3 col-sm-12 col-xs-12");var resultsDiv=document.createElement('div');resultsDiv.setAttribute("id","results");resultsDiv.setAttribute("class","col-md-3 col-sm-12 col-xs-12 collapse");var buttonDiv=document.createElement('button');buttonDiv.setAttribute("id","button-view");buttonDiv.setAttribute("type","button");buttonDiv.setAttribute("class","col-md-3 col-sm-12 col-xs-12 btn btn-info button-close");buttonDiv.setAttribute("aria-expanded","false");buttonDiv.setAttribute("data-toggle","collapse");buttonDiv.setAttribute("data-target","#results");buttonDiv.innerHTML=title;buttonDiv.addEventListener('click',function(){var expanded=document.getElementById('button-view').getAttribute('aria-expanded');console.log(expanded);if(expanded===true||expanded==='true'){$("#view-icon").removeClass("fa-angle-down").addClass("fa-angle-up");$(".faq-box-slider.soft-shadow.mb-3").removeClass("hide-on-modile")
$(this).removeClass("button-open").addClass("button-close");}else{$(".faq-box-slider.soft-shadow.mb-3").addClass("hide-on-modile")
$("#view-icon").removeClass("fa-angle-up").addClass("fa-angle-down");$(this).removeClass("button-close").addClass("button-open");}});centerControlDiv.appendChild(buttonDiv);results.forEach(function(branch,index){branch.properties.Name=branch.properties.Name||'N/A';var name=branch.properties.Name.replace(/&/g," and ").replace(/ /g,"-").replace(/'/g,"").replace(/\./g,"").replace(/\(/g,"-").replace(/\)/g,"-");var colorClass=branch.properties.BranchCategory.toLowerCase().search('installer')>=0?"installer-custom":branch.properties.BranchCategory.toLowerCase().search('dealer')>=0?"dealer-custom":""
var card=document.createElement('div');card.setAttribute("id","card-results-"+index);card.setAttribute("class","card results "+colorClass);card.setAttribute("name",branch.properties.MapLocation.Latitude+','+branch.properties.MapLocation.Longitude+','+branch.properties.MapLocation.Zoom+','+name);card.setAttribute("location",jQuery(branch.properties.PhysicalAddress).text());card.innerHTML='<div class="card-body"><h5 class="card-title">'+branch.properties.Name+'</h5><span class="card-text">'+branch.properties.PhysicalAddress+' <a class="tel '+colorClass+'" style="display:block" href="Tel:'+branch.properties.Telephone+'">Tel:'+branch.properties.Telephone+'</a><a class="tel '+colorClass+'" style="display:block" href="e-mail:'+branch.properties.Email+'">e-mail:'+branch.properties.Email+'</a></span><div class="card-footer"><span class="distance" id="distance-'+index+'"> </span><i class="fa fa-map-marker"></i></div></div>';card.addEventListener('click',function(){document.getElementById("button-view").click();var markerlongLat=this.getAttribute("name").split(',');$(".card.results").removeClass("selected-card");var id=this.getAttribute("id");$("#"+id).addClass('selected-card');$(".branch.active").removeClass("active");$(".marker-"+markerlongLat[3]).not(".cycle-sentinel").addClass("active");var slides=$(".branch-holder").children("div.branch").not(".cycle-sentinel");var targetSlide=$(".marker-"+markerlongLat[3]).not(".cycle-sentinel");console.log(targetSlide);var targetSlideIndex=_.indexOf(slides,targetSlide[0]);$('.find-dealer-installer-landing .faq-box-slider.soft-shadow.mb-3').show();$(".branch-holder").cycle("goto",targetSlideIndex);let lat=markerlongLat[0]
let lang=markerlongLat[1]
let address=this.getAttribute("location");let vendorType=$(this).attr('class').search('installer')>=0?'installer':'dealer';let takeMeThere=$(targetSlide[0]).find('a.takeMeThere')[0];let takeMeThereID=undefined;if(takeMeThere)
takeMeThereID=takeMeThere.getAttribute('id');self.onVendorClickShowMarker(name,address,vendorType,lat,lang,takeMeThereID);});resultsDiv.appendChild(card);destinations.push(new google.maps.LatLng(branch.properties.MapLocation.Latitude,branch.properties.MapLocation.Longitude));});centerControlDiv.appendChild(resultsDiv);self.map.controls[google.maps.ControlPosition.TOP_CENTER].push(centerControlDiv);if(results&&results.length>0){self.getDistance(destinations);self.resultSlide(results);self.resultMarkers(results);setTimeout(function(){$("#button-view").click();},1000)}}}
self.infoWindowContent=[];self.getDistance=function(destinations){if(destinations.length>0&&navigator.geolocation){navigator.geolocation.getCurrentPosition(function(position){var origin=new google.maps.LatLng(position.coords.latitude,lng=position.coords.longitude);var service=new google.maps.DistanceMatrixService();service.getDistanceMatrix({origins:[origin],destinations:destinations,travelMode:'DRIVING',transitOptions:{modes:['BUS'],routingPreference:'LESS_WALKING'},drivingOptions:{departureTime:new Date(Date.now()),trafficModel:'bestguess'},avoidHighways:false,avoidTolls:false,},callback);});}
function callback(response,status){if(!response||!response.rows.length)return;var distances=response.rows[0].elements;distances.forEach(function(dist,index){});}}
self.addMarker=function(markerTag){var position=new google.maps.LatLng(markerTag.opts.lat,markerTag.opts.lng);var marker=new google.maps.Marker({map:self.map,position:position,icon:self.markerImg,title:markerTag.opts.title,markername:markerTag.opts.markername,optimized:false});google.maps.event.addListener(marker,'click',function(){self.markers.push(marker);self.latlng.push(new google.maps.LatLng(markerTag.opts.lat,markerTag.opts.lng));self.map.setZoom(5);if(markerTag.opts.infocontent){let infoWindow=new google.maps.InfoWindow({content:markerTag.opts.infocontent});infoWindow.close();infoWindow.open(self.map,marker)}
if($('.gm-style-iw').length){$('.gm-style-iw').parent().remove();}});google.maps.event.addListener(marker,'click',(function(marker,i){return function(){var markerlongLat=marker.markername.split(',');$(".branch.active").removeClass("active");$(".marker-"+markerlongLat[2]).not(".cycle-sentinel").addClass("active");var slides=$(".branch-holder").children("div.branch").not(".cycle-sentinel");var targetSlide=$(".marker-"+markerlongLat[2]).not(".cycle-sentinel");console.log(targetSlide);var targetSlideIndex=_.indexOf(slides,targetSlide[0]);$(".branch-holder").cycle("goto",targetSlideIndex);if(markerlongLat[0]&&markerlongLat[1]&&markerlongLat[0]!=='null'&&markerlongLat[1]!=='null'){var latLng=new google.maps.LatLng(markerlongLat[0],markerlongLat[1]);self.map.setZoom(17);self.map.panTo(latLng);}
else{alert("Can't find the location, Try again")}};})(marker));};self.addMarkerCustom=function(markerTag){if(markerTag.opts.lat&&markerTag.opts.lng){var position=new google.maps.LatLng(markerTag.opts.lat,markerTag.opts.lng);var markerImg={url:markerTag.opts.type==='dealer'?"/media/4412/map_marker_sml_green.png":self.marker,size:new google.maps.Size(self.markerwidth,self.markerheight),scaledSize:new google.maps.Size(self.markerwidth,self.markerheight),origin:new google.maps.Point(0,0),anchor:new google.maps.Point(self.markerwidth/2,self.markerheight-self.markerheight/5)};var marker=new google.maps.Marker({map:self.map,position:position,icon:markerImg,title:markerTag.opts.title,markername:markerTag.opts.markername,optimized:false});self.markers.forEach(function(mk){mk.setMap(null);});self.markers=[];self.markers.push(marker);self.map.setCenter(marker.getPosition());self.latlng.push(new google.maps.LatLng(markerTag.opts.lat,markerTag.opts.lng));google.maps.event.addListener(marker,'click',(function(marker,i){return function(){var markerlongLat=marker.markername.split(',');let vendorName=markerlongLat[2];$(".branch.active").removeClass("active");$(".marker-"+vendorName).not(".cycle-sentinel").addClass("active");var slides=$(".branch-holder").children("div.branch").not(".cycle-sentinel");var targetSlide=$(".marker-"+vendorName).not(".cycle-sentinel");console.log(targetSlide);var targetSlideIndex=_.indexOf(slides,targetSlide[0]);$('.find-dealer-installer-landing .faq-box-slider.soft-shadow.mb-3').show();$(".branch-holder").cycle("goto",targetSlideIndex);if(markerlongLat[0]&&markerlongLat[1]&&markerlongLat[0]!=='null'&&markerlongLat[1]!=='null'){var latLng=new google.maps.LatLng(markerlongLat[0],markerlongLat[1]);self.map.setZoom(17);self.map.panTo(latLng);}
else{alert("Can't find the location, Try again")}};})(marker));}};self.loadDealersInstallers=function(isInstallerSearch,installerCity){self.showLoader()
site.factory.GetJWT().then(function(token){self.token=token;console.log('Delaers&Installers : Loading installers data started...')
console.log('Delaers&Installers : Installers city - '+(installerCity||'none'))
let url=dstvApp.InstallersURL
if(isInstallerSearch)
url=url+'&City='+installerCity;site.factory.Get(url,self.token,self.successInitialPostCallback,self.errorPostCallback);})
self.successInitialPostCallback=function(vendorsResponse){console.log('Delaers&Installers : Loading installers data completed')
if(vendorsResponse){vendorsResponse=vendorsResponse.map(x=>reformInstallerAddress(x));self.installersList=vendorsResponse.map(x=>({class:"installerDealerItem",title:x.installerName,properties:{BranchCategory:"Installer",ContactPerson:x.contactPerson,Email:(x.emailID||'NA'),Fax:"",Id:"23873",MapLocation:{Latitude:x.Latitude,Longitude:x.Longitude,Zoom:17,Icon:{Image:"https://www.dstvafrica.com:443/api-dealerorinstaller/branches/ujson?children=true&select=Id,Name,mapOverviewContent,mapMarker,markerWidth,googleMapsAPIKey,markerHeight,Id,Name,physicalAddress,postalAddress,telephone,tel,fax,email,branchCategory,contactPerson,mondayToFrinday,sunday,saturday,mapLocation&resolveMedia=mapMarker&cdv",ShadowImage:null,Size:{Width:0,Height:0},Anchor:{Horizontal:{Manual:-9998,Automatic:-9998},Vertical:{Manual:-9997,Automatic:-9997}}},Format:0,Api:{GoogleApiKey:"AIzaSyBj0KH5NOUdIfXgNbN0YcgG6byCxDxNcKg",CoordinateSystem:0,Search:{Status:"",Limit:{Country:""}}},SearchTyped:""},Name:x.installerName,PhysicalAddress:`<p><span>${x.physicalAddress}</span></p>`,City:x.cityName.toLowerCase(),PostalAddress:`<p><span>${x.physicalAddress}</span></p>`,Province:x.province,Saturday:{Start:"08:00:00",End:"17:00:00"},Sunday:{Start:"08:00:00",End:"17:00:00"},Tel:"",Telephone:x.mobileNo||x.telephone}}));}
else{console.log('Installers data not loaded.')}
if(isInstallerSearch)
self.getData(installerCity)
self.tileState="loaded";self.update();if(self.refs.cycleslide!==undefined){$(self.refs.cycleslide).cycle();}
self.hideLoader()}
self.errorPostCallback=function(err){console.log('Delaers&Installers : Error');console.log('ERROR : '+err.responseJSON.Message)
if(isInstallerSearch)
self.getData(installerCity)
self.hideLoader()}
if(!isInstallerSearch)
site.factory.GetJWT().then(function(token){self.token=token;console.log('Delaers&Installers : Loading dealers data started...')
site.factory.Get(dstvApp.DealersURL,self.token,self.successDealerLoading,self.errorDealerLoading);})
self.successDealerLoading=function(res){console.log('Delaers&Installers : Loading dealers data completed')
if(res){res=res.vendors.map(dealer=>reformDealerAddress(dealer))
self.installerDealersList=res.map(x=>({class:"installerDealerItem",title:x.name,properties:{BranchCategory:"Dealer",ContactPerson:"",Email:(x.contact.emailAddress||'NA'),Fax:"",Id:"23873",MapLocation:{Latitude:x.location.latitude,Longitude:x.location.longitude,Zoom:17,Icon:{Image:"https://www.dstvafrica.com:443/api-dealerorinstaller/branches/ujson?children=true&select=Id,Name,mapOverviewContent,mapMarker,markerWidth,googleMapsAPIKey,markerHeight,Id,Name,physicalAddress,postalAddress,telephone,tel,fax,email,branchCategory,contactPerson,mondayToFrinday,sunday,saturday,mapLocation&resolveMedia=mapMarker&cdv",ShadowImage:null,Size:{Width:0,Height:0},Anchor:{Horizontal:{Manual:-9998,Automatic:-9998},Vertical:{Manual:-9997,Automatic:-9997}}},Format:0,Api:{GoogleApiKey:"AIzaSyBj0KH5NOUdIfXgNbN0YcgG6byCxDxNcKg",CoordinateSystem:0,Search:{Status:"",Limit:{Country:x.location.country}}},SearchTyped:""},Name:x.name,PhysicalAddress:`<p><span>${x.location.fullAddress}</span></p>`,City:x.city,PostalAddress:`<p><span>${x.location.fullAddress}</span></p>`,Saturday:{Start:"08:00:00",End:"18:00:00"},Sunday:{Start:"08:00:00",End:"18:00:00"},Tel:"",Telephone:x.contact.mobile1}}));self.DealersCityList=res.map((x)=>{if(x.location.city&&x.location.city.trim())
return x.location.city;});}
else{console.log('Delaers&Installers : Loading dealers data completed with zero records')}
self.tileState="loaded";self.update();if(self.refs.cycleslide!==undefined){$(self.refs.cycleslide).cycle();}
self.hideLoader()}
self.errorDealerLoading=function(data){console.log('Delaers&Installers : ERROR - Loading dealers data')
console.log(data)
self.hideLoader()}
function reformDealerAddress(dealer){dealer.location.fullAddress=dealer.location.fullAddress||"";dealer.location.fullAddress=dealer.location.fullAddress+","+dealer.location.city+', '+dealer.location.country;dealer.location.fullAddress=dealer.location.fullAddress.indexOf(',')==0?dealer.location.fullAddress.substring(1):dealer.location.fullAddress;dealer.location.fullAddress=dealer.location.fullAddress.indexOf('"')>-1?dealer.location.fullAddress.replace(/"/g,""):dealer.location.fullAddress;return dealer;}
function reformInstallerAddress(installer){installer.PhysicalAddress=installer.physicalAddress||"";if(!installer.PhysicalAddress){let subburb='';if(installer.subUrbs&&installer.subUrbs.length>0){subburb=installer.subUrbs[0].SubUrb;installer.PhysicalAddress=subburb+', '+installer.province+', '+dstvApp.country;installer.PhysicalAddress=installer.PhysicalAddress.indexOf(',')==0?installer.PhysicalAddress.substring(1):installer.PhysicalAddress;}}
if(installer.PhysicalAddress&&!(installer.PhysicalAddress.toLowerCase().indexOf(dstvApp.country)>-1)){installer.PhysicalAddress=installer.PhysicalAddress+', '+installer.province+', '+(dstvApp.country.charAt(0).toUpperCase()+dstvApp.country.slice(1));}
return installer;}}
self.MapAddressToGeoLocation=function(x){return new Promise((resolve,reject)=>{if((!(x.location.latitude&&x.location.longitude))){x.location.fullAddress=x.location.fullAddress||"";x.location.fullAddress=x.location.fullAddress+","+x.location.city+','+x.location.country;if(x.location.fullAddress.indexOf(',')==0)
x.location.fullAddress=x.location.fullAddress.substring(1);if(x.location.fullAddress.indexOf('"')>-1)
x.location.fullAddress=x.location.fullAddress.replace(/"/g,"")
geocoder.geocode({'address':x.location.fullAddress},function(results,status){if(status==google.maps.GeocoderStatus.OK){resolve({lat:results[0].geometry.location.lat(),lang:results[0].geometry.location.lng()});}
else{console.log('Unable to find location for : '+x.name);resolve({lat:null,lang:null});}});}
else{console.log('Unable to find location for : '+x.name);resolve({lat:null,lang:null});}});}
if(self.tags["tag-google-map-marker"]){if(!self.tags["tag-google-map-marker"].length){self.tags["tag-google-map-marker"]=[self.tags["tag-google-map-marker"]];}
self.tags["tag-google-map-marker"].map(function(tag){self.addMarker(tag);});}
self.loadDealersInstallers();$(".nav-paddle.left").on("click",function(){var allBranches=$(".branch-holder").children("div.branch").not(".cycle-sentinel");var currentActive=$(".branch.active").not(".cycle-sentinel");var previous=currentActive[0].previousElementSibling;var target;if(previous==null||$(previous).hasClass("nav-paddle")||$(previous).hasClass("cycle-sentinel")){target=allBranches.last();}else{target=$(previous);}
if(target!=null){target.addClass("active");currentActive.removeClass("active");var targetLatLong=target.data("latlong").split(',');self.clickroute(targetLatLong[0],targetLatLong[1]);var latLng=new google.maps.LatLng(targetLatLong[0],targetLatLong[1]);self.map.setZoom(17);self.map.panTo(latLng);}});$(".nav-paddle.right").on("click",function(){var allBranches=$(".branch-holder").children("div.branch").not(".cycle-sentinel");var currentActive=$(".branch.active").not(".cycle-sentinel");var next=currentActive[0].nextElementSibling;var target;if(next==null||$(next).hasClass("nav-paddle")||$(next).hasClass("cycle-sentinel")){target=allBranches.first();}else{target=$(next);}
if(target!=null){target.addClass("active");currentActive.removeClass("active");var targetLatLong=target.data("latlong").split(',');console.log(targetLatLong)
var latLng=new google.maps.LatLng(targetLatLong[0],targetLatLong[1]);self.map.setZoom(17);self.map.panTo(latLng);}});$("body").on("change",'select.mapchanger',function(){if($(this).val()!=""){var longLat=$(this).val().split(',');$(".contact-details > div").hide();$("."+longLat[2]).show();self.clickroute(longLat[0],longLat[1]);}
else{self.infoWindow.close();$(".contact-details > div").hide();$(".maphome").show();self.map.setCenter(self.latlngbounds.getCenter());self.map.fitBounds(self.latlngbounds);}});self.clickroute=function(lati,long){var latLng=new google.maps.LatLng(lati,long);self.map.setZoom(17);self.map.panTo(latLng);};};self.LoadInstallerCities=function(){setTimeout(function(){site.factory.GetJWT().then(function(token){console.log('Delaers&Installers : Loading installer cities...')
site.factory.Get(dstvApp.InstallerCitiesURL,token,OnCityLoadSuccess,OnCityLoadError);})},1000);function OnCityLoadSuccess(cities){console.log('Delaers&Installers : Loading installer cities completed')
if(self.DealersCityList){cities=cities.concat(self.DealersCityList).sort();cities=$.unique(cities);}
$("#pac-input").autocomplete({source:cities,select:OnCityChange});self.update();if(self.refs.cycleslide!==undefined){$(self.refs.cycleslide).cycle();}}
function OnCityLoadError(err){console.log('Delaers&Installers : ERROR Loading Installer Cities')
console.log(err)}
function OnCityChange(event,ui){self.divClean();self.loadDealersInstallers(true,ui.item.value.toLocaleLowerCase());}}});riot.tag2('tag-header','<div if="{opts.view == \'homepage\'}" class="search-bar home-search" ref="searchbarhold"><tag-type-a-head myid="{opts.mysearchid}" searchsrc="{opts.searchurlsrc}" resultdisplay="{opts.searchresultdisplay}" resulturl="{opts.searchresulturl}" placeholdertext="{opts.searchplaceholder}" displayslide="{opts.displaysearchslide}" view="{opts.view}"><yield from="searcher"></yield></tag-type-a-head><yield from="content"></yield></div><div if="{opts.view == \'generalpage\'}" class="search-bar general-page-head overlay fadeIn" ref="searchbarhold"><tag-type-a-head myid="{opts.mysearchid}" searchsrc="{opts.searchurlsrc}" resultdisplay="{opts.searchresultdisplay}" resulturl="{opts.searchresulturl}" placeholdertext="{opts.searchplaceholder}" displayslide="{opts.displaysearchslide}" view="{opts.view}" inpage="true"><yield from="searcher"></yield></tag-type-a-head></div><div if="{opts.view == \'page404\'}" class="search-bar error-404-head" ref="searchbarhold"><tag-type-a-head myid="{opts.mysearchid}" searchsrc="{opts.searchurlsrc}" resultdisplay="{opts.searchresultdisplay}" resulturl="{opts.searchresulturl}" placeholdertext="{opts.searchplaceholder}" displayslide="{opts.displaysearchslide}" view="{opts.view}"><yield from="searcher"></yield></tag-type-a-head><div class="not-found-nav-holder"><ul class="list-inline not-found-menu text-center"><li><a href="/home/">Home</a></li><li><a href="/home/#my-viewing">Holiday Viewing</a></li><li><a href="/how-to-pay/">How To Pay</a></li><li><a href="/contact-us/">Contact Us</a></li></ul></div></div>','tag-header,[riot-tag="tag-header"],[data-is="tag-header"]{ visibility: visible; }','',function(opts){var self=this;self.bgSrc='';var country="";var selectedLanguage="";var windowurl=window.location;sessionStorage.setItem('countryCode',dstvApp.countryabbreviation);self.on('mount',function(){setTimeout(function(){if(app.comparedecoders&&app.comparedecoders.entities.length<2){console.log('Decoder count: '+app.comparedecoders.entities.length);$('.linkCompareDecoder').remove();}},2000);if(app.loggedin){$('#countryDropdown').css({'cursor':'default'});$('.icon-ico-arrow-down').hide();}
$("#sucess-overlay .close-link").click(function(){$("#claim-overlay .close-link").click();});$('.clfbanner .btn.anim-btn.btn-primary.track_campaignslider').attr("data-target","#CLFpopup");$('.clfbanner .btn.anim-btn.btn-primary.track_campaignslider').attr("data-toggle","modal");$('#CLFpopup .btnClose').click(function(){$('body').removeClass("scrollhidden");});$('.bbn-popup .btn.anim-btn.btn-primary.track_campaignslider').attr("data-target","#BBNpopup");$('.bbn-popup .btn.anim-btn.btn-primary.track_campaignslider').attr("data-toggle","modal");$('#BBNpopup .btnClose').click(function(){$('body').removeClass("scrollhidden");});$('.fa-popup .btn.anim-btn.btn-primary.track_campaignslider').attr("data-target","#FApopup");$('.fa-popup .btn.anim-btn.btn-primary.track_campaignslider').attr("data-toggle","modal");$('#FApopup .btnClose').click(function(){$('body').removeClass("scrollhidden");});if(sessionStorage.getItem('countryHomeFlagIcon')!=='undefined'&&sessionStorage.getItem('countryHomeFlagIcon')!==null&&window.location.pathname=='/home'){$('#countryIcon').attr('src',"/countryicons/codes/"+sessionStorage.getItem('countryHomeFlagIcon')+".svg");}else if(window.location.pathname=='/home'){$('#countryIcon').attr('src',"/countryicons/codes/null.svg");}
else{$('#countryIcon').attr('src',"/countryicons/"+dstvApp.country+".svg");}
$(window).load(function(){var cultureclass=window.culture;var res=cultureclass.replace("/","");$("body").addClass(res);});$(".downloadAppBtn a").click(function(){$('html,body').animate({scrollTop:$("tag-manage-section").offset().top},'slow');});$(window).load(function(){$('#loader').hide();});$(".contact-us-text-btn").click(function(){$(".mapwhiteBox").show();});$(window).resize(function(){if($(window).width()<=767){$(".section3 .col-md-4.colOne").css("top","30px");}});$(".mega-close-button").click(function(){$(".overlay").css("height","0%");});$(".main-menu-get").click(function(){$("#myNav").css("height","100%");$("#myNavpay").css("height","0%");$("#myNavwatch").css("height","0%");$("#myNavman").css("height","0%");$("#myNavearn").css("height","0%");$("#myNavhelp").css("height","0%");});$(".main-menu-pay").click(function(){$("#myNav").css("height","0%");$("#myNavpay").css("height","100%");$("#myNavwatch").css("height","0%");$("#myNavman").css("height","0%");$("#myNavearn").css("height","0%");$("#myNavhelp").css("height","0%");});$(".main-menu-watch").click(function(){$("#myNav").css("height","0%");$("#myNavpay").css("height","0%");$("#myNavwatch").css("height","100%");$("#myNavman").css("height","0%");$("#myNavearn").css("height","0%");$("#myNavhelp").css("height","0%");});$(".main-menu-manage").click(function(){$("#myNav").css("height","0%");$("#myNavpay").css("height","0%");$("#myNavwatch").css("height","0%");$("#myNavman").css("height","100%");$("#myNavearn").css("height","0%");$("#myNavhelp").css("height","0%");});$(".main-menu-earn").click(function(){$("#myNav").css("height","0%");$("#myNavpay").css("height","0%");$("#myNavwatch").css("height","0%");$("#myNavman").css("height","0%");$("#myNavearn").css("height","100%");$("#myNavhelp").css("height","0%");});$(".main-menu-help").click(function(){$("#myNav").css("height","0%");$("#myNavpay").css("height","0%");$("#myNavwatch").css("height","0%");$("#myNavman").css("height","0%");$("#myNavearn").css("height","0%");$("#myNavhelp").css("height","100%");});$("#navViewBalance").click(function(e){MegaMenuLogin(e)})
$("#navMyAccountMenu, #navAccountMenu").click(function(e){MegaMenuLogin(e)});$("#navChangePackage").click(function(e){MegaMenuLogin(e)});$("#navMyProfile").click(function(e){MegaMenuLogin(e)})
function MegaMenuLogin(e){$(".mega-close-button").click();e.preventDefault();e.stopImmediatePropagation()
site.factory.ShowSignIn();}
$('.btn').click(function(e){let changePackageBtn=['get add-on','upgrade now','obter pacote adicional','actualizar agora'];let targetElement=e.target.text||e.currentTarget.text||"";console.log(targetElement)
if(changePackageBtn.includes(targetElement.toLowerCase())){e.preventDefault();e.stopImmediatePropagation();if(app.loggedin)
window.location=dstvApp.ChangePackageURL;else{if(window.location.pathname!='/home'){riot.mount('tag-sign-in',{returnURL:dstvApp.ChangePackageURL});}}}})
$('.mega-dropdown-menu a, #loginLinkLabel').map(function(x,menuItemLink){if(menuItemLink.href.includes('eazy.dstv.com'))
return menuItemLink;menuItemLink.pathname=menuItemLink.pathname.includes(window.culture)?menuItemLink.pathname:window.culture+menuItemLink.pathname;return menuItemLink;})
$('.login-popup .dropdown-menu a').map(function(x,loginPopupLink){if(loginPopupLink.hash)
loginPopupLink.href=loginPopupLink.origin+window.culture+'/'+loginPopupLink.hash;else
loginPopupLink.pathname=loginPopupLink.pathname.includes(window.culture)?loginPopupLink.pathname:window.culture+loginPopupLink.pathname;return loginPopupLink;})
$('.mega-menu a, #loginLinkLabel').map(function(x,menuItemLink){if(menuItemLink.href.includes('eazy.dstv.com'))
return menuItemLink;menuItemLink.pathname=menuItemLink.pathname.includes(window.culture)?menuItemLink.pathname:window.culture+menuItemLink.pathname;if(menuItemLink.pathname.includes('sign-in')&&!app.loggedin&&menuItemLink.id!='loginLinkLabel'){$(menuItemLink).click(function(e){e.preventDefault();e.stopImmediatePropagation();$('#loginLinkLabel').click();})}
return menuItemLink;})
$('.package-slider-new .packageItem a').map(function(x,menuItemLink){if(menuItemLink.href.includes('eazy.dstv.com'))
return
menuItemLink.pathname=menuItemLink.pathname.includes(window.culture)?menuItemLink.pathname:window.culture+menuItemLink.pathname;return menuItemLink;})
$('.self-service-slider .ssItem a').map(function(x,menuItemLink){if(menuItemLink.href.includes('eazy.dstv.com'))
return
menuItemLink.pathname=menuItemLink.pathname.includes(window.culture)?menuItemLink.pathname:window.culture+menuItemLink.pathname;return menuItemLink;})
$('.decoder-slider-new .decoderItem a').map(function(x,menuItemLink){if(menuItemLink.href.includes('eazy.dstv.com'))
return
menuItemLink.pathname=menuItemLink.pathname.includes(window.culture)?menuItemLink.pathname:window.culture+menuItemLink.pathname;return menuItemLink;})
setTimeout(function(){$('.home-latest-offers-rewards').map(function(x,menuItemLink){if(menuItemLink.href.includes('eazy.dstv.com'))
return
menuItemLink.pathname=menuItemLink.pathname.includes(window.culture)?menuItemLink.pathname:window.culture+menuItemLink.pathname;return menuItemLink;})},100)
$(".dropdownnew li a").click(function(){$(".dropdownnew .overlay").toggle();});var scroll_pos=0;$(document).scroll(function(){scroll_pos=$(this).scrollTop();if(scroll_pos>30){$("#header").addClass("fixed-position");}else{$("#header").removeClass("fixed-position");}});$(".mega-menu.mega-stacked").scroll(function(){scroll_pos=$(this).scrollTop();if(scroll_pos>10){$("#header #nav").css("z-index","9999999999");}else{$("#header #nav").css("z-index","99");}});var newWindowWidth=$(window).width();if(newWindowWidth<678){$(".country").click(function(){$("body").css("overflow","hidden");$(".dropdown-content .country-row ").css("display","none");$(".country-row-mobile").css("display","block");});$(".footer-container .row.text-center").removeClass("footer-menu");}
$("#countryDropdown-newhome").click(function(){if(!app.loggedin){$(".new_flags .dropdown-content").fadeIn('slow');}});$("#newcountryClose").click(function(){$(".new_flags .dropdown-content").fadeOut('slow');$("body.NewDstvPage").css("overflow","auto");});$(".new_flags a.flags").click(function(){$(".new_flags .dropdown-content").fadeOut('slow');$("body.NewDstvPage").css("overflow","auto");});$("#loginLinkLabel-NewHome").click(function(e){let eazyURL="";if(!app.loggedin){let selectedCountryAbbrivation=sessionStorage.getItem('countryHomeFlagIcon');let isDStvCountry=dstvApp.DTHCountries.includes(selectedCountryAbbrivation)||dstvApp.SelfServiceEnabledCountries.includes(selectedCountryAbbrivation)||dstvApp.liveTargetCountries.includes(selectedCountryAbbrivation)
if(window.location.pathname.includes('en-')||window.location.pathname.includes('pt-')){selectedCountryAbbrivation=dstvApp.countryabbreviation;}
else{if(!isDStvCountry)
selectedCountryAbbrivation='ng';}
if(dstvApp.SelfServiceEnabledCountries.includes(selectedCountryAbbrivation)||dstvApp.liveTargetCountries.includes(selectedCountryAbbrivation)){e.preventDefault();e.stopImmediatePropagation()
site.factory.ShowSignIn();return;}
else{if(site.env=="PROD"){if(window.location.pathname.includes('pt-'))
eazyURL=`https://eazy.dstv.com/pt/${selectedCountryAbbrivation}/account`;else
eazyURL=`https://eazy.dstv.com/en/${selectedCountryAbbrivation}/account`;}
else{eazyURL=`https://staging-eazy.dstv.com/en/${selectedCountryAbbrivation}/account`;}
window.location=eazyURL;}}});$(".country").click(function(){if(!app.loggedin){$("body").css("overflow","hidden");$(".dropdown-content").fadeIn('slow');$(".search-opener").hide();$(".dropdown-content").css("height","100%");$("#myNav").css("height","0%");$("#myNavpay").css("height","0%");$("#myNavwatch").css("height","0%");$("#myNavman").css("height","0%");$("#myNavearn").css("height","0%");$("#myNavhelp").css("height","0%");}});$("#countryClose").click(function(){$("body").css("overflow","auto");$(".dropdown-content").fadeOut('slow');$(".search-opener").show();$(".search-filed").val('');var value=$(this).val().toLowerCase();$(".dropdown-content .row .column a").filter(function(){$(this).toggle($(this).text().toLowerCase().indexOf(value)>-1)});});$(".search-filed").on("keyup",function(){var value=$(this).val().toLowerCase();$(".dropdown-content .row .column a").filter(function(){$(this).toggle($(this).text().toLowerCase().indexOf(value)>-1)});let totalResult=$(".country-row-mobile .column a").length;let hiddenRecordCount=$(".country-row-mobile .column a").filter((x,i)=>i.style.display==='none').length;if(hiddenRecordCount==totalResult){$('#nocountryfoundmobile').remove();$('.country-row-mobile').append('<p id="nocountryfoundmobile" class="result-no">'+langTranslateApp.noResult+'</p>');$('#nocountryfoundmobile').show();}
else{$('#nocountryfoundmobile').remove();}});var geoCountry="";var geoCountryFlagLocation="";var geoErrorMessage="<p id='modalMessage'>We are unable to locate your country. Please select your country from the Country menu.</p>";var googleAPIKey="AIzaSyCEzqu9o5trVDXkxpRznQIFPLagxsQakGA";var urlGoogleAPI="";var firedAlready=false;var positionFlagValue=sessionStorage.getItem('positionFlag');var selectedFlagValue=sessionStorage.getItem('selectedFlag');function setCountrySelection(country){$("#countryErrorMessageModal").removeClass("countrymessageModalDiplay");if(!dstvApp.targetcountries.includes(country.toLowerCase())){$(".country-model-btn").click();if(!$('#modalMessage').length)
{$("#countryErrorMessageModal .modal-body").append(geoErrorMessage);}
$("#countryErrorMessageModal").addClass("countrymessageModalDiplay");$('#countrymessageModal').modal({backdrop:'static',keyboard:false})
$('#countryErrorMessageModal .modal-footer .btn-default').click(function(){$("#countryErrorMessageModal").removeClass("countrymessageModalDiplay");$("#overlaycountry").css("display","none");window.location.href=window.location.origin+'/en-ng';});}
else{window.location.href=window.location.origin+'/en-'+country.toLowerCase();}
if(country.toLowerCase()=='test'){$('.lang-dropdown-menu').removeAttr('disabled');selectedLanguage=$(":selected",'.lang-dropdown-menu').text().toLowerCase();}
else{$('.lang-dropdown');$('.no-active  .jcf-select-text').css("color","gray");selectedLanguage=$(":selected",'.lang-dropdown-menu').text().toLowerCase();$('.lang-dropdown-menu');}}
$("#countryErrorMessageModal").removeClass("countrymessageModalDiplay");var dstvurl="https://www.dstv.com/";var zambia_logo="/media/4547/logo-zambia.png";if(selectedFlagValue){$('.img-globe').addClass("countryactive");var selectedCountryCssClass='.column a.flags.'+selectedFlagValue;$("#my_image").attr("src","second.jpg");$('.country  .icon-globe').hide();if(selectedFlagValue=='zm'){$('.logo img').attr('src',zambia_logo);$('.logo').addClass("country-logo");}
return false;}
$('.flag.ao , .flag.mz').click(function(){$('  .jcf-select-text').css("color","white");});var res;var myClass;var countryCode=null;$('.new_flags .column a.flags').click(function(e){myClass=$(this).attr("class");res=myClass.replace("flags","").trim();if(dstvApp.targetcountries.includes(res)){countryAbr=res.trim();window.location="https://www.dstvafrica.com/en-"+countryAbr;}
else if(res.trim()=="mz"){countryAbr=res.trim();window.location="https://eazy.dstv.com/en/"+countryAbr;}
else{sessionStorage.setItem('countryCode',res);countryCode=sessionStorage.getItem('countryCode');countryCode=countryCode.trim();$('#countryIcon-newhome').attr('src',"/countryicons/codes/"+countryCode+".svg");}});if(window.location.href==window.location.origin+window.culture+"/help-contact-us#holder")
{window.location.href=window.location.origin+window.culture+"/help-contact-us/";}
setTimeout(function(){$(".mega-dropdown-menu a").click(function(e){if(site.factory.IsSignURL(e.currentTarget.pathname)&&(dstvApp.SelfServiceEnabledCountries.includes(dstvApp.countryabbreviation)||dstvApp.liveTargetCountries.includes(dstvApp.countryabbreviation))){e.preventDefault();e.stopImmediatePropagation()
site.factory.ShowSignIn();return;}
if(sessionStorage.getItem('countryCode')!=='undefined'&&sessionStorage.getItem('countryCode')!==null){var hrefurl=$(this).attr('href');e.preventDefault()
countryCode=sessionStorage.getItem('countryCode');countryCode=countryCode.trim();if(dstvApp.liveTargetCountries.includes(countryCode.toLowerCase())){if(!hrefurl.includes('https')){window.location=window.location.origin+window.location.pathname;}else{window.location=hrefurl;}}else{if(e.currentTarget.pathname.includes('dstv-thanks')){window.location=e.currentTarget.href;return;}
else{hrefurl=e.currentTarget.href
window.open(hrefurl);}}}});$(".NewDstvPage .main-container a, .dashboard-page .footer-menu a").click(function(e){let selectedCountryAbbrivation=sessionStorage.getItem('countryHomeFlagIcon');let isDStvCountry=dstvApp.DTHCountries.includes(selectedCountryAbbrivation)||dstvApp.SelfServiceEnabledCountries.includes(selectedCountryAbbrivation)||dstvApp.liveTargetCountries.includes(selectedCountryAbbrivation)
if(window.location.pathname.includes('en-')||window.location.pathname.includes('pt-')){selectedCountryAbbrivation=dstvApp.countryabbreviation;}
else{if(!isDStvCountry)
selectedCountryAbbrivation='ng';}
if(site.factory.IsSignURL(e.currentTarget.pathname)&&(dstvApp.SelfServiceEnabledCountries.includes(selectedCountryAbbrivation)||dstvApp.liveTargetCountries.includes(selectedCountryAbbrivation))){e.preventDefault();e.stopImmediatePropagation()
site.factory.ShowSignIn();return;}
if(sessionStorage.getItem('countryCode')!=='undefined'&&sessionStorage.getItem('countryCode')!==null){var originalURL=this.href;var finalURL='';var isInternalURL=false,isMediaURL=false;e.preventDefault();e.stopImmediatePropagation();if(originalURL.includes(window.origin)&&originalURL.includes('/media/')){finalURL=window.origin+this.pathname;isInternalURL=true;isMediaURL=true;}
else if(originalURL.includes(window.origin)&&!originalURL.includes(window.culture)){finalURL=window.origin+window.culture+this.pathname;isInternalURL=true;}
else if(originalURL.includes(window.origin)&&originalURL.includes(window.culture)){finalURL=originalURL;isInternalURL=true;}
else if(!originalURL.includes(window.origin)){finalURL=originalURL;isInternalURL=false;}
if(!isInternalURL&&finalURL.includes('multichoiceafrica')){window.open(finalURL);return;}
if(!isInternalURL){window.open(finalURL);return;}
if(isInternalURL&&isMediaURL){window.location=finalURL;return;}
if(isInternalURL&&!dstvApp.liveTargetCountries.includes(selectedCountryAbbrivation)){var thisHREF=$(this).attr('href');var thisHREFPathName=thisHREF.replace(window.origin,"");thisHREFPathName=thisHREFPathName.slice(6);thisHREFPathName=thisHREFPathName.replace('dashboard','account').replace('manage-error-codes','clear-error-code').replace('find-installer-or-dealer','installers').replace('ways-to-pay','payment-methods').replace('get-home/dstv-for-you','').replace('help/need-help','support')
window.open("https://eazy.dstv.com/"+dstvApp.languageAbbreviation+"/"+selectedCountryAbbrivation+thisHREFPathName);return;}
if(isInternalURL&&dstvApp.liveTargetCountries.includes(selectedCountryAbbrivation)){if(finalURL.includes('dashboard')){e.preventDefault();e.stopImmediatePropagation()
site.factory.ShowSignIn();}
else{window.location=finalURL;}
return;}
var hrefurl=$(this).attr('href');hrefPathName=hrefurl.replace(window.origin,"");hrefPathName=hrefPathName.slice(6);if(hrefurl.includes(window.origin)){e.preventDefault()
countryCode=sessionStorage.getItem('countryCode');countryCode=countryCode.trim();countryHomeFlagIcon=sessionStorage.getItem('countryHomeFlagIcon');if(hrefurl.includes('multichoiceafrica')){window.open(hrefurl);}else{if(dstvApp.liveTargetCountries.includes(countryCode.toLowerCase())){if(countryHomeFlagIcon!=null||countryHomeFlagIcon!=undefined){if(!dstvApp.liveTargetCountries.includes(countryHomeFlagIcon)&&!dstvApp.liveTargetCountries.includes(countryHomeFlagIcon))
{hrefurl="https://eazy.dstv.com/en/"+countryHomeFlagIcon+hrefPathName;window.open(hrefurl);}else{window.location=hrefurl;}}else{if(hrefurl.includes('dashboard')){e.preventDefault();e.stopImmediatePropagation()
site.factory.ShowSignIn();}else{window.location=hrefurl;}}}else{if(site.env=="PROD"){if(hrefurl.includes('dstv-thanks')&&window.location.pathname.includes('ke')){window.location=hrefurl;}else{hrefurl="https://eazy.dstv.com/en/"+countryCode+hrefPathName;window.open(hrefurl);}}else{hrefurl="https://eazy.dstv.com/en/"+countryCode+hrefPathName;window.open(hrefurl);}}}}}else{var hrefurl=$(this).attr('href');if(!hrefurl.includes('https')){e.preventDefault()
hrefurl="https://eazy.dstv.com/en/"+app.GeoCountry+hrefPathName;window.open(hrefurl);}}});},500)
$('.flags-icons-menu .column a.flags').click(function(e){var country=$(this).attr("class").replace('flags','').trim();sessionStorage.setItem('countryHomeFlagIcon',country);if(country.toLowerCase()=='test'){$('.lang-dropdown-menu').removeAttr('disabled');selectedLanguage=$(":selected",'.lang-dropdown-menu').text().toLowerCase();}
else{e.preventDefault();e.stopImmediatePropagation();selectedLanguage=$(":selected",'.lang-dropdown-menu').text().toLowerCase();if(!dstvApp.targetcountries.includes(country)){window.open(dstvurl+selectedLanguage+'-'+country,'_blank');}
else{e.preventDefault();if(window.location.href.indexOf("decoders")>-1){if(dstvApp.liveTargetCountries.includes(country)){window.location.href=window.location.origin+'/en-'+country+"/decoders-list/";}else{window.location=window.location.origin+window.location.pathname.replace(window.location.pathname,$(this).attr('href'));}}else if(window.location.href.indexOf("packages")>-1){if(dstvApp.liveTargetCountries.includes(country)){window.location.href=window.location.origin+'/en-'+country+langTranslateApp.subMenuGetComparePackagesLink;}else{window.location=window.location.origin+window.location.pathname.replace(window.location.pathname,$(this).attr('href'));}}else{if(dstvApp.liveTargetCountries.includes(country)){window.location=window.location.origin+window.location.pathname.replace(window.culture,$(this).attr('href'));}else{window.location=window.location.origin+window.location.pathname.replace(window.location.pathname,$(this).attr('href'));}}}}});});self.GetBackGroundImageSrc=function(){var str=self.refs.searchbarhold.className;if(str.indexOf('error-404-head')===-1||opts.view=='page404'){$.getJSON(window.culture+"/umbraco/api/homepage/GetHomePageBanners",function(data){self.bgSrc=data;$(document).ready(function(){if(self.bgSrc&&self.refs.searchbarhold){if(str.indexOf('error-404-head')===-1){$(self.refs.searchbarhold).attr('style','background-color: transparent; background-image: url("'+self.bgSrc+'")');}else if(opts.view=='page404'){$(self.refs.searchbarhold).attr('style','background-color: transparent; background-image: url("'+opts.bgimgsrc+'")');}
setTimeout(function(){$(self.refs.searchbarhold).addClass('fadeIn');},200);};});});}};if(window.location.href.includes('?success='))
{var success=window.location.search.substring(1).split('success=')[1];if(success&success==1)
{site.factory.ShowModelPopup('success','Thank you','Your request has been successfully submitted. We will be in contact with you shortly.','',false,true);window.history.pushState('','',window.location.pathname);}
else if(success&success==0)
{site.factory.ShowModelPopup('error','Error!','Sorry, your request could not be submitted.','',false,true);window.history.pushState('','',window.location.pathname);}}});riot.tag2('tag-initialise','<yield></yield><tag-getdata></tag-getdata>','','',function(opts){var self=this;self.bgSrc='';var dstvurl="https://www.dstv.com/";var zambia_logo="/media/4547/logo-zambia.png";self.on('mount',function(){$(window).load(function(){$('#loader').hide();});countryHomeFlagIconcode=sessionStorage.getItem('countryHomeFlagIcon');$('#countryIcon').attr('src',"/countryicons/codes/"+countryHomeFlagIconcode+".svg");$('.inlinePop').click(function(){$('body.package-landing').css('overflow','hidden');setTimeout(function(){$("#cboxClose").on("click",function(){resetScroll();});},1000)});$(".mapwhiteBox h2").before("<span class='contact-close-btn'><i class='icon-Close_M pl-1'></i></span>");$(".mapwhiteBox .wg2k_submitField.col-md-12.submit-btn-rounded").after('<div class="footer-contact-from">GET IN TOUCH <a href="" target="_blank" class="twitterurl"><img src="/media/4806/contact-tw.jpg" hspace="5"></a><a href="" target="_blank" class="facebookurl"><img src="/media/4805/contact-fb.jpg" hspace="5"></a></div>');var twitter=$('#twitter').val();$(".twitterurl").attr("href",twitter);var facebook=$('#facebook').val();$(".facebookurl").attr("href",facebook);$(".contact-us-text-btn").click(function(){$(".mapwhiteBox").show();$('.gm-style .gm-style-iw').hide();});$(".contact-close-btn").click(function(){$(".mapwhiteBox").hide();$('.gm-style .gm-style-iw').show();});$(".map-contact-btn").on("click",function(){$("html, body").animate({scrollTop:300},"slow");});$(".map-contact-btn1").on("click",function(){$("html, body").animate({scrollTop:1500},"slow");});$('.call-button').click(function(){$('body.package-landing').css('overflow','hidden');setTimeout(function(){$("#cboxClose").on("click",function(){resetScroll();});},1000)});function resetScroll(){$('body.package-landing').css('overflow','scroll');$('body.business-pay').css('overflow','scroll');}
$('#cboxClose').click(function(){$('#colorbox').hide();});$(document).ready(function(){$('<div class="overlayBottom"> <span id="expandIcon"> <img src="/media/4561/down_arrow.svg" width="40px"></span></div>').insertAfter(".single-new-article p:last-child");$('#expandIcon').click(function(){$('.single-new-article .mb64').toggleClass('fullHeight');});});$(window).load(function(){});$(".grid-section:nth-child(2)").attr("id","main-scroll");var scroll_pos=0;$(document).scroll(function(){scroll_pos=$(this).scrollTop();if(scroll_pos>30){$("#header").addClass("fixed-position");}else{$("#header").removeClass("fixed-position");}});$(".search-filed").on("keyup",function(){var value=$(this).val().toLowerCase();$(".country-row .column a").filter(function(){$(this).toggle($(this).text().toLowerCase().indexOf(value)>-1);});let totalResult=$(".country-row .column a").length;let hiddenRecordCount=$(".country-row .column a").filter((x,i)=>i.style.display==='none').length;if(hiddenRecordCount==totalResult){$('#nocountryfound').remove();$('.country-row').append('<p id="nocountryfound" class="result-no">'+langTranslateApp.noResult+'</p>');$('#nocountryfound').show();}
else{$('#nocountryfound').remove();}});$(document).ready(function(){$('.installtion').click(function(){$(".pvrDescription").show();$(".pvr1Description").hide();});$('.caret').click(function(){$(".pvrDescription").hide();$(".pvr1Description").show();});$("#myDiv .dropdown-menu li").click(function(){var selText=$(this).text();var imgSource=$(this).find('img').attr('src');var imgClass=$(this).find('img').attr('class');var img='<img src="'+imgSource+'" class="'+imgClass+'"/>';var liImgSrc=$(this).parents('.btn-group').find('.dropdown-toggle').find('img').attr('src');var liImgClass=$(this).parents('.btn-group').find('.dropdown-toggle').find('img').attr('class');var imgLi='<img src="'+liImgSrc+'" class="'+liImgClass+'"/>';$(this).parents('.btn-group').find('.dropdown-toggle').html(img+' '+selText+' <span class="caret"></span>');$(this).parents('.btn-group').find('.dropdown-menu li').html(imgLi+' '+selText+' <span class=""></span>');$('.'+imgClass).click();if(imgClass==='installtion'){$(".pvrDescription").show();$(".pvr1Description").hide();}
else if(imgClass==='pvr'){$(".pvrDescription").hide();$(".pvr1Description").show();}});});if(sessionStorage.getItem('selectedFlag')){$('.img-globe').addClass("countryactive");$("#my_image").attr("src","second.jpg");$('.logo img').attr('src',zambia_logo);$('.logo').addClass("country-logo");$('.country  .icon-globe').hide();}
var country="";if(country.toLowerCase()=='test'){$('.lang-dropdown-menu').removeAttr('disabled');selectedLanguage=$(":selected",'.lang-dropdown-menu').text().toLowerCase();}
else{$('.lang-dropdown');$('.jcf-select  .jcf-select-text').css("color","gray");selectedLanguage=$(":selected",'.lang-dropdown-menu').text().toLowerCase();$('.lang-dropdown-menu');}
$('.flag.ao , .flag.mz').click(function(){$('.jcf-select-text').css("color","white");});$('.flags-icons-menu .column a.flags').click(function(e){country=$(this).attr("class").replace('flags','').trim();sessionStorage.setItem('countryHomeFlagIcon',country);if(country.toLowerCase()=='test'){$('.lang-dropdown-menu').removeAttr('disabled');selectedLanguage=$(":selected",'.lang-dropdown-menu').text().toLowerCase();}
else{e.preventDefault();e.stopImmediatePropagation();if(country=='sa'){window.location="http://www.dstv.co.za";}
else if(!dstvApp.targetcountries.includes(country)){countryHomeFlagIconcode=sessionStorage.getItem('countryHomeFlagIcon');$('#countryIcon-newhome').attr('src',"/countryicons/codes/"+countryHomeFlagIconcode+".svg");window.open(window.location.origin+'/home');}
else{e.preventDefault();if(window.location.href.indexOf("decoders")>-1){window.location.href=window.location.origin+'/en-'+country+"/decoders-list/";}else if(window.location.href.indexOf("packages")>-1){window.location.href=window.location.origin+'/en-'+country+langTranslateApp.subMenuGetComparePackagesLink;}else{if(dstvApp.liveTargetCountries.includes(country)){if(window.location.pathname.includes(window.culture)){let currentLang=window.culture.split('-')[0];let targateLang=$(this).attr('href').split('-')[0];if(currentLang==targateLang)
window.location=window.location.origin+window.location.pathname.replace(window.culture,$(this).attr('href'));else
window.location=window.location.origin+$(this).attr('href');}
else
window.location=window.location.origin+$(this).attr('href');}else{window.location=window.location.origin+window.location.pathname.replace(window.location.pathname,$(this).attr('href'));}}}}});});});riot.tag2('tag-input','<div if="{opts.type != \'checkbox\' && opts.type != \'radio\' && opts.type != \'select\' && opts.type != \'hidden\' && opts.type != \'textarea\'}" class="group {\'hasvalue\' : opts.value != \'\' && opts.type != \'submit\'} {opts.cls} "><input if="{opts.type != label}" placeholder=" " trigger="{clicktrigger: opts.clicktrigger}" pattern="{opts.pattern}" type="{opts.type}" id="{opts.fieldid}" class="{opts.cls} addvars form-control"><span class="input-group-btn search-btn" if="{opts.icon}"><span><span class="{opts.icon}"></span></span></span><div id="{opts.results}" if="{opts.results}"></div><label for="{opts.name}" if="{opts.label}" class="lbl text" aria-label="{opts.label}">{opts.label}</label><span class="help-block" if="{opts.error}">{opts.error}</span><span class="error-holder"></span></div><div if="{opts.type == \'hidden\'}" class="hidden-field"><input class="{opts.cls} addvars" type="text" id="{opts.fieldid}"></div><div if="{opts.type == \'checkbox\'}" style="overflow:hidden"><div class="checkbox"><input if="{opts.type != label}" type="{opts.type}" trigger="{clicktrigger: opts.clicktrigger}" id="{opts.fieldid}" class="{opts.cls} addvars"><label> {opts.label} </label><span class="error-holder"></span></div></div><div if="{opts.type == \'radio\'}" style="overflow:hidden"><div class="radio-option" temp="{current} {opts.value}"><div class="inner"></div><input if="{opts.type != label}" type="{opts.type}" groupname="{opts.radiogroup}" trigger="{clicktrigger: opts.clicktrigger}" id="{opts.fieldid}" class="{opts.cls} addvars"></div><span>{opts.label}</span><span class="error-holder"></span></div><div if="{opts.type == \'textarea\'}" class="group {\'hasvalue\' : opts.value != \'\'} form-textarea"><textarea rows="3" id="{opts.fieldid}" class="{opts.cls} addvars"></textarea><label for="{opts.name}" if="{opts.label}" class="lbl">{opts.label}</label><span class="help-block" if="{opts.error}">{opts.error}</span><span class="error-holder"></span></div>','tag-input,[riot-tag="tag-input"],[data-is="tag-input"]{ visibility: visible; } tag-input .hidden-field,[riot-tag="tag-input"] .hidden-field,[data-is="tag-input"] .hidden-field,tag-input div[type=hidden].form-group,[riot-tag="tag-input"] div[type=hidden].form-group,[data-is="tag-input"] div[type=hidden].form-group{ min-height: 0; height: 0; overflow: hidden; min-height: 0; } tag-input .group,[riot-tag="tag-input"] .group,[data-is="tag-input"] .group{ position: relative; overflow: visible; } tag-input .password-meter .progress,[riot-tag="tag-input"] .password-meter .progress,[data-is="tag-input"] .password-meter .progress{ display: none; } tag-input .password-meter .hasvalue .progress,[riot-tag="tag-input"] .password-meter .hasvalue .progress,[data-is="tag-input"] .password-meter .hasvalue .progress{ display: block; } tag-input .help-block,[riot-tag="tag-input"] .help-block,[data-is="tag-input"] .help-block{ opacity: 0; display: none; } tag-input .help-block,[riot-tag="tag-input"] .help-block,[data-is="tag-input"] .help-block{ opacity: 0; top: 10px; line-height: 15px; margin-top: 10px; position: absolute; left: 10px; -moz-transition: all ease 0.3s; -o-transition: all ease 0.3s; -webkit-transition: all ease 0.3s; transition: all ease 0.3s; font-style: italic; color: #999; } tag-input .error ~ .help-block,[riot-tag="tag-input"] .error ~ .help-block,[data-is="tag-input"] .error ~ .help-block{ display: none; } tag-input .form-group:hover .help-block,[riot-tag="tag-input"] .form-group:hover .help-block,[data-is="tag-input"] .form-group:hover .help-block{ opacity: 1; top: 45px; } tag-input input:-webkit-autofill ~ label.lbl,[riot-tag="tag-input"] input:-webkit-autofill ~ label.lbl,[data-is="tag-input"] input:-webkit-autofill ~ label.lbl,tag-input textarea:-webkit-autofill ~ label.lbl,[riot-tag="tag-input"] textarea:-webkit-autofill ~ label.lbl,[data-is="tag-input"] textarea:-webkit-autofill ~ label.lbl{ top: -22px !important; font-size: 13px; color: #777; }','',function(opts){var self=this;self.on('mount',function(){if(opts.helptext){var x=opts.helptext;$(self.root).find(".help-block").html(x);}
if(opts.type=="checkbox"){if(opts.value.toLowerCase()=="true"){$(self.root).find('input[type=checkbox]').prop('checked',true);$(self.root).find('.checkbox-option').addClass('checked');}
else{$(self.root).find('input[type=checkbox]').prop('checked',false);$(self.root).find('.checkbox-option').removeClass('checked');}}
$('form,input').attr("autocomplete","off");var input;switch(opts.type){case 'textarea':input=$(self.root).find("textarea.addvars")[0];break;case 'checkbox':input=$(self.root).find(".checkbox .addvars")[0];break;case 'textarea':input=$(self.root).find("textarea.addvars")[0];break;case 'text':case 'email':case 'password':case 'date':case 'tel':case 'number':input=$(self.root).find("input.addvars")[0];break;default:input=$(self.root).find(".addvars")[0];}
if(self.opts.cls=="password-meter"){$(self.root).parent().addClass("password-meter");$(input).pwstrength({ui:{showVerdictsInsideProgressBar:true}});};Object.keys(opts).forEach(function(key,i){if("label clicktrigger columns class riot-tag type validation".indexOf(key)==-1){if(key=="propenabled"&&opts[key]=="false"){input.setAttribute('disabled','');}
if(key=="mask"&&opts[key]!=undefined){input.setAttribute('data-mask',opts[key]);}
if(input==undefined){console.log("input not found"+self.root+self.opts.type);return;}
if(opts[key]!=""&&opts[key]!=undefined){if(key!="value"||key=="value"&&opts.type!="checkbox"&&opts.type!='radio'&&opts.type!='select'&&opts.type!='textarea'){input.setAttribute(key,opts[key]);self.root.removeAttribute(key);}}}});$(self.root).addClass("form-group");if(self.opts.validation){Object.keys(self.opts.validation).forEach(function(key,i){if("ignore".indexOf(key)==-1){if(key=="required"){input.setAttribute("required","");input.setAttribute("data-rule-"+key,self.opts.validation[key].value);input.setAttribute("data-msg-"+key,self.opts.validation[key].message);}
else{input.setAttribute("data-rule-"+key,self.opts.validation[key].value);input.setAttribute("data-msg-"+key,self.opts.validation[key].message);}}});}
$(self.root).on("click","[trigger=clicktrigger]",function(e){site.trigger(opts.clicktrigger,e);});self.update();self.thisroot=self.root;self.input=$(self.root).find("input[type=text], input[type=password], input[type=email], input[type=tel], input[type=number], textarea");self.checkboxoption=$(self.root).find(".checkbox-option");self.radiooption=$(self.root).find(".checkbox-option");if(self.input.val()){self.input.parent().addClass("hasvalue");}
else{self.input.parent().removeClass("hasvalue");}
$(self.input,self.checkboxoption,self.radiooption).on('keyup blur touchstart mouseup change',function(){if(self.input.val()){self.input.parent().addClass("hasvalue");}
else{self.input.parent().removeClass("hasvalue");}});$(self.input).on('focus',function(){if(self.input.val()){self.input.parent().addClass("hasvalue");}
else{self.input.parent().removeClass("hasvalue");}});$(self.input).focusin(function(){self.input.parent().addClass("hasfocus");});$(self.input).focusout(function(){self.input.parent().removeClass("hasfocus");});if($("input[name=NameOfEmployer]").val()!==undefined){$("#search-query").val($("input[name=NameOfEmployer]").val());}
self.selectedDate=self.opts.value;});self.on("update",function(){var input;switch(opts.type){case 'textarea':input=$(self.root).find("textarea.addvars")[0];break;case 'checkbox':input=$(self.root).find(".checkbox .addvars")[0];break;case 'textarea':input=$(self.root).find("textarea.addvars")[0];break;case 'text':case 'email':case 'password':case 'tel':case 'date':case 'number':input=$(self.root).find("input.addvars")[0];break;default:input=$(self.root).find(".addvars")[0];}
if($(self.root).find(".date-picker").length>0){$(input).val(moment(self.selectedDate).format('dddd D MMMM YYYY'));$(self.root).find(".date-picker").datepicker({dateFormat:'DD d MM yy',altFormat:"yyyy-mm-dd",defaultDate:moment(self.selectedDate).format('dddd D MMMM YYYY'),numberOfMonths:1,onSelect:function(selected,evnt){self.selectedDate=selected;if($(this).val()){$(this).parent().addClass("hasvalue");}
else{$(this).parent().removeClass("hasvalue");}
if($(this).hasClass("error")){$(this).valid();}}});}
if(self.input!=undefined&&self.input.val()!=""){self.input.parent().addClass("hasvalue");}});});riot.tag2('tag-loading','<div class="loading-veil" if="{loaderVisible == true}"><div class="loading-loader"><div class="col-sm-12 text-center"><div class="spinner"></div><br><div class="loading-message">{messageHeader}</div></div></div></div>','tag-loading,[riot-tag="tag-loading"],[data-is="tag-loading"]{ visibility: visible; } tag-loading .loading-veil,[riot-tag="tag-loading"] .loading-veil,[data-is="tag-loading"] .loading-veil{ background-color: rgba(0, 0, 0, 0.80); position: fixed; top: 0; bottom: 0; left: 0; right: 0; z-index: 10001; height: 100%; } tag-loading .loading-loader,[riot-tag="tag-loading"] .loading-loader,[data-is="tag-loading"] .loading-loader{ overflow: hidden; max-width: 50%; width: 50%; position: fixed; padding: 5px 0px; -webkit-transition: .3s; -o-transition: .3s; -webkit-transition: all .3s ease; -moz-transition: all .3s ease; transition: .3s; transition: all .3s ease; top: 50%; left: 50%; -moz-transform: translateX(-50%) translateY(-50%); -ms-transform: translateX(-50%) translateY(-50%); -o-transform: translateX(-50%) translateY(-50%); -webkit-transform: translateX(-50%) translateY(-50%); transform: translateX(-50%) translateY(-50%); max-width: 160px; }','',function(opts){var self=this;self.loaderVisible=false;self.meaageHeader="Loading";self.messageBody="";site.on('showLoader',function(data){self.loaderVisible=true;if(data){self.messageHeader=data.messageHeader;self.messageBody=data.messageBody;}
else{self.messageHeader="Loading";self.messageBody="";}
self.update();})
site.on('hideLoader',function(){self.loaderVisible=false;self.update();})});riot.tag2('tag-news-slider','<section class="spotlight-section {opts.sectionclass}"><yield from="header"></yield><div class="spotlight-slider" if="{model.entities}"><div class="slide" each="{article, index in model.entities}"><div class="holder"><a href="{article.properties.ArticleUrl}" class="track_newsslider"><div class="img-holder" riot-style="background-image:url(/cdn-cgi/image/width=288,quality=90{article.properties.CoverImage.replace(/\\(/g, \'%28\').replace(/\\)/g, \'%29\')});"><img riot-src="/cdn-cgi/image/width=288,quality=90{article.properties.CoverImage}" alt="{article.Title}" style="visibility:hidden"></div><div class="desc"><span class="title">{article.properties.Title}</span></div></a></div></div></div><yield from="footer"></yield></section>','tag-news-slider,[riot-tag="tag-news-slider"],[data-is="tag-news-slider"]{ visibility: visible; }','',function(opts){var self=this;self.on('before-mount',function(){opts.serviceurl=opts.serviceurl?opts.serviceurl.toLocaleLowerCase():opts.serviceurl;site.trigger("setdata",window.culture+opts.serviceurl,"GET","","serv"+opts.servicename,"serv"+opts.servicename,10);});self.on('mount',function(){setTimeout(function(){},200);})
site.on("serv"+self.opts.servicename+"-loading-success",function(data,result){if(result){self.model=data;self.update();setTimeout(function(){self.intitsliders();},50);}else{console.log("failed to get "+opts.servicename+" data",data);}});self.intitsliders=function(){var $spotslickSlider=$('.spotlight-slider');if($spotslickSlider.hasClass("initialised")){}
else{$spotslickSlider.addClass("initialised")
$spotslickSlider.slick({slidesToScroll:2,slidesToShow:3,prevArrow:'<button class="slick-prev"><span class="icon-ico-arrow-next"></span></button>',nextArrow:'<button class="slick-next"><span class="icon-ico-arrow-next"></span></button>',infinite:false,variableWidth:true,responsive:[{breakpoint:992,settings:{variableWidth:false,arrows:false,}},{breakpoint:768,settings:{slidesToShow:1,slidesToScroll:1,variableWidth:false,arrows:false,}}]});}}});riot.tag2('tag-manage-section','<tag-show-manage id="holder" sectionclass="blue-tab" apidomain="{window.location.href}" servicename="manage" serviceurl="/api-manage/manage/ujson?select=Name,appStoreImage,description,appStoreUrl,Id,Title,googleStoreUrl,footerText,googleStoreImage,appImage,backgroundClass,&resolveMedia=appStoreImage,googleStoreImage,appImage&cdv={cdv}"></tag-show-manage>','tag-manage-section,[riot-tag="tag-manage-section"],[data-is="tag-manage-section"]{ visibility: visible; }','',function(opts){var self=this;self.on('before-mount',function(){if(!app["serv"+opts.servicename]){opts.serviceurl=opts.serviceurl?opts.serviceurl.toLocaleLowerCase():opts.serviceurl;site.trigger("setdata",window.culture+(opts.serviceurl||""),"GET","","serv"+opts.servicename,"serv"+opts.servicename,2);}
else{self.model=app["serv"+opts.servicename];self.update();}});self.on('mount',function(){self.manage=self.tags['tag-show-manage'];})
site.on("serv"+self.opts.servicename+"-loading-success",function(data,result){if(result){self.model=data;self.update();}else{console.log("failed to get "+opts.servicename+" data",data);}});});riot.tag2('tag-show-manage','<section class="manage-section viewport-section {model.properties.BackgroundClass} in-viewport"><div class="container"><div class="holder"><div class="desc-holder"><span class="text h1" style="font-weight: lighter;font-size: 48px;text-transform:uppercase;">{model.properties.Title}</span><div class="appicon"><span><a href="{model.properties.AppStoreUrl}" target="_blank"><img src="{model.properties.AppStoreImage}" class="icon" width="140"></a></span>&nbsp;&nbsp;&nbsp;&nbsp;<span><a href="{model.properties.GoogleStoreUrl}" target="_blank"><img src="{model.properties.GoogleStoreImage}" class="icon" width="140"></a></span></div><span class="text h2" style="font-weight: 900;color: #36bee4;"> {model.properties.Description}</span><p style="text-align: left;margin-top: -13px; font-weight: 100;"><span class="sublink" style="color: #ffffff;">{model.properties.FooterText}&nbsp;</p><p></p></div><div class="img-holder"><span if="{dstvApp.language == \'English\'}"><img src="{model.properties.AppImage}" alt="image description English"></span><span if="{dstvApp.language == \'Portuguese\'}"><img src="/media/6959/new-phone-img-portu.png" alt="Image Description Portuguese"></span></div></div></div></div></section>','tag-show-manage,[riot-tag="tag-show-manage"],[data-is="tag-show-manage"]{ visibility: visible; }','',function(opts){var self=this;self.model={};self.display=false;self.loaded=false;self.apiloaded=false;self.domain=window.location.origin;self.truncate=function(string,length,mobilelength){if($(window).width()>=768){if(string.length<=length){return string;}
return string.substring(0,length)+'...';}
else{if(string.length<=mobilelength){return string;}
return string.substring(0,mobilelength)+'...';}};self.on('before-mount',function(){if(!app["serv"+opts.servicename]||window.reloadData){self.apiloaded=true;opts.serviceurl=opts.serviceurl?opts.serviceurl.toLocaleLowerCase():opts.serviceurl;site.trigger("setdata",window.culture+opts.serviceurl,"GET","","serv"+opts.servicename,"serv"+opts.servicename,0);}
else{self.model=app["serv"+opts.servicename];self.update();}});site.on("serv"+opts.servicename+"-loading-success",function(data,result){if(result){self.model=data;self.update();}else{console.log("failed to get "+opts.servicename+" data",data);}});site.on("makeslideactive",function(slidename){if(slidename==opts.servicename){if(!self.display){self.display=true;self.update();if(!self.loaded){self.loaded;}}}else{self.display=false;self.update();}});});riot.tag2('tag-package-detail','<div if="{model}"><div if="{opts.view == \'changepackage\'}"><div class="package-block" ref="packblock"><div class="package-image img-bg" if="{currentPackage[0].properties.ProductImage != \'\'}" riot-style="background-image: url({currentPackage[0].properties.ProductImage})"></div><div class="package-image img-bg" if="{currentPackage[0] == undefined || currentPackage[0].properties.ProductImage == \'\'}"></div><div if="{!tileviewset}" class="package-name"> {currentPackage[0].properties.PackageName.replace(\'DStv \',\'\')} </div><div if="{tileviewset}" class="package-icon-logo" title="{currentPackage[0].properties.PackageName.replace(\'DStv \',\'\')}"><i class="icon {\'icon-logo-\' + currentPackage[0].properties.Code}"></i></div><div class="pricebar"><div class="pack-price" if="{currentPackage[0].properties.Price}">{dstvApp.countrycurrency.toUpperCase() +" "+ currentPackage[0].properties.Price + currentPackage[0].properties.PriceLetter}</div></div><span if="{!opts.altprice == \'true\'}" class="icon-Tick_large check-select"></span><div if="{opts.altprice == \'true\'}" class="inline-block package-checkselect-holder"><span class="icon-Tick_large check-select"></span> Select this device </div></div></div></div><yield></yield>','tag-package-detail,[riot-tag="tag-package-detail"],[data-is="tag-package-detail"]{ visibility: visible; }','',function(opts){var self=this;self.currentPackage=undefined;self.model={};self.storedData=undefined;self.storedUmbracoPackages="umbracopackages";self.tileviewset=self.parent.opts.view=='tileview';self.on('before-mount',function(){if(self.storedUmbracoPackages&&app[self.storedUmbracoPackages]!=undefined){self.umbracopackages=app[self.storedUmbracoPackages];self.currentPackage=_.filter(app.umbracopackages.entities,function(obj){var currpack=_.findWhere([obj.properties],{Code:opts.package.value});if(currpack){return currpack;}});}});self.on('mount',function(){if(self.currentPackage){self.findcolour(self.currentPackage);}});site.on("umbracopackages-loading-success",function(data,result){if(result){self.umbracopackages=app[self.storedUmbracoPackages];self.currentPackage=_.filter(app.umbracopackages.entities,function(obj){var currpack=_.findWhere([obj.properties],{Code:opts.package.value});if(currpack){self.findcolour(currpack);return currpack;}});}
else{window.consolelog("umbraco package failed");}})
site.on(self.storedData,function(data,result){if(result){self.model=data;self.update();}else{console.log("failed to get data",data);}});self.findcolour=function(currentPackage){if(currentPackage[0]){self.refs.packblock.setAttribute('style','background-color:'+currentPackage[0].properties.PackageColor);}}});riot.tag2('tag-progress-bar','<div class="progress mb-8 mt-5 mb-sm-6 mt-sm-3"><div class="progress-steps" if="{opts.steps}"><div each="{step in steps}" class="progress-step step-{step.stepNumber} {active : stepActive(step)} {currentactive : step.stepNumber == currentStep}" riot-style="left: {stepPos(step)} "><span class="num"></span><span>{step.label}</span></div></div><div class="bar-holder"><div class="progress-bar" riot-style="width:{progress + \'%\'}"></div></div></div><h4 class="mobile-header">{heading}</h4>','tag-progress-bar,[riot-tag="tag-progress-bar"],[data-is="tag-progress-bar"]{ visibility: visible; display: block; } tag-progress-bar .progress,[riot-tag="tag-progress-bar"] .progress,[data-is="tag-progress-bar"] .progress{ position: relative; } tag-progress-bar .progress-steps,[riot-tag="tag-progress-bar"] .progress-steps,[data-is="tag-progress-bar"] .progress-steps{ position: absolute; top: 50%; margin: 0 10px; left: 0; right: 0; -moz-transform: translate(0, -50%); -ms-transform: translate(0, -50%); -o-transform: translate(0, -50%); -webkit-transform: translate(0, -50%); transform: translate(0, -50%); height: 2px; } tag-progress-bar .progress-step,[riot-tag="tag-progress-bar"] .progress-step,[data-is="tag-progress-bar"] .progress-step{ font-size: 12px; padding-top: 2px; position: absolute; } tag-progress-bar .progress-bar,[riot-tag="tag-progress-bar"] .progress-bar,[data-is="tag-progress-bar"] .progress-bar{ -moz-transition: width 2s ease; -o-transition: width 2s ease; -webkit-transition: width 2s ease; transition: width 2s ease; height: 2px; } tag-progress-bar .bar-holder,[riot-tag="tag-progress-bar"] .bar-holder,[data-is="tag-progress-bar"] .bar-holder{ background-color: rgba(85, 85, 85, 0.2); }','',function(opts){var self=this;self.stepsNo=parseInt(opts.stepsNo)||0;self.progress=opts.progress||0;self.currentStep=1;self.heading="";self.steps=self.opts.steps||[];self.heading=self.steps[0].stepHeading;var allSteps=self.steps;self.stepPos=function(step){if(step!=undefined){var ret=(step.stepNumber-1)*(100/(self.opts.stepsno-1))+"%";return ret;}};self.stepActive=function(step){if(step!=undefined){var ret=self.progress>=(parseInt(step.stepNumber-1)*(100/(self.opts.stepsno-1)));return ret;}};site.on('updateStepProgress',function(data){self.progress=data.progress;self.heading=allSteps[(data.step-1)].stepHeading;self.currentStep=data.step;self.update();})});riot.tag2('tag-raw','','','',function(opts){this.root.innerHTML=opts.content});riot.tag2('tag-raw-cardback','','','',function(opts){this.root.innerHTML=opts.content});riot.tag2('recurse','<ul each="{item in items}" no-reorder><li><h4>class: {item.class} </h4><div if="{item.properties}"><p>Properties: </p><ul class="bullets mb-2"><li each="{item, name in item.properties}"><b>{name.camelToTitleCase()} :</b> {item.value}</li></ul></div><div if="{item.actions}"><h4>Actions: </h4><div class="action-buttons"><span each="{item in item.actions}"><a href="{site.factory.formatUrl(item.href)}" class="btn btn-filled action-click" data-route="{item.class.join(\'_\')}"> {item.class.join(\'-\')} </a></span></div></div><div if="{item.links}"><h4>Links</h4><div class="link-buttons"><span each="{item in item.links}"><a href="{site.factory.formatUrl(item.href)}" class="btn btn-default link-click" data-route="{item.rel.join(\'_\')}">{item.rel.join(\'-\')}</a></span></div></div><div if="{item.entities}"><h4>Entities: </h4><recurse items="{item.entities}"></recurse></div></li></ul>','recurse,[riot-tag="recurse"],[data-is="recurse"],recurse .bordered,[riot-tag="recurse"] .bordered,[data-is="recurse"] .bordered{ padding: 5px 5px 5px 30px; display: block; background-color: rgba(0, 159, 255, 0.2); }','',function(opts){this.on('mount',function(eventName){});this.on('before-mount',function(eventName){this.items=opts.items;});});riot.tag2('tag-reward','<div if="{reward && (opts.ispremium || rewardstatus == \'7\')}" class="col-md-4 col-sm-6 reward-holder sHRewardHold"><div class="reward-block"><div class="reward-header pb-2 sHReward"><h3 class="">{reward.properties.Title}</h3><tag-raw content="{reward.properties.Description}"></tag-raw></div><div class="reward-img mb-4"><div class="reward-overlay" if="{rewardstatus == \'2\' || rewardstatus == \'1\' && challengeAccepted}"><img src="/images/moments/cal_icon.svg" width="100%" height="auto" alt="top_img_mobile"><div class="progress"><div class="progress-indicator" ref="progress" style="width:0"></div></div><div class="progress-marker"><div class="progress-indicator-bar"><div class="payments"><p><span class="payments-made">{String(milestone).padStart(2,0)}/{String(reward.properties.MilestonesRequired).padStart(2,0)} </span><span class="bold-font">PAYMENTS MADE</span></p></div></div></div></div><img riot-src="{reward.properties.Image}" width="100%" height="auto" alt="top_img_mobile"><div class="reward-gift-overlay" if="{rewardstatus == \'7\'}"><img src="/images/moments/gift-overlay_2.png" width="100%" height="auto" alt="top_img_mobile"></div></div><div if="{opts.reward.actions && opts.reward.actions.length > 0 || rewardstatus == \'7\'}"><a if="{rewardstatus == \'1\' && !challengeAccepted}" class="inlinePop btn btn-default btn-rounded btn-white btn-bordered anim-btn" onclick="{() => openpopup()}"><span class="anim-span"></span>{opts.reward.actions[0].title}<span class="arrow-next"></span></a><a if="{rewardstatus == \'7\'}" class="inlinePop btn btn-default btn-rounded btn-white btn-bordered anim-btn" onclick="{() => claimreward()}"><span class="anim-span"></span>Claim Reward<span class="arrow-next"></span></a><div class="hidden"><div id="open{_riot_id}" class="modal-pop-up make-table text-center"><div class="container-holder make-table-cell verticle-middle"><div class="container"><div class="row"><div class="col-sm-10 col-sm-push-1 col-xs-12 col-xs-push-0 view-area" if="{errorOccured}"><div class="title-area"><h2 class="uppercase h1">ERROR!<strong></strong></h2></div><div class="content-area"><div class="content"><p>An error has occured</p></div></div></div><div class="col-sm-10 col-sm-push-1 col-xs-12 col-xs-push-0 view-area" if="{rewardstatus == \'1\' && !acceptloading && !challengeAccepted && !errorOccured}"><div class="title-area"><img class="lead-image" src="/images/moments/thumbs_up.svg"><h2 class="uppercase h1">Oh <strong>yeah!</strong></h2></div><div class="content-area"><div class="content"><tag-raw content="{reward.properties.Description}"></tag-raw></div></div><div class="form-area"><div class="terms-holder" if="{termsVisible}"><tag-raw content="{reward.properties.TermsAndConditions}"></tag-raw></div><form action="#"><div class="checkbox-field pt-3 pb-4"><input class="checkbox-input" type="checkbox" name="checkboxOne"><label for="checkboxOne"><span><span></span></span></label><span> I agree to the <a onclick="{() => toggleTerms()}">terms and conditions</a></span></div></form><div if="{opts.reward.actions && opts.reward.actions.length > 0}"><button href="#" class="disabled btn btn-default btn-rounded btn-bordered anim-btn btn-primary" data-href="{opts.reward.actions[0].href}" onclick="{processAccept}"><span class="anim-span"></span>{opts.reward.actions[0].title} <span class="arrow-next"></span></button></div></div></div><div class="col-sm-10 col-sm-push-1 col-xs-12 col-xs-push-0 view-area" if="{rewardstatus == \'1\' && !acceptloading && challengeAccepted && !errorOccured}"><div class="title-area"><img class="lead-image" src="/images/moments/thumbs_up.svg"><h2 class="uppercase h1">Congrats!<strong></strong></h2></div><div class="content-area"><div class="content"><tag-raw content="{reward.properties.AcceptedMessage}"></tag-raw></div></div><div class="form-area pt-3 pb-4"><div><a onclick="{() => $.colorbox.close();}" class="btn btn-default btn-rounded btn-white btn-bordered anim-btn btn-primary"><span class="anim-span"></span>back to rewards <span class="arrow-next"></span></a></div></div></div><div class="col-sm-10 col-sm-push-1 col-xs-12 col-xs-push-0 view-area" if="{rewardstatus == \'1\' && acceptloading && !challengeAccepted && !errorOccured}"><div class="title-area"><h2 class="uppercase h1">Loading!<strong></strong></h2></div><div class="content-area"><div class="content"></div></div></div><div class="col-sm-10 col-sm-push-1 col-xs-12 col-xs-push-0 view-area" if="{rewardstatus == \'7\'&& !claimloading && claimed && !errorOccured}"><div class="title-area"><img class="lead-image" src="/images/moments/thumbs_up.svg"><h2 class="uppercase h1">Congrats!<strong></strong></h2></div><div class="content-area"><div class="content"><tag-raw content="{reward.properties.ClaimedMessage}"></tag-raw><p><a href="{opts.reward.properties.uRL.value}" class="" style="color: #d1b45f;" target="_blank">Claim your reward here</a> using <strong style="color: #fff;">#{opts.reward.properties.customerPin.value}</strong></p></div></div><div class="form-area pt-3 pb-4"><div><a onclick="{() => $.colorbox.close();}" class="btn btn-default btn-rounded btn-white btn-bordered anim-btn btn-primary"><span class="anim-span"></span>back to rewards <span class="arrow-next"></span></a></div></div></div><div class="col-sm-10 col-sm-push-1 col-xs-12 col-xs-push-0 view-area" if="{rewardstatus == \'7\' && claimloading && !claimed}"><div class="title-area"><h2 class="uppercase h1">Loading!<strong></strong></h2></div><div class="content-area"><div class="content"></div></div></div></div></div></div></div></div></div></div></div>','tag-reward,[riot-tag="tag-reward"],[data-is="tag-reward"]{ visibility: visible; }','',function(opts){var self=this;self.termsVisible=false;self.rewardstatus=opts.reward.properties.rewardStatus.value;self.milestone=opts.reward.properties.milestone.value;self.errorOccured=false;self.mixin("tracker");self.on('mount',function(){if(opts.reward&&app.momentscampaigns!=undefined){self.assignreward();};});self.openpopup=function(){self.errorOccured=false;$.colorbox({inline:true,href:$('#open'+self._riot_id),width:"100%",maxWidth:"100%",height:"100%"});var trackdata={};trackdata.status="open pop up";trackdata.location=location.href;trackdata.button=opts.reward.actions!=null?opts.reward.actions[0].title:"Claim Reward";self.track("moments-cta-click",trackdata);}
self.toggleTerms=function(){self.termsVisible=self.termsVisible==true?false:true;self.update();}
self.assignreward=function(){self.momentscampaigns=app.momentscampaigns;self.rewardfilter=_.find(app.momentscampaigns.entities,function(item){return item.title==opts.reward.properties.campaignType.value;});if(self.rewardfilter){self.reward=self.rewardfilter;if(self.refs.progress){self.progress=(parseInt(opts.reward.properties.milestone.value)/parseInt(self.reward.properties.MilestonesRequired))*100;$(self.refs.progress).css("width",self.progress>=100?"100%":self.progress+"%");}
self.update();if(self.colorboxLoaded){self.runjs();}}};site.on("momentscampaigns-loading-success",function(data,result){if(result){self.assignreward();}else{console.log("failed to get momentscampaigns data",data);}});site.on("colorboxLoaded",function(){self.colorboxLoaded=true;if(self.momentscampaigns&&self.reward){self.runjs();}});self.runjs=function(){if(self.jsrun==undefined){$('.form-area').find('.checkbox-input').on('change',function(e){e.preventDefault();if($(this).is(':checked')){$(this).closest('.form-area').find('.btn').removeClass('disabled');}else{$(this).closest('.form-area').find('.btn').addClass('disabled');};});}
self.jsrun=true;}
self.processAccept=function(e){self.acceptloading=true;self.update();var url=e.currentTarget.dataset.href;if(window.location.protocol!='https:'){url=url.Replace("https","http");}
site.trigger("getdata",url,self.successAcceptCallback,self.errorCallback,"",0);}
self.successAcceptCallback=function(data){self.challengeAccepted=true;self.acceptloading=false;console.log("challengeAccepted:"+self.challengeAccepted,"returned data:",data);self.update();site.trigger("setdata",app.url+"customers/"+app.customernumber+"/rewards","GET","","rewards","rewards",10);var trackdata={};trackdata.status="success";trackdata.location=location.href;trackdata.type="Challenge Accept Terms";self.track("moments-cta-click",trackdata);}
self.errorCallback=function(error){console.log(error);self.errorOccured=true;var trackdata={};trackdata.status="error";trackdata.location=location.href;trackdata.type="Challenge Accept Terms";self.track("moments-cta-click",trackdata);}
self.claimreward=function(){self.claimloading=true;self.claimed=false;self.openpopup();self.processClaim();self.update();}
self.processClaim=function(){setTimeout(function(){self.successClaimCallback("test data");},1000);}
self.successClaimCallback=function(data){self.claimloading=false;self.claimed=true;console.log("claimed:"+self.claimed,"returned data:",data);self.update();var trackdata={};trackdata.type="claimed reward for "+self.reward.title;trackdata.status="success";trackdata.location=location.href;self.track("moments-cta-click",trackdata)}
site.on("rewards-loading-success",function(data,result){if(result){self.update();}else{}});});riot.tag2('tag-select','<div if="{opts.type == \'select\'}"><div class="select-option group {\'hasvalue\' : opts.value != \'\'}"><select data-jcf="{⁗wrapNative⁗: false, ⁗wrapNativeOnMobile⁗: false, ⁗fakeDropInBody⁗: false, ⁗useCustomScroll⁗: false}" name="{opts.name}" class="{opts.cls} addvars" onchange="{opts.onchangeevent ? opts.onchangeevent : changed}" id="{opts.fieldid}" value="{current}" no-reorder><option value="">{opts.defaultoption == \'\' ? \'Select\' : opts.defaultoption}</option><option each="{opt in selectedoptions}" value="{opt.value}" __selected="{opts.value == opt.value}">{parent.opts.processaccountnumbers ? site.factory.GetAccountType(parent.opts.processaccountnumbers, opt.displayValue) : site.factory.translate(opt.displayValue)}</option></select><span class="help-block" if="{opts.error}">{opts.error}</span><span class="error-holder"></span></div></div>','tag-select,[riot-tag="tag-select"],[data-is="tag-select"]{ visibility: visible; } tag-select select,[riot-tag="tag-select"] select,[data-is="tag-select"] select{ -webkit-appearance: none; -moz-appearance: none; appearance: none; text-overflow: \'\'; text-indent: 0.01px; text-overflow: ""; } tag-select select::-ms-expand,[riot-tag="tag-select"] select::-ms-expand,[data-is="tag-select"] select::-ms-expand{ display: none; } tag-select .lbl,[riot-tag="tag-select"] .lbl,[data-is="tag-select"] .lbl{ color: #aaa; font-size: 14px; font-weight: normal; position: absolute; pointer-events: none; left: 20px; top: 14px; text-transform: uppercase; } tag-select .hasvalue label.lbl,[riot-tag="tag-select"] .hasvalue label.lbl,[data-is="tag-select"] .hasvalue label.lbl,tag-select .hasfocus label.lbl,[riot-tag="tag-select"] .hasfocus label.lbl,[data-is="tag-select"] .hasfocus label.lbl{ top: -25px !important; font-size: 13px; color: #777; } tag-select .password-meter .progress,[riot-tag="tag-select"] .password-meter .progress,[data-is="tag-select"] .password-meter .progress{ display: none; } tag-select .password-meter .hasvalue .progress,[riot-tag="tag-select"] .password-meter .hasvalue .progress,[data-is="tag-select"] .password-meter .hasvalue .progress{ display: block; } tag-select .help-block,[riot-tag="tag-select"] .help-block,[data-is="tag-select"] .help-block{ opacity: 0; display: none; } tag-select .help-block,[riot-tag="tag-select"] .help-block,[data-is="tag-select"] .help-block{ opacity: 0; top: 10px; position: absolute; left: 10px; -moz-transition: all ease-in-out 0.3s; -o-transition: all ease-in-out 0.3s; -webkit-transition: all ease-in-out 0.3s; transition: all ease-in-out 0.3s; font-style: italic; color: #999; } tag-select .error ~ .help-block,[riot-tag="tag-select"] .error ~ .help-block,[data-is="tag-select"] .error ~ .help-block{ display: none; } tag-select .error ~ .lbl,[riot-tag="tag-select"] .error ~ .lbl,[data-is="tag-select"] .error ~ .lbl{ color: #f02700; } tag-select .form-group:hover .help-block,[riot-tag="tag-select"] .form-group:hover .help-block,[data-is="tag-select"] .form-group:hover .help-block{ opacity: 1; top: 50px; line-height: 1; } tag-select input:-webkit-autofill ~ label.lbl,[riot-tag="tag-select"] input:-webkit-autofill ~ label.lbl,[data-is="tag-select"] input:-webkit-autofill ~ label.lbl{ top: -22px !important; font-size: 13px; color: #777; }','',function(opts){var self=this;self.current=opts.value==undefined?opts.value==undefined?"":opts.val:opts.value;self.checkselected=function(opt){if(self.current===opt.value||self.current===opt.val){return true;}else{return false;}}
self.changed=function(e){site.trigger('select-updated',e);}
self.selectedoptions=opts.selectoptions;self.updateMe=function(){self.selectedoptions=opts.selectoptions;var input=$(self.root).find("select.addvars")[0];if(input.enabled&&input.enabled=="false"){input.setAttribute('disabled','')}
if(input.type&&input.type=="select-one"){for(option in input.options){if(input.options.hasOwnProperty(option)){if(input.options[option].value==opts.value){if(opts.onchangeevent!=undefined&&opts.value!=""){site.trigger("update-fields",{"selectedPropName":input.name,"selectedText":input.options[option].text})}}}}}}
self.on('update',self.updateMe);self.on('update',function(){console.log("select updated");});self.on('mount',function(){if(opts.helptext){var x=opts.helptext;$(self.root).find(".help-block").html(x);}
$('form,input').attr("autocomplete","off");var input=$(self.root).find("select.addvars")[0];Object.keys(opts).forEach(function(key,i){if("label clicktrigger columns class riot-tag type validation selectoptions onchangeevent processaccountnumbers".indexOf(key)==-1){input.setAttribute(key,opts[key]);self.root.removeAttribute(key);}});if(input.enabled&&input.enabled=="false"){input.setAttribute('disabled','')}
if(input.type&&input.type=="select-one"){for(option in input.options){if(input.options.hasOwnProperty(option)){if(input.options[option].value==opts.value){$(input).val(opts.value);if(opts.onchangeevent!=undefined&&opts.value!=""){site.trigger("update-fields",{"selectedPropName":input.name,"selectedText":input.options[option].text})}}}}}
if(self.opts.validation){Object.keys(self.opts.validation).forEach(function(key,i){if("ignore".indexOf(key)==-1){input.setAttribute("required","");if(key=="required"){input.setAttribute("data-rule-"+key,self.opts.validation[key].value);input.setAttribute("data-msg-"+key,self.opts.validation[key].message);}
else{input.setAttribute("data-rule-"+key,self.opts.validation[key].value);input.setAttribute("data-msg-"+key,self.opts.validation[key].message);}}});}
self.thisroot=self.root;self.select=$(self.root).find("select");$(self.select).on('change',function(){if(self.select.find(":selected").attr("value")!=undefined&&self.select.find(":selected").val()!=""){self.select.parent().addClass("hasvalue");}else{self.select.parent().removeClass("hasvalue");}});if(self.select.find(":selected").attr("value")!=undefined&&self.select.find(":selected").val()!=""){self.select.parent().addClass("hasvalue");}
else{self.select.parent().removeClass("hasvalue");}
$(self.root).addClass("form-group");});});riot.tag2('tag-selfservice-nav','<section class="{opts.sectionclass} pt-sm-0 pb-xs-3"> <div class="container"> <div class="pb-0"> <div class="my-profile pb-3"> <div class="row"> <div class="col-md-12 sub-nav-col"> <ul class="list-inline faux-tabs mb-4 list-inline category-list-menu account-nav nav navbar-nav"> <li class="{activemenu != undefined && activemenu.indexOf(\'my-profile\') > 0 ? \'active\' : \'\'} sub-nav-holder" if="{window.culture != \'/en-ng\'}"> <div class="dropdown"> <button id="drop-my-profile" type="button" class="btn btn-link" data-toggle="dropdown" ref="drop-my-profile" aria-haspopup="true" aria-expanded="false">{langTranslateApp.subMenuMyProf} <span class="custom-caret"></span></button> <ul class="dropdown-menu" aria-labelledby="drop-my-profile"> <li class="{activemenu != undefined && activemenu.indexOf(\'update-details\') > 0 ? \'active\' : \'\'}"><a href="#my-profile/update-details" class="dropmyprofile-update-details">{langTranslateApp.contactUpdateDetails}</a></li> </ul> </div> </li> <li class="{activemenu != undefined && activemenu.indexOf(\'my-account\') > 0 ? \'active\' : \'\'} sub-nav-holder"> <div class="dropdown"> <button id="drop-my-account" type="button" class="btn btn-link" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">{langTranslateApp.subMenuMyAcc.toUpperCase()} <span class="custom-caret"></span></button> <ul class="dropdown-menu" aria-labelledby="drop-my-account"> <li class="{activemenu != undefined && activemenu.indexOf(\'view-balance\') > 0 ? \'active\' : \'\'}"><span class="dropmyaccount-make-payment"><a href="#my-account/view-balance">{langTranslateApp.subMenuViewMyBal}</a></span></li> <li class="{activemenu != undefined && activemenu.indexOf(\'transaction-history\') > 0 ? \'active\' : \'\'}"><a href="#my-account/transaction-history" class="dropmyaccount-transaction-history">{langTranslateApp.payPaymentHistory.toUpperCase()}</a></li> </ul> </div> </li> <li class="{activemenu != undefined && activemenu.indexOf(\'my-package\') > 0 ? \'active\' : \'\'} sub-nav-holder"> <div class="dropdown"> <button id="drop-my-package" type="button" class="btn btn-link" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">{langTranslateApp.subMenuMyPkg} <span class="custom-caret"></span></button> <ul class="dropdown-menu" aria-labelledby="drop-my-package"> <li class="{activemenu != undefined && activemenu.indexOf(\'fix-errors\') > 0 ? \'active\' : \'\'}"><a href="#my-package/fix-errors" class="dropmypackage-fix-errors">{langTranslateApp.fixErrorHeader}</a></li> <li class="{activemenu != undefined && activemenu.indexOf(\'change-package\') > 0 ? \'active\' : \'\'}"><span class="dropmypackage-change-package"><a href="#my-package/change-package">{langTranslateApp.pkgChangePackage}</a></span></li> </ul> </div> </li> </ul> </div> </div> </div> <div class="headerh3"> <h3 class="page-header {\'nouppercase\' : opts.uppercase} ">{opts.pagename}</h3> </div> </div> <yield></yield> <div class="update-detailes"> <div class="update-details mt-3"> <h4 class="mobile-header">{langTranslateApp.contactDetails}</h4> <div class="form-on-white first-form"> <div class="row step2 pb-2 pt-5 pt-sm-2"> <div class="col-xs-12"> <div class="text-info"></div> <div data-is="tag-form" formview="false"> <form ref="form" novalidate="novalidate" autocomplete="off"> <div> <fieldset> <div class="two-col"> <div> <div type="text" label="Title" class="form-group"> <div class="group hasvalue serial"> <input readonly="readonly" type="text" class="serial addvars" autocomplete="off" datais="tag-input" cls="serial" value={app.customercontactdetails.Title} name="title"> <div class="wrapper"> <span class="glyphicon glyphicon-info-sign"></span> <div class="tooltip">{langTranslateApp.accToolTip} <a href="{window.culture}/{langTranslateApp.subMenuContactUsLink}" target="_blank">{langTranslateApp.subMenuContactUs}</a></div> </div> <label class="lbl text" for="title" aria-label="Title">{langTranslateApp.contactTitle}</label> </div> </div> </div> <div> <div type="text" label="Name" class="form-group"> <div class="group hasvalue serial"> <input readonly="readonly" type="text" class="serial addvars" autocomplete="off" datais="tag-input" cls="serial" value={app.customercontactdetails.FirstName} name="firstName"> <div class="wrapper"> <span class="glyphicon glyphicon-info-sign"></span> <div class="tooltip">{langTranslateApp.accToolTip} <a href="{window.culture}/{langTranslateApp.subMenuContactUsLink}" target="_blank">{langTranslateApp.subMenuContactUs}</a></div> </div> <label class="lbl text" for="firstName" aria-label="First Name">{langTranslateApp.contactFirstName}</label> </div> </div> </div> <div> <div type="text" label="Surname" class="form-group"> <div class="group hasvalue serial"> <input readonly="readonly" type="text" class="serial addvars" autocomplete="off" datais="tag-input" cls="serial" value={app.customercontactdetails.Surname} name="surname"> <div class="wrapper"> <span class="glyphicon glyphicon-info-sign"></span> <div class="tooltip">{langTranslateApp.accToolTip} <a href="{window.culture}/{langTranslateApp.subMenuContactUsLink}" target="_blank">{langTranslateApp.subMenuContactUs}</a></div> </div> <label class="lbl text" for="surname" aria-label="Surname">{langTranslateApp.contactSurname}</label> </div> </div> </div> <div> <div type="text" label="Email Address" class="for m-group"> <div class="group hasvalue serial"><input placeholder=" " id="emailAddress" type="text" class="serial addvars form-control" autocomplete="off" datais="tag-input" cls="serial" value={app.customercontactdetails.EmailAddress.trim()} name="emailAddress" data-rule-email="true" data-msg-email="Please enter a valid email address"><label class="lbl text" for="emailAddress" aria-label="Email Address">{langTranslateApp.contactEmail}</label><span class="error-holder"></span></div> </div> </div> <div> <div type="tel" label="Mobile Tell" class="form-group"> <div class="group hasvalue serial"><span class="img-globe flagfortelephone" style="{dstvApp.flagposition}" title="{dstvApp.country} +{dstvApp.countryCode}"></span><input placeholder=" " id="cellNumber" type="tel" class="serial addvars form-control" style="padding-left: 30px;" autocomplete="off" datais="tag-input" cls="serial" value={app.customercontactdetails.MobileTel} error={dstvApp.cellnumbermessage} name="cellNumber" data-rule-checkphoneformat="true" data-msg-checkphoneformat={dstvApp.cellnumbermessage} data-rule-maxlength={dstvApp.cellnumbermaxlength} data-msg-maxlength={dstvApp.cellnumbermaxmessage} data-rule-required="true" data-msg-required={dstvApp.cellnumberrequiredmessage}><label class="lbl text" for="cellNumber" aria-label="Cell Number">{langTranslateApp.contactMobile}</label><span class="lbl text requiredField">*</span><span class="error-holder"></span></div> </div> </div> <div> <div type="tel" label="Home Tel" class="form-group"> <div class="group serial"><span class="img-globe flagfortelephone" style="{dstvApp.flagposition}" title="{dstvApp.country} +{dstvApp.countryCode}"></span><input placeholder=" " id="homeTel" type="tel" class="serial addvars form-control" style="padding-left: 30px;" autocomplete="off" datais="tag-input" cls="serial" value={app.customercontactdetails.HomeTel} name="homeNumber" data-rule-checkphoneformat="true" data-msg-checkphoneformat={dstvApp.homenumbermessage} data-rule-maxlength={dstvApp.cellnumbermaxlength} data-msg-maxlength={dstvApp.cellnumbermaxmessage}><label class="lbl text" for="homeNumber" aria-label="Home Number">{langTranslateApp.contactHomeTel}</label><span class="help-block hidden">{dstvApp.homenumbermessage}</span><span class="error-holder"></span></div> </div> </div> <div> <div type="tel" label="Work Tel" class="form-group"> <div class="group serial"><span class="img-globe flagfortelephone" style="{dstvApp.flagposition}" title="{dstvApp.country} +{dstvApp.countryCode}"></span><input placeholder=" " id="workTel" type="tel" class="serial addvars form-control" style="padding-left: 30px;" autocomplete="off" datais="tag-input" cls="serial" value={app.customercontactdetails.WorkTel} name="workNumber" data-rule-checkphoneformat="true" data-msg-checkphoneformat={dstvApp.worknumbermessage} data-rule-maxlength={dstvApp.cellnumbermaxlength} data-msg-maxlength={dstvApp.cellnumbermaxmessage}><label class="lbl text" for="workNumber" aria-label="Work Number">{langTranslateApp.contactWorkTel}</label><span class="help-block hidden">{dstvApp.worknumbermessage}</span><span class="error-holder"></span></div> </div> </div> <div> <div type="tel" label="Fax Tel" class="form-group"> <div class="group hasvalue serial"><span class="img-globe flagfortelephone" style="{dstvApp.flagposition}" title="{dstvApp.country} +{dstvApp.countryCode}"></span><input id="faxNumber" type="tel" class="serial addvars" style="padding-left: 30px;" autocomplete="off" datais="tag-input" cls="serial" value={app.customercontactdetails.FaxTel} name="faxNumber" data-rule-maxlength={dstvApp.cellnumbermaxlength} data-msg-maxlength={dstvApp.cellnumbermaxmessage}><label class="lbl text" for="faxtel" aria-label="Fax Tel">{langTranslateApp.contactFax}</label><span class="help-block hidden">{dstvApp.faxnumbermessage}</span><span class="error-holder"></span> </div> </div> </div> </div> </fieldset> </div> </form> </div> </div> <div class="next-form" style="display:block"> <p></p> <h4 class="mobile-header">{langTranslateApp.contactAddressDetails}</h4> <div class="form-on-white"> <div class="row step2 pb-2 pt-5 pt-sm-2"> <div class="col-xs-12"> <div class="text-info"></div> <div data-is="tag-form" formview="false"> <form ref="form" novalidate="novalidate" autocomplete="off"> <div> <fieldset> <div class="two-col"> <div> <div type="text" label="Country" class="form-group"> <div class="group serial"><input id="txtCountry" readonly="readonly" placeholder=" " type="text" class="serial addvars form-control" autocomplete="off" datais="tag-input" cls="serial" value={app.customeraddressdetails.Country} name="country"> <label class="lbl text" for="country" aria-label="Country">{langTranslateApp.contactCountry}</label><span class="error-holder"></span></div> </div> </div> <div> <div type="select" label="Province" class="form-group"> <div> <div class="select-option group hasvalue serial"> <select no-reorder="" id="ddlProvince" name="province" class="addvars jcf-hidden" value="{app.customeraddressdetails.Province}" datais="tag-select" error="undefined" cls="serial" defaultoption="Select Province" required="" data-rule-required="true" data-msg-required="Please provide Province"> <option class="hide" value="">Select Province</option> <option each="{province, index in app.provincelist.ProvinceList}" value="{province.Description}" selected="{ app.customeraddressdetails && app.customeraddressdetails.Province.toLowerCase() === province.Description.toLowerCase()}">{province.Description}</option> </select> <label class="lbl text" for="provinceName" aria-label="Province">{langTranslateApp.contactProvince}</label> <span class="error-holder"></span> </div> </div> </div> </div> <div> <div type="select" label="City" class="form-group"> <div> <div class="select-option group hasvalue serial"> <select no-reorder="" id="ddlCity" name="city" class="addvars jcf-hidden" value="{app.customeraddressdetails.City}" datais="tag-select" error="undefined" cls="serial" defaultoption="Select City" required="" data-rule-required="true" data-msg-required="Please provide City"> <option class="hide" value="">Select city</option> <option each="{cities, index in app.finalcitieslist.CityList}" value="{cities}" selected="{ app.customeraddressdetails && app.customeraddressdetails.City.toLowerCase() == cities.toLowerCase()}">{cities}</option> </select> <label class="lbl text" for="cityName" aria-label="City">{langTranslateApp.contactCity}</label> <span class="error-holder"></span> </div> </div> </div> </div> <div> <div type="select" label="Suburb" class="form-group"> <div> <div class="select-option group serial"> <select no-reorder="" id="ddlSuburb" name="suburb" class="addvars jcf-hidden" datais="tag-select" error="Please provide Suburb" cls="serial" defaultoption="Select Suburb" required="" data-rule-required="true" data-msg-required="Please provide Suburb"> <option class="hide" value="{app.customeraddressdetails.Suburb}">Select suburb</option> <option each="{suburbs, index in app.suburbsbycity.SuburbPostalCodeList}" value="{suburbs.Suburb}" selected="{app.customeraddressdetails && app.customeraddressdetails.Suburb.toLowerCase() == suburbs.Suburb.toLowerCase()}">{suburbs.Suburb}</option> </select> <label class="lbl text" for="suburbName" aria-label="Suburb">{langTranslateApp.contactSuburb}</label> <span class="error-holder"></span> </div> </div> </div> </div> <div> <div type="text" label="House Number" class="form-group"> <div class="group serial"><input id="houseNumber" placeholder=" " type="text" value={app.customeraddressdetails.HouseNumber} class="serial addvars form-control" autocomplete="off" datais="tag-input" cls="serial" name="physicalBuildingName"><label class="lbl text" for="physicalBuildingName" aria-label="Physical Building Name">{langTranslateApp.contactHouseNumber}</label><span class="error-holder"></span></div> </div> </div> <div> <div type="text" label="Street Name" class="form-group"> <div class="group hasvalue serial"><input id="streetName" placeholder=" " type="text" class="serial addvars form-control" autocomplete="off" datais="tag-input" cls="serial" value={app.customeraddressdetails.Street} name="physicalStreet"><label class="lbl text" for="physicalStreet" aria-label="Physical Street">{langTranslateApp.contactPhysicalStreet}</label><span class="error-holder"></span></div> </div> </div> <div> <div type="hidden" label="Postal Code" class="form-group"> <div class="group serial"><input readonly="readonly" type="text" id="txtPostalCode" value={app.customeraddressdetails.PostalCode} class="serial addvars form-control" autocomplete="off" datais="tag-input" cls="serial" error="Please provide Postal Code" name="physicalPostalCode" required="" data-rule-required="true" data-msg-required="Please provide Postal Code"><label class="lbl text" for="postalcode" aria-label="Postal Code">{langTranslateApp.contactPostalCode}</label></div> </div> </div> </div> </fieldset> </div> </form> </div> </div> <div class="col-xs-12 btn-area pt-5 pb-3 pt-sm-2 pb-sm-2"><button type="button" class="btn btn-default btn-rounded anim-btn cancel-btn"><span class="anim-span"></span>{langTranslateApp.contactCancel}</button><a id="btnSubmit" href="#" onclick={submitUpdateDetails} class="btn btn-primary btn-rounded anim-btn"><span class="anim-span"></span>{langTranslateApp.contactUpdate}</a></div> </div> </div> </div> </div> </div> <div class="row step2 notify pb-2 pt-4 pt-sm-2" id="updateSuccess" style="display:none"> <div> <div class="col-xs-12 text-center"> <div class="inline-block mb-2"><span class="ti icon-Tick_large down-ico"></span></div> </div> <div class="col-xs-12"> <div class="text-info text-center"> <h4 class="mt-3">GREAT! YOUR DETAILS HAVE BEEN UPDATED SUCCESSFULLY</h4> <p><a class="btn btn-primary" id="updateSuccessMessageBtn" href="/#my-profile/update-details">View my profile</a></p> </div> </div> </div> </div> <div class="relative" id="updateProcessing" style="display:none;min-height:300px;"> <div class="loading-loader loading"> <div class="col-sm-12 text-center black-text"> <div class="spinner black-text"></div> <div class="loading-message">{langTranslateApp.dashProcessing}</div> </div> </div> </div> <div class="row step2 notify pb-2 pt-2 pt-sm-2" id="updateError" style="display:none"> <div> <div class="col-xs-12"> <div class="text-info text-center"> <h4 class="mt-3">{langTranslateApp.dashboardLooksLikeProblem}</h4> <p>We were unable to process your request. We\'re sorry for any inconvenience, please try again later or if the problem persists, contact us.</p> <a href="{window.culture}/{langTranslateApp.subMenuContactUsLink}/" class="btn btn-primary mt-3 mb-1">{langTranslateApp.subMenuContactUs}</a> </div> </div> </div> </div> </div> </div> </div> <div class="container"> <div class="changepackagesPS"> <div> <h3 class="pageheader hidden">{langTranslateApp.pkgChangePackage}</h3> <div> <div class="row pb-2 change-package"> <div class="col-xs-12"> <div class="text-info"> <h4 class="package-change-info text-center">{langTranslateApp.pkgHeader}</h4> </div> <div class="list-info package-change-info"> <ul class="decoders"></ul> </div> </div> </div> </div> </div> <div class="package-select-sec"> <div class="row pb-2 pt-5 change-package"> <div class="col-xs-12"> <div class="text-info"> <div class="current-package-header mb-3"> <h4>{langTranslateApp.pkgCurrentlyOn} <strong id="currentlyOnID" class="text-primary"></strong></h4> <div class=""> <div> <div> <div class="current-package-block" ref="" style="background-color:#2bb34d"> <div class="current-package-image img-bg family-pack" style="background-image: url(/media/5138/compact-img.jpg)"></div> <div class="current-package-name">DStv Compact</div> <div class="current-pricebar"> <div class="current-pack-price">{dstvApp.countrycurrency} 305</div> </div> </div> </div> </div> </div> __ </div> </div> <div class="change-package-info text-info"> <h4 class="">{langTranslateApp.pkgEntertainmentAddOn} :</h4> <br> <ul class="packages"></ul> <div class="addOn"> <div class="text-info"> <h4 class="">{langTranslateApp.pkgAddChange}</h4> </div> <ul class="addOnpackages"></ul> </div> </div> <div class="no-package" style="display:none"> <div class="package-error-message"> </div> </div> <div id="paymentSummaryDiv" class="col-md-12 paymentSummary"></div> <div class="col-xs-12 btn-area pt-5 pb-3 pt-sm-2 pb-sm-2"><button class="cancel-butn-package btn btn-default btn-rounded anim-btn"><span class="anim-span "></span>{langTranslateApp.contactCancel}</button></div> </div> </div> </div> <div class="package-select-date-info"> <div class="row pb-2 pt-5 change-package"> <div class="col-xs-12"> <div class="text-info"> <h4 class="text-center">The package you have selected is lower than your existing package so we need to schedule the change from your current <strong class="text-primary">DStv Premium</strong> package to <strong>DStv Family</strong>. <br><br> Please pick a date for the switch that youre comfortable with from the options below.</h4> </div> <ul class="change-date"> <li class="feb-date" data-date-value="2019-02-23T12:00"> <div class="date-block"><span class="c-day">23 </span><span class="c-month">February </span><span class="c-year"> 2019</span><span class="icon-Tick_large check-select"></span></div> </li> <li data-date-value="2019-03-23T12:00"> <div class="date-block"><span class="c-day">23 </span><span class="c-month">March </span><span class="c-year"> 2019</span><span class="icon-Tick_large check-select"></span></div> </li> <li data-date-value="2019-04-23T12:00"> <div class="date-block"><span class="c-day">23 </span><span class="c-month">April </span><span class="c-year"> 2019</span><span class="icon-Tick_large check-select"></span></div> </li> </ul> </div> <div class="col-xs-12 btn-area pt-5 pb-3 pt-sm-2 pb-sm-2"><button class="cancel-butn-package-last btn btn-default btn-rounded anim-btn"><span class="anim-span"></span>Cancel</button></div> </div> </div> <div class="confirm-date-info"> <div> <div class="row pb-2 pt-5 change-package"> <div class="col-xs-12"> <ul class="change-confirm"> <li> <div class="confirm-block c-pack"><span>Your new package is <strong class="text-primary" style="color:#2bb34d">Family</strong></span></div> </li> <li> <div class="confirm-block c-date"><span>To be effective on <strong class="text-primary">23 February 2019</strong></span></div> </li> <li> <div class="confirm-block c-amount"><span>New monthly cost <strong class="text-primary">{dstvApp.countrycurrency}205.00</strong></span></div> </li> </ul> </div> <div class="col-xs-12 btn-area pt-5 pb-3 pt-sm-2 pb-sm-2"><button class="confirm-date-info-btn btn btn-default btn-rounded anim-btn"><span class="anim-span"></span>Cancel</button><a href="#" class="btn btn-primary btn-rounded anim-btn "><span class="anim-span"></span>Confirm</a></div> </div> </div> </div> </div> <div class="container"> <div class="my-profile my-profile-sec"> <div class="row pt-3"> <div class="p-0"> <div> <div class="row" id="smartcardblock"> <label class="selectcard">{langTranslateApp.balSelectSmartCard} :</label> <div class="col-sm-4 col-md-4"> <div if="{app.smartcards != undefined}"> <select onchange="{updateActiveTenureDetails}" id="selectsmartcard" name="selectsmartcard"> <option if="{app.smartcards != undefined}" each="{smartcard, index in app.smartcards}" id="{smartcard.SerialNumber}" value="{smartcard.SerialNumber}" class="custom-class">{smartcard.SerialNumber}</option> </select> </div> </div> </div> <div class=""> <div id="mainblock" class="col-md-6 col-sm-12" if="{ app.paymentduedetails.properties.amountToPay != undefined }"> <div class="row"> <div class="col-sm-12"> <div class="box-holder p-3 pt-4 mb-2" style="height: 268px;"> <h2 class="mb-5 uppercase total-amount">{langTranslateApp.accTotalPay}</h2> <div class="c100 big {site.factory.pieClassesGeneral(site.factory.getDateDiffValue(app.paymentduedetails.properties.dueDate.value),app.paymentduedetails.properties.amountToPay.value)}"> <div class="c-inner"> <div> <a href="javascript:;"> <ol> <li class="cvmtooltip">{site.factory.getDateDiff(app.paymentduedetails.properties.dueDate.value)} {langTranslateApp.balDays}</li> <li>{langTranslateApp.balLeftToPay}</li> <li class="price">{dstvApp.countrycurrency} {app.paymentduedetails.properties.amountToPay.value< 0?0 : app.paymentduedetails.properties.amountToPay.value}</li> <li if="{dstvApp.country == \'angola\'}" class="cvmtooltip">{langTranslateApp.angolaJVText}</li> </ol> </a> </div> </div> <div class="slice"> <div class="bar"></div> <div class="fill"></div> </div> </div> <div if="{ app.filteredResult != undefined }" style="margin-bottom: 35px;" class="text-center" ><a href="javascript:;" id="payOnTime" class="btn btntooltip {payOnTimeCss} tooltips" data-html="true" style="text-transform:none;font-weight:400;">{payOnTimeButtonText}<span id="payOnTimeTooTip" class="tooltipstext">{payOnTimeTooTip}</span><span><span class="glyphicon glyphicon-info-sign"></span></span></a><a href="javascript:;" id="activeTenureDuration" class="btn btntooltip {activeTenureDurationCss} tooltips" style="text-transform:none;font-weight:400;">{activeTenureButtonText}<span class="tooltipstext">{activeTenureDurationToolTip}</span><span><span class="glyphicon glyphicon-info-sign"></span></span></a></div> <a id="viewBalancePayBtn" href="#" data-target="totalamounttopay" class="btn btn-default dark residentialgeneral-button">{langTranslateApp.subMenuPayNow.toUpperCase()}</a> </div> </div> </div> </div> <div id="paymentGrid" class="col-md-6 hidden"> <div class="row"> <div class="col-sm-6 col-sm-8 shPaymentblock mb-2"> <div class="box-holder"> <h2 class="mb-5 uppercase">RESIDENTIAL</h2> <div class="c100 small {site.factory.pieClassesGeneral(site.factory.getDateDiffValue(app.paymentduedetails.properties.dueDate.value),app.paymentduedetails.properties.amountToPay.value)}"> <div class="c-inner"> <div> <a name="residentialgeneral" href="/#my-account/transaction-history"> <ol> <li>{site.factory.getDateDiff(app.paymentduedetails.properties.dueDate.value)} DAYS</li> <li>LEFT TO PAY</li> <li class="price">{dstvApp.countrycurrency} {app.paymentduedetails.properties.balanceAmount.value}</li> </ol> </a> </div> </div> <div class="slice"> <div class="bar"></div> <div class="fill"></div> </div> </div> <a href="#" data-target="landing" class="btn btn-default dark light-button disabled">PAID</a> </div> </div> </div> </div> </div> </div> </div> <div></div> </div> </div> </div> </div> </div></section>','tag-selfservice-nav,[riot-tag="tag-selfservice-nav"],[data-is="tag-selfservice-nav"]{ visibility: visible; }','',function(opts){var self=this;this.mixin('promise');if(app.loggedin){$('.newMenu').css('display','none');$('#navNewClick').css('display','none');$('.headerrightsidemenu').css('float','right');$('#siteCulture').click(function(e){e.preventDefault();return;})
$('#siteCulture').css('cursor','default');;}
self.on('mount',function(){$('[data-toggle="popover"]').popover();$('body').on('click',function(e){if($(e.target).data('toggle')!=='popover'&&$(e.target).parents('.popover.in').length===0){$('[data-toggle="popover"]').popover('hide');}});});});riot.tag2('tag-shows-service','<div class="{opts.sectionclass} bg-holder slide-holder" style="background-image:url({domain + model.properties.FeaturedBackground})" data-bg="{domain + model.properties.FeaturedBackground}" if="{display && model.properties}"><div class="heading-area"><div class="container"><span class="sub">{model.properties.Title}</span><h2>{model.properties.SubTitle}</h2></div></div><div class="show-slider-holder" if="{model.entities}"><div class="show-slider slide-item"><div class="slide" each="{show, index in model.entities}"><div class="scene"><div class="card" showtitle="{show.properties.Title}"><div class="img-holder card-face front multi-card"><a href="{show.properties.LinkUrl}" if="{show.properties.LinkUrl}" target="_blank" class="track_showslider"><img style="width:270px !important;" riot-src="/cdn-cgi/image/width=270,quality=90{show.properties.CoverImage}" alt="{show.properties.Title} cover"></a><img riot-src="/cdn-cgi/image/width=270,quality=90{show.properties.CoverImage}" alt="{show.properties.Title} cover" if="{!show.properties.LinkUrl}"><div class="lowholdFooter showcard"  riot-style="background-image:url({show.properties.CoverImage})"><span class="arrow-btn-watch show-btn">{langTranslateApp.showcardsbtn}</span></div></div><div class="desc-hold card-face back"><div class="body-wrap"><div class="head-area"><span class="genre" if="{show.properties.Type}">{show.properties.Type}</span><h2>{show.properties.Title}</h2></div><p if="{show.properties.Summary}">{truncate(show.properties.Summary,280, 120)}</p><ul class="meta-hold"><li if="{show.properties.ContentRating != \'\'}"><span class="ico icon-ico-pg"></span><span class="text">{show.properties.ContentRating}</span></li><li if="{show.properties.Genre != \'\'}"><span class="ico icon-ico-movietype"></span><span class="text">{show.properties.Genre}</span></li><li if="{show.properties.Duration != \'\'}"><span class="ico icon-ico-time"></span><span class="text">{show.properties.Duration}</span></li></ul></div><div class="btn-holder" if="{show.properties.RentNowLink || show.properties.TrailerUrl || show.properties.WatchNowLink}"><a if="{show.properties.RentNowLink && model.properties.Name != \'SERIES\'}" href="{show.properties.RentNowLink}" target="_blank" class="btn-desc fill track_showbutton">{langTranslateApp.dashRentNow}</a><a if="{show.properties.RentNowLink && model.properties.Name == \'SERIES\'}" href="{show.properties.RentNowLink}" target="_blank" class="btn-desc fill track_showbutton">{langTranslateApp.watchNow}</a><a if="{show.properties.TrailerUrl && model.properties.Name != \'LOCAL\' || model.properties.Name == \'INTERNATIONAL\'}" href="{show.properties.TrailerUrl}" target="_blank" class="btn-desc bordered track_showbutton">{langTranslateApp.watchTrailer}</a><a if="{show.properties.TrailerUrl && model.properties.Name == \'LOCAL\' || model.properties.Name == \'INTERNATIONAL\'}" href="{show.properties.TrailerUrl}" target="_blank" class="btn-desc bordered track_showbutton">{langTranslateApp.watchMoreInfo}</a></div></div></div></div></div></div></div><div class="low-area"><div class="container"><div class="wrap"><div class="logo-hold"><a href="{model.properties.FooterButtonUrl}" target="_blank" class="track_showbutton"></a></div><span class="arrow-btn-watch">{model.properties.FooterButtonText}</span><a href="{model.properties.FooterButtonUrl}" target="_blank"><button class="slick-next slick-arrow" style="display: block;" aria-disabled="false"><span class="icon-ico-arrow-next"></span></button></a></div></div></div></div>','tag-shows-service,[riot-tag="tag-shows-service"],[data-is="tag-shows-service"]{ visibility: visible; }','',function(opts){var self=this;self.model={};self.display=false;self.loaded=false;self.apiloaded=false;self.domain=window.location.origin;self.truncate=function(string,length,mobilelength){if($(window).width()>=768){if(string.length<=length){return string;}
return string.substring(0,length)+'...';}
else{if(string.length<=mobilelength){return string;}
return string.substring(0,mobilelength)+'...';}};self.on('before-mount',function(){if(!self.apiloaded){self.apiloaded=true;opts.serviceurl=opts.serviceurl?opts.serviceurl.toLocaleLowerCase():opts.serviceurl;site.trigger("setdata",window.culture+opts.serviceurl,"GET","","serv"+opts.servicename,"serv"+opts.servicename,10);}});site.on("serv"+opts.servicename+"-loading-success",function(data,result){if(result){self.model=data;self.update();setTimeout(function(){self.intitsliders();},50);}else{console.log("failed to get "+opts.servicename+" data",data);}});site.on("makeslideactive",function(slidename){if(slidename==opts.servicename){if(!self.display){self.display=true;self.update();if(!self.loaded){self.loaded;self.intitsliders();self.setBackground();}}}else{self.display=false;self.update();}});self.setBackground=function(){var bgBlock=$('.watch-section .bg-hold:first-child');var newBgBlock=$('<div class="bg-hold"></div>');var $container=$(self.root).find('.slide-holder');if($container.data('bg')&&bgBlock.length){newBgBlock.insertBefore(bgBlock);bgBlock.stop().animate({opacity:0},1000,function(){$('.watch-section .bg-hold.delete').remove();$('.watch-section .bg-hold').addClass('delete');});}else if($container.data('bg')){$('.watch-section .tabs-section').prepend(newBgBlock);bgBlock.stop().animate({opacity:0},1000,function(){$('.watch-section .bg-hold.delete').remove();$('.watch-section .bg-hold').addClass('delete');});}}
self.intitsliders=function(){$(self.root).find('.show-slider-holder').each(function(){var $holder=jQuery(this);if($holder.hasClass("initialised")){}
else{$holder.addClass("initialised")
var $container=$holder.closest('.slide-holder');var $slickSlider=$holder.find('.show-slider');var disabledClass='slick-disabled';var initialClass='initial-state';var fakePrevBtn=jQuery('<button class="fake-slick-prev slick-arrow"><span class="icon-ico-arrow-next"></span></button>');var fakeNextBtn=jQuery('<button class="fake-slick-next slick-arrow"><span class="icon-ico-arrow-next"></span></button>');$container.addClass(initialClass);$holder.append(fakePrevBtn);$holder.append(fakeNextBtn);$slickSlider.on('init',function(e,slick){});$slickSlider.slick({slidesToScroll:6,slidesToShow:6,prevArrow:'<button class="slick-prev"><span class="icon-ico-arrow-next"></span></button>',nextArrow:'<button class="slick-next"><span class="icon-ico-arrow-next"></span></button>',appendArrows:$holder,infinite:false,waitForAnimate:false,responsive:[{breakpoint:2100,settings:{slidesToShow:3,slidesToScroll:3}},{breakpoint:1600,settings:{slidesToShow:4,slidesToScroll:3,}},{breakpoint:1200,settings:{slidesToShow:4,slidesToScroll:4,}},{breakpoint:768,settings:{slidesToShow:2,slidesToScroll:2,}},{breakpoint:560,settings:{slidesToShow:1,slidesToScroll:1,}}],});$slickSlider.on('beforeChange',function(event,slick,currentSlide,nextSlide){var flippedSlides=slick.$slides.filter('.is-flipped');if(flippedSlides.length){flippedSlides.find('.is-flipped').removeClass('is-flipped')
flippedSlides.removeClass('is-flipped');}});$slickSlider.on('afterChange',function(event,slick,currentSlide){});$slickSlider.on('swipe',function(event,slick,direction){if(direction==='left'){event.preventDefault();if($container.hasClass(initialClass)){$container.removeClass(initialClass);if(slick.currentSlide>0){$container.removeClass(initialClass);setTimeout(function(){$slickSlider.slick('slickGoTo',0,true)},1)}}}
if(direction==='right'){if(slick.currentSlide===0){$container.addClass(initialClass);}}});$holder.on('click','.fake-slick-next',function(e){e.preventDefault();var $btnPrev=$holder.find('.slick-prev');if($btnPrev.hasClass(disabledClass)){$container.removeClass(initialClass);}
$(".watch-section .slick-slide").addClass("slick-active");});$holder.on('click','.fake-slick-prev',function(e){e.preventDefault();var $btnPrev=$holder.find('.slick-prev');if($btnPrev.hasClass(disabledClass)){$container.addClass(initialClass);}
$(".watch-section .slick-slide").addClass("slick-active");});}});}});riot.tag2('tag-shows-slider','<div class="section-hidden"><section class="watch-section" id="watch"><div class="tabs-section"><div class="watchBg"></div><div class="tabset-holder"><div class="container"><ul class="tabset lavalamp" if="{services}"><li each="{service, index in services}" class="{\'active\' : activeslide == service.opts.servicename}"><span class="icons-watch icons-watch-{service.opts.servicename}"></span><a class="name-watch name-watch-{service.opts.servicename}"  onclick="{() => parent.selectservice(service.opts.servicename)}" >{service.opts.servicename}</a></li></ul></div></div ><div class="slide-main-sec"><tag-shows-service sectionclass="blue-tab" apidomain="{window.location.href}" servicename="{langTranslateApp.watchLocal}" serviceurl="/api-services/{langTranslateApp.watchLocal}/ujson?children=true&select=Name,Episode,summary,description,coverImage,trailerUrl,Id,linkUrl,Title,SubTitle,footerButtonUrl,footerButtonText,featuredBackground&resolveMedia=coverImage,featuredBackground&cdv={cdv}"></tag-shows-service><tag-shows-service sectionclass="blue-tab international" apidomain="{window.location.href}" servicename="{langTranslateApp.watchIntl}" serviceurl="/api-services/{langTranslateApp.watchIntl}/ujson?children=true&select=Name,Episode,summary,description,coverImage,trailerUrl,Id,linkUrl,Title,SubTitle,footerButtonUrl,footerButtonText,featuredBackground&resolveMedia=coverImage,featuredBackground&cdv={cdv}"></tag-shows-service><tag-shows-service sectionclass="green-tab" apidomain="qa://www.dstvafrica.com/{window.culture}" servicename="{langTranslateApp.watchMovies}" servicelogo="/images/boxoffice-logo.png" servicelink="https://boxoffice.dstv.com/" serviceurl="/api-services/{langTranslateApp.watchMovies}/ujson?children=true&select=Name,Type,YearReleased,Episode,season,contentrating,coverImage,Id,summary,description,actors,genre,duration,trailerUrl,title,SubTitle,footerButtonUrl,footerButtonText,rentNowLink,additionalImages,featuredBackground&resolveMedia=coverImage,additionalImages,featuredBackground&cdv={cdv}"></tag-shows-service><tag-shows-service if="{hideseries}" sectionclass="pink-tab" apidomain="{window.location.href}" servicename="{langTranslateApp.watchSeries}" servicelogo="/images/showmax.svg" servicelink="https://www.showmax.com/" serviceurl="/api-services/{langTranslateApp.watchSeries}/ujson?children=true&select=Name,Type,YearReleased,Episode,season,contentrating,coverImage,Id,summary,description,actors,genre,duration,trailerUrl,title,SubTitle,footerButtonUrl,footerButtonText,rentNowLink,additionalImages,featuredBackground&resolveMedia=coverImage,additionalImages,featuredBackground&cdv={cdv}"></tag-shows-service><tag-shows-service sectionclass="red-tab" apidomain="{window.location.href}" servicename="{langTranslateApp.watchSport}" servicelogo="/markup/images/logo-supersport.png" servicelink="https://www.supersport.com/" serviceurl="/api-services/{langTranslateApp.watchSport}/ujson?children=true&select=Name,coverImage,Id,linkUrl,title,SubTitle,footerButtonUrl,footerButtonText,featuredBackground&resolveMedia=coverImage,featuredBackground&cdv={cdv}"></tag-shows-service></div></div></section><div>','tag-shows-slider,[riot-tag="tag-shows-slider"],[data-is="tag-shows-slider"]{ visibility: visible; }','',function(opts){var self=this;self.cdv=window.cdv;self.hideseries=!(window.culture=='/pt-ao'||window.culture=='/en-ao'||window.culture=='/pt-mz'||window.culture=='/en-mz');self.update();self.on('before-mount',function(){});self.on('mount',function(){self.services=self.tags['tag-shows-service'];if(self.services.constructor===Array){site.trigger("makeslideactive",self.services[0].opts.servicename);self.activeslide=self.services[0].opts.servicename;setTimeout(function(){self.services[0].setBackground();},1500);}else{site.trigger("makeslideactive",self.services.opts.servicename);self.activeslide=self.services.opts.servicename;setTimeout(function(){self.services.setBackground();},1500);}
self.update();initLavalamp();})
self.selectservice=function(service){self.activeslide=service;site.trigger("makeslideactive",service);$(".watch-section .slick-slide").addClass("slick-active");slideToElement('#watch');}});riot.tag2('tag-tab','<div class="my-tab-content"><yield></yield></div>','tag-tab,[riot-tag="tag-tab"],[data-is="tag-tab"]{ visibility: visible; }','',function(opts){var self=this;var thistag=$(self.root);var parentactive=false;self.on('mount',function(){});app.on('checkactive',function(data){if(data===opts.tabname){thistag.find(".my-tab-content").removeClass("hidden");}else{thistag.find(".my-tab-content").addClass("hidden");}});});riot.tag2('tag-tabs','<nav class="nav-tab pb-5 pb-md-4 mb-11 mb-md-4 object-non-visible" data-animation-effect="fadeIn" data-effect-delay="100"><ul class="tabset list-inline"><li if="{tabs.length > 1}" each="{tab, i in tabs}" class="{active: parent.isActiveTab(tab)}"><a href="javascript:void(0)" class="tabItem {is-active: parent.isActiveTab(tab)}" onclick="{parent.toggleTab}">{tab.opts.tabname}</a></li><li if="{tabs.length == undefined}" class="{active: parent.isActiveTab(tabs)}"><a href="javascript:void(0)" class="tabItem {is-active: parent.isActiveTab(tabs)}" onclick="{parent.toggleTab}">{tabs.opts.tabname}</a></li></ul></nav><div class="tab-content object-non-visible" data-animation-effect="fadeIn" data-effect-delay="200"><yield></yield></div>','tag-tabs,[riot-tag="tag-tabs"],[data-is="tag-tabs"]{ visibility: visible; } tag-tabs .tabs-wrapper,[riot-tag="tag-tabs"] .tabs-wrapper,[data-is="tag-tabs"] .tabs-wrapper{ position: relative; display: inline-block; width: 100%; height: 50px; overflow: hidden; } tag-tabs .scrolltab-scroller,[riot-tag="tag-tabs"] .scrolltab-scroller,[data-is="tag-tabs"] .scrolltab-scroller{ position: absolute; z-index: 1; -webkit-tap-highlight-color: rgba(0,0,0,0); display: block; width: auto; height: 50px; white-space: nowrap; } tag-tabs .scrolltab-scroller ul,[riot-tag="tag-tabs"] .scrolltab-scroller ul,[data-is="tag-tabs"] .scrolltab-scroller ul{ list-style: none; padding: 0; margin: 0; width: 100%; text-align: center; display: inline-block; width: auto; white-space: nowrap; }','',function(opts){var self=this;self.tabs=[];self.on('mount',function(){self.tabs=self.tags["tag-tab"];if(self.tabs.length){self.activeTab=self.tabs[0].opts.tabname;app.trigger("checkactive",self.activeTab);}else{self.activeTab=self.tabs.opts.tabname;app.trigger("checkactive",self.activeTab);}
self.update();});self.isActiveTab=function(tab){return self.activeTab===tab.opts.tabname;}
self.toggleTab=function(e){self.activeTab=e.item.tab.opts.tabname;app.trigger("checkactive",self.activeTab);return true;}});riot.tag2('tag-type-a-head','<div class="chatbot-holder"><div class="modal-block"></div><div id="bot"></div></div><div class="container" if="{!opts.inpage}"><div class="row"><div class="col-md-8 col-md-offset-2 col-xs-12 col-xs-offset-0 fullscreen relative"><form data-ref="searchform" action="/search/" class="search-form"><div class="input-holder mt-sm-5"><input data-ref="searchinput" class="form-control search" name="search" id="{opts.myid}" type="search" placeholder="{opts.placeholdertext || \'Enter search term...\'}" autocomplete="off"><button class="search-btn" type="submit"><div class="loading-anim"></div><i class="ti ti-search"></i></button><button data-ref="closesearch" id="closeSearch" type="button"><i class="ti ti-close"></i></button><div class="drop-content"></div></div><div if="{opts.displayslide == \'true\' && mobileDisplay && marqueeDisplay}" data-ref="galleryholder" class="gallery-holder"><div class="gallery-frame"><yield></yield><ul data-ref="wheelcarousel" class="wheel-carousel"></ul></div><div if="{loadingMarquee}" class="loading-loader loading"><div class="gallery-frame text-center white"><div class="spinner white"></div><div class="loading-message">Loading</div></div></div></div></form></div><div if="{opts.displayslide == \'true\' && !mobileDisplay && marqueeDisplay}" class="col-md-2 col-md-pull-1 col-xs-12 col-xs-offset-0 col-lg-2 col-lg-pull-0 fullscreen gallery-container"><div data-ref="galleryholder" class="gallery-holder"><div class="gallery-frame"><yield></yield><ul data-ref="wheelcarousel" class="wheel-carousel"></ul></div><div if="{loadingMarquee}" class="loading-loader loading"><div class="gallery-frame text-center white"><div class="spinner white"></div><div class="loading-message">Loading</div></div></div></div></div><ul data-ref="wheelcopy" class="hidden"></ul></div></div><form data-ref="searchform" action="/search/" class="search-form hidden" if="{opts.inpage}"><div class="input-holder mt-sm-5"><input data-ref="searchinput" class="form-control search" name="search" id="{opts.myid}" type="search" placeholder="{opts.placeholdertext || \'Enter search term...\'}" autocomplete="off"><button class="search-btn" type="submit"><div class="loading-anim"></div><i class="ti ti-search"></i></button><button data-ref="closesearch" id="closeSearch" type="button"><i class="ti ti-close"></i></button><div class="drop-content"></div></div></form>','tag-type-a-head,[riot-tag="tag-type-a-head"],[data-is="tag-type-a-head"]{ visibility: visible; } tag-type-a-head .typing .drop-content,[riot-tag="tag-type-a-head"] .typing .drop-content,[data-is="tag-type-a-head"] .typing .drop-content{ display: block !important; } tag-type-a-head .typing .drop-content .ui-autocomplete,[riot-tag="tag-type-a-head"] .typing .drop-content .ui-autocomplete,[data-is="tag-type-a-head"] .typing .drop-content .ui-autocomplete{ top: 0 !important; left: 0 !important; display: block !important; } tag-type-a-head .typing .drop-content .ui-autocomplete .result.show,[riot-tag="tag-type-a-head"] .typing .drop-content .ui-autocomplete .result.show,[data-is="tag-type-a-head"] .typing .drop-content .ui-autocomplete .result.show{ top: 0 !important; left: 0 !important; display: block !important; }','',function(opts){var getUrlParameter=function getUrlParameter(sParam){var sPageUrl=decodeURIComponent(window.location.search.substring(1)),sUrlVariables=sPageUrl.split('&'),sParameterName,i;for(i=0;i<sUrlVariables.length;i++){sParameterName=sUrlVariables[i].split('=');if(sParameterName[0]===sParam){return sParameterName[1]===undefined?true:sParameterName[1];}}};var self=this;self.selectfunction=opts.selectfunction||"selectItem";self.tagId="type-"+self._id;self.myid=opts.myid||"search-query";self.mod1="";self.mod2="";self.placeholdertext=opts.placeholdertext;self.loadingMarquee=true;self.marqueeDisplay=true;self.marqueeRunning=false;self.fetchAll=true;self.marqueeTries=50;self.mobileDisplay=false;if(StyleMixin!==undefined)
self.mixin(StyleMixin);self.on('mount',function(){var searchUrl=opts.searchsrc?opts.searchsrc:"http://gd.geobytes.com/AutoCompleteCity?callback=?&q=";if(!app["marquee-responses"]&&opts.view=="homepage"){var marqueeUrl="/umbraco/api/WebApiLuis/GetAllStoredResponses/";}else if(app["marquee-responses"]&&opts.view=="homepage"){self.buildMarqueeData(app["marquee-responses"]);}
self.screenCheck();initCustomForms();$("body").on("click",".drop-search-btn",function(e){e.preventDefault();$("form.search-form").submit();});$(self.refs.closesearch).on("click",function(){$(self.refs.searchform).removeClass("typing");var txtBox=$(self.refs.searchinput);txtBox.val('');txtBox.focus();});var searchParam=getUrlParameter("search");if(searchParam!==""&&searchParam!=null){$("#"+self.myid).val(searchParam.replace(/\+/g,' '));}
self.GetPlaceholderText();self.checkclearsearch=function(item,clear){if($(item).val()!=""&&!clear){$(self.refs.searchform).addClass("typing");};if(clear){$(item).val("");};};$(document).ready(function(){$(".input-holder input").on("click",function(){self.checkclearsearch("#"+self.myid,false);});$("#"+self.myid).on("blur",function(){$(this).prop("placeholder",self.placeholdertext);});$("#"+self.myid).on("focus",function(){$(this).prop("placeholder","");});});self.getData=function(request,response){$.getJSON(self.opts.searchsrc+request.term,function(data){self.fetchedData=data;if(data!==null&&data!==undefined){response(data.Result);}
$(".loading-anim").hide();$(".search-btn").removeClass("windows-search");});};self.selectItem=function(event,ui){if(ui.item!=undefined){$("#"+self.myid).val(ui.item.value);}
return false;}
if(!opts.resultdisplay&&!opts.resulturl){$(self.root).on('keydown.autocomplete',"#"+self.myid,function(){$(this).autocomplete({source:self.getData,select:self[self.selectfunction],minLength:2}).data("ui-autocomplete")._renderItem=function(ul,items){var that=this;$("<li id='drop-top'></li><li id='drop-content' aria-label='hi'></li>").appendTo(ul);$("<div></div>").appendTo($("#drop-content"));setMaxWidth();$.each(items,function(index,item){return $("<div></div>").data('ui-autocomplete-item',item).append("<a href='"+item+"'><i class='ti-file'></i> "+item+"</a>").appendTo($("#drop-content > div"));});};});}
$("#"+self.myid).on("autocompleteopen",function(event,ui){self.checkclearsearch("#"+self.myid,false);});$("#"+self.myid).on("autocompleteclose",function(event,ui){});function setMaxWidth(){var w=$("#"+self.myid).outerWidth();self.addCSSRule(".ui-autocomplete","max-width:"+w+"px !important;");}
var waitForFinalEvent=(function(){var timers={};return function(callback,ms,uniqueId){if(!uniqueId){uniqueId="Don't call this twice without a uniqueId";}
if(timers[uniqueId]){clearTimeout(timers[uniqueId]);}
timers[uniqueId]=setTimeout(callback,ms);};})();setMaxWidth();$(window).resize(function(){waitForFinalEvent(function(){var w=$("#"+self.myid).outerWidth();self.updateCSSRule(".ui-autocomplete"," max-width:"+w+"px !important;");},500,"type");setTimeout(function(){self.screenCheck();if(opts.view=="homepage"){self.refreshMarquee();}},100);});$('.search-opener').on('click',function(e){e.preventDefault();if($('body').hasClass('search-active')){if($(self.refs.galleryholder).data('MarqueeHorizontal')){$(self.refs.galleryholder).data('MarqueeHorizontal').destroy();$(self.refs.wheelcarousel).html('');}
if($(self.refs.galleryholder).data('Marquee')){$(self.refs.galleryholder).data('Marquee').destroy();$(self.refs.wheelcarousel).html('');}
if($("#for-menu-on-desktop .search-opener").hasClass("for-menu-on-mobile-search")||$("#for-package-landing-page .search-opener").hasClass("for-menu-on-mobile-search")){$("#for-menu-on-desktop > a.search-opener").removeClass("for-menu-on-mobile-search");$("#for-menu-on-desktop > a.search-opener").css("visibility","");$("#for-package-landing-page a.search-opener").removeClass("for-menu-on-mobile-search");$("#for-package-landing-page a.search-opener").css("visibility","");$(".nav-active #header .container-fluid").removeClass("hidden");$(".nav-active #nav").removeClass("hidden");$("#for-menu-on-desktop .search-opener").removeClass("for-menu-on-mobile-search")
$("#for-menu-on-desktop .search-opener").css("visibility","");$("body.tag-page-home.nav-active .banner-block .search-opener, body.tag-page-home.search-active #header, body.tag-page-ng-home.nav-active .banner-block .search-opener, body.tag-page-ng-home.search-active #header").css("z-index","");}
self.marqueeDisplay=false;self.marqueeRunning=false;self.update();}else{if(e.currentTarget.id==='for-menu-on-mobile-search'){$(".nav-active #header .container-fluid").addClass("hidden");$(".nav-active #nav").addClass("hidden");$("#for-menu-on-desktop > a.search-opener").addClass("for-menu-on-mobile-search");$("#for-menu-on-desktop > a.search-opener").css("visibility","visible");$("#for-package-landing-page a.search-opener").addClass("for-menu-on-mobile-search");$("#for-package-landing-page a.search-opener").css("visibility","visible");$("#for-menu-on-desktop .search-opener").addClass("for-menu-on-mobile-search");$("#for-menu-on-desktop .search-opener").css("visibility","visible");$("body.tag-page-home.nav-active .banner-block .search-opener, body.tag-page-home.search-active #header, body.tag-page-ng-home.nav-active .banner-block .search-opener, body.tag-page-ng-home.search-active #header").css("z-index","999");}
self.loadingMarquee=false;self.marqueeDisplay=true;self.marqueeRunning=false;self.update();self.loadMarquee();}});$(self.root).on('click','ul.wheel-carousel > li a',function(e){if($(e.target).data("hasurl")===true){return;}
var searchPhrase=e.target.innerText;$(self.refs.closesearch).click();$(self.refs.searchinput).val(searchPhrase).trigger("keydown");});});self.GetPlaceholderText=function(){}
site.on('loggedout',function(){self.GetPlaceholderText();});site.on("customerloaded",function(){self.GetPlaceholderText();});self.GetName=function(){var firstName=app[app.customernumber].properties.firstName.value;return firstName.charAt(0)+firstName.substr(1).toLocaleLowerCase();}
self.loadMarquee=function(){if($(self.refs.wheelcopy).html().length){self.loadingMarquee=false;$(self.refs.wheelcarousel).append($(self.refs.wheelcopy).html());self.marqueeDisplay=true;self.marqueeRunning=true;self.update();initMarquee();}else if(self.marqueeTries){setTimeout(function(){self.loadMarquee();},300);self.marqueeTries--;}}
self.refreshMarquee=function(){if(self.marqueeRunning){if($(self.refs.galleryholder).data('MarqueeHorizontal')){$(self.refs.galleryholder).data('MarqueeHorizontal').destroy();$(self.refs.wheelcarousel).html('');}
if($(self.refs.galleryholder).data('Marquee')){$(self.refs.galleryholder).data('Marquee').destroy();$(self.refs.wheelcarousel).html('');}
self.marqueeDisplay=false;self.marqueeRunning=false;self.update();setTimeout(function(){self.marqueeDisplay=true;self.update();self.loadMarquee();console.log('marquee refreshed');},200);}}
site.on("marquee-responses-loading-success",function(data,result){if(result){self.buildMarqueeData(data);}});self.buildMarqueeData=function(data){$.each(data,function(index,item){var hasUrl=false;var searchTerm=item.Query;var linkedItemUrl="#";var linkedItemJson=JSON.parse(item.LinkToItem);if(searchTerm=="Holiday home"||searchTerm=="Decoder Insurance"||searchTerm=="BoxOffice")return;if(linkedItemJson!=null){linkedItemUrl=linkedItemJson.url;hasUrl=true;}
$(self.refs.wheelcopy).append("<li> <a href='"+linkedItemUrl+"' data-hasurl='"+hasUrl+"'>"+searchTerm+"</a></li>");});self.fetchAll=false;self.loadingMarquee=false;self.update();}
self.screenCheck=function(){self.mobileDisplay=$(window).width()>991?false:true;self.update();}});riot.tag2('page-home','<yield></yield><main id="main" role="main"><div class="package"><tag-compare-slider apidomain="" currency="{dstvApp.countrycurrency}" sectionclass="bg-white" comparepackages="/packages/ujson?descendants=Package&where=isNigeria%20ne%20true%20and%20canCompare%20eq%20true&select=code,description,Name,newPrice,packageColor,Currency,Id,packageLogo,packageName,price,productImage,additionalProductImage,productDetail,appHeading,appTextColor,productMoreLink,packageFeatures,description,currency,channelCount,PriceLetter,canCompare&resolvemedia=productImage,additionalProductImage,packageLogo&cdv={cdv}" allchannels="/channels/ujson?descendants=Channel&select=channelName,ChannelGenre,ChannelPackages,ChannelLogo,AudioChannel,ChannelNumber&resolveToIds=ChannelGenre,ChannelPackages&resolveMedia=ChannelLogo&cdv={cdv}"><yield to="header"><div class="heading-area"><div class="container"><span class="sub">{langTranslateApp.browsercomparetitle}</span><h2 class="uppercase">{langTranslateApp.packagetitle}</h2></div></div></yield><yield to="footer"><div class="low-area"><div class="container"><div class="wrap"><span class="arrow-btn-label">{langTranslateApp.comparePkg}</span><a href="{window.culture}{langTranslateApp.subMenuGetComparePackagesLink}/"><button class="slick-next slick-arrow bg-gradient-45 arrow-font-color" style="display: block;" aria-disabled="false"><span class="icon-ico-arrow-next"></span></button></a></div></div></div></yield></tag-compare-slider></div><div class="package1"><tag-compare-slider apidomain="" currency="{dstvApp.countrycurrency}" sectionclass="bg-white" comparepackages="/packages/ujson?descendants=Package&where=isNigeria%20ne%20true%20and%20canCompare%20eq%20true&select=code,description,Name,newPrice,packageColor,Currency,Id,packageLogo,packageName,price,productImage,additionalProductImage,productDetail,appHeading,appTextColor,productMoreLink,packageFeatures,description,currency,channelCount,PriceLetter,canCompare&resolvemedia=productImage,additionalProductImage,packageLogo&cdv={cdv}" allchannels="/channels/ujson?descendants=Channel&select=channelName,ChannelGenre,ChannelPackages,ChannelLogo,AudioChannel,ChannelNumber&resolveToIds=ChannelGenre,ChannelPackages&resolveMedia=ChannelLogo&cdv={cdv}"><yield to="header"><div class="heading-area"><div class="container"><span class="sub">{langTranslateApp.browsercomparetitle}</span><h2 class="uppercase">{langTranslateApp.packagetitle}</h2></div></div></yield><yield to="footer"><div class="low-area"><div class="container"><div class="wrap"><span class="arrow-btn-label">{langTranslateApp.comparePkg}</span><a href="{window.culture}{langTranslateApp.subMenuGetComparePackagesLink}/"><button class="slick-next slick-arrow bg-gradient-45 arrow-font-color" style="display: block;" aria-disabled="false"><span class="icon-ico-arrow-next"></span></button></a></div></div></div></yield></tag-compare-slider></div><tag-decoder-slider apidomain="" currency="{dstvApp.countrycurrency}" sectionclass="bg-decoder" comparedecoders="/decoders/ujson?descendants=Package&where=isNigeria%20ne%20true%20and%20canCompare%20eq%20true&select=code,description,Name,newPrice,packageColor,Currency,Id,packageLogo,packageName,price,productImage,additionalProductImage,productDetail,appHeading,appTextColor,productMoreLink,packageFeatures,description,canCompare,priceLetter&resolvemedia=productImage,additionalProductImage,packageLogo&cdv={cdv}" ><yield to="header"><div class="heading-area"><div class="container"><span class="sub">{langTranslateApp.browserdecoderhm}</span><h2 class="uppercase">{langTranslateApp.decoderthitlehm}</h2></div></div></yield><yield to="footer"><div class="low-area"><div class="container"><div class="wrap"><span class="arrow-btn-label">{langTranslateApp.compareDec}</span><a href="{window.culture}/{langTranslateApp.decodersList}/"><button class="slick-next slick-arrow bg-gradient-45 arrow-font-color" style="display: block;" aria-disabled="false"><span class="icon-ico-arrow-next"></span></button></a></div></div></div></yield></tag-decoder-slider><div class="section-hidden"><tag-shows-slider></tag-shows-slider><tag-news-slider sectionclass="bg-white" servicename="dstvnews" serviceurl="/api-news/news/ujson?children=true&select=Name,coverImage,Id,articleUrl,title,subTitle,footerButtonText,footerButtonUrl,featuredBackground&resolveMedia=coverImage,featuredBackground&cdv={cdv"><yield to="header"><div class="heading-area"><div class="container"><h2>{model.properties.SubTitle}</h2><span class="sub">{model.properties.Title}</span></div></div></yield><yield to="footer"><div class="low-area"><div class="container"><div class="wrap"><span class="arrow-btn-label">{langTranslateApp.homeMoreNews.toUpperCase()}</span><a href="{model.properties.FooterButtonUrl}"><button class="slick-next slick-arrow bg-gradient-45 arrow-font-color" style="display: block;" aria-disabled="false"><span class="icon-ico-arrow-next"></span></button></a><a href="{model.properties.FooterButtonUrl}" class="hidden btn btn-primary track_homebutton"><span class="anim"></span>{langTranslateApp.homeMoreNews.toUpperCase()}</a></div></div></div></yield></tag-news-slider><tag-tvguide-slider></tag-tvguide-slider><tag-manage-section></tag-manage-section></main>','page-home,[riot-tag="page-home"],[data-is="page-home"]{ visibility: visible; }','',function(opts){var self=this;self.model={};self.cdv=window.cdv;self.routename='page-home';site.on('loggedout',function(){self.update();});self.on('mount',function(){});self.on('update',function(){});site.on('routeChanged',function(page){if(page===self.routename){self.initializePage();}
else{}});self.initializePage=function(){initSlickCarousel();initInViewport();initAnchors();jcf.replaceAll();jQuery('.video:has(.video-item)').each(function(){var videoHolder=jQuery(this);var videoItem=videoHolder.find('.video-item');var delay=500;var src=videoItem.attr('data-video-id');var startat="0";var stopat="150";var autoPlay="true";var mute="true";var volume="0";var loop="true";var containment="self";var background=true;videoItem.attr('data-property',"{ videoURL: '//youtu.be/"+src+"', autoPlay: true, loop: true, mute: true, startAt: 0, stopAt: 150, opacity: 1, quality: 'default' }");var myPlayer;setTimeout(function(){myPlayer=videoItem.YTPlayer({showControls:false,containment:videoHolder,showControls:false,playOnlyIfVisible:true,});videoItem.stop().animate({opacity:0},1);myPlayer.on('YTPReady',function(){videoItem.stop().animate({opacity:1},delay);});},1000)});$(self.root).on('click','.myclass',function(e){e.preventDefault();window.consolelog($(this));});}
site.on("customerloaded",function(){if(self.routename===app.currentroute){}});});riot.tag2('page-fix-errors','<yield></yield><tag-header view="generalpage" mysearchid="searchtype" searchurlsrc="/umbraco/api/WebApiLuis/GetLuisResponse/?restrictpath=-1&currentPage=1&filtertype=&search=" searchresultdisplay="Title" searchresulturl="Url" searchplaceholder="How can we help you?"></tag-header><tag-selfservice-nav sectionclass="" pagename="{langTranslateApp.fixErrorHeader}"><tag-fix-errors view="inpage"></tag-fix-errors></tag-selfservice-nav>','page-fix-errors,[riot-tag="page-fix-errors"],[data-is="page-fix-errors"]{ visibility: visible; }','',function(opts){var self=this;self.model={};self.PropertyConfig={};$(".changepackagesPS").hide();console.log("fixerroes");site.on('loggedout',function(){self.update();});self.on('mount',function(id,gg,hh,jj){this.message='now loading...';});this.on('before-mount',function(id,gg,hh,jj){self.model=app.customer;});self.fetchdataroute=function(url,successroute,errorroute){site.trigger("getdataroute",url,"",successroute,errorroute);}
self.fetchdata=function(url){site.trigger("getdata",url,self.successCallback,self.errorCallback);}
self.successRouteCallback=function(data,router){console.log(data,router);var d=router.substr(router.lastIndexOf('/')+1);app[d]=data;route(router);}
self.successCallback=function(data){self.model=data;self.update();}
self.errorCallback=function(error){console.log(error);}
self.linkclick=function(e){e.preventDefault();var url=e.currentTarget.dataset.href.Replace('https','http');switch(e.item.item.rel.join('_')){case "update_personal_details":self.fetchdataroute(url,"/customers/"+app.customernumber+"/updatepersonaldetails","update-personal-details/error");break;default:console.log("route-not-specified");self.fetchdataroute(url,"/generic/"+e.item.item.rel.join('_').Replace('-','_'),"/generic/error");break;}}
self.actionclick=function(e){e.preventDefault();var url=e.currentTarget.dataset.href.Replace('https','http');if(e.item.item.method!=undefined&&e.item.item.method==="POST"&&e.item.item.title!="Validate"){self.postdata(url,self.model);}
else if(e.item.item.title=="Validate"){self.validatedata(url,self.model);}
else{switch(e.item.item.class.join('_').Replace('-','_')){case "update_personal_details":self.fetchdataroute(url,"/customers/"+app.customernumber+"/updatepersonaldetails","update-personal-details/error");break;default:console.log("route-not-specified");self.fetchdataroute(url,"/generic/"+e.item.item.class.join('_').Replace('-','_'),"/generic/error");break;}}}
self.postdata=function(url,model){site.factory.setPropertyModel(model,self.tags["tag-form"].refs.form.elements);site.trigger("postdata",url,"POST",model,self.successPostCallback,self.errorPostCallback);}
self.validatedata=function(url,model){site.factory.setPropertyModel(model,self.tags["tag-form"].refs.form.elements);site.trigger("postdata",url,"POST",model,self.successValidateCallback,self.errorValidateCallback);}
self.successPostCallback=function(data){self.model=data;self.update();console.log(data);}
self.errorPostCallback=function(error){console.log(error);}
self.successValidateCallback=function(data){console.log(data);}
self.errorValidateCallback=function(error){console.log(error);}});riot.tag2('tag-application','<yield></yield><tag-routes ></tag-routes><tag-clear-errors-data></tag-clear-errors-data><tag-loading></tag-loading><tag-feedback view="modal"></tag-feedback><tag-tracker></tag-tracker>','tag-application,[riot-tag="tag-application"],[data-is="tag-application"]{ visibility: visible; }','',function(opts){var self=this;self.PropertyConfig={};site.on('loggedout',function(){self.update();});self.on('mount',function(){let arrayDualCurrencyContries=[];let arrayDualCurrencies=[];for(var i=0;i<dstvApp.DualCurrenciesList.length;i++){var split=dstvApp.DualCurrenciesList[i].split("-");arrayDualCurrencyContries.push(split[0]);arrayDualCurrencies.push(split[1]);}
$('.switch-input').change(function(){console.log('Toggle clicked');self.onCurrencyToggle();});self.showHidePriceTags=function(){if(app.dualCurrencyApplicable){$('.usdPrice').hide();$('.etbPrice').show();$('.usdCurrency').hide();$('.etbCurrency').show();$('.actualValue').hide();$('.etbValue').show();}
else{$('.etbPrice').hide();$('.usdPrice').show();$('.etbCurrency').hide();$('.usdCurrency').show();$('.etbValue').hide();$('.actualValue').show();}}
if(dstvApp.DualCurrency=='on'&&app.dualCurrencyApplicable){console.log('Dual currency is ON');var setToggleSwitch=function(){$('#toggleSwitch').addClass('jcf-label-active');$('.jcf-checkbox').removeClass('jcf-checked').addClass('jcf-unchecked');$('.switch-input').prop('checked',false);let currencyToggleStatus=$('.switch-input').prop('checked');site.factory.SetCurrency(currencyToggleStatus,dstvApp.countryabbreviation);};setTimeout(setToggleSwitch,50);try{var dualPackageValues=$('#dualPackageValues').attr('class').split('~');var currency=dualPackageValues[1].toString();var price=dualPackageValues[2].toString();var price_tag1=$('.etbPrice')[0];var price_span='<span class="currencyStyleHmPgBanner">'+currency+'</span><span class="priceStyle">'+price+'</span>';price_tag1.innerHTML=price_span;self.showHidePriceTags();}
catch(e){}}
else{console.log('Dual currency is OFF');var setToggleSwitch=function(){$('#toggleSwitch').removeClass('jcf-label-active');$('.jcf-checkbox').removeClass('jcf-unchecked').addClass('jcf-checked');$('.switch-input').prop('checked',true);let currencyToggleStatus=$('.switch-input').prop('checked');site.factory.SetCurrency(currencyToggleStatus,dstvApp.countryabbreviation);};setTimeout(setToggleSwitch,50);try{var dualPackageValues=$('#dualPackageValues').attr('class').split('~');var currency=dualPackageValues[1].toString();var price=dualPackageValues[2].toString();var etbPrice1=dualPackageValues;if(dstvApp.DualCurrencyCountryList.includes(dstvApp.countryabbreviation)){var price_tag1=$('.etbPrice')[0];var price_span='<span class="currencyStyleHmPgBanner">'+currency+'</span><span class="priceStyle">'+price+'</span>';price_tag1.innerHTML=price_span;}
self.showHidePriceTags();}
catch(e){}}
self.onCurrencyToggle=function(){let currencyToggleStatus=$('.switch-input').prop('checked');if(currencyToggleStatus!==undefined){site.factory.SetCurrency(currencyToggleStatus,dstvApp.countryabbreviation);}
self.setDualCurrencyFlag();self.showHidePriceTags();self.setPricingInModuleSection();riot.mount('tag-compare-slider');};self.setDualCurrencyFlag=function(){console.log('On setDualCurrencyFlag : After Currency Toggle');if(arrayDualCurrencies.includes(dstvApp.countrycurrency.toLowerCase())){app.dualCurrencyApplicable=true;window.SessionSave("app",app);}
else{app.dualCurrencyApplicable=false;window.SessionSave("app",app);}}
self.hideToggle=function(){$('.currencyToggle').hide();}
if((dstvApp.DualCurrency!=='on')||(!dstvApp.DualCurrencyCountryList.includes(dstvApp.countryabbreviation))||(window.location.href.includes('/decoders/'))||dstvApp.countryabbreviation=='mu'){self.hideToggle();}
if(dstvApp.countryabbreviation!=='mu'){self.showDualCurrencyDecoderPricing();self.setPricingInModuleSection();}});site.on('routeChanged',function(page){if(page!="page-home"&&page!="page-ng-home"){$("body").removeClass("home-page");}else{$("body").addClass("home-page");}
$("body[class*='tag-page-']").removeClass(function(index,css){return(css.match(/(^|\s)tag-page-\S+/g)||[]).join(' ');});$("body").addClass("tag-"+page);});self.showDualCurrencyDecoderPricing=function(){if(dstvApp.DualCurrencyCountryList.includes(dstvApp.countryabbreviation)&&window.location.href.includes('/decoders/')){let price_tag=document.getElementsByTagName("h2")[0];let price_span='<span class="currencyStyleHmPgBanner">'+'ETB'+'</span><span class="priceStyle">'+price.replace('USD','')+'</span>';price_tag.innerHTML=price_span;price_tag.style.display="block";}}
self.setPricingInModuleSection=function(){if(dstvApp.DualCurrency=='on'&&dstvApp.DualCurrencyCountryList.includes(dstvApp.countryabbreviation)){let dualPackageValues=$('#dualPackageValues').attr('class').split('~');let etbCurrency=dualPackageValues[1].toString();let etbPrice=dualPackageValues[2].toString();let usdCurrency='USD';let usdPrice=$('.usdPrice').text().split('USD')[1];if(app.dualCurrencyApplicable){$('.modulePrice').text(etbCurrency+' '+etbPrice);}
else{$('.modulePrice').text(usdCurrency+' '+usdPrice);}}}});riot.tag2('tag-routes','<router on-routechange="fireRouteChange" on-tagnotfound="fireTagnotfound"><route path="/" component="page-home"></route><route path="home" component="page-home"></route><route path="/main" component="page-home"></route><route path="ng-home" component="page-ng-home"></route><route path="login" component="page-login"></route><route path="decoders" component="page-decoders"></route><route path="feedback" component="page-feedback"></route><route path="moments" component="page-moments"></route><route path="my-profile" component="page-update-details"></route><route path="my-profile"><route path="/update-details" component="page-update-details"></route></route><route path="/manage" component="page-manage"></route><route path="my-account" component="page-my-account"></route><route path="my-account"><route path="/insure-decoder" component="page-insure-decoder"></route><route path="/link-showmax" component="page-link-showmax"></route><route path="/transaction-history" component="page-transaction-history"></route><route path="/my-statements" component="page-my-statements"></route><route path="/my-statements" component="page-my-statements"></route><route path="/my-statements" component="page-my-statements"></route><route path="/view-balance" component="page-view-balance"></route><route path="/set-up-debit-order" component="page-set-up-debit-order"></route><route path="/view-balance" component="page-make-payment"></route><route path="/view-balance/*" component="page-make-payment"></route><route path="/*" component="page-my-account"></route></route><route path="my-package"><route path="/fix-errors" component="page-fix-errors"></route><route path="/change-package" component="page-change-package"></route><route path="/holiday-viewing" component="page-holiday-viewing"></route><route path="/reconnect-packages" component="page-reconnect-packages"></route><route path="/upgrade-package" component="page-upgrade-package"></route></route><route path="customer"><route path="/*" component="tag-customer"></route></route><route path="generic"><route path="/*" component="tag-generic"></route></route></router>','','',function(opts){});riot.tag2('tag-fix-errors','<div class="title-area" if="{opts.view == \'tileview\'}"><div class="row"><div class=""><div class="selection-box p-3 mt-sm-3"><div class="box-content"><i class="icon-caution mb-3 mb-sm-2"></i><strong class="title mb-1">{langTranslateApp.subMenuErrorCode}</strong><p></p><div if="{tagstate == \'loading\'}"><div class="relative fix-errors-loader-bg"><div class="loading-loader loading"><div class="col-sm-12 text-center white"><div class="spinner white"></div><div class="loading-message">Loading</div></div></div></div></div><div if="{tagstate == \'loaded\' && app.loggedin && app.smartcards != undefined && app.clearerrorcodes != undefined}" class="p-0"><div><tag-fix-error-managepage selectclass="white" inputclass="serial" btnclass="btn-primary" view="tileview"></tag-fix-error-managepage></div></div><div if="{!app.loggedin && tagstate == \'loaded\' && app.clearerrorcodes != undefined}" class="p-0"><tag-fix-errors-logged-out selectclass="white" inputclass="serial" btnclass="btn-primary" view="tileview"></tag-fix-errors-logged-out></div></div></div></div></div></div><div class="search-area" if="{opts.view == \'searchbar\'}"><div class="head p-2 pt-3 pb-0 searchbar"><strong class="bold">{langTranslateApp.subMenuErrorCode}</strong><div class="row drop-list errors"><div if="{tagstate == \'loading\'}"><div class="relative fix-errors-loader-bg"><div class="loading-loader loading"><div class="col-sm-12 text-center white"><div class="spinner white"></div><div class="loading-message">Loading</div></div></div></div></div><div if="{tagstate == \'loaded\' && app.loggedin && app.decoders != undefined && app.clearerrorcodes != undefined}" class="p-0 clear-errors-form block-3"><tag-fix-error-managepage selectclass="" inputclass="serial" btnclass="btn-default" view="searchbar"></tag-fix-error-managepage></div><div if="{!app.loggedin && tagstate == \'loaded\' && app.clearerrorcodes != undefined}" class="p-0 clear-errors-form block-4"><tag-fix-errors-logged-out selectclass="" inputclass="serial" btnclass="btn-default" view="searchbar"></tag-fix-errors-logged-out></div></div></div></div><div class="in-page" if="{opts.view == \'inpage\'}"><div class="row"><div class="col-xs-12"><div class="form-holder p-3 pt-4"><h1>{langTranslateApp.subMenuErrorCode}</h1><p></p><div if="{tagstate == \'loading\'}"><div class="relative fix-errors-loader-bg"><div class="loading-loader loading"><div class="col-sm-12 text-center white"><div class="spinner white"></div></div></div></div></div><div><div if="{tagstate == \'loaded\' && app.loggedin && app.clearerrorcodes != undefined}" class="p-0"><div><tag-fix-error-managepage selectclass="white large" inputclass="serial" btnclass="btn-primary" view="inpage"></tag-fix-error-managepage></div></div><div if="{tagstate == \'loaded\' && !app.loggedin && app.clearerrorcodes != undefined}" class="p-0 block-4"><tag-fix-errors-logged-out selectclass="white large" inputclass="serial" btnclass="btn-primary" view="inpage"></tag-fix-errors-logged-out></div></div></div></div></div></div>','tag-fix-errors,[riot-tag="tag-fix-errors"],[data-is="tag-fix-errors"]{ visibility: visible; }','',function(opts){var self=this;self.model={};self.loggedin=app.customernumber?true:false;self.update();self.PropertyConfig={};self.tagstate="loaded";site.on("*",function(event){if(event===app.customernumber+"-loading-success"){self.update();}
self.update();});site.on("loggedin",function(){self.tagstate="loading";self.update();});site.on("decoders-loading",function(){self.tagstate="loading";self.update();});site.on("decoders-loading-fail",function(){self.tagstate="loaded";self.update();});site.on("clearerrorcodes-loading-success",function(){self.tagstate="loaded";self.update();});site.on("alldecodersloaded",function(){self.tagstate="loaded";self.update();});self.on('update',function(){self.tagstate="loaded";});self.on('mount',function(){self.tagstate="loaded";$('.changepackagesPS').hide();self.update();});site.on('customerloaded',function(){self.update();});});riot.tag2('tag-decoder','{decodername} <yield></yield>','tag-decoder,[riot-tag="tag-decoder"],[data-is="tag-decoder"]{ visibility: visible; }','',function(opts){var self=this;self.model={};self.decodername=opts.decoderserial;self.modelname=opts.model;self.loggedin=app[app.customernumber]?true:false;self.PropertyConfig={};self.on('mount',function(){if(app[opts.decoderserial]&&app[opts.decoderserial].properties&&app[opts.decoderserial].properties.linkedSmartcardSerialNumber){self.decodername=app[opts.decoderserial].properties.model.value+" : "+app[opts.decoderserial].properties.serialNumber.value+" / "+app[opts.decoderserial].properties.linkedSmartcardSerialNumber.value;self.update();}});self.on('update',function(){})
site.on(opts.decoderserial+"-loading-success",function(){if(app[opts.decoderserial]&&app[opts.decoderserial].properties&&app[opts.decoderserial].properties.linkedSmartcardSerialNumber){self.decodername=app[opts.decoderserial].properties.model.value+" : "+app[opts.decoderserial].properties.serialNumber.value+" / "+app[opts.decoderserial].properties.linkedSmartcardSerialNumber.value;self.update();}})});riot.tag2('tag-fix-errors-logged-in','<div class="list-info" if="{state == \'inprogress\'}"> <div class="main-top-fix-error-info row"> <div class="list-info"> <h1 class="heading-fix-error">{langTranslateApp.fixerrorTitle}</h1> <span class="sub-text-error">{langTranslateApp.fixerrorDiscription}</span> <div class="smartcard_slider"> <div class="center-heading-smarcard"><span>{langTranslateApp.fixerrorselctsmartcard}</span></div> <span class="arrows-fix-smart"></span> <div class="fix-smartcard-slider"> <div class="fix-slider fix-package slider"> <div class="package-item {package.primaryService.productName}-package fix-package" each="{package in packages}"> <label for="{package.SerialNumber}_radiobtn"> <div class="smartcard-section-top"> <div class="col-lg-5 col-sm-5 col-md-5 col-xs-5 decoder-img-left"><img src="/media/7655/explora-1.png"></div> <div class="smartcard fix-smt col-lg-5 col-sm-5 col-md-5 col-xs-5"> {langTranslateApp.loginSmartcardNumber} <div class="number">{package.SerialNumber}</div> <div class="col-lg-1 col-sm-1 col-md-1 col-xs-1 medium cinput"><input class="package-input" id="{package.SerialNumber}_radiobtn" alt="{package.primaryService.status}" name="test" type="radio" style="position: absolute; opacity: 0;" onchange="{onPackageClick}" value="{package.SerialNumber}"></div> </div> </div> <div class="smartcard-section-bottom {\'package-details contents \' + ptDashSmallFontClass}"> <div class="col-lg-4 col-sm-4 col-md-4 col-xs-4 package-name three-section"><span>{langTranslateApp.loginPackage}</span><span class="second-span"><i class="icon-pack icon-{package.primaryService.productCode}"></i></div> <div class="col-lg-4 col-sm-4 col-md-4 col-xs-4 three-section"><span>{langTranslateApp.addon}</span><span class="second-span">{package.addonService}</span></div> <div class="col-lg-4 col-sm-4 col-md-4 col-xs-4 three-section"> <span>{langTranslateApp.accStatus}</span> <span class="second-span"> <img src="/media/8268/icon-tick.svg" class="act-image" if="{package.primaryService.status == \'Active\'}"><span id="status" if="{dstvApp.language == \'English\'}">{package.primaryService.status}</span><span id="status" if="{dstvApp.language == \'Portuguese\' && package.primaryService.status == \'Active\'}">Activo</span><span id="status" if="{dstvApp.language == \'Portuguese\' && package.primaryService.status == \'Disconnected\'}">Desconectado</span> </span> </div> </div> </label> </div> </div> <!-- start --><!-- end --> </div> </div> </div> </div> <div class="form-group fix-error-option"> <div class="fix-error-options" if="{app.clearerrorcodes != undefined && formproperties != undefined && formproperties.properties != undefined}"> <select class="{opts.selectclass}" onchange="{changederror}" name="errorCode" data-ref="errorselectitem"> <option class="hide" value="">{langTranslateApp.fixErrorDropdownHeader}</option> <option each="{error, index in formproperties.properties.errorCode.selectFrom}" value="{error.value}">{error.displayValue}</option> </select> </div> <div if="{errorCode != undefined && errorCode != \'\' && state == \'inprogress\'}" class="note p-3 relative"> <div class="shadow-box"></div> <span>{errorCode.properties.Code} - {errorCode.properties.ErrorCodeName}</span> <!--div class="relative p-0"><div data-ref="dottext" class="p-0 inline-block"><div if="{opts.view == \'inpage\'}"><div><div data-ref="messagecontent" class="error-content">{htmlCatch(errorCode.properties.ErrorCodeDetail, false, \'messagecontent\')}</div></div><div><div class="mb-1 mt-1"><b>{langTranslateApp.fixErrorHowToFix}: </b></div><div data-ref="howtomessage" class="error-content">{htmlCatch(errorCode.properties.ErrorCodeHowToFix, false, \'howtomessage\')}</div></div></div></div><a if="{opts.view == \'tileview\'}" class="link-to" href="{\'/error-codes/#\' + value}">read more</a><a if="{opts.view == \'searchbar\'}" class="link-to" href="{\'/error-codes/#\' + value}">read more</a></div--> </div> <div class="textDisconnected"> <span class="icon-icon-Disconnected"></span><span class="disc-name">{titleDisconnected}</span> <p class="disc-pack">{textDisconnectedNote}</p> </div> <span class="bottom-note-text">{langTranslateApp.fixerrornote}</span> <div class="button fix-btn-bootom {fixItClass}"><a href="#" class="btn fixerror {opts.btnclass} {submitButton ? \'\': \'disabled\'}" onclick="{submit}" if="{submitButton}">{fixErrorButtonCaption}</a></div> </div></div></div><div if="{state == \'processing\'}"> <div class="fix-errors-loader-bg"> <div class="loading-loader loading"> <div class="col-sm-12 text-center white"> <div class="spinner white"></div> <div class="loading-message">{langTranslateApp.dashProcessing}</div> </div> </div> </div></div><div class="container-fluid main-section" if="{state == \'suspendederror\'}"> <div class="popup suspended"> <div class="row"> <img class="indicator-icon" style="width:9%;" src="/media/8074/warning_new_img.png" alt="suspended" /> <h2>{langTranslateApp.accountSuspended}</h2> <h4>{langTranslateApp.dstvAccountSuspended}.</h4> <p>{langTranslateApp.payNowToReconnect}.</p> <a href={paymentUrl} class="cta paybtn">{langTranslateApp.accPay}<span class="icon icon-Arrow_right_thin"></span></a> </div> </div></div><div class="container-fluid main-section" if="{state == \'addchangepackageerror\'}"> <div class="popup suspended"> <div class="row"> <img class="indicator-icon" style="width:9%;" src="/media/8074/warning_new_img.png" alt="addchangepackage" /> <h2>{langTranslateApp.addPackage}</h2> <h4>{langTranslateApp.dstvAddPackage}.</h4> <p>{langTranslateApp.addPackageDescription}.</p> <a href={dstvApp.ChangePackageURL} class="cta addChangePackagebtn">{langTranslateApp.addChangePackagebtn}<span class="icon icon-Arrow_right_thin"></span></a> </div> </div></div><div class="container-fluid main-section" if="{state == \'inprogressderror\'}"> <div class="popup suspended"> <div class="row"> <img class="indicator-icon" style="width:9%;" src="/8074/warning_new_img.png" alt="suspended" /> <h2>{langTranslateApp.requestInProgress}</h2> <h4>{langTranslateApp.yourRequestInProgress}.</h4> <p>{langTranslateApp.systemInProcess}.</p> <a href="javascript:void(0)" onclick="window.location.reload()" class="cta">{langTranslateApp.okGotIt}<span class="icon icon-Arrow_right_thin"></span></a> </div> </div></div><div class="container-fluid main-section" if="{state == \'success\'}"> <div class="popup success"> <div class="row"> <img class="indicator-icon" src="/media/8073/tickmark_icon.png" alt="" /> <h2>{langTranslateApp.successful}</h2> <h4>{langTranslateApp.requestProcessedSuccessfully}</h4> <p>{langTranslateApp.changesProcess}.</p> <a href="javascript:void(0)" onclick="window.location.reload()" class="cta success-btn">{langTranslateApp.okGotIt}<span class="icon icon-Arrow_right_thin"></span></a> </div> </div></div><div class="container-fluid main-section" if="{state == \'error\'}"> <div class="popup unsuccessful"> <div class="row"> <img class="indicator-icon" src="/media/8075/payment_failed.png" alt="unsuccessful" /> <h2>{langTranslateApp.dashboardRequestUnsuccessful}</h2> <p>{error.error}</p> <p>{langTranslateApp.dashPlzTryAgainAndContactUs}</p> <a href="javascript:void(0)" onclick="window.location.reload()" class="cta">{langTranslateApp.dashboardRetry}<span class="icon icon-Arrow_right_thin"></span></a> </div> </div></div>','tag-fix-errors-logged-in,[riot-tag="tag-fix-errors-logged-in"],[data-is="tag-fix-errors-logged-in"]{ visibility: visible; } tag-fix-errors-logged-in select,[riot-tag="tag-fix-errors-logged-in"] select,[data-is="tag-fix-errors-logged-in"] select{ display: none !important; }','',function(opts){var self=this;self.mixin("tracker");self.state="inprogress";self.selecteddecoder="";self.submitButton=false;self.errorCode="";self.model={};self.viewtype=opts.view;self.errors=false;self.dotdotit=false;self.showpackages=false;self.dotheight=100;let smartCardNumber=app.smartcard;self.PropertyConfig={"x-form-prelogin-clearErrorCodes":{"properties":[{"serialNumber":{"title":"Serial Number","type":"text","validations":{"mandatory":{"errorText":"A serial number is required","isMandatory":true}}}},{"surname":{"title":"Surname","type":"text","validations":{"mandatory":{"errorText":"A surname is required","isMandatory":true},"minLength":{"errorText":"Surname should be at least 2 characters","length":2}}}},{"errorCode":{"title":"Error","editable":"true","type":"select","selectFrom":[{"value":"e16","displayValue":"E16","allowedError":"false"},{"displayValue":"E30","value":"e30","allowedError":"false"},{"displayValue":"E32","value":"e32","allowedError":"false"}],"value":""}}],"links":[{"rel":["self"],"href":"https://selfservice.league.wg2k.com/selfservice/api/zaf/decoders/clearerrorcode/e16?processId=5ea77ff1-ceda-48c9-855a-9b01b9fa01a6&sessionId=f742bd69-daa7-4f2a-9a97-e1b5903d61be"}],"actions":[{"class":["next"],"title":"Next","method":"POST","href":"https://selfservice.league.wg2k.com/selfservice/api/zaf/decoders/clearerrorcode/e16?processId=5ea77ff1-ceda-48c9-855a-9b01b9fa01a6&sessionId=f742bd69-daa7-4f2a-9a97-e1b5903d61be","type":"application/json"}]}};;self.packageOpacity='package-section-opacity';self.packageLoaded=false;self.ptDashSmallFontClass=dstvApp.languageAbbreviation+"dash-small-font";;self.ptSmallFontClass=dstvApp.languageAbbreviation+"small-font";self.paymentUrl=dstvApp.PaymentURL+app.smartcard;self.fixErrorButtonCaption=langTranslateApp.accPay;self.isNoOnlinePayment=dstvApp.NoOnlinePaymentCountryList.includes(dstvApp.countryabbreviation);self.textDisconnectedNote=langTranslateApp.textDisconnected;self.titleDisconnected=langTranslateApp.titleDisconnected;self.fixItClass='';if(self.isNoOnlinePayment){if(dstvApp.language.toLowerCase()=='portuguese'){self.paymentUrl=window.culture+'/formas-de-pagamento';}
else{self.paymentUrl=window.culture+'/ways-to-pay';}
self.fixErrorButtonCaption=langTranslateApp.dashboardHowToPay;}
self.initiPackageSliderFixError=function(){$('.fix-slider').not('.slick-initialized').slick({appendArrows:'.arrows-fix-smart',dots:false,infinite:false,nextArrow:'<span class="slick-next slick-arrow arrowColor" aria-label="Next" style="transform: translateY(-50%) rotate(180deg) !important; height:30px !important; width:30px !important; line-height:30px !important; top:auto !important;"></span>',prevArrow:'<span class="slick-prev slick-arrow arrowColor" aria-label="Previous" style="transform: translateY(-50%) rotate(0deg) !important; height:30px !important; width:30px !important; line-height:30px !important; top:-11px !important;"></span>',slidesToShow:2,slidesToScroll:1,autoplay:false,speed:500,responsive:[{breakpoint:1024,settings:{slidesToShow:1,slidesToScroll:1,infinite:true,}},{breakpoint:768,settings:{slidesToShow:1,slidesToScroll:1,infinite:true,}},{breakpoint:600,settings:{slidesToShow:1,slidesToScroll:1,}},{breakpoint:480,settings:{slidesToShow:1,slidesToScroll:1,}}]});}
self.CreateToken=function(){site.factory.GetJWT().then(function(token){self.token=token;})}
self.on('mount',function(){if(opts.showmodal&&app.loggedin){$('#dashboardModelFixError').modal('show')
self.initialUpload();self.checkInitialStatus();}});self.initialUpload=function(){self.packages=app.smartcards;self.packages=self.packages.filter(x=>x.primaryService);self.update();if(app.clearerrorcodes!=undefined){self.formproperties=app.clearerrorcodes;self.errors=true;}
if(self.packages)
self.initiPackageSliderFixError();self.value=sessionStorage['errorCode'];if(self.value){self.changederror(undefined,true)
jQuery('select[name="errorCode"]').val(self.value);jcf.getInstance(jQuery('select[name="errorCode"]')).refresh();sessionStorage.removeItem('errorCode');}
self.CreateToken();let dashboardPackageHolder=$('.fix-package');let firstPackage;try{firstPackage=dashboardPackageHolder[0].firstElementChild;if(firstPackage){let radioButton=$(firstPackage.querySelector('input'));radioButton.attr('checked','checked');self.selectedserial=self.packages[0].SerialNumber;}}
catch(e){console.log('package radio button exception')}
self.update();jcf.replaceAll();jcf.refreshAll();}
self.checkInitialStatus=function(){setTimeout(function(){var isRadioChecked=$("input[name='test']:checked").is(":checked")
if(isRadioChecked){self.smartCardStatus=$("input[name='test']:checked")[0].alt.trim().toLowerCase();app.fixErrorSelectedCardStatus=self.smartCardStatus;window.SessionSave('app',app);}
if((self.smartCardStatus)&&(self.smartCardStatus=='disconnected'||self.smartCardStatus=='suspended')){console.log(self.smartCardStatus);self.hideTexts();}
else if(self.smartCardStatus&&self.smartCardStatus=='pending'){self.fixItClass='disable-fixerror-button';self.titleDisconnected=langTranslateApp.fixerrorTitlePending;self.textDisconnectedNote=langTranslateApp.fixerrorPendingNote;self.hideTexts();$('.fixerror').text(langTranslateApp.fixerrorbutton);self.update();}
else{self.showTexts();}},50);}
self.checkPostStatus=function(){self.fixItClass='';setTimeout(function(){var isRadioChecked=$("input[name='test']:checked").is(":checked")
if(isRadioChecked){self.smartCardStatus=$("input[name='test']:checked")[0].alt.trim().toLowerCase();app.fixErrorSelectedCardStatus=self.smartCardStatus;window.SessionSave('app',app);}
if((self.smartCardStatus)&&(self.smartCardStatus=='disconnected'||self.smartCardStatus=='suspended')){console.log(self.smartCardStatus);self.hideTexts();}
else if(self.smartCardStatus&&self.smartCardStatus=='pending'){self.fixItClass='disable-fixerror-button';self.titleDisconnected=langTranslateApp.fixerrorTitlePending;self.textDisconnectedNote=langTranslateApp.fixerrorPendingNote;self.hideTexts();$('.fixerror').text(langTranslateApp.fixerrorbutton);self.update();}
else{self.showTexts();}},500);}
self.hideTexts=function(){$('.fix-error-options').hide();$('.note').hide();$('.bottom-note-text').hide();$('.textDisconnected').show();$('.fixerror').text(self.fixErrorButtonCaption);}
self.showTexts=function(){$('.fix-error-options').show();$('.note').show();$('.bottom-note-text').show();$('.textDisconnected').hide();$('.fixerror').text(langTranslateApp.fixerrorbutton);}
self.dotdot=function(selector,display){if(selector!=undefined&&display){$(selector).trigger("destroy");$(selector).dotdotdot({ellipsis:"...",wrap:"word",height:self.dotheight,after:'a.link-to'});self.update();};}
self.htmlCatch=function(list,strip,content){var htmlList=list;if(htmlList!=undefined&&htmlList!=""){if(strip){var cleanList="";try{cleanList=$(htmlList).text();}catch(err){cleanList=htmlList.toString().replace(/(<([^>]+)>)/ig,"");};$(self.refs[content]).html(cleanList);}else{$(self.refs[content]).html(htmlList);};};}
self.onPackageClick=function(e){self.submitButton=true;self.selectedserial=e.target.value;self.checkPostStatus();self.update();}
self.changederror=function(e,isFromDashboard){if(!isFromDashboard)
self.value=e.target.value;else
self.value=sessionStorage['errorCode'];site.trigger('select-updated',e);self.errorCode=_.findWhere(app.errorcodelist.entities,{title:self.value.toUpperCase()});if(self.errorCode!=undefined&&self.errorCode!=''){if(!self.errorCode.properties.IsResetable){self.showpackages=false;self.update();}else{self.showpackages=true;self.update();}}
if(self.showpackages)
self.submitButton=true;else
self.submitButton=false;self.dotdot(self.refs.dottext,self.dotdotit);if(self.errorCode.properties.IsResetable){if(self.packages!=undefined&&self.packages.length){for(var i=0;i<self.packages.length;i++){var currdecoder=self.packages[i].SerialNumber;self.packages[i].clearerror=true;}}}
self.update();jcf.replaceAll();}
self.submit=function(e){if(app.fixErrorSelectedCardStatus&&(app.fixErrorSelectedCardStatus=='disconnected'||app.fixErrorSelectedCardStatus=='suspended')){var paymentUrl='';if(!self.selectedserial){self.state="error";self.error={};self.error.error=langTranslateApp.dashSelectValidCard;setTimeout(function(){location.reload();},100000);return;}
let smartcard=self.selectedserial;if(dstvApp.NoOnlinePaymentCountryList.includes(dstvApp.countryabbreviation)){site.factory.HandleHowToPay();return;}
else{if(dstvApp.DSOPayments&&dstvApp.DSOPayments.trim().toLowerCase()=='off'){window.location.href=dstvApp.PaymentBaseUrl+dstvApp.countryisocode+'/'+dstvApp.languageAbbreviation+'/payment/'+smartcard;}
else{self.loadPaymentsPopup();}}}
self.state='processing';e.preventDefault();if(!self.selectedserial){self.state="error";self.error={};self.error.error=langTranslateApp.dashSelectValidCard;setTimeout(function(){location.reload();},100000);return;}
let smartcard=self.selectedserial;let data={country:dstvApp.country,smartCardNumber:smartcard,errorCode:self.value.toUpperCase()};var url=`${dstvApp.DSOAPIUrl}apifixerror/api/v1/Reauthorize?BusinessUnit=${dstvApp.businessunit}&Channel=${dstvApp.channel}`;self.state='processing'
site.factory.Post(url,data,self.token,self.successPostCallback,self.errorPostCallback);}
self.successPostCallback=function(data,pollstatus){self.state="success";self.status=data;if(data.Message&&data.Message.includes("There were no active services on the device")){self.state="addchangepackageerror";}
self.update();site.factory.CaptureFeedback('DSTVFIXERROR_'+app.customernumber);}
self.errorPostCallback=function(error){self.state="error";if(error.responseJSON){self.error={};self.error.error=error.responseJSON.Message;}
else{self.error=typeof error.error.error=="string"?error.error:error.statusText;}
if(error.responseJSON.Message&&error.responseJSON.Message.includes("Your DStv account is suspended"))
self.state="suspendederror";if(error.responseJSON.Message&&error.responseJSON.Message.includes("Device not found for the smart card"))
self.state="addchangepackageerror";self.update();if(site.env=='QA')
site.factory.CaptureFeedback('DSTVFIXERROR_'+app.customernumber);}
self.loadPaymentsPopup=function(){console.log('loading payments pop-up');$('#dashboardModelFixError').modal('hide');riot.mount('tag-payments-new');$('#paymentModal').modal('show');}});riot.tag2('tag-fix-error-managepage','<div class="list-info" if="{state == \'inprogress\'}"><ol class="errors list-unstyled"><li if="{app.clearerrorcodes != undefined && formproperties != undefined && formproperties.properties != undefined}"><select class="{opts.selectclass}" onchange="{changederror}" name="errorCode" data-ref="errorselectitem"><option class="hide" value="">{langTranslateApp.fixErrorDropdownHeader}</option><option each="{error, index in formproperties.properties.errorCode.selectFrom}" value="{error.value}">{error.displayValue}</option></select></li><li if="{showdropdown && primaryPackages != undefined }"><select no-reorder data-ref="cleardecoderdropdown" class="medium {opts.selectclass} cinput" onchange="{changeddec}"><option class="hide" value="">{langTranslateApp.balSelectSmartCard}</option><option if="{smcard.Status == \'Active\'}" each="{smcard, index in primaryPackages}" value="{smcard.SerialNumber}">{smcard.SerialNumber}</option><option if="{smcard.Status != \'Active\'}" each="{smcard, index in primaryPackages}" value="{smcard.SerialNumber}">{smcard.SerialNumber}</option></select></li><li class="button"><a href="#" class="btn {opts.btnclass} {submitButton ? \'\': \'disabled\'}" onclick="{submit}" if="{submitButton}">{langTranslateApp.fixErrorNow}</a></li></ol></div><div if="{errorCode != undefined && errorCode != \'\' && state == \'inprogress\'}" class="note p-3 relative"><div class="shadow-box"></div><strong>{errorCode.properties.Code} - {errorCode.properties.ErrorCodeName}</strong><div class="relative p-0"><div data-ref="dottext" class="p-0 inline-block"><div if="{opts.view == \'inpage\'}"><div><div data-ref="messagecontent" class="error-content">{htmlCatch(errorCode.properties.ErrorCodeDetail, false, \'messagecontent\')}</div></div><div><div class="mb-1 mt-1"><b>{langTranslateApp.fixErrorHowToFix}: </b></div><div data-ref="howtomessage" class="error-content">{htmlCatch(errorCode.properties.ErrorCodeHowToFix, false, \'howtomessage\')}</div></div></div></div><a if="{opts.view == \'tileview\'}" class="link-to" href="{\'/error-codes/#\' + value}">read more</a><a if="{opts.view == \'searchbar\'}" class="link-to" href="{\'/error-codes/#\' + value}">read more</a></div></div><div if="{state == \'processing\'}"><div class="fix-errors-loader-bg"><div class="loading-loader loading"><div class="col-sm-12 text-center white"><div class="spinner white"></div><div class="loading-message">{langTranslateApp.dashProcessing}</div></div></div></div></div><div class="container-fluid main-section" if="{state == \'suspendederror\'}"><div class="popup suspended"><div class="row"><img class="indicator-icon" src="/media/8074/warning_new_img.png" alt="suspended" /><h2>{langTranslateApp.accountSuspended}</h2><h4>{langTranslateApp.dstvAccountSuspended}.</h4><p>{langTranslateApp.payNowToReconnect}.</p><a href={getPaymentUrl()} class="cta">{paymentButtonCaption}<span class="icon icon-Arrow_right_thin"></span></a></div></div></div><div class="container-fluid main-section" if="{state == \'addchangepackageerror\'}"><div class="popup suspended"><div class="row"><img class="indicator-icon" src="/media/8074/warning_new_img.png" alt="addchangepackage" /><h2>{langTranslateApp.titleDisconnected}</h2><h4>{langTranslateApp.dstvAddPackage}.</h4><p>{langTranslateApp.textDisconnected}.</p><a href={getPaymentUrl()} class="cta">{paymentButtonCaption}<span class="icon icon-Arrow_right_thin"></span></a></div></div></div><div class="container-fluid main-section" if="{state == \'inprogressderror\'}"><div class="popup suspended"><div class="row"><img class="indicator-icon" src="/media/8074/warning_new_img.png" alt="suspended" /><h2>{langTranslateApp.requestInProgress}</h2><h4>{langTranslateApp.yourRequestInProgress}.</h4><p>{langTranslateApp.systemInProcess}.</p><a href="javascript:void(0)" onclick="window.location.reload()" class="cta">{langTranslateApp.okGotIt}<span class="icon icon-Arrow_right_thin"></span></a></div></div></div><div class="container-fluid main-section" if="{state == \'success\'}"><div class="popup success"><div class="row"><img class="indicator-icon" src="/media/8073/tickmark_icon.png" alt="" /><h2>{langTranslateApp.successful}</h2><h4>{langTranslateApp.requestProcessedSuccessfully}</h4><p>{langTranslateApp.changesProcess}.</p><a href="javascript:void(0)" onclick="window.location.reload()" class="cta">{langTranslateApp.okGotIt}<span class="icon icon-Arrow_right_thin"></span></a> </div></div></div><div class="container-fluid main-section" if="{state == \'error\'}"><div class="popup unsuccessful"><div class="row"><img class="indicator-icon" src="/media/5972/unsuccessful.jpg" alt="unsuccessful" /><h2>{langTranslateApp.dashboardRequestUnsuccessful}</h2><p>{error.error}</p><p>{langTranslateApp.dashPlzTryAgainAndContactUs}</p><a href="javascript:void(0)" onclick="window.location.reload()" class="cta">{langTranslateApp.dashboardRetry}<span class="icon icon-Arrow_right_thin"></span></a> </div></div></div>','tag-fix-error-managepage,[riot-tag="tag-fix-error-managepage"],[data-is="tag-fix-error-managepage"]{ visibility: visible; } tag-fix-error-managepage select,[riot-tag="tag-fix-error-managepage"] select,[data-is="tag-fix-error-managepage"] select{ display: none !important; }','',function(opts){var self=this;self.mixin("tracker");self.state="inprogress";self.selecteddecoder="";self.submitButton=false;self.errorCode="";self.model={};self.viewtype=opts.view;self.errors=false;self.dotdotit=false;self.showdropdown=false;self.dotheight=100;let smartCardNumber=app.smartcard;self.PropertyConfig={"x-form-prelogin-clearErrorCodes":{"properties":[{"serialNumber":{"title":"Serial Number","type":"text","validations":{"mandatory":{"errorText":"A serial number is required","isMandatory":true}}}},{"surname":{"title":"Surname","type":"text","validations":{"mandatory":{"errorText":"A surname is required","isMandatory":true},"minLength":{"errorText":"Surname should be at least 2 characters","length":2}}}},{"errorCode":{"title":"Error","editable":"true","type":"select","selectFrom":[{"value":"e16","displayValue":"E16","allowedError":"false"},{"displayValue":"E30","value":"e30","allowedError":"false"},{"displayValue":"E32","value":"e32","allowedError":"false"}],"value":""}}],"links":[{"rel":["self"],"href":"https://selfservice.league.wg2k.com/selfservice/api/zaf/decoders/clearerrorcode/e16?processId=5ea77ff1-ceda-48c9-855a-9b01b9fa01a6&sessionId=f742bd69-daa7-4f2a-9a97-e1b5903d61be"}],"actions":[{"class":["next"],"title":"Next","method":"POST","href":"https://selfservice.league.wg2k.com/selfservice/api/zaf/decoders/clearerrorcode/e16?processId=5ea77ff1-ceda-48c9-855a-9b01b9fa01a6&sessionId=f742bd69-daa7-4f2a-9a97-e1b5903d61be","type":"application/json"}]}};;self.paymentButtonCaption=langTranslateApp.subMenuPayNow;if(self.viewtype!=undefined){switch(self.viewtype){case "tileview":self.dotheight=100;self.dotdotit=true;break;case "searchbar":self.dotheight=60;self.dotdotit=true;break;default:self.dotheight=100;}}
self.CreateToken=function(){site.factory.GetJWT().then(function(token){self.token=token;})}
site.on('clearerrorcodes-loading-success',function(data,result){if(result){self.formproperties=app.clearerrorcodes;site.factory.AugmentData(self.formproperties,self.PropertyConfig);self.errors=true;self.update();}});self.on('mount',function(){self.primaryPackages=app.smartcards;self.primaryPackages=self.primaryPackages.filter(x=>x.primaryService);self.update();if(app.clearerrorcodes!=undefined){self.formproperties=app.clearerrorcodes;if(app.clearerrorcodes.properties.errorCode.selectFrom===undefined){site.factory.AugmentData(self.formproperties,self.PropertyConfig);}
self.errors=true;self.update();if(window.location.href.indexOf("/error-codes/")>0){self.preselectederroccode=window.location.hash.toLowerCase().Replace("#","").Replace("_"," ");self.refs.errorselectitem.value=self.preselectederroccode;var val=self.preselectederroccode;var value=val.toUpperCase();setTimeout(function(){self.errorCode=_.findWhere(app.errorcodelist.entities,{title:value});if(self.errorCode!=undefined&&self.errorCode!=''){if(self.errorCode.properties.IsResetable){self.showdropdown=true;self.update();}else{self.showdropdown=false;self.update();}}
self.dotdot(self.refs.dottext,self.dotdotit);if(self.errorCode!=undefined&&self.errorCode!=''&&self.errorCode.properties.IsResetable){if(app.decoders!=undefined&&app.decoders.entities!=undefined&&app.decoders.entities[0].entities!=undefined){for(var i=0;i<app.decoders.entities[0].entities.length;i++){var currdecoder=app.decoders.entities[0].entities[i].properties.linkedSmartcardSerialNumber.value;var errocurrdecoder=app["ce"+currdecoder];if(errocurrdecoder!=undefined){var founderrorcode=_.find(errocurrdecoder.properties.errorCode.selectFrom,function(error){return error.value.toLowerCase()===self.preselectederroccode});if(founderrorcode!=undefined){app.decoders.entities[0].entities[i].clearerror=true;}else{app.decoders.entities[0].entities[i].clearerror=false;}}}
self.update();jcf.replaceAll();}}},5000);}
jcf.replaceAll();}
self.inintdropdowns();self.value=sessionStorage['errorCode'];if(self.value){self.changederror(undefined,true)
jQuery('select[name="errorCode"]').val(self.value);jcf.getInstance(jQuery('select[name="errorCode"]')).refresh();sessionStorage.removeItem('errorCode');}
console.log("Fix Error : tracking token if its created");self.CreateToken();self.update();});self.dotdot=function(selector,display){if(selector!=undefined&&display){$(selector).trigger("destroy");$(selector).dotdotdot({ellipsis:"...",wrap:"word",height:self.dotheight,after:'a.link-to'});self.update();};}
self.htmlCatch=function(list,strip,content){var htmlList=list;if(htmlList!=undefined&&htmlList!=""){if(strip){var cleanList="";try{cleanList=$(htmlList).text();}catch(err){cleanList=htmlList.toString().replace(/(<([^>]+)>)/ig,"");};$(self.refs[content]).html(cleanList);}else{$(self.refs[content]).html(htmlList);};};}
self.changeddec=function(e){site.trigger('select-updated',e);self.submitButton=true;self.selectedserial=e.target.value;self.update();jcf.replaceAll();}
self.changederror=function(e,isFromDashboard){if(!isFromDashboard)
self.value=e.target.value;else
self.value=sessionStorage['errorCode'];site.trigger('select-updated',e);self.errorCode=_.findWhere(app.errorcodelist.entities,{title:self.value.toUpperCase()});if(self.errorCode!=undefined&&self.errorCode!=''){if(!self.errorCode.properties.IsResetable){self.showdropdown=false;self.update();}else{self.showdropdown=true;self.update();}}
if(self.showdropdown)
self.submitButton=true;else
self.submitButton=false;self.dotdot(self.refs.dottext,self.dotdotit);if(self.errorCode.properties.IsResetable){if(app.smartcards!=undefined&&app.smartcards.length){for(var i=0;i<app.smartcards.length;i++){var currdecoder=app.smartcards[i].SerialNumber;app.smartcards[i].clearerror=true;}}}
self.update();jcf.replaceAll();}
site.on("alldecodersloaded",function(){if(app.clearerrorcodes){self.formproperties=app.clearerrorcodes;if(app.clearerrorcodes.properties.errorCode.selectFrom===undefined){site.factory.AugmentData(self.formproperties,self.PropertyConfig);}
self.errors=true;self.update();jcf.replaceAll();}});self.inintdropdowns=function(){self.update();jcf.replaceAll();var inputString=$("#searchtype").val();var inputWords=inputString.trim().split(" ");inputWords.forEach(function(word){var errorCodeDropdown=$('select[name="errorCode"]');if(app.errorcodelist&&app.errorcodelist.entities){self.errorCode=_.findWhere(app.errorcodelist.entities,{title:word.toUpperCase()});self.value=word;if(self.errorCode!=undefined&&self.errorCode!=''){errorCodeDropdown.val(word.toLowerCase());if(!self.errorCode.properties.IsResetable){self.showdropdown=false;self.update();}else{self.showdropdown=true;self.update();}
self.dotdot(self.refs.dottext,self.dotdotit);if(self.errorCode.properties.IsResetable){if(app.smartcards!=undefined){for(var i=0;i<app.decoders.entities[0].entities.length;i++){var currdecoder=app.decoders.entities[0].entities[i].properties.linkedSmartcardSerialNumber.value;var errocurrdecoder=app["ce"+currdecoder];if(errocurrdecoder!=undefined){var founderrorcode=_.find(errocurrdecoder.properties.errorCode.selectFrom,function(error){return error.value.toLowerCase()===self.value.toLowerCase()});if(founderrorcode!=undefined){app.decoders.entities[0].entities[i].clearerror=true;}else{app.decoders.entities[0].entities[i].clearerror=false;}}}}}
self.update();jcf.replaceAll();}}});}
self.submit=function(e){self.state='processing';e.preventDefault();if(!self.selectedserial){self.state="error";self.error={};self.error.error=langTranslateApp.dashSelectValidCard;setTimeout(function(){location.reload();},100000);return;}
let smartcard=self.selectedserial;let data={country:dstvApp.country,smartCardNumber:smartcard,errorCode:self.value.toUpperCase()};var url=`${dstvApp.DSOAPIUrl}apifixerror/api/v1/Reauthorize?BusinessUnit=${dstvApp.businessunit}&Channel=${dstvApp.channel}`;self.state='processing'
site.factory.Post(url,data,self.token,self.successPostCallback,self.errorPostCallback);}
self.successPostCallback=function(data,pollstatus){self.state="success";self.status=data;if(data.Message&&data.Message.includes("There were no active services on the device")){self.state="addchangepackageerror";}
self.update();site.factory.CaptureFeedback('DSTVFIXERROR_'+app.customernumber);}
self.errorPostCallback=function(error){self.state="error";if(error.responseJSON){self.error={};self.error.error=error.responseJSON.Message;}
else{self.error=typeof error.error.error=="string"?error.error:error.statusText;}
if(error.responseJSON.Message&&error.responseJSON.Message.includes("Your DStv account is suspended"))
self.state="suspendederror";if(error.responseJSON.Message&&error.responseJSON.Message.includes("Device not found for the smart card"))
self.state="addchangepackageerror";self.update();if(site.env=='QA')
site.factory.CaptureFeedback('DSTVFIXERROR_'+app.customernumber);}
self.getPaymentUrl=function(){if(dstvApp.NoOnlinePaymentCountryList.includes(dstvApp.countryabbreviation)){if(dstvApp.language.toLowerCase()=='portuguese'){return window.culture+'/formas-de-pagamento';}
else{return window.culture+'/ways-to-pay';}}
else{return dstvApp.ChangePackageURL;}}
if(dstvApp.NoOnlinePaymentCountryList.includes(dstvApp.countryabbreviation)){self.paymentButtonCaption=langTranslateApp.dashboardHowToPay;}});riot.tag2('tag-fix-errors-logged-out','<div class="list-info" if="{state == \'inprogress\'}"><ol class="errors list-unstyled"><li if="{app.clearerrorcodes != undefined && formproperties != undefined && formproperties.properties != undefined}"><select class="{opts.selectclass}" onchange="{selectError}" name="errorCode" data-ref="errorselectitem"><option class="hide" value="">{langTranslateApp.fixErrorDropdownHeader}</option><option each="{error, index in formproperties.properties.errorCode.selectFrom}" value="{error.value}">{error.displayValue}</option></select></li><li each="{item, name in formproperties.properties}" if="{name == \'serialNumber\'}"><div data-is="tag-input" onkeypress={ValidateNumeric} type="{item.editable == false || (item.type == \'select\' && item.selectFrom == undefined) ? \'hidden\' : item.type}" cls="{parent.opts.inputclass} cinput" value="{item.value}" label="{langTranslateApp.loginSmartcardNumber}" validation="{item.validations}" error="{item.error}" name="{name}" if="{item.type != \'select\' || item.editable == false || (item.type == \'select\' && item.selectFrom == undefined)}"></div></li><li class="button"><a href="#" class="btn {opts.btnclass} {submitButton ? \'\': \'disabled\'}" onclick="{submitClearErrorLoggedOut}" if="{submitButton}">{langTranslateApp.fixErrorNow}</a></li></ol></div><div if="{errorCode != undefined && errorCode != \'\' && state == \'inprogress\'}" class="note p-3 relative"><div class="shadow-box"></div> <strong>{errorCode.properties.Code} - {errorCode.properties.ErrorCodeName}</strong> <div class="relative p-0"><div data-ref="dottext" class="p-0 inline-block"><div data-ref="howtomessage" if="{opts.view != \'inpage\'}" class="error-content">{htmlCatch(errorCode.properties.ErrorCodeHowToFix, true, \'howtomessage\')}</div><div if="{opts.view == \'inpage\'}"><div><div class="mb-1"><b>{langTranslateApp.fixErrorCauseOfError}: </b></div><div data-ref="messagecontent" class="error-content">{htmlCatch(errorCode.properties.ErrorCodeDetail, false, \'messagecontent\')}</div></div><div><div class="mb-1 mt-1"><b>{langTranslateApp.fixErrorHowToFix}: </b></div><div data-ref="howtomessage" class="error-content">{htmlCatch(errorCode.properties.ErrorCodeHowToFix, false, \'howtomessage\')}</div></div></div></div> <a if="{opts.view == \'tileview\'}" class="link-to" href="{\'/error-codes/#\' + errorCode.properties.Code.Replace(\' \',\'_\')}">read more</a><a if="{opts.view == \'searchbar\'}" class="link-to" href="{\'/error-codes/#\' + errorCode.properties.Code.Replace(\' \',\'_\')}">read more</a> </div></div><div if="{state == \'processing\'}"><div class="fix-errors-loader-bg"><div class="loading-loader loading"><div class="col-sm-12 text-center white"><div class="spinner white"></div><div class="loading-message">{langTranslateApp.dashProcessing}</div></div></div></div></div><div class="container-fluid main-section" if="{state == \'suspendederror\'}"><div class="popup suspended"><div class="row"><img class="indicator-icon" src="/media/5971/suspended.jpg" alt="suspended" /><h2>{langTranslateApp.accountSuspended}</h2><h4>{langTranslateApp.dstvAccountSuspended}.</h4><p>{langTranslateApp.payNowToReconnect}.</p><a href={getPaymentUrl()} class="cta">{paymentButtonCaption}<span class="icon icon-Arrow_right_thin"></span></a></div></div></div><div class="container-fluid main-section" if="{state == \'addchangepackageerror\'}"><div class="popup suspended"><div class="row"><img class="indicator-icon" src="/media/5971/suspended.jpg" alt="addchangepackage" /><h2>{langTranslateApp.titleDisconnected}</h2><h4>{langTranslateApp.dstvAddPackage}.</h4><p>{langTranslateApp.textDisconnected}.</p><a href={getPaymentUrl()} class="cta">{paymentButtonCaption}<span class="icon icon-Arrow_right_thin"></span></a></div></div></div><div class="container-fluid main-section" if="{state == \'inprogressderror\'}"><div class="popup suspended"><div class="row"><img class="indicator-icon" src="/media/5971/suspended.jpg" alt="suspended" /><h2>{langTranslateApp.requestInProgress}</h2><h4>{langTranslateApp.yourRequestInProgress}.</h4><p>{langTranslateApp.systemInProcess}.</p><a href="javascript:void(0)" onclick="window.location.reload()" class="cta">{langTranslateApp.okGotIt}<span class="icon icon-Arrow_right_thin"></span></a></div></div></div><div class="container-fluid main-section" if="{state == \'success\'}"><div class="popup success"><div class="row"><img class="indicator-icon" src="/media/8073/tickmark_icon.png" alt="" /><h2>{langTranslateApp.successful}</h2><h4>{langTranslateApp.requestProcessedSuccessfully}</h4><p>{langTranslateApp.changesProcess}.</p><a href="javascript:void(0)" onclick="window.location.reload()" class="cta">{langTranslateApp.okGotIt}<span class="icon icon-Arrow_right_thin"></span></a> </div></div></div><div class="container-fluid main-section" if="{state == \'error\'}"><div class="popup unsuccessful"><div class="row"><img class="indicator-icon" src="/media/5972/unsuccessful.jpg" alt="unsuccessful" /><h2>{langTranslateApp.dashboardRequestUnsuccessful}</h2><p>{error.error}</p><p>{langTranslateApp.dashPlzTryAgainAndContactUs}</p><a href="javascript:void(0)" onclick="window.location.reload()" class="cta">{langTranslateApp.dashboardRetry}<span class="icon icon-Arrow_right_thin"></span></a> </div></div></div>','tag-fix-errors-logged-out { visibility: visible; }','',function(opts){var self=this;self.model={};self.mixin("tracker");self.PropertyConfig={"x-form-prelogin-clearErrorCodes":{"properties":[{"serialNumber":{"title":"Serial Number","type":"text","validations":{"mandatory":{"errorText":"A serial number is required","isMandatory":true}}}},{"surname":{"title":"Surname","type":"text","validations":{"mandatory":{"errorText":"A surname is required","isMandatory":true},"minLength":{"errorText":"Surname should be at least 2 characters","length":2}}}},{"errorCode":{"title":"Error","editable":"true","type":"select","selectFrom":[{"value":"e16","displayValue":"E  1  6","allowedError":"false"},{"displayValue":"E30","value":"e30","allowedError":"false"},{"displayValue":"E32","value":"e32","allowedError":"false"}],"value":""}}],"links":[{"rel":["self"],"href":"https://selfservice.league.wg2k.com/selfservice/api/zaf/decoders/clearerrorcode/e16?processId=5ea77ff1-ceda-48c9-855a-9b01b9fa01a6&sessionId=f742bd69-daa7-4f2a-9a97-e1b5903d61be"}],"actions":[{"class":["next"],"title":"Next","method":"POST","href":"https://selfservice.league.wg2k.com/selfservice/api/zaf/decoders/clearerrorcode/e16?processId=5ea77ff1-ceda-48c9-855a-9b01b9fa01a6&sessionId=f742bd69-daa7-4f2a-9a97-e1b5903d61be","type":"application/json"}]}};self.errorCode="";self.submitButton=false;self.errors=false;self.viewtype=opts.view;self.dotdotit=false;self.dotheight=100;self.preselectederroccode="";self.state="inprogress";let smartCardNumber=app.smartcard;self.paymentButtonCaption=langTranslateApp.subMenuPayNow;if(self.viewtype!=undefined){switch(self.viewtype){case "tileview":self.dotheight=100;self.dotdotit=true;break;case "searchbar":self.dotheight=60;self.dotdotit=true;break;default:self.dotheight=100;}}
self.CreateToken=function(){site.factory.GetJWT().then(function(token){self.token=token;})}
self.on('mount',function(){this.message='now loading...';if(app.clearerrorcodes!=undefined){self.formproperties=app.clearerrorcodes;self.errors=true;self.update();if(window.location.href.indexOf("/error-codes/")>0){self.preselectederroccode=window.location.hash.toLowerCase().Replace("#","").Replace("_"," ");self.refs.errorselectitem.select.val(self.preselectederroccode);var val=self.preselectederroccode;var value=val.toUpperCase();setTimeout(function(){self.errorCode=_.findWhere(app.errorcodelist.entities,{title:value});if(self.errorCode!=undefined&&self.errorCode!=''){if(!self.errorCode.properties.IsResetable){self.submitButton=false;self.update();$(self.root).find(".cinput").hide();}else{self.submitButton=true;self.update();$(self.root).find(".cinput").show();}}
self.dotdot(self.refs.dottext,self.dotdotit);},2000);}
jcf.replaceAll();$(self.root).find(".cinput").hide();}
console.log("Fix Error : token created on logged out stage");self.CreateToken();self.inintdropdowns();});self.ValidateNumeric=function ValidateNumeric(e){let isNumeric=self.IsNumeric(e.key);let isEnterPress=e.which==13;if(!isNumeric&&!isEnterPress){e.preventDefault();$(e.currentTarget).focus()
return false;}}
self.IsNumeric=function(str){return $.isNumeric(str)};self.dotdot=function(selector,display){if(selector!=undefined&&display){$(selector).trigger("destroy");$(selector).dotdotdot({ellipsis:"...",wrap:"word",height:self.dotheight,after:'a.link-to'});self.update();};}
self.htmlCatch=function(list,strip,container){var htmlList=list;if(htmlList!=undefined&&htmlList!=""){if(strip){var cleanList="";try{cleanList=$(htmlList).text();}catch(err){cleanList=htmlList.toString().replace(/(<([^>]+)>)/ig,"");};$(self.refs[container]).html(cleanList);}else{$(self.refs[container]).html(htmlList);};};}
self.selectError=function(e){self.checkfields(e);}
self.checkfields=function(e){var val=e.target.value;var value=val.toUpperCase();if(app.errorcodelist!==undefined){self.errorCode=_.findWhere(app.errorcodelist.entities,{title:value});if(self.errorCode!=undefined&&self.errorCode!=''){if(!self.errorCode.properties.IsResetable){self.submitButton=false;self.update();$(self.root).find(".cinput").hide();}else{self.submitButton=true;self.update();$(self.root).find(".cinput").show();}}
self.dotdot(self.refs.dottext,self.dotdotit);}}
self.submitClearErrorLoggedOut=function(e){e.preventDefault();self.model=self.formproperties;self.model.properties["serialNumber"].value=$(self.root).find("input[name=serialNumber]").val();self.model.properties["errorCode"].value=$(self.root).find("select[name=errorCode]").val().toUpperCase();var model=self.model;if(!self.model.properties["serialNumber"].value){self.state='error'
self.error={error:'A valid smartcard number is required - Please try again later'};setTimeout(function(){location.reload();},100000);return;}
let data={country:dstvApp.country,smartCardNumber:self.model.properties["serialNumber"].value,errorCode:self.model.properties["errorCode"].value};var url=`${dstvApp.DSOAPIUrl}apifixerror/api/v1/Reauthorize?BusinessUnit=${dstvApp.businessunit}&Channel=${dstvApp.channel}`;self.state='processing'
site.factory.Post(url,data,self.token,self.DecodeSuccessCallback,self.DecodeErrorCallback);}
self.DecodeSuccessCallback=function(data,pollstatus){self.state="success";self.status=data;if(data.Message&&data.Message.includes("There were no active services on the device")){self.state="addchangepackageerror";}
self.update();}
self.DecodeErrorCallback=function(error){self.state="error";if(error.responseJSON){self.error={};self.error.error=error.responseJSON.Message;}
else{self.error=typeof error.error.error=="string"?error.error:error.statusText;}
if(error.responseJSON.Message&&error.responseJSON.Message.includes("Your DStv account is suspended"))
self.state="suspendederror";if(error.responseJSON.Message&&error.responseJSON.Message.includes("Device not found for the smart card"))
self.state="addchangepackageerror";self.update();}
self.inintdropdowns=function(){self.update();jcf.replaceAll();var inputString=$("#searchtype").val();var inputWords=inputString.trim().split(" ");inputWords.forEach(function(word){var errorCodeDropdown=$('select[name="errorCode"]');if(app.errorcodelist!==undefined){self.errorCode=_.findWhere(app.errorcodelist.entities,{title:word.toUpperCase()});if(self.errorCode!=undefined&&self.errorCode!=''){errorCodeDropdown.val(word.toLowerCase());jcf.getInstance(errorCodeDropdown).refresh();if(!self.errorCode.properties.IsResetable){self.submitButton=false;self.update();$(self.root).find(".cinput").hide();}else{self.submitButton=true;self.update();$(self.root).find(".cinput").show();}
self.dotdot(self.refs.dottext,self.dotdotit);}}});}
self.paymentUrl=function(){if(dstvApp.NoOnlinePaymentCountryList.includes(dstvApp.countryabbreviation)){site.factory.HandleHowToPay();}
else{window.location=dstvApp.PaymentURL+self.model.properties["serialNumber"].value;}}
self.getPaymentUrl=function(){if(dstvApp.NoOnlinePaymentCountryList.includes(dstvApp.countryabbreviation)){if(dstvApp.language.toLowerCase()=='portuguese'){return window.culture+'/formas-de-pagamento';}
else{return window.culture+'/ways-to-pay';}}
else{return dstvApp.ChangePackageURL;}}
if(dstvApp.NoOnlinePaymentCountryList.includes(dstvApp.countryabbreviation)){self.paymentButtonCaption=langTranslateApp.dashboardHowToPay;}});riot.tag2('page-feedback','<yield></yield><tag-header view="generalpage" mysearchid="searchtype" searchurlsrc="/umbraco/api/WebApiLuis/GetLuisResponse/?restrictpath=-1&currentPage=1&filtertype=&search=" searchresultdisplay="Title" searchresulturl="Url" searchplaceholder="How can we help you?"></tag-header><section><div class="container"><h3>Feedback</h3><tag-feedback view="inpage"></tag-feedback></div></section>','page-feedback,[riot-tag="page-feedback"],[data-is="page-feedback"]{ visibility: visible; }','',function(opts){var self=this;self.model={};self.PropertyConfig={};self.on('mount',function(){});self.on('before-mount',function(){if(!app[app.customernumber]){console.log("no customer model found");}
this.message='now loading...';});self.on('routeChange',function(){this.message='now loading...';});});riot.tag2('tag-feedback','<div if="{opts.view == \'modal\'}"> <div id="flyout" class="feedback-bubble tri-right right-top" data-toggle="modal" data-target="#feedbackmodal"> <div class="feedback-text"> <span if="{dstvApp.language == \'English\'}"><img src="/media/5032/feedback.jpg" alt="English Feedback"></span> <span if="{dstvApp.language == \'Portuguese\'}"><img src="/media/6678/tab-feedback-portuguese.png" alt="Portuguese Feedback"></span> <p>{langTranslateApp.fbkWidgetHeader }</p> <a href="#" class="feedbackBtn">{langTranslateApp.fbkWidgetSubHeader}</a> </div> </div> <div class="modal fade" id="feedbackmodal" role="dialog"> <div class="webform container modal-dialog feedback-dialog"> <div class="modal-content"> <button type="button" class="close btnClose" data-dismiss="modal"><i class=" icon-Close_M"></i></button> <div class="text-info"> <h1>{langTranslateApp.fbkFrmHeader}</h1> <p>{langTranslateApp.fbkFrmSubHeader}</p> </div> <div class="select-option group"> <select id="score{randId}"> <option value="0">{langTranslateApp.fbkFrmSelect}</option> <option value="1">1</option> <option value="2">2</option> <option value="3">3</option> <option value="4">4</option> <option value="5">5</option> </select> </div> <div class="serial mt-1"><label class="lbl text">{langTranslateApp.fbkFrmComment}:*</label><textarea id="comment{randId}" placeholder="" class="serial form-control"></textarea></div> <div class="serial mt-1"><label class="lbl text">{langTranslateApp.fbkFrmName}:*</label><input type="text" id="firstname{randId}" name="firstname" placeholder="" class="serial form-control"></div> <div class="serial mt-1"><label class="lbl text">{langTranslateApp.fbkFrmEmail}:</label><input type="text" id="email{randId}" name="email" placeholder="" class="serial form-control"></div> <div class="serial mt-1"><label class="lbl text">{langTranslateApp.fbkFrmCellPhone}:*</label><input type="text" id="cellphone{randId}" name="cellphone" placeholder="" value="{app.cellphonenumber}" class="serial form-control integerInput"></div> <div class="serial mt-1 checkbox"><label class="lbl text">{langTranslateApp.fbkFrmPermission}:</label><input type="checkbox" name="maycontactme" id="maycontactme{randId}" checked="checked"> {langTranslateApp.fbkFrmPermissionInput} </div> <div class="wg2k_submitField col-md-12"><input id="sendfeedback{randId}" type="submit" value="{langTranslateApp.fbkFrmSubmit}" class="serial form-control" onclick="{sendfeedbackclick}"></div> </div> </div> </div></div>','tag-feedback,[riot-tag="tag-feedback"],[data-is="tag-feedback"]{ visibility: hidden; } tag-feedback .modal,[riot-tag="tag-feedback"] .modal,[data-is="tag-feedback"] .modal{ background: rgba(0,0,0,.5); } tag-feedback .modal-content,[riot-tag="tag-feedback"] .modal-content,[data-is="tag-feedback"] .modal-content{ background: #f7f7f7 !important; padding: 30px; overflow: auto; } tag-feedback .modal-content .select-option,[riot-tag="tag-feedback"] .modal-content .select-option,[data-is="tag-feedback"] .modal-content .select-option{ margin-bottom: 7px; } tag-feedback .modal-content .select-option .jcf-select,[riot-tag="tag-feedback"] .modal-content .select-option .jcf-select,[data-is="tag-feedback"] .modal-content .select-option .jcf-select{ background: transparent; } tag-feedback .modal-content .wg2k_submitField,[riot-tag="tag-feedback"] .modal-content .wg2k_submitField,[data-is="tag-feedback"] .modal-content .wg2k_submitField{ padding-left: 0; padding-right: 0; } tag-feedback .modal-content .checkbox,[riot-tag="tag-feedback"] .modal-content .checkbox,[data-is="tag-feedback"] .modal-content .checkbox{ font-size: 14px; font-weight: normal; } tag-feedback .feedback-dialog,[riot-tag="tag-feedback"] .feedback-dialog,[data-is="tag-feedback"] .feedback-dialog{ background: #224a73; padding: 0; z-index: 999; position: relative; margin-top: 80px; } tag-feedback .feedback-bubble,[riot-tag="tag-feedback"] .feedback-bubble,[data-is="tag-feedback"] .feedback-bubble{ position: fixed; right: 0px; top: 150px; margin: 30px; z-index: 999; width: 300px; background-color: #224a73; cursor: pointer; margin-right:0px !important} tag-feedback .feedback-text,[riot-tag="tag-feedback"] .feedback-text,[data-is="tag-feedback"] .feedback-text{ padding: 0; text-align: center; line-height: 1.5em; color: #FFF; background: #417bb6; } tag-feedback .feedback-text img,[riot-tag="tag-feedback"] .feedback-text img,[data-is="tag-feedback"] .feedback-text img{ float: left; margin-right: -12px; max-height: 120px;} tag-feedback .feedback-text p,[riot-tag="tag-feedback"] .feedback-text p,[data-is="tag-feedback"] .feedback-text p{ padding: 15px; margin: 0; font-size: 14px; line-height: 20px; } tag-feedback .feedback-text p:last-child,[riot-tag="tag-feedback"] .feedback-text p:last-child,[data-is="tag-feedback"] .feedback-text p:last-child{ font-weight: bold; }  tag-feedback #flyout,[riot-tag="tag-feedback"] #flyout,[data-is="tag-feedback"] #flyout{ position: fixed; width: 239px; background: #417bb6 !important; overflow:hidden; border-top-left-radius:15px !important; border-bottom-left-radius:15px !important; top: 130px; right: -195px; -webkit-transition: all 400ms ease; -moz-transition: all 400ms ease; -ms-transition: all 400ms ease; -o-transition: all 400ms ease; transition: all 400ms ease; -webkit-border-radius: 4px 0 0 4px; border-radius: 4px 0 0 4px; z-index:99 } tag-feedback #flyout.active,[riot-tag="tag-feedback"] #flyout.active,[data-is="tag-feedback"] #flyout.active,tag-feedback #flyout:hover,[riot-tag="tag-feedback"] #flyout:hover,[data-is="tag-feedback"] #flyout:hover{ right: -10px; -webkit-transition: all 400ms ease; -moz-transition: all 400ms ease; -ms-transition: all 400ms ease; -o-transition: all 400ms ease; transition: all 400ms ease; }','',function(opts){var self=this;self.randId=new Date().valueOf();self.model={};self.loggedin=app[app.customernumber]!=undefined?true:false;self.PropertyConfig={};self.on('mount',function(){self.update();});$(function(){$('.integerInput').on('input',function(){this.value=this.value.replace(/[^\d]/g,'');});});self.sendfeedbackclick=function(e){e.preventDefault();$(this).prop('disabled',true);site.trigger('showLoader',{messageHeader:"Loading",messageBody:""});var loc=window.location;var baseUrl=loc.protocol+"//"+loc.hostname+(loc.port?":"+loc.port:"");var url=baseUrl+"/umbraco/Api/Feedback/SaveFeedback/";var country=dstvApp.country;var feedbackDto={FirstName:$("#firstname"+self.randId).val(),Surname:'',CustomerNumber:'',Email:$("#email"+self.randId).val(),Cellphonenumber:$("#cellphone"+self.randId).val(),Score:$("#score"+self.randId).val(),Comment:$("#comment"+self.randId).val(),AppRoute:window.location.href,Maycontactme:$('#maycontactme'+self.randId).is(":checked"),Country:country};if(app[app.customernumber]){feedbackDto.FirstName=app[app.customernumber].properties.firstName.value;feedbackDto.Surname=app[app.customernumber].properties.surname.value;feedbackDto.CustomerNumber=app.customernumber;feedbackDto.Email=app[app.customernumber].properties.email.value;}
site.trigger("sendFeedback",url,"POST",feedbackDto,self.successCallback,self.errorCallback);};site.on("paymentduedetails",function(){if(app.contactdetails){app.cellphonenumber=app.contactdetails.entities[0].properties.cellNumber.value;}
self.update();});self.on('before-mount',function(){if(!app[app.customernumber]){}
this.message='now loading...';});self.on('routeChange',function(){this.message='now loading...';});self.successCallback=function(data){site.trigger('hideLoader');$("#flyout").removeClass('active');if(data.Success){toastr.success("Thank you for your feedback");self.closeModal();}else{toastr.error(data.DisplayMessage);}
$('#sendfeedback'+self.randId).prop('disabled',false);}
self.errorCallback=function(data){site.trigger('hideLoader');toastr.error(data);$('#sendfeedback'+self.randId).prop('disabled',false);}
self.closeModal=function(){self.clearModalInputs();$('#feedbackmodal').modal('hide');$(".modal").on("hidden.bs.modal",function(){$(".modal-body1").html("");});}
self.clearModalInputs=function(){$("#score"+self.randId).val('0');jcf.refreshAll();$("#comment"+self.randId).val('');$("#firstname"+self.randId).val('');$("#cellphone"+self.randId).val('');$("#email"+self.randId).val('');}
self.modalAnimation=function(){var flyout=$("#flyout");setTimeout(function(){flyout.addClass('active');},6000);setTimeout(function(){flyout.removeClass('active');},9000);}});riot.tag2('tag-tracker','','tag-tracker,[riot-tag="tag-tracker"],[data-is="tag-tracker"]{ visibility: visible; }','',function(opts){var self=this;self.mixin('tracker');site.on("track-postdata-error",function(data){self.track('postdataerror',data);});site.on("track-getdata-error",function(data){self.track('getdataerror',data);});site.on("track-setdata-error",function(data){self.track('setdataerror',data);});site.on("track-api-retry-fail",function(data){self.track('apiretryfail',data);});site.on("track-connect-login-success",function(data){self.track('connectsuccess',data);});site.on("track-connect-login-error",function(data){self.track('connecterror',data);});});riot.tag2('tag-error','','tag-error,[riot-tag="tag-error"],[data-is="tag-error"]{ visibility: visible; }','',function(opts){var self=this;self.mixin('tracker');});riot.tag2('page-my-account','<yield></yield><tag-header view="generalpage" mysearchid="searchtype" searchurlsrc="/umbraco/api/WebApiLuis/GetLuisResponse/?restrictpath=-1&currentPage=1&filtertype=&search=" searchresultdisplay="Title" searchresulturl="Url" searchplaceholder="How can we help you?"></tag-header><tag-selfservice-nav sectionclass="my-profile" pagename="{langTranslateApp.balViewBalance}"><div class="row" if="{app[app.customernumber]}"><div class="col-md-12"><h2>{app[app.customernumber].properties[⁗title⁗].value} {app[app.customernumber].properties[⁗firstName⁗].value} {app[app.customernumber].properties[⁗surname⁗].value}</h2></div><div class="col-md-4"><p><strong>Email:</strong> {app[app.customernumber].properties[⁗email⁗].value}</p></div><div class="col-md-4"><p><strong>Customer number:</strong> {app.customernumber}</p></div></div><div class="row pt-7 relative"><tag-make-payment view="inpage"></tag-make-payment></div></tag-selfservice-nav>','page-my-account,[riot-tag="page-my-account"],[data-is="page-my-account"]{ visibility: visible; }','',function(opts){var self=this;self.model={};self.PropertyConfig={};site.on('loggedout',function(){self.update();});self.on('mount',function(){self.update();});site.on("*",function(event){if(event===app.customernumber+"-loading-success"){self.update();}});self.on('before-mount',function(){if(!app[app.customernumber]){console.log("no customer model found");}
this.message='now loading...';});self.on('routeChange',function(){this.message='now loading...';});site.on('customerloaded',function(){self.update();});});riot.tag2('tag-dashboard-update-details','<div class="" style="z-index: 9999;" if="{updating}"> <div class="loading-loader loading"> <div class="col-sm-12 text-center white"> <div class="spinner black"></div> <div class="loading-message">{langTranslateApp.dashProcessing}...</div> </div> </div></div><div class="main-top-Details-info"> <h4 class="modal-title">{langTranslateApp.updateMyDetails}</h4> <div class="profile-img-icon"><img src="https://qa.dstvafrica.com/media/8614/avtar.svg" class="profile_image_user"></div> <span class="person_name_details">{langTranslateApp.updateWelcome} <span class="profile_name">{app.customername}</span> </span> <div class="details_coloums"> <span class="address_details_coloums address-col active">{langTranslateApp.updateAddressDetails}</span> <span class="contact_details_coloums contact-col">{langTranslateApp.updateContactDetails}</span></div> <div class="update-details-section"> <form class="update-details-form"><span id="invalidpostalCodeMsg" style="display:none" class="invalidpostalCodeMsgRed">Please update your address.</span> <a href="javascript:void(0)" onclick={onEditIconClick}><span class="details_edit"> <img src="/media/8619/materialicon-1.svg" class="details_edit_iocn"></span></a> <div class="details-rows col-lg-12 col-sm-12 col-xs-12 col-md-12"> <div class="details-coloum col-lg-6 col-sm-6 col-xs-12 col-md-6"><span class="details-coloum-label">{langTranslateApp.updateCountry}:</span> <span class="details-coloum-value"> <input type="text" name="countryaddress" value="{app.country}" class="details-coloum-value" disabled="disabled" id="country"> </span></div> <div class="details-coloum col-lg-6 col-sm-6 col-xs-12 col-md-6"> <span class="details-coloum-label">{langTranslateApp.updateProvince}: *</span> <span class="details-coloum-value"> <select id="update-province" name="province" class="form-control " disabled="true"> <option value="">{langTranslateApp.updateSelectProvince}</option> <option each="{province, index in app.locationProvinceList}" value="{province.name}" selected="{ app.customerCurrentProvinceId[0].id === province.id }">{province.name}</option> </select> </span> </div> <div class="col-lg-6 col-sm-6 col-xs-12 col-md-6"></div> </div> <div class="details-rows col-lg-12 col-sm-12 col-xs-12 col-md-12"> <div class="details-coloum col-lg-6 col-sm-6 col-xs-12 col-md-6"> <span class="details-coloum-label">{langTranslateApp.updateCity}: *</span> <span class="details-coloum-value"> <select id="update-city" name="city" class="form-control" disabled = "true"> <option value="">{langTranslateApp.updateSelectCity}</option> <option each="{city, index in app.locationCityList}" value="{city.name}" selected="{ app.customerCurrentCityId[0].id === city.id }">{city.name}</option> </select> </span> </div> </div> <div class="details-rows col-lg-12 col-sm-12 col-xs-12 col-md-12"> <div class="details-coloum col-lg-6 col-sm-6 col-xs-12 col-md-6"> <span class="details-coloum-label">{langTranslateApp.updateSuburb}: *</span> <span class="details-coloum-value"> <select id="update-suburb" name="suburb" class="form-control" disabled="true"> <option value="">{langTranslateApp.updateSelectSuburb}</option> <option each="{suburb, index in app.locationSuburbList}" value="{suburb.name}" selected="{ app.customerCurrentSuburbId[0].id === suburb.id }">{suburb.name}</option> </select> </span> </div> <div class="details-coloum col-lg-6 col-sm-6 col-xs-12 col-md-12"> <span class="details-coloum-label">{langTranslateApp.updatePostalCode}:</span> <input type="text" name="postalcodeaddress" value="{app.postalcode}" class="details-coloum-value" disabled="disabled" id="postalcode" onkeyup="{OnKeyUp}"></div> </div> <div class="details-rows col-lg-12 col-sm-12 col-xs-12 col-md-12"> <div class="details-coloum col-lg-6 col-sm-6 col-xs-12 col-md-6"> <span class="details-coloum-label">{langTranslateApp.updateHouseNumber}</span> <input type="text" name="address" value="****" class="details-coloum-value" readonly id="housenumber"></div> <div class="details-coloum col-lg-6 col-sm-6 col-xs-12 col-md-6"> <span class="details-coloum-label">{langTranslateApp.updateStreetName}:</span> <input type="text" name="streetaddress" value="****" class="details-coloum-value" readonly id="streetname" onkeyup="{OnKeyUp}"></div> </div> <div style="clear: both;"></div> </div> </form> <div class="contact-details-section" style="display:none;"> <form class="contact-details-form"> <a href="javascript:void(0)" onclick={onContactEditIconClick}><span class="contact_edit"> <img src="/media/8619/materialicon-1.svg" class="details_edit_iocn"></span></a> <div class="contact-rows col-lg-12 col-sm-12 col-xs-12 col-md-12"> <div class="contact-coloum col-lg-6 col-sm-6 col-xs-12 col-md-6"> <span class="contact-coloum-label">{langTranslateApp.updateTitle}:</span> <input type="text" name="title" value="****" class="contact-coloum-value" id="contactupdatetitle" readonly></div> <div class="contact-coloum col-lg-6 col-sm-6 col-xs-12 col-md-6"> <span class="{\'contact-coloum-label \' + ptDashEditSmallFontClass}">{langTranslateApp.updateMobileNumber}: *</span> <input type="tel" name="mobilenumber" maxlength="10" class="contact-coloum-value" onkeypress={checkIsNumeric} id="contactupdatemobilenumber" readonly></div> </div> <div class="contact-rows col-lg-12 col-sm-12 col-xs-12 col-md-12"> <div class="contact-coloum col-lg-6 col-sm-6 col-xs-12 col-md-6"> <span class="contact-coloum-label">{langTranslateApp.updateName}</span> <input type="text" name="name" value="****" class="contact-coloum-value" id="contactname" readonly></div> <div class="contact-coloum col-lg-6 col-sm-6 col-xs-12 col-md-6"> <span class="{\'contact-coloum-label \' + ptDashEditSmallFontClass}">{langTranslateApp.updateHomeNumber}</span> <input type="tel" name="homenumber" class="contact-coloum-value" maxlength="10" onkeypress={checkIsNumeric} id="contactupdatehometel" readonly></div> </div> <div class="contact-rows col-lg-12 col-sm-12 col-xs-12 col-md-12"> <div class="contact-coloum col-lg-6 col-sm-6 col-xs-12 col-md-6"> <span class="contact-coloum-label">{langTranslateApp.updateSurname}</span> <input type="text" name="surname" value="****" class="contact-coloum-value" id="contactupdatesurname" readonly></div> <div class="contact-coloum col-lg-6 col-sm-6 col-xs-12 col-md-6"> <span class="{\'contact-coloum-label \' + ptDashEditSmallFontClass}">{langTranslateApp.updateWorkNumber}</span> <input type="tel" name="worknumber" value="234567" class="contact-coloum-value" maxlength="10" onkeypress={checkIsNumeric} id="contactupdateworktel" readonly></div> </div> <div class="contact-rows col-lg-12 col-sm-12 col-xs-12 col-md-12"> <div class="contact-coloum col-lg-6 col-sm-6 col-xs-12 col-md-6"> <span class="contact-coloum-label">{langTranslateApp.updateEmail} *</span> <input type="email" autocomplete="off" name="email" value="****" class="contact-coloum-value" maxlength="50" id="contactupdateemail" readonly></div> <div class="contact-coloum col-lg-6 col-sm-6 col-xs-12 col-md-6" style="display:none"> <span class="contact-coloum-label">{langTranslateApp.updateFaxNumber}</span> <input type="tel" name="faxnumber" value="****" class="contact-coloum-value" maxlength="14" onkeypress={checkIsNumeric} id="contactupdatefaxtel" readonly></div> </div> <div style="clear: both;"></div> </div> </form> <div class="text-contact-gray"><span class="contact-link-text">{langTranslateApp.updateGreyedOut} <a href="{GetContactPageLink()}">{langTranslateApp.updateGreyedOut1}</a> {langTranslateApp.updateGreyedOut2} </span></div> <div class="details_btn"><button type="button" class="back_details_btn" onclick={onCancelUpdateDetailsButtonClick}>{langTranslateApp.updateCancel}</button><button type="button" class="save_details_btn" onclick={onSaveDetailsButtonClick} value="Validate!">{langTranslateApp.updateSave}</button></div> <div if="{showLoader}" style="z-index: 9999;;height: 200px" id="loginLoader"> <div class="relative fix-errors-loader-bg"> <div class="loading-loader loading"> <div class="col-sm-12 text-center white"> <div class="spinner white"></div> <div class="loading-message"></div> </div> </div> </div> </div></div><div class="response-end success-update" id="UpdateSuccessModal"> <div> <span class="happy-face"> <img class="face-icon" src="/media/8615/layer-2-1.svg"> </span> <h4 class="thank-update">{langTranslateApp.updateThankYou}</h4> <div class="dppinnerwrap details"> <p>{langTranslateApp.updateDetailsUpdateFirst}</p> <p>{langTranslateApp.updateDetailsUpdateLast}.</p> </div> <button class="update-done-btn" id="done-update" data-dismiss="modal">{langTranslateApp.updateDone}</button> </div></div><div class="response-end failed-update" style="display: none;" id="UpdatefailedModal"> <div if="{!genericError}"> <span class="icon-icon-warning"></span> <h4 class="thank-update">{langTranslateApp.updateDetailsFail}</h4> <div class="dppinnerwrap details"> <p>{langTranslateApp.updateDetailsUnsuccessful}</p> <p>{langTranslateApp.updateDetailsUnsuccessful2}.</p> <span if="{dstvApp.language == \'English\'}"> <p>{app.json_response}</p> </span> <span if="{dstvApp.language == \'Portuguese\' && app.json_response == \'Invalid mobile number.\'}"> <p>número de celular inválido.</p> </span> </div> <button class="retry-done-btn" onclick={onRetryUpdateDetailsButtonClick} data-toggle="modal" data-target="#updateDetailsModel" data-dismiss="modal">{langTranslateApp.updateDetailsRetry}</button> </div><div if="{genericError}" class=""><span class="icon-icon-warning"></span> <span class="error-wrong-msg">{langTranslateApp.paymentErrorMessageTitle}</span><span  class="error-note">{langTranslateApp.genericTechnicalIssueMsg1}<u><a href="{window.culture}/{langTranslateApp.subMenuContactUsLink}">{langTranslateApp.subMenuContactUs}</a></u>{langTranslateApp.genericTechnicalIssueMsg2}</span><a href="javascript:void(0)" onclick="{onErrorClose}" class="btn anim-btn btn-default ok-btn close" data-dismiss="modal">{langTranslateApp.menuClose}</a></div></div>','tag-dashboard-update-details,[riot-tag="tag-dashboard-update-details"],[data-is="tag-dashboard-update-details"]{ visibility: visible; }','',function(opts){var self=this;let surname=app.customername;let smartcard=app.smartcard;let customerNumber=app.customernumber;let mobileNumberTxt='#contactupdatemobilenumber';let homeTelephoneTxt='#contactupdatehometel';let workTelephoneTxt='#contactupdateworktel';let faxNumberTxt='#contactupdatefaxtel';self.ptDashEditSmallFontClass=dstvApp.languageAbbreviation+"-dash-edit-small-font";self.updating=false;self.genericError=false;self.on('before-mount',function(){self.log('before-mount')
self.GenerateToken();});self.on('mount',function(){self.log('mount')
if(app.loggedin){$('#updateDetailsModel').on('hidden.bs.modal',function(){self.OnUpdateDetailsClose();})
self.primaryAddress=_.filter(app.customerDetails.ListOfAddress,function(address){return address.IsPrimary===true;});$('.main-top-Details-info input').next(".red").remove();$('.main-top-Details-info select').next(".red").remove();$(".address-col").click(function(){$(".update-details-section").show();$(".contact-details-section").hide();});$(".contact-col").click(function(){$(".update-details-section").hide();$(".contact-details-section").show();});$(".details_edit").click(function(){$('.update-details-section').addClass('active');$('.main-top-Details-info').addClass('active');$('.contact-details-section').addClass('active');$('.main-top-Details-info').addClass('active');});$(".contact_edit").click(function(){$('.contact-details-section').addClass('active');$('.main-top-Details-info').addClass('active');$('.update-details-section').addClass('active');$('.main-top-Details-info').addClass('active');});$("#updateDetailsModel .close").click(function(){$('.contact-details-section').removeClass('active');$('.update-details-section').removeClass('active');$('.main-top-Details-info').removeClass('active');$('.main-top-Details-info input').next(".red").remove();$('.main-top-Details-info select').next(".red").remove();});$(".back_details_btn").click(function(){$('.contact-details-section').removeClass('active');$('.update-details-section').removeClass('active');$('.main-top-Details-info').removeClass('active');$('.main-top-Details-info input').next(".red").remove();$('.main-top-Details-info select').next(".red").remove();});$("#done-update").click(function(){$('.contact-details-section').removeClass('active');$('.update-details-section').removeClass('active');$('.main-top-Details-info').removeClass('active');$('.main-top-Details-info input').next(".red").remove();$('.main-top-Details-info select').next(".red").remove();});$(".address_details_coloums").click(function(){$('.address_details_coloums').addClass('active');$('.contact_details_coloums').removeClass('active');});$(".contact_details_coloums").click(function(){$('.contact_details_coloums').addClass('active');$('.address_details_coloums').removeClass('active');});$(".contacts .cta.blue").click(function(){$('.main-top-Details-info').removeClass('hidden');$('#UpdatefailedModal').css('display','none');$('#UpdateSuccessModal').css('display','none');});$('#contactupdatemobilenumber').on('change keyup',function(){var sanitized=$(this).val().replace(/[^0-9]/g,'');$(this).val(sanitized);});$('#contactupdatehometel').on('change keyup',function(){var sanitized=$(this).val().replace(/[^0-9]/g,'');$(this).val(sanitized);});$('#contactupdateworktel').on('change keyup',function(){var sanitized=$(this).val().replace(/[^0-9]/g,'');$(this).val(sanitized);});$('#contactupdatefaxtel').on('change keyup',function(){var sanitized=$(this).val().replace(/[^0-9]/g,'');$(this).val(sanitized);});$('#contactupdatemobilenumber').keyup(function(){$('#contactupdatemobilenumber').next(".red").remove();});$('#contactupdatehometel').keyup(function(){$('#contactupdatehometel').next(".red").remove();});$('#contactupdateworktel').keyup(function(){$('#contactupdateworktel').next(".red").remove();});$('#contactupdateemail').keyup(function(){$('#contactupdateemail').next(".red").remove();});$('#update-province').change(function(){$('#update-province').next(".red").remove();$('#invalidpostalCodeMsg').next(".red").remove();self.log('province changed');let selectedProvinceName=$(this).val();self.log(selectedProvinceName);app.customerCurrentProvinceId=_.filter(app.locationProvinceList,function(province){return province.name.toLowerCase()===selectedProvinceName.toLowerCase();});$('#update-city').val('');$('#update-suburb').val('');$('#postalcode').val('');app.locationSuburbList=[]
app.locationCityList=_.map(app.customerCurrentProvinceId,'cityList')[0];jcf.replaceAll();self.update();});$('#update-city').change(function(){$('#update-city').next(".red").remove();$('#invalidpostalCodeMsg').next(".red").remove();self.log('city changed');let selectedCityName=$(this).val();self.log(selectedCityName);app.customerCurrentCityId=_.filter(app.locationCityList,function(city){return city.name.toLowerCase()===selectedCityName.toLowerCase();});$('#update-suburb').val('');app.locationSuburbList=_.map(app.customerCurrentCityId,'suburbList')[0];jcf.replaceAll();self.update();});$('#update-suburb').change(function(){$('#update-suburb').next(".red").remove();$("#postalcode").next(".red").remove();$('#invalidpostalCodeMsg').next(".red").remove();self.log('suburb changed');let selectedSuburbName=$(this).val();self.log(selectedSuburbName);app.customerCurrentSuburbId=_.filter(app.locationSuburbList,function(suburb){return suburb.name.toLowerCase()===selectedSuburbName.toLowerCase();});app.locationPostalCode=_.map(app.customerCurrentSuburbId,'postalCode')[0];self.update();$('#postalcode').val(app.locationPostalCode);self.update();});}});self.OnUpdateDetailsClose=function()
{self.log('cancel editing on Modal Close..');self.updating=false;onEditIconClickCount=0;$('.contact-details-section').removeClass('active');$('.update-details-section').removeClass('active');$('.main-top-Details-info').removeClass('active');$('.update-details-section select').attr('disabled',true);$('.update-details-section input').attr('readonly',true);$('.contact-details-section input').attr('readonly',true);$('#housenumber').val(app.TempCustomerPrimaryAddress[0].HouseNumber);$('#postalcode').val(app.TempCustomerPrimaryAddress[0].PostCode);$('#streetname').val(app.TempCustomerPrimaryAddress[0].Street);$('#country').val(app.TempCustomerPrimaryAddress[0].Country);$('#contactname').val(app.customercontactdetails.FirstName);$('#contactupdateemail').val(app.customercontactdetails.EmailAddress);$('#contactupdatetitle').val(app.customercontactdetails.Title);$('#contactupdatemobilenumber').val(app.customercontactdetails.MobileTel);$('#contactupdatehometel').val(app.customercontactdetails.HomeTel);$('#contactupdatefaxtel').val(app.customercontactdetails.FaxTel);$('#contactupdateworktel').val(app.customercontactdetails.WorkTel);$('#contactupdatesurname').val(app.customercontactdetails.Surname);$('.main-top-Details-info input').next(".red").remove();$('.main-top-Details-info select').next(".red").remove();let customerCurrentProvinceName=app.TempCustomerPrimaryAddress[0].Province,customerCurrentsuburbName=app.TempCustomerPrimaryAddress[0].Suburb;app.customerCurrentProvinceId=_.filter(app.locationProvinceList,function(province){return province.name.toLowerCase()===customerCurrentProvinceName.toLowerCase();});let customerCurrentCityName=app.TempCustomerPrimaryAddress[0].City;app.locationCityList=_.map(app.customerCurrentProvinceId,'cityList')[0];app.customerCurrentCityId=_.filter(app.locationCityList,function(city){return city.name.toLowerCase()===customerCurrentCityName.toLowerCase();});app.locationSuburbList=_.map(app.customerCurrentCityId,'suburbList')[0];app.customerCurrentSuburbId=_.filter(app.locationSuburbList,function(suburb){return suburb.name.toLowerCase()===customerCurrentsuburbName.toLowerCase();});self.update();riot.update();jcf.refreshAll();}
self.GetContactPageLink=function(){if(site.env=='PROD'&&dstvApp.SelfServiceEnabledCountries.includes(dstvApp.countryabbreviation)){return `https://eazy.dstv.com/${dstvApp.languageAbbreviation}/${dstvApp.countryabbreviation}/contact`}
else{return window.culture+langTranslateApp.subMenuContactUsLink;}}
self.GenerateToken=function(){site.factory.GetJWT().then(function(token){self.token=token;})};self.log=function(action){if(typeof action=='string')
console.log(`Update Details : ${action}`);else
console.log(action);}
var onEditIconClickCount=0;self.onEditIconClick=function(e){self.log('onEditIconClick')
onEditIconClickCount=onEditIconClickCount+1;if(onEditIconClickCount==1){if(app.customerCurrentSuburbId.length>0){if(app.customerDetails.ListOfAddress[0].PostCode!=app.customerCurrentSuburbId[0].postalCode){let selectedProvinceName="";self.log(selectedProvinceName);app.customerCurrentProvinceId=_.filter(app.locationProvinceList,function(province){return province.name.toLowerCase()===selectedProvinceName.toLowerCase();});$('#update-province').val('');$('#update-city').val('');$('#update-suburb').val('');$('#postalcode').val('');$('#streetname').val('');app.locationSuburbList=[]
app.locationCityList=_.map(app.customerCurrentProvinceId,'cityList')[0];jcf.replaceAll();self.update();}}else{}}
$('.update-details-section input').attr('readonly',false);$('.update-details-section select').attr('disabled',false);$('#update-province').focus();$('.contact-details-section input').attr('readonly',false);$('#contactupdatetitle').attr('disabled',true);$('#contactname').attr('disabled',true);$('#contactupdatesurname').attr('disabled',true);};self.onContactEditIconClick=function(e){self.log('onContactEditIconClick')
onEditIconClickCount=0;$('.contact-details-section input').attr('readonly',false);$(mobileNumberTxt).focus();$('#contactupdatetitle').attr('disabled',true);$('#contactname').attr('disabled',true);$('#contactupdatesurname').attr('disabled',true);$('.update-details-section input').attr('readonly',false);$('.update-details-section select').attr('disabled',false);};self.onRetryUpdateDetailsButtonClick=function(e){$('.main-top-Details-info').removeClass('hidden');self.updating=false;onEditIconClickCount=0;$('.contact-details-section').removeClass('active');$('.update-details-section').removeClass('active');$('.main-top-Details-info').removeClass('active');$('.update-details-section select').attr('disabled',true);$('.update-details-section input').attr('readonly',true);$('.contact-details-section input').attr('readonly',true);$('#housenumber').val(app.customerPrimaryAddress[0].HouseNumber);$('#postalcode').val(app.customerPrimaryAddress[0].PostCode);$('#streetname').val(app.customerPrimaryAddress[0].Street);$('#country').val(app.customerPrimaryAddress[0].Country);$('#contactname').val(app.customercontactdetails.FirstName);$('#contactupdateemail').val(app.customercontactdetails.EmailAddress);$('#contactupdatetitle').val(app.customercontactdetails.Title);$('#contactupdatemobilenumber').val(app.customercontactdetails.MobileTel);$('#contactupdatehometel').val(app.customercontactdetails.HomeTel);$('#contactupdatefaxtel').val(app.customercontactdetails.FaxTel);$('#contactupdateworktel').val(app.customercontactdetails.WorkTel);$('#contactupdatesurname').val(app.customercontactdetails.Surname);$('#contactupdatemobilenumber').next(".red").remove();$('#contactupdateemail').next(".red").remove();debugger;let customerCurrentProvinceName=app.customerPrimaryAddress[0].Province,customerCurrentsuburbName=app.customerPrimaryAddress[0].Suburb;app.customerCurrentProvinceId=_.filter(app.locationProvinceList,function(province){return province.name.toLowerCase()===customerCurrentProvinceName.toLowerCase();});let customerCurrentCityName=app.customerPrimaryAddress[0].City;app.locationCityList=_.map(app.customerCurrentProvinceId,'cityList')[0];app.customerCurrentCityId=_.filter(app.locationCityList,function(city){return city.name.toLowerCase()===customerCurrentCityName.toLowerCase();});app.locationSuburbList=_.map(app.customerCurrentCityId,'suburbList')[0];app.customerCurrentSuburbId=_.filter(app.locationSuburbList,function(suburb){return suburb.name.toLowerCase()===customerCurrentsuburbName.toLowerCase();});self.update();jcf.refreshAll();}
self.onCancelUpdateDetailsButtonClick=function(e){self.log('canceling editing..');self.updating=false;onEditIconClickCount=0;$('.contact-details-section').removeClass('active');$('.update-details-section').removeClass('active');$('.main-top-Details-info').removeClass('active');$('.update-details-section select').attr('disabled',true);$('.update-details-section input').attr('readonly',true);$('.contact-details-section input').attr('readonly',true);$('#housenumber').val(app.TempCustomerPrimaryAddress[0].HouseNumber);$('#postalcode').val(app.TempCustomerPrimaryAddress[0].PostCode);$('#streetname').val(app.TempCustomerPrimaryAddress[0].Street);$('#country').val(app.TempCustomerPrimaryAddress[0].Country);$('#contactname').val(app.customercontactdetails.FirstName);$('#contactupdateemail').val(app.customercontactdetails.EmailAddress);$('#contactupdatetitle').val(app.customercontactdetails.Title);$('#contactupdatemobilenumber').val(app.customercontactdetails.MobileTel);$('#contactupdatehometel').val(app.customercontactdetails.HomeTel);$('#contactupdatefaxtel').val(app.customercontactdetails.FaxTel);$('#contactupdateworktel').val(app.customercontactdetails.WorkTel);$('#contactupdatesurname').val(app.customercontactdetails.Surname);$('.main-top-Details-info input').next(".red").remove();$('.main-top-Details-info select').next(".red").remove();let customerCurrentProvinceName=app.TempCustomerPrimaryAddress[0].Province,customerCurrentsuburbName=app.TempCustomerPrimaryAddress[0].Suburb;app.customerCurrentProvinceId=_.filter(app.locationProvinceList,function(province){return province.name.toLowerCase()===customerCurrentProvinceName.toLowerCase();});let customerCurrentCityName=app.TempCustomerPrimaryAddress[0].City;app.locationCityList=_.map(app.customerCurrentProvinceId,'cityList')[0];app.customerCurrentCityId=_.filter(app.locationCityList,function(city){return city.name.toLowerCase()===customerCurrentCityName.toLowerCase();});app.locationSuburbList=_.map(app.customerCurrentCityId,'suburbList')[0];app.customerCurrentSuburbId=_.filter(app.locationSuburbList,function(suburb){return suburb.name.toLowerCase()===customerCurrentsuburbName.toLowerCase();});self.update();riot.update();jcf.refreshAll();};self.validateAll=function(){let errors=[],emailaddress=$('#contactupdateemail').val(),address=$(mobileNumberTxt).val();mobiNumeber=$(mobileNumberTxt).val();homeNumber=$(homeTelephoneTxt).val();workNumber=$(workTelephoneTxt).val();if(address.length==0||!checkIsDigit(address)){errors.push({msg:langTranslateApp.updateInvalidMobile,error:true,fieldId:'#contactupdatemobilenumber',});}
if(!ValidateEmail(emailaddress)){errors.push({msg:langTranslateApp.updateInvalidEmail,error:true,fieldId:'#contactupdateemail',});}
errors=validateMobiHomeWorkNumber(mobiNumeber,dstvApp.countryCode,errors,true,false,false);if(homeNumber.length>0){errors=validateMobiHomeWorkNumber(homeNumber,dstvApp.countryCode,errors,false,true,false);}
if(workNumber.length>0){errors=validateMobiHomeWorkNumber(workNumber,dstvApp.countryCode,errors,false,false,true);}
if(!$("#update-province").val())
errors.push({msg:langTranslateApp.updatePleaseSelectProvince,error:true,fieldId:'#update-province'})
if(!$("#update-city").val())
errors.push({msg:langTranslateApp.updatePleaseSelectCity,error:true,fieldId:'#update-city'})
if(!$("#update-suburb").val())
errors.push({msg:langTranslateApp.updatePleaseSelectSuburb,error:true,fieldId:'#update-suburb'})
if(app.customerDetails.ListOfAddress[0].PostCode==$("#postalcode").val()){if(app.customerCurrentSuburbId.length>0){if(app.customerDetails.ListOfAddress[0].PostCode!=app.customerCurrentSuburbId[0].postalCode){errors.push({msg:"",error:true,fieldId:'#postalcode'})
$(".update-details-section").show();$(".contact-details-section").hide();}else{}}else{}}else{}
return errors;};function checkIsDigit(valueTocheck){var numberRegex=/^[+-]?\d+(\.\d+)?([eE][+-]?\d+)?$/;return numberRegex.test(valueTocheck);}
function ValidateEmail(email){var expr=/^([\w-\.]+)@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.)|(([\w-]+\.)+))([a-zA-Z]{2,4}|[0-9]{1,3})(\]?)$/;return expr.test(email);};function validateMobiHomeWorkNumber(number,countryCode,errors,isMobiNumber,isHomeNumber,isWorkNumber){var fieldIdTxt='';if(isMobiNumber){fieldIdTxt='#contactupdatemobilenumber';}else if(isHomeNumber){fieldIdTxt='#contactupdatehometel';}else if(isWorkNumber){fieldIdTxt='#contactupdateworktel';}else{}
if(number.length<7||number.length>10){errors.push({msg:langTranslateApp.updateInvalidMobileWorkHomeNumberLength,error:true,fieldId:fieldIdTxt,});return errors;}else{if(isMobiNumber){var numberType=isMobileNumber(number,countryCode,isMobiNumber,isHomeNumber,isWorkNumber);if(!numberType.includes("Mobile")){errors.push({msg:langTranslateApp.updateInvalidMobile,error:true,fieldId:fieldIdTxt,});return errors;}else{return errors;}}else{var numberType=isMobileNumber(number,countryCode,isMobiNumber,isHomeNumber,isWorkNumber);if(!numberType.includes("Mobile")&&!numberType.includes("Fixed Line")){if(isHomeNumber){errors.push({msg:langTranslateApp.updateInvalidHome,error:true,fieldId:fieldIdTxt,});}else if(isWorkNumber){errors.push({msg:langTranslateApp.updateInvalidWork,error:true,fieldId:fieldIdTxt,});}else{return errors;}}
else{return errors;}}}
return errors;}
function isMobileNumber(number,countryCode,isMobiNumber,isHomeNumber,isWorkNumber){var phoneUtil=i18n.phonenumbers.PhoneNumberUtil.getInstance();var regionCode=phoneUtil.getRegionCodeForCountryCode(countryCode);var phNumber=phoneUtil.parseAndKeepRawInput(number,regionCode);if(phoneUtil.isValidNumber(phNumber)){var PNT=i18n.phonenumbers.PhoneNumberType;var numberType=phoneUtil.getNumberType(phNumber);if(numberType==PNT.MOBILE){return "Mobile";}else if(numberType==PNT.FIXED_LINE){return "Number is Fixed Line."}else if(numberType==PNT.FIXED_LINE_OR_MOBILE){return "Number is Fixed Line or Mobile";}else if(numberType==PNT.UNKNOWN){return "Unknown Number. Please enter valid number.";}else{return langTranslateApp.updateInvalidMobile;}}else{if(isMobiNumber){return langTranslateApp.updateInvalidMobile;}else if(isHomeNumber){return langTranslateApp.updateInvalidHome;}else{return langTranslateApp.updateInvalidWork;}}}
self.onSaveDetailsButtonClick=function(e){console.log('Update Details : Updating...');let errors=self.validateAll();if(errors.length!=0){console.log('error.length',errors.length);self.log('Error validation failed');let error=errors[0];errors.forEach(function(error){if($(error.fieldId).closest('div').find('.red').length==0){$(error.fieldId).after('<div class="red">'+error.msg+'</div>');}});return false;}
else{self.updating=true;let houseNumber=$('#housenumber').val(),city=$('#update-city').val(),postalCode=$('#postalcode').val(),streetName=$('#streetname').val(),suburb=$('#update-suburb').val(),addressType=$('#email').val(),floor=$('#email').val(),province=$('#update-province').val(),buildingName=$('#buildingname').val(),buildingNumber=$('#buildingnumber').val(),email=$('#contactupdateemail').val(),faxnumber=$(faxNumberTxt).val(),worknumber=$(workTelephoneTxt).val(),homenumber=$(homeTelephoneTxt).val(),number=$(mobileNumberTxt).val();let listOfPhoneNumber=[];let mobile=self.RemoveCountryCode($(mobileNumberTxt).val().trim())
let fax=self.RemoveCountryCode($(faxNumberTxt).val().trim())
let work=self.RemoveCountryCode($(workTelephoneTxt).val().trim())
let home=self.RemoveCountryCode($(homeTelephoneTxt).val().trim())
if(fax)listOfPhoneNumber.push({phoneType:"Fax",countryCode:dstvApp.countryCode,number:fax});if(work)listOfPhoneNumber.push({phoneType:"Work",countryCode:dstvApp.countryCode,number:work});if(home)listOfPhoneNumber.push({phoneType:"Home",countryCode:dstvApp.countryCode,number:home});if(mobile)listOfPhoneNumber.push({phoneType:"Mobile",countryCode:dstvApp.countryCode,number:mobile});let listOfAddress=[{addressType:"physical",houseNumber:houseNumber,floor:"",streetName:streetName,buildingNumber:"",buildingName:"",subUrb:suburb,city:city,province:province,postalCode:postalCode}]
let data={email:email,listOfPhoneNumber:listOfPhoneNumber,listOfAddress:listOfAddress};console.log('CustomerNumber : not null');let url=`${dstvApp.DSOAPIUrl}apiupdatecontactdetails/api/v1/UpdateContactDetails/UpdateCustomerProfile?country=${dstvApp.country}&BusinessUnit=${dstvApp.businessunit}&Channel=${dstvApp.channel}&customernumber=${app.customernumber}&smartcardnumber=${app.smartcard}`;site.factory.Put(url,data,self.token,self.onUpdateUserDetailsSuccess,self.onUpdateUserDetailsFailure);}};self.onCustomerNumberNull=function(){self.log('Failed to update details');self.updating=false;self.log('Customer number not found');app.json_response="Customer number not found";$('.main-top-Details-info').addClass('hidden');$('#updateDetailsModel').addClass('failure');$('#UpdatefailedModal').modal('show');$('.contact-details-section').removeClass('active');$('.update-details-section').removeClass('active');$('.main-top-Details-info').removeClass('active');self.update();if(site.env=='QA')
site.factory.CaptureFeedback('DSTVUPDATEDETAILS_'+app.customernumber);};self.onUpdateUserDetailsSuccess=function(data){self.log('Details successfully Updated');self.updating=false;$('.main-top-Details-info').addClass('hidden');$('#updateDetailsModel').addClass('success');$('#UpdateSuccessModal').modal('show');app.customerPrimaryAddress[0].HouseNumber=data.listOfAddress[0].houseNumber;app.customerPrimaryAddress[0].Street=data.listOfAddress[0].streetName;app.customerPrimaryAddress[0].PostCode=data.listOfAddress[0].postalCode;app.customerCurrentProvinceId[0].name=data.listOfAddress[0].province;app.customerCurrentCityId[0].name=data.listOfAddress[0].city;app.customerCurrentSuburbId[0].name=data.listOfAddress[0].subUrb;app.customerPrimaryAddress[0].Suburb=data.listOfAddress[0].subUrb;app.customerPrimaryAddress[0].City=data.listOfAddress[0].city;app.customerPrimaryAddress[0].province=data.listOfAddress[0].province;app.TempCustomerPrimaryAddress[0].Province=data.listOfAddress[0].province;app.customercontactdetails.EmailAddress=data.email;app.customercontactdetails.FirstName=data.firstName;app.customercontactdetails.Surname=data.surname;app.customercontactdetails.MobileTel=$(mobileNumberTxt).val();app.customercontactdetails.FaxTel=$(faxNumberTxt).val();app.customercontactdetails.WorkTel=$(workTelephoneTxt).val();app.customercontactdetails.HomeTel=$(homeTelephoneTxt).val();window.SessionSave("app",app)
self.update();riot.update();site.factory.CaptureFeedback('DSTVUPDATEDETAILS_'+app.customernumber);};self.onUpdateUserDetailsFailure=function(error){self.log('Failed to update details');self.updating=false;self.log(error)
if(!error.responseJSON.Message.includes('Addressing')){app.json_response=error.responseJSON.Message;}else if(error.responseJSON&&err.responseJSON.StatusCode==404&&error.responseJSON.Message.includes("CMProxyHelper")){self.genericError=true;}else if(error.responseJSON&&err.responseJSON.StatusCode==500){self.genericError=true;}else{}
$('.main-top-Details-info').addClass('hidden');$('#updateDetailsModel').addClass('failure');$('#UpdatefailedModal').modal('show');$('.contact-details-section').removeClass('active');$('.update-details-section').removeClass('active');$('.main-top-Details-info').removeClass('active');self.update();if(site.env=='QA')
site.factory.CaptureFeedback('DSTVUPDATEDETAILS_'+app.customernumber);};self.RemoveCountryCode=function(num){num=num.substr(0,3)==dstvApp.countryCode?num.substr(3):num;return num;}
self.SetFocus=function(curr){setTimeout(function(){$(curr).focus();},1000)}
self.checkIsNumeric=function(e){if(!self.IsNumeric(e.key)){e.preventDefault();return false;}}
self.IsNumeric=function(str){return $.isNumeric(str)};self.onErrorClose=function(){$('#UpdatefailedModal').modal('hide');}});riot.tag2('page-manage','<yield></yield><tag-header view="generalpage" mysearchid="searchtypemid" searchurlsrc="/umbraco/api/WebApiLuis/GetLuisResponse/?restrictpath=-1&amp;currentPage=1&amp;filtertype=&amp;search=" searchresultdisplay="Title" searchresulturl="Url" searchplaceholder="How can we help you?"></tag-header><section class="bg-secondary pt-xs-2"><div class="container"><div class="row"><div class="col-sm-4"><tag-fix-errors view="tileview"></tag-fix-errors></div><div class="col-sm-8"><tag-holiday-viewing view="tileview"></tag-holiday-viewing></div><div class="col-sm-4"><tag-faq-slider sliderspeed="3000" slidereffect="scrollHorz"></tag-faq-slider></div><div class="col-sm-4"><tag-make-payment view="tileview"></tag-make-payment></div><div class="col-sm-8"><div class="p-0 box-holder"><div class="title-area tile-image text-center" style="background-image:url(\'/images/bg.jpg\')"><div class="row"><div class="col-xs-10 col-xs-push-1 col pt-9 pb-2"><div class="holder"><h4 class="title">Need to do something but can\'t find what you are looking for?</h4><a href="http://self-service.dstv.com/decision-tool/index.html" target="_blank" class="btn btn-default btn-rounded anim-btn"><span class="anim-span"></span>See all Your Options Here</a></div></div></div></div></div></div><div class="col-sm-4 decision-tool-block"><div class="p-0 mb-3 light-blue box-holder"><div class="title-area row text-center"><div class="col-xs-8 col-xs-push-2 pt-8"><span class="title mb-3">Help us improve your experience</span><a class="btn-rounded feedbackDialog" href="#"><i class="icon ti-plus"></i></a></div></div></div></div><div class="col-sm-4"><tag-my-statements view="tileview"></tag-my-statements></div><div class="col-sm-4"><tag-transaction-history view="tileview"></tag-transaction-history></div><div class="col-sm-4"><tag-link-showmax view="tileview"></tag-link-showmax></div></div></div></section>','page-manage,[riot-tag="page-manage"],[data-is="page-manage"]{ visibility: visible; }','',function(opts){var self=this;self.routename='page-manage';site.on('loggedout',function(){self.update();});self.on('mount',function(){$(self.root).on('click','.myclass',function(e){e.preventDefault();window.consolelog($(this));});$.getJSON("/umbraco/api/BoxOfficeContent/GetBoxOfficeContent",function(data){$("div.now-showing-holder em").html(data.title);});var divs=$(".info").hide();var i=0;(function cycle(){divs.eq(i).fadeIn(400).delay(5000).fadeOut(400,cycle);i=++i%divs.length;})();});self.on('after-mount',function(){window.consolelog("AFTER MOUNT");});self.on('before-mount',function(){if(!app[app.customernumber]){window.consolelog("no customer model found");}
this.message='now loading...';self.model=app[app.customernumber];});self.on('update',function(){});site.on("allholidaydecodersloaded",function(){if(self.routename===app.currentroute){self.update();}
site.trigger('hideLoader');});site.on('routeChanged',function(page){if(page===self.routename){}
this.message='now loading...';});site.on("customerloaded",function(){if(self.routename===app.currentroute){self.update();}
site.trigger('hideLoader');});$(".wheel-carousel").on("click",function(){window.consolelog($(this));});});riot.tag2('tag-model-for-showmax-upgrade','<div class="modal fade dashboardModal dashboardPOP" id="errorUpgreadeModel" role="dialog"> <div class="webform container modal-dialog modal-lg feedback-dialog"> <div class="modal-content"> <button type="button" class="close btnClose" data-dismiss="modal"><i class=" icon-Close_M"></i></button> <div class="modal-body"> <div class="container-fluid main-section"> <div class="popup error"> <div class="row"> <span class="icon-icon-warning errorUpgradeIcon"></span> <h2>Bought a <span class="boldText">NEW</span> decoder?</h2> <h4 class="colorBrown">Activate your subscription</h4> <div class="errorUpdateMessage"> <p class="firstSection">Looks like this "Smartcard" you are using to login with does not have an "Active -Package Subscription" yet.</p> <p>Please contact our customer service center to activate your subscription and manage it seamlessly using the Website.</p> </div> <div class="errorUpgradeButtons"> <a href="{window.culture}/help-contact-us" class="cta callnowButton"> Contact Us </a> <a href="javascript:void(0)" class="cta closeButton" data-dismiss="modal">CLOSE</a> </div> </div> </div> </div> <div class="clearfix"></div> </div> </div> </div></div>','tag-model-for-showmax-upgrade,[riot-tag="tag-model-for-showmax-upgrade"],[data-is="tag-model-for-showmax-upgrade"]{ visibility: visible; } tag-model-for-showmax-upgrade select,[riot-tag="tag-model-for-showmax-upgrade"] select,[data-is="tag-model-for-showmax-upgrade"] select{ display: none !important; }','',function(opts){var self=this;self.on('mount',function(){if(opts.showmodel)
$('#errorUpgreadeModel').modal('show');});self.modalClose0101=function(e){}})
riot.tag2('tag-modal-popup','<div class="modal fade dashboardModal" id="commonModalPopup" role="dialog"><div class="webform container modal-dialog modal-lg feedback-dialog"><div class="modal-content"><button type="button" class="close btnClose" data-dismiss="modal"><i class=" icon-Close_M"></i></button><div class="modal-body"><div class="container-fluid main-section"><div class="popup {indicatorTypeClass}"><div class="row"><img class="indicator-icon" src={indicatorTypeURL} alt="opts.state" /><h2>{opts.mainheading}</h2><h4>{opts.subheading}</h4><p style="white-space: pre-line;">{opts.description}</p><div if="{opts.showretrybutton}"><p>{langTranslateApp.dashPlzTryAgainAndContactUs}</p><a href="javascript:void(0)" onclick="window.location.reload()" class="cta">{langTranslateApp.dashboardRetry}<span class="icon icon-Arrow_right_thin"></span></a> </div><div if="{opts.showclosebutton}"><a id="modalClose0101" href="javascript:void(0)" onclick={modalClose0101} class="cta " data-dismiss="modal">{opts.closebuttontext || "Close"}<span class={closeButtonIcon}></span></a> </div></div></div></div><div class="clearfix"></div></div></div></div></div>','tag-modal-popup,[riot-tag="tag-modal-popup"],[data-is="tag-modal-popup"]{ visibility: visible; } tag-modal-popup select,[riot-tag="tag-modal-popup"] select,[data-is="tag-modal-popup"] select{ display: none !important; }','',function(opts){var self=this;self.indicatorTypeClass=opts.state=='error'?'unsuccessful':'success';self.indicatorTypeURL=opts.state=='error'?"/media/8074/warning_new_img.png":"/media/8073/tickmark_icon.png"
self.closeButtonIcon=opts.closebuttontext&&opts.closebuttontext.toLowerCase().includes('cell number')?'icon icon-ico-call-2':'icon icon-Arrow_right_thin';self.update();self.on('mount',function(){if(opts.showmodel)
$('#commonModalPopup').modal('show');$('.btnClose').click(function(){})});self.modalClose0101=function(e){if(typeof opts.callback==='function')
opts.callback();}})
riot.tag2('tag-rentnow-modal-popup','<div class="modal fade dashboardModal dashboardPOP" id="rentNowModalPopup" role="dialog"><div class="webform container modal-dialog feedback-dialog"><div class="modal-content"><button type="button" class="close btnClose" data-dismiss="modal"><i class=" icon-Close_M"></i></button><div class="modal-body"><div class="container-fluid main-section"><div class="popup"><div if="{!isBoxOfficeCustomer}"><div style="padding-bottom: 40px;"><img src="/media/6155/icon-boxoffice-3.png" class="boxoffice-logo-img"> <span class="boxoffice-logo"><span>{langTranslateApp.boxOfficeWelcome} </span><strong>Box</strong>Office</span></div><div class="" style="color: black;"><br><h2>{langTranslateApp.boxOfficeRentYour} <span class="green">1<sup>st</sup></span> {langTranslateApp.boxOfficeMovie} <br>{langTranslateApp.boxOfficeFree}!</h2><a class="cta" href={dstvApp.BoxOfficeSignUpURL}>{langTranslateApp.dashRentNow}<span class="icon icon-ico-movietype"></span></a></div></div><div if="{isBoxOfficeCustomer}"><div style="padding-bottom: 40px;"><img src="/media/6155/icon-boxoffice-3.png" class="boxoffice-logo-img"> <span class="boxoffice-logo"><strong>Box</strong>Office</span></div><div if="{state == \'renting\'}"> <span style="color: #000;font-weight: 500;">{langTranslateApp.dashBoxPopupSubHeader}.</span><div class="row" style="margin-top: 10px;"><input type="text" id="txtPVRCode" class="serial addvars form-control" autocomplete="off" datais="tag-input"><div><a id="rentNowBtn" href="javascript:void(0)" class="cta " onclick={onRentNow}>{langTranslateApp.dashRentNow}<span class="icon icon-BoxOffice"></span></a> </div></div></div><div if="{state == \'processing\'}" class="rentnow-loading"><div class="loading-loader loading"><div class="col-sm-12 text-center white"><div class="spinner white"></div><div class="loading-message">{langTranslateApp.dashProcessing}</div></div></div></div><div if="{state == \'notopup\'}"><h2 style=" color: #000; text-transform: none; margin-bottom: 10px !important;">{langTranslateApp.dashNoFundsMessage1}</h2><br><p style="color: #000;opacity: unset;">Please <b>{langTranslateApp.dashBoxOfficeTop}</b> now to Rent the hottest movies at home or on the move, wherever you like</p><div class="row" style="margin-top: 10px;"><div><a id="newRentBtn" href="javascript:void(0)" class="cta " onclick={requestForTOPUP}>{langTranslateApp.dashBoxOfficeTopUp}<span class="icon icon-BoxOffice"></span></a></div></div></div><div if="{state == \'error\'}"><h2 style=" color: #000; text-transform: none; margin-bottom: 10px !important; margin-top: 10px; font-weight: 400; ">{langTranslateApp.dashOhno}</h2><p style="color: #000;opacity: unset;">{langTranslateApp.dashRentNowErrorMessage1}</p><p style="color: #000;opacity: unset;">{langTranslateApp.dashRentNowErrorMessage2}</p><div class="row" style="margin-top: 10px;"><div><a id="newRentBtn" href="javascript:void(0)" class="cta " onclick={showRentForm}>{langTranslateApp.dashTryNewCode}<span class="icon icon-BoxOffice"></span></a></div></div></div><div if="{state == \'errorFromBO\'}"><h2 style=" color: #000; text-transform: none; margin-bottom: 10px !important; margin-top: 10px; font-weight: 400; ">{langTranslateApp.dashOhno}</h2><p style="color: #000;opacity: unset;">{errorMSG}</p><div class="row" style="margin-top: 10px;"><div><a id="newRentBtn" href="javascript:void(0)" class="cta " onclick={showRentForm}>{langTranslateApp.dashTryNewCode}<span class="icon icon-BoxOffice"></span></a></div></div></div><div if="{state == \'success\'}"><h3 style=" color: #000; text-transform: none; margin-bottom: 15px !important; margin-top: 10px; font-weight: 300; ">{langTranslateApp.dashRentNowSuccessMessage0}</h3><p style="color: #000;opacity: unset;"><span style="font-weight: 300 !important;">{langTranslateApp.dashRentNowSuccessMessage1}</span></p><p style="color: #000;opacity: unset;"><span style=" font-weight: 300 !important; ">{langTranslateApp.dashRentNowSuccessMessage2}</span></p><p style="color: #000;opacity: unset;text-decoration-line: underline;text-decoration-skip-ink: none;"><span>{langTranslateApp.dashRentNowSuccessMessage4}</span></p></div></div></div><div class="clearfix"></div></div></div></div></div></div>','tag-rentnow-modal-popup,[riot-tag="tag-rentnow-modal-popup"],[data-is="tag-rentnow-modal-popup"]{ visibility: visible; } ','',function(opts){var self=this;self.state='renting'
self.isBoxOfficeCustomer=app.IsBOCustomer;self.on('mount',function(){if(opts.showmodal){if(self.isBoxOfficeCustomer){let boAccountBal=app.BOAccount.AccountBalance.Value*-1;let currentMoviePrice=opts.currentMoviePrice;if(boAccountBal<currentMoviePrice){self.state='notopup';}}
self.update();$('#rentNowModalPopup').modal('show');self.setFocus();}
jcf.replaceAll();$('#txtPVRCode').on("keypress",function(e){if(e.keyCode==13){self.onRentNow();}});});self.on('updated',function(){self.setFocus();})
self.setFocus=function(){setTimeout(function(){$('#txtPVRCode').focus();},1000);}
self.requestForTOPUP=function(){riot.mount('tag-topup-modal-popup',{showmodal:true})}
self.linkCellNumber=function(){window.location=dstvApp.UpdateDetailsURL;}
self.showRentForm=function(){self.state='renting';self.setFocus();}
self.onRentNow=function(){if(!app.customercontactdetails.MobileTel){site.factory.ShowModelPopupWithCustomButtonText('error','Oops!!','Cell number not linked','We didn\'t find cell number to link this account \n Please add cell number to your account ',false,null,true,'Add Cell Number',self.linkCellNumber);return;}
else{let code=$('#txtPVRCode').val().trim();if(!code){swal('Oops!','Please enter rental code shown on your TV screen of PVR rentals ','error');$('#txtPVRCode').focus();return;}
self.state='processing';let tokenAvailable=site.factory.GetUserTokenAndType(app.customernumber,'surname',dstvApp.country);if(tokenAvailable){let getTopupAmountURL=dstvApp.EazyMobileAPIURL+`v1/BoxOffice/${dstvApp.country}/Rental`;let settings={async:true,crossDomain:true,url:getTopupAmountURL,method:"POST",data:JSON.stringify({msisdn:app.customercontactdetails.MobileTel,rentalCode:code}),headers:{"Content-Type":"application/json",Authorization:tokenAvailable.token}}
$.ajax(settings).done(function(response){if(response.data&&!response.data.successfulRental){self.errorMSG=response.data.responseMessage;self.state='errorFromBO';self.update();return;}
self.state='success';let movieName='';if(response.data&&response.data.title)
movieName=response.data.title
langTranslateApp.dashRentNowSuccessMessage1=langTranslateApp.dashRentNowSuccessMessage1.replace('[MOVIENAME]',movieName)
self.update();if(typeof site.startBoxOfficeTokenCreation=='function')
site.startBoxOfficeTokenCreation();}).fail(function(error){try{if(error.responseJSON.errors.rentalCode[0])
self.errorMSG=error.responseJSON.errors.rentalCode[0]}
catch(e){self.errorMSG='Something went wrong while processing your request. \n Please try again.'}
self.state='error';self.update();});}
else{console.log('Rent Now : Error - Token not found')}
return}}})
riot.tag2('tag-topup-modal-popup','<div class="modal fade dashboardModal dashboardPOP" id="topupModalPopup" role="dialog"> <div class="webform container modal-dialog feedback-dialog"> <div class="modal-content"> <button type="button" class="close btnClose" data-dismiss="modal"><i class=" icon-Close_M"></i></button> <div class="modal-body"> <div class="container-fluid main-section"> <div class="popup"> <div style="margin-top: 25px;"> <span class="icon-How_to_pay" style="color: #009639;font-size: 3em;"></span> <h4 style="color: #009639;margin-bottom: 20px;">{langTranslateApp.dashBoxOfficeTopUp}</h4> <span style="color: #000;font-weight: 500;">{langTranslateApp.dashBoxOfficeToProceedRental}</span> <div class="row" style="margin-top: 10px;"> <span id="animationSandbox"> <select class="medium white cinput" name="topupSelect" onchange={onTopupChange}> <option class="hide" value="">{langTranslateApp.dashBoxOfficeSelectTopUp}</option> <option if="{!app.dualCurrencyApplicable || notDualCurrency}" each="{amount, index in app.topUpAmountList}" value="{amount}">{dstvApp.countrycurrency.toUpperCase()+" "+amount}</option> <option if="{app.dualCurrencyApplicable && !notDualCurrency}" each="{amount, index in app.topUpAmountList}" value="{amount}">{"USD "+amount}</option> </select> </span> <div><a id="topupBtn" href="javascript:void(0)" class="cta disable-fixerror-button" onclick={performTopup}>{langTranslateApp.dashBoxOfficeTop}<span class="icon icon-Arrow_right_thin"></span></a> </div> </div> </div> </div> <div class="clearfix"></div> </div> <div id="boxofficeoverlay" class="row"> <div class="cv-spinner"> <span class="cpspinner"></span> </div> </div> </div> </div> </div></div>','tag-topup-modal-popup,[riot-tag="tag-topup-modal-popup"],[data-is="tag-topup-modal-popup"]{ visibility: visible; } ','',function(opts){var self=this;self.notDualCurrency=false;if(dstvApp.countryabbreviation=='mu')
self.notDualCurrency=true;self.on('mount',function(){$("#boxofficeoverlay").fadeOut();if(opts.showmodal)
$('#topupModalPopup').modal('show');jcf.replaceAll();self.GenerateJWT();});self.GenerateJWT=function(){site.factory.GetJWT().then(function(token){self.token=token;})}
self.onTopupChange=function(e){self.currentAmount=e.currentTarget.value;if(self.currentAmount)
$('#topupBtn').removeClass('disable-fixerror-button');}
self.performTopup=function(e){if(!self.currentAmount){swal({button:langTranslateApp.dashBoxOfficeOk,title:'Oops!',text:langTranslateApp.boxOfficeSelectAmountMsg,icon:'error'});}
else{if(dstvApp.NoOnlinePaymentCountryList.includes(dstvApp.countryabbreviation)){site.factory.HandleHowToPay();}
else{if(dstvApp.DSOPayments&&dstvApp.DSOPayments.trim().toLowerCase()=='off'){window.location=dstvApp.PaymentURL+app.smartcard+'/topup/'+self.currentAmount+'/';}
else{$('#topupModalPopup').hide();riot.mount('tag-payments-new',{boxOfficePayment:true,amount:self.currentAmount});}}}
return;}
self.loadIframeAndProcessPayment=function(){self.newWin=window.open('','_blank');let html="";if(dstvApp.languageAbbreviation=='pt')
html+="<html><head></head><body><div>Por favor, espere...</div></body></html>";else
html+="<html><head></head><body><div>Please Wait...</div></body></html>";self.newWin.document.write(html);$("#boxofficeoverlay").fadeIn(300);var currency=dstvApp.countrycurrency;if(dstvApp.DualCurrencyCountryList.includes(dstvApp.countryabbreviation)){currency=dstvApp.DualCurrencyPaymentCurrency.filter(x=>x.country==dstvApp.countryabbreviation)[0].currency;}
let account=app.accounts.filter(x=>x.AccountType=="Box Office");let accNumber=account[0]?account[0].AccountNumber:null;let accountInfo=app.accountsInfo.filter(x=>x.AccountType=="Box Office");let accBalance=accountInfo[0]?accountInfo[0].AccountBalance.Value:null;let payDueDate=accountInfo[0]?accountInfo[0].DueDate:null;let amtToPay=accountInfo[0]?accountInfo[0].AmountToPay.Value:null;var reqBodyPaymentService={"country":dstvApp.country,"businessUnit":dstvApp.businessunit,"channel":dstvApp.channel,"currency":currency,"customerNumber":app.customernumber,"smartCardNumber":app.smartcard,"firstName":app.customerDetails.PersonalDetail.FirstName,"name":app.customerDetails.PersonalDetail.Surname,"accountNumber":accNumber,"amount":self.currentAmount,"productUserKey":"","paymentType":"BoxOffice","backUrl":"","successReturnURL":"","failureReturnURL":"","bypassPaymentSuite":true,"LanguageCode":dstvApp.languageAbbreviation,"accountBalance":accBalance,"dueDate":payDueDate,"productNamesPrices":"Box Office"+":"+self.currentAmount,"amountToPay":amtToPay};site.trigger('getpostdata',dstvApp.DSOPaymentServiceURL,'POST','application/json',"Bearer "+self.token,'',reqBodyPaymentService,'',self.onPaymentProcessSuccess,self.onPaymentProcessError);}
self.onPaymentProcessSuccess=function(data){console.log('Payment process successful');$("#boxofficeoverlay").fadeOut(300);$('#topupModalPopup').modal('hide');riot.mount('tag-payments-new');$('#paymentModal').modal('show');if(data){let dppRedirectUrl=data.redirectUrl;$("#boxofficeoverlay").fadeOut(300);$('#paymentPage').hide();$('#paymentModal').modal('hide');self.newWin.location=dppRedirectUrl;}
else{$("#boxofficeoverlay").fadeOut(300);console.log('error after successful DSOPaymentServiceURL call');}}
self.onPaymentProcessError=function(err){$('#topupModalPopup').modal('hide');$("#boxofficeoverlay").fadeOut(300);console.log('Error on DSO Payment process');let html="";if(dstvApp.languageAbbreviation=='pt')
html+="<html><head></head><body><div>Algo deu errado!</div></body></html>";else
html+="<html><head></head><body><div>Something went wrong!</div></body></html>";self.newWin.document.write(html);}});riot.tag2('tag-box-office-movies','<div class="boxoffice-bg"><div class="boxoffice-trailer" if="{selectedBoxOfficeMove && play}"><h1>{selectedBoxOfficeMove.name}</h1> <div class="row"><div class="controls" if="{showPlayButton}"><ul><li></li><li><img src="/media/6369/playicon.png" width="155" height="65" onclick={playVideo} alt="" style="cursor: pointer;"></li><li></li></ul></div><video id="videoPlayer" width="100%" poster="{selectedBoxOfficeMove.thumbPrintImage}" controls="" ><source src={selectedBoxOfficeMove.trailerLink} type="video/mp4">Your browser does not support HTML5 video.</video></div><div class="row synopsis"><ul class="meta-hold"><li><span class="ico icon-ico-pg"></span><span class="text">{selectedBoxOfficeMove.contentRating}</span></li><li><span class="ico icon-ico-movietype"></span><span class="text">{selectedBoxOfficeMove.type}</span></li><li><span class="ico icon-ico-time"></span><span class="text">{selectedBoxOfficeMove.duration}</span></li></ul><p>{selectedBoxOfficeMove.summary}</p><p></p><p><strong>{langTranslateApp.boxOfficeStarring}:</strong> {selectedBoxOfficeMove.actors}</p></div><div class="left"> <a href="javascript:void(0)" onclick={onTopup} class="cta" if="{app.IsBOCustomer}">{langTranslateApp.dashBoxOfficeTop}</a> </div><div class="right"> <a href="javascript:void(0)" onclick={onRent} class="cta" if="{app.IsBOCustomer}">{langTranslateApp.dashRentNow}</a> </div></div><div class="boxoffice-welcome" if="{app.IsBOCustomer}"><h1><span class="white"><strong>Box</strong>Office</span> {langTranslateApp.boxOfficeAccountDashboard}</h1> <div class="left"><p><span class="icon-How_to_pay"></span>Amount Available</p><p class="boxoffice-amount"><span class="currency">{dstvApp.countrycurrency.toUpperCase()}</span>{Math.abs(app.BOAccount.AccountBalance.Value)}</p> <a href="https://onlinepayments.dstvafrica.com/zmb/payment/4250358928" class="cta hidden" >{langTranslateApp.dashRentNow}</a> </div><div class="right"><p>{langTranslateApp.boxOfficeAccountDashboard} #: <span class="data">{app.BOAccount.AccountNumber}</span></p><p>{langTranslateApp.boxOfficeCustomer} #: <span class="data">{app.customernumber}</span></p> <a href="https://onlinepayments.dstvafrica.com/zmb/payment/4250358928" class="cta hidden">{langTranslateApp.dashBoxOfficeTop}</a> </div></div><div class="boxoffice-welcome non-box-office-user" if="{!app.IsBOCustomer}"><h1> {langTranslateApp.boxOfficeWelcome} <span class="white"><strong>Box</strong>Office</span></h1> <h2>{langTranslateApp.dashBoxOfficeGetYour}<span class="green">1st</span> {langTranslateApp.watchMovies} <strong>{langTranslateApp.dashFree}</strong></h2><a href={boxOfficeSignInURL} class="cta">{langTranslateApp.dashBoxOfficeGetMovies}</a></div><section class=""><h2>{langTranslateApp.dashBoxOfficeLatestMovies}</h2><div class="box-office-popup-items" each="{item in opts.boxofficemovies}"><div><a href="javascript:void(0)" target="_blank" onclick="{onBoxOfficeMovieClick}"><div class="card-label-holder"><div class="channel-logo" style="display:none"><img src="{item.logoImageURL}"></div></div><img src="{item.thumbPrintImage}" title="{item.name}"></a></div></div></section></div>','tag-box-office-movies,[riot-tag="tag-box-office-movies"],[data-is="tag-box-office-movies"]{ visibility: visible; } tag-box-office-movies select,[riot-tag="tag-box-office-movies"] select,[data-is="tag-box-office-movies"] select{ display: none !important; }','',function(opts){var self=this;self.selectedBoxOfficeMove=opts.selectedBoxOfficeMove;self.boxOfficeSignInURL=dstvApp.BoxOfficeSignUpURL;console.log('opts.play :'+opts.play)
self.play=opts.play;self.vPlayer=null;self.on('mount',function(){self.vPlayer=$('#videoPlayer')[0];$('#boxOfficeModal').on('shown.bs.modal',function(){self.onPopupOpen()});$('#boxOfficeModal').on('hidden.bs.modal',function(){self.popupScrollTop();})
self.update();});self.onPopupOpen=function(){if(self.opts.viewall===true){self.popupScrollDown();return;}
self.play=true;self.selectedBoxOfficeMove=self.selectedBoxOfficeMove||app.boxOfficeMovies[0];self.popupScrollTop();self.vPlayerAction('LOAD')
self.update();}
self.onPopupClose=function(){self.vPlayerAction('PAUSE');self.showPlayButton=true
self.selectedBoxOfficeMove=app.boxOfficeMovies[0];self.update();$('#boxOfficeModal').modal('hide');return;}
self.onTopup=function(){riot.mount('tag-topup-modal-popup',{showmodal:true})}
self.onRent=function(){self.showRentNowPopup();}
self.showRentNowPopup=function(){let boAccount=site.factory.GetUserTokenAndType(app.customernumber,'surname',dstvApp.country);this.selectedBoxOfficeMove.price=this.selectedBoxOfficeMove.price||"0";let currentMoviePrice=parseFloat(this.selectedBoxOfficeMove.price.match(/\d+/)[0]);riot.mount('tag-rentnow-modal-popup',{showmodal:true,boAccount:boAccount,currentMoviePrice:currentMoviePrice})}
self.vPlayerAction=function(action){let vPlayer=$('#videoPlayer')[0];let promise;try{switch(action){case 'PAUSE':promise=vPlayer.pause();break;case 'PLAY':promise=vPlayer.play();break;case 'LOAD':promise=vPlayer.load();break;}
if(promise!==undefined){promise.then(_=>{}).catch(error=>{});}}
catch(e){console.log('Unable to pause video player');}}
self.playVideo=function(){self.showPlayButton=false;self.update();self.vPlayerAction('PLAY');}
self.onBoxOfficeMovieClick=function(e){e.preventDefault();let item=e.item.item;self.selectedBoxOfficeMove=item;self.showPlayButton=true;self.play=true;self.update();self.popupScrollTop();self.vPlayerAction('LOAD');}
self.popupScrollTop=function(){$('.modal-body').animate({scrollTop:10},1000);}
self.popupScrollDown=function(){let latestMoviesPos=$('tag-box-office-movies h2').offset();console.log('popupScrollDown ',latestMoviesPos)
if(latestMoviesPos>0)
$('.modal-body').animate({scrollTop:$('tag-box-office-movies h2').offset().top-100},1000);}})
riot.tag2('tag-dashboard-rewards-section','<div class="" style="z-index: 9999;" if="{!rewardsLoaded}"><div class="loading-loader loading"><div class="col-sm-12 text-center white"><div class="spinner black"></div><div class="loading-message">{langTranslateApp.dashLoading}</div></div></div></div> <div class="hidden reward-alert active" if="{rewardsCount}"> <p><span class="reward-number">{rewardsCount}</span>{langTranslateApp.rewardAvailable}</p> </div> </div> <h2>{langTranslateApp.rewards}</h2> <p>{rewardMessage}</p> <a href="javascript:void(0)" onclick={onViewRewardsClick} class="cta" style="font-size: 13px;padding: 0 6px 0 20px;height: 42px;line-height: 42px;">{langTranslateApp.rewardViewRewards}<span class="icon-ico-arrow-next"></span></a>','tag-dashboard-rewards-section,[riot-tag="tag-dashboard-rewards-section"],[data-is="tag-dashboard-rewards-section"]{ visibility: visible; } tag-dashboard-rewards-section select,[riot-tag="tag-dashboard-rewards-section"] select,[data-is="tag-dashboard-rewards-section"] select{ display: none !important; }','',function(opts){var self=this;self.rewardsOpacity='watch-section-opacity';self.rewardsLoaded=false;self.rewardMessage=langTranslateApp.rewardMessage;self.rewardsCount=0;self.on('mount',function(){console.log('Rewards : Rewards loding started...')
if(app.loggedin)
site.factory.GetJWT().then(function(token){self.token=token;console.log('Rewards : Token fetched')
self.loadCategories();})})
self.loadCategories=function(){console.log('Rewards : dstv thanks authenticating user...')
var authenticationUrl=dstvApp.DSOAPIUrl+`apidstvthanks/api/v1/Authenticate?Smartcardnumber=${app.smartcard}&Surname=${app.paymentduedetails.properties.surname.value.trim()}&Country=${dstvApp.country}&BusinessUnit=${dstvApp.businessunit}&Channel=${dstvApp.channel}&Language=${dstvApp.language}`;site.factory.Get(authenticationUrl,self.token,self.onAuthenticateSuccess,self.onAuthenticateError);};self.onAuthenticateSuccess=function(data){console.log('Rewards : dstv thanks user authenticated')
dstvApp.UserSessionKey=data.sessionKey;dstvApp.AuthenticateUserResponse=data;var loggedinCategoriesQueryString=`apidstvthanks/api/v1/GetReward?Country=${dstvApp.country}&BusinessUnit=${dstvApp.businessunit}&Language=${dstvApp.language}&Channel=${dstvApp.channel}&CustomerSmartCard=${app.smartcard}&SessionKey=${dstvApp.UserSessionKey}`;loadAllCategoriesUrl=dstvApp.DSOAPIUrl+loggedinCategoriesQueryString;console.log('Rewards : dstv thanks pulling data...')
site.factory.Get(loadAllCategoriesUrl,self.token,self.loadCategorySuccess,self.loadCategoryError);}
self.loadCategorySuccess=function(response){console.log('Rewards : dstv thanks pulling data completed')
if(response.smartCardQueryByCustomerResult)
self.rewardsCount=response.smartCardQueryByCustomerResult.length?response.smartCardQueryByCustomerResult.map(x=>x.productList.length).reduce((x,y)=>x+y):0;self.rewardMessage=langTranslateApp.dashRewardMsg4;self.showRewards();}
self.loadCategoryError=function(e){console.log('Rewards : dstv thanks pulling data failed')
console.log(e)
self.showRewards();}
self.onAuthenticateError=function(e){console.log('Rewards : dstv thanks user authentication failed.')
console.log(e)
self.showRewards();}
self.showRewards=function(){self.rewardsOpacity='';self.rewardsLoaded=true;self.update();}
self.onViewRewardsClick=function(e){window.location=dstvApp.DstvThanksURL;}});riot.tag2('tag-dashboard-package-section','<div class="" style="z-index: 9999;" if="{!packageLoaded}"> <div class="loading-loader loading"> <div class="col-sm-12 text-center white"> <div class="spinner black"></div> <div class="loading-message">{langTranslateApp.dashPkgLoading}...</div> </div> </div></div><div class="scrollbar dashboard-package-holder"> <div if="{package.primaryService}" class="package-item {package.primaryService.productName}-package" each="{package in packages}"> <input class="package-input" id="pckg-itm-cmpct" name="accordion-1" type="radio" style="position: absolute; opacity: 0;" value="{package.SerialNumber}~{package.primaryService.serviceName}~{package.primaryService.status}"><span></span> <label class="package-label jcf-label-active" for="pckg-itm-cmpct"> <span class="option"><i class="icon-pack icon-{package.primaryService.productCode}"></i></span> <span class="smartcard">{langTranslateApp.loginSmartcardNumber}<br><span class="number">{package.SerialNumber}</span></span></label> <div class="{\'package-details contents \' + ptDashSmallFontClass}"> <ul> <li> <h6>{langTranslateApp.dashAddon}</h6> <p>{package.addonService}</p> </li> <li> <div class="package-text-price ">{langTranslateApp.pkgPriceMonthly}</div> <div if="{!app.dualCurrencyApplicable}" class="package-price">{dstvApp.countrycurrency.toUpperCase()} {package.primaryService.price}</div> <div if="{app.dualCurrencyApplicable}" class="package-price">{dstvApp.countrycurrency.toUpperCase()} {package.primaryService.localPrice.amount}</div> <div class="package-text-amount price-bten">{langTranslateApp.pkgAmountAvailable}</div> <div if="{!app.dualCurrencyApplicable}" class="package-amount">{dstvApp.countrycurrency.toUpperCase()} {availableAccountBalance}</div> <div if="{app.dualCurrencyApplicable}" class="package-amount">{dstvApp.countrycurrency.toUpperCase()} {availableAccountBalanceDualCurrency}</div> </li> <li> <h6>{langTranslateApp.accStatus}</h6> <p><img src="/media/4534/active-icon.png" if="{package.primaryService.status == \'Active\'}"><span if="{dstvApp.language == \'English\'}">{package.primaryService.status}</span><span if="{dstvApp.language == \'Portuguese\' && package.primaryService.status == \'Active\'}">Activo</span><span if="{dstvApp.language == \'Portuguese\' && package.primaryService.status == \'Disconnected\'}">Desconectado</span></p> <span if="{dstvApp.language == \'Portuguese\' && package.primaryService.status == \'Suspended\'}">Suspensa</span> <p if="{dstvApp.language == \'Portuguese\' && package.primaryService.status == \'Pending\'}"><span>Pendente</span></p> </p> </li> </ul> <div class="package-footer-section-new"> <a if="{package.primaryService.status != \'Pending\'}" href="javascript:void(0)" onclick={openchangepackagemodal} class="{\'change-package \' + ptSmallFontClass}">{langTranslateApp.dashChangePackage} <span class="icon-ico-compare"></span></a><a href="javascript:void(0)" onclick={openAddOnmodal} class="{\'add-ons \' + ptSmallFontClass}" if="{package.primaryService.status == \'Active\'}">{langTranslateApp.dashAddOns} <span class="icon-Plus_in_circle"></span></a> <div class="clearfix"></div> </div> </div> </div></div>','tag-dashboard-package-section,[riot-tag="tag-dashboard-package-section"],[data-is="tag-dashboard-package-section"]{ visibility: visible; } tag-dashboard-package-section select,[riot-tag="tag-dashboard-package-section"] select,[data-is="tag-dashboard-package-section"] select{ display: none !important; }','',function(opts){var self=this;app.noServicesLoaded=false;self.packageOpacity='package-section-opacity';self.packageLoaded=false;self.ptDashSmallFontClass=dstvApp.languageAbbreviation+"-dash-small-font";;self.ptSmallFontClass=dstvApp.languageAbbreviation+"-small-font";self.on('before-mount',function(){console.log('Package : package loding started...')
if(app.loggedin)
site.factory.GetJWT().then(function(token){self.token=token;console.log('Package : fetch view subscription started...')
let url=dstvApp.DSOAPIUrl+`/apiviewsubscription/api/v1/Subscription?country=${dstvApp.country}&customerNumber=${app.customernumber}&BusinessUnit=${dstvApp.businessunit}&Channel=${dstvApp.channel}`
site.factory.Get(url,self.token,self.successPostCallback,self.errorPostCallback);})})
self.on('mount',function(){})
self.successPostCallback=function(data){console.log('Package : fetch view subscription completed')
app.viewSubscriptionResponse=data;self.packageLoaded=true;self.packages=data.map((package)=>{if(package.smartcardNumber==app.smartcard){app.viewingDaysLeft=package.viewingDaysLeft}
if(package.services!==null){if(package.services.length>1)
package.services=package.services.sort(function(x,y){return x.psnr-y.psnr})
primaryService=package.services.filter((service)=>{serviceName=service.serviceName.split('-');if(service.serviceName.includes('-')){serviceName=service.serviceName.split('-');}
else if(service.serviceName.toUpperCase().includes('SHOWMAX')){serviceName[0]=service.serviceName.toUpperCase().trim().substring(0,7).trim();serviceName[1]=service.serviceName.toUpperCase().trim().substring(15,7).trim();}
service.productCode=serviceName[0].trim();let pckNameArray=packageName=serviceName[1].includes('+')?serviceName[1].toLowerCase().replace('dstv','').trim().split('+'):serviceName[1].toLowerCase().replace('dstv','').trim().split(' ');service.productName=pckNameArray[0];if(serviceName[1].includes('+')){service.productName=pckNameArray[0].trim().substr(0,pckNameArray[0].trim().indexOf(' '))+'-'+pckNameArray[1].trim().substr(0,pckNameArray[1].trim().indexOf(' '));}
service.productName+=packageName[1]=='plus'?'plus':'';service.productName=service.productName.replace("'","");service.hideAddonLinkClass=service.status=="Active"?'':' visibility-hidden';currentPackageFullName=service.serviceName;return service.type=='Principal'});if(primaryService.length>1)
primaryService=primaryService.filter((service)=>{return service.status=='Active'})
primaryService=primaryService[0];if(primaryService!=undefined||primaryService!=null){app.CardStatus=primaryService.status;app.MonthlyPrice=primaryService.price;app.ProductCode=primaryService.productCode;app.currentPackageFullName=primaryService.serviceName;if(dstvApp.DualCurrencyCountryList.includes(dstvApp.countryabbreviation))
app.MonthlyPriceDualCurrency=primaryService.localPrice?primaryService.localPrice.amount:null;}
addonServiceList=package.services.filter((service)=>{return(service.type=='Addon'||service.description.includes('Add-on')||service.description.includes('add-on'))&&service.status=='Active'});addonService=package.services.filter((service)=>{return service.type=='Addon'||service.description.includes('Add-on')||service.description.includes('add-on')})[0];addonService=addonService&&addonService.status=='Active'?(addonService.serviceName||addonService.description):'N/A';app.AddOnService=addonService;app.SmartCardNumber=package.smartcardNumber;window.SessionSave("app",app);}
return{SerialNumber:package.smartcardNumber,SmartcardName:package.smartcardName,primaryService:primaryService,addonService:addonService,Status:package.Status,psnr:package.psnr,serviceId:package.serviceId,isPrimarySmartcard:package.isPrimarySc,isXtraView:package.isXtraView};})
app.smartcards=self.packages;app.loadedpackages=true;app.noServicesLoaded=app.smartcards.filter(x=>(x.primaryService!==undefined&&x.primaryService.length!==0&&x.primaryService!=='')).length==0;let sm=app.smartcards.filter(x=>x.SerialNumber==app.smartcard)
app.showTerminatedBouquetScreen=null;if(sm.length&&sm[0].primaryService&&dstvApp.BouquetTermination){app.showTerminatedBouquetScreen=sm[0].primaryService.isExpired}
window.SessionSave("app",app);self.packages=self.packages.filter(x=>x.primaryService);self.update();$('input:radio[class="package-input"]').click(function(){var isRadioChecked=$('input:radio[class="package-input"]').is(":checked")
if(isRadioChecked){var dashSelectedPackageValue=$("input[class='package-input']:checked").val();app.dashSelectedSmartCard=dashSelectedPackageValue.split('~')[0].trim();app.dashSelectedPackageName=dashSelectedPackageValue.split('~')[1].trim();app.dashSelectedPackageCardStatus=dashSelectedPackageValue.split('~')[2].trim();window.SessionSave('app',app);}});if(app.showTerminatedBouquetScreen){riot.mount('tag-payments-new');$('#paymentModal').modal('show');}
let dashboardPackageHolder=$('.dashboard-package-holder');let firstPackage;try{firstPackage=dashboardPackageHolder[0].firstElementChild;if(firstPackage){let radioButton=$(firstPackage.querySelector('input'));radioButton.attr('checked','checked');}
var isRadioChecked=$('input:radio[class="package-input"]').is(":checked")
if(isRadioChecked){var dashSelectedPackageValue=$("input[class='package-input']:checked").val();app.dashSelectedSmartCard=dashSelectedPackageValue.split('~')[0].trim();app.dashSelectedPackageName=dashSelectedPackageValue.split('~')[1].trim();app.dashSelectedPackageCardStatus=dashSelectedPackageValue.split('~')[2].trim();window.SessionSave('app',app);}}
catch(e){console.log('package radio button exception')}
if(app.accountsInfo&&app.accountsInfo[0]&&app.accountsInfo[0].AccountBalance){self.availableAccountBalance=app.accountsInfo.filter(d=>d.AccountType=='DStvRes')[0].AccountBalance.Value;if(dstvApp.DualCurrency=='on'&&dstvApp.DualCurrencyCountryList.includes(dstvApp.countryabbreviation))
self.availableAccountBalanceDualCurrency=app.accountsInfo.filter(d=>d.AccountType=='DStvRes')[0].AccountBalance.LocalPrice.Amount.toString();}
else{self.availableAccountBalance='NA';}
jcf.replaceAll();self.packageLoaded=true;self.update();if(!app.noServicesLoaded){$('a[name=errorCode]').removeClass('disable-fixerror-links');}
self.parent.LoadShowMaxDetails();}
self.errorPostCallback=function(data){console.log('Package : ERROR in fetch view subscription')}
self.openchangepackagemodal=function(e){e.preventDefault();$('#changepackageModal').modal('show');$('.changePackModel').show();if(app.deadlineTime){let currentDateTime=new Date().getTime();if(currentDateTime<=app.deadlineTime){riot.mount('tag-change-package-new',{showmodal:false,showAlert:true});return;}
else{app.deadlineTime=undefined;window.SessionSave("app",app);}}
riot.mount('tag-change-package-new',{showmodal:true});}
self.openAddOnmodal=function(e){e.preventDefault();$('#addOnPackageModal').modal('show');$('.addOnPacakgeModal').show();if(app.deadlineTime){let currentDateTime=new Date().getTime();if(currentDateTime<=app.deadlineTime){riot.mount('tag-addons-new',{showmodal:false,showAlert:true});return;}
else{app.deadlineTime=undefined;window.SessionSave("app",app);}}
riot.mount('tag-addons-new',{showmodal:true});}});riot.tag2('tag-test-dashboard','<section class="container-fluid main"> <div class="container-fluid profile-section"> <div class="container"> <!--div class="profile-picture"><img src="/media/5932/user-profile.png" alt="" /></div--> <div class="profile-details"> <h3>{langTranslateApp.loginWelcome}</h3> <h2>{app.customername}</h2> </div> </div> <div if="{dstvApp.DualCurrency == \'on\' && dstvApp.DualCurrencyCountryList.includes(dstvApp.countryabbreviation) && !notDualCurrency}" class="currencyToggle"><span class="currencyWord">Currency</span><label class="switch"><input onclick={onCurrencyToggle} class="switch-input" type="checkbox" checked /><span class="switch-label" data-on="USD" data-off="ETB"></span><span class="switch-handle"></span> </label></div> </div> <div class="container" if="{!app.loggedin}"> <span class="no-login">Please login....</span></div> <div class="container" if="{app.loggedin}"> <div class="col-md-4 account"> <div class="account-detail"> <span class="left"> <p>{langTranslateApp.accAmountPay}</p> <p class="amount" if="{!app.dualCurrencyApplicable}"><span class="currency">{dstvApp.countrycurrency.toUpperCase()} </span> {app.paymentduedetails.properties.amountToPay.value}</p> <p if="{app.dualCurrencyApplicable}" class="amount"><span class="currency">{dstvApp.countrycurrency.toUpperCase()} </span> {app.paymentduedetails.properties.amountToPayEtb.value}</p> <p if="{dstvApp.country == \'angola\'}" class="amount"><span class="currency">{langTranslateApp.angolaJVText}</span></p> </span> <span class="right"> <p>{langTranslateApp.accViewingdays}: <span class="result">{app.viewingDaysLeft}</span></p> <p>{langTranslateApp.accDueBy}: <span class="result">{site.factory.GetEazyDateFormat(app.paymentduedetails.properties.dueDate.value)}</span></p> </span> </div> <div class="cta-area"> <a href="javascript:void(0)" onclick={loadPaymentsPopup} class={payCTA} id="paybtn-dashboard">{paymentButtonCaption}<span class="icon-ico-arrow-next"></span></a> </div> </div> <div class="col-md-4 packages"> <div class="txt-wrapper" if="{app.noServicesLoaded}"> <span class="icon-icon-warning errorUpgradeIcon package"></span> <p>{langTranslateApp.dashNoServiceMessage1}. {langTranslateApp.transHistoryPlease} {langTranslateApp.dashNoServiceMessage2} {langTranslateApp.dashNoServiceMessage3}.</p> <div class="errorUpgradeButtons"><a href="{window.culture}{langTranslateApp.subMenuContactUsLink}" class="cta callnowButton" > {langTranslateApp.subMenuContactUs} <span class="icon-ico-arrow-next"></span></a></div> </div> <div class="" style="z-index: 9999;" if="{!packageLoaded}"> <div class="loading-loader loading"> <div class="col-sm-12 text-center white"> <div class="spinner black"></div> <div class="loading-message">{langTranslateApp.dashPkgLoading}...</div> </div> </div> </div> <tag-dashboard-package-section></tag-dashboard-package-section> <!--div class="links"><a href={dstvApp.ChangePackageURL} class="add-to-package"><span class="icon-ico-compare"></span>{langTranslateApp.pkgChangePackage}</a></div--> <div class="glass"> <h2>{langTranslateApp.accYourPackage}</h2> </div> </div> <div class="col-md-4 watch" if="{showBoxOfficeSection}"> <div class="" style="z-index: 9999;" if="{!boxOfficeLoaded}"> <div class="loading-loader loading"> <div class="col-sm-12 text-center white"> <div class="spinner black"></div> <div class="loading-message">{langTranslateApp.dashBoxOffLoading}...</div> </div> </div> </div> <div class="watch-header {boxofficeOpacity}" style="background: url({watchTrailerPicture})"> <div class="controls"> <ul> <li><a href="javascript:void(0)" onclick={performTopup} class="cta no-border"><span class="cta-text">{langTranslateApp.dashBoxOfficeTop}</span><span class="icon-circlearrow-right"></span></a></li> <li><img src="/media/6369/playicon.png" width="155" height="65" alt="" onclick={playBoxOfficeMovie} style="cursor: pointer;"></li> <li><a href="javascript:void(0)" class="cta no-border" onclick={onRent}><span class="cta-text">{langTranslateApp.dashRentNow}</span><span class="icon-circlearrow-right"></span></a></li> </ul> </div> </div> <section class=" second-slider {boxofficeOpacity}"> <div class="highlights-nav-section"> <section class="responsive slider"> <div each="{item in app.boxOfficeMovies}"> <div><a href="javascript:void(0)" target="_blank" onclick="{onBoxOfficeMovieClick}"><img src="{item.thumbPrintImage}" title="{item.name}"></a></div> </div> </section> </div> </section> <a href="javascript:void(0)" class="cta add-to-package" data-toggle="modal" data-target="#boxOfficeModal">{langTranslateApp.viewAll}<span class="icon-circlearrow-right">&nbsp;</span></a> <div class="glass"><img src="/media/7610/boxoffice-logo-dasboard.png" alt="Box Office"></div> </div> <div class="col-md-4 error-fix"> <!--p>{langTranslateApp.fixErrorSubHeader}</p--> <ul class="error-list"> <li> <div class="errorcode-block"><span class="error-code">E16</span></div> <span class="error-text">{langTranslateApp.fixErrorE16}.</span><a href="javascript:void(0)" name="errorCode" class="cta blue disable-fixerror-links" errorcode="e16" onclick={onFixErrorClick}><span class="icon-circlearrow-right">&nbsp;</span><span class="cta-text">{langTranslateApp.fixErrorNow}</span></a> </li> <li> <div class="errorcode-block"><span class="error-code">E30</span></div> <span class="error-text">{langTranslateApp.fixErrorE30}</span><a href="javascript:void(0)" name="errorCode" class="cta blue disable-fixerror-links" errorcode="e30" onclick={onFixErrorClick}><span class="icon-circlearrow-right">&nbsp;</span><span class="cta-text">{langTranslateApp.fixErrorNow}</span></a> </li> <li> <div class="errorcode-block"><span class="error-code">E32</span></div> <span class="error-text">{langTranslateApp.fixErrorE32}</span><a href="javascript:void(0)" name="errorCode" errorcode="e32" class="cta blue disable-fixerror-links" onclick={onFixErrorClick}><span class="icon-circlearrow-right">&nbsp;</span><span class="cta-text">{langTranslateApp.fixErrorNow}</span></a> </li> </ul> <div class="glass"> <h2>{langTranslateApp.fixErrorHeader}</h2> </div> </div> <div class="col-md-4 recurring desktop" if="{IsRecurringPaymentApplicable}"> <div class="cta-area iconDiv"><a href="javascript:void(0)" id="paybtn-dashboard" class="pay-cta" onclick="{ShowRecurringPayment}"><span class="icon icon-icon-change-package"></span> Recurring Payment<span class="icon-ico-arrow-next"></span></a> </div> </div> <div class="col-md-4 rewards" if="{showRewardSection}"> <div> <tag-dashboard-rewards-section></tag-dashboard-rewards-section> </div> <div class="glass"><img src="https://www.dstvafrica.com/media/4996/cfb30ae9-6c3c-46b8-86e4-a4a51cbdb5db.png" alt="DStv Thanks" if="{dstvApp.language == \'English\'}"><img src="/media/7865/icon-agradece.svg" style="max-height: 39.22px;" alt="DStv Agradece" if="{dstvApp.language == \'Portuguese\'}"></div> </div> <div class="col-md-4 contacts"> <!--h2>{langTranslateApp.contactDetails}</h2> <p>{langTranslateApp.contactAddInfo}</p--> <ul> <li><span class="item-title">{langTranslateApp.contactEmail}:</span><span class="item-detail">{app.customercontactdetails.EmailAddress}</span></li> <li><span class="item-title">{langTranslateApp.contactMobile}:</span><span class="item-detail">{app.customercontactdetails.MobileTel}</span></li> <!--li><span class="item-title">{langTranslateApp.contactAddress}:</span><span class="item-detail address-field" title={addressField}>{addressField}</span></li--> </ul> <a href="javascript:void(0)" class="cta blue" data-toggle="modal" onclick={onDashboardEditDetailsClick}><span class="icon-circlearrow-right">&nbsp;</span><span class="cta-text">{langTranslateApp.contactEditDetails}</span></a> <div class="glass"> <h2>{langTranslateApp.contactDetails}</h2> </div> </div> <div class="col-md-4 spacer" if="{IsRecurringPaymentApplicable}"></div> <div class="col-md-4 spacer" if="{IsRecurringPaymentApplicable}"></div> <div class="col-md-4 showmax" if="{showShowmaxSection}"> <div class="" style="z-index: 9999;height: 200px;" if="{!showMaxLoaded}"> <div class="loading-loader loading"> <div class="col-sm-12 text-center white"> <div class="spinner black"></div> <div class="loading-message">{langTranslateApp.dashShowmaxLoading}...</div> </div> </div> </div> <div class="txt-wrapper" if="{noServicesLoadedOnCard}"> <span class="icon-icon-warning errorUpgradeIcon package showmax-errorUpgradeIcon"></span> <p class="noServiceMessage-showmax">{langTranslateApp.dashNoServiceMessage1}. {langTranslateApp.transHistoryPlease} {langTranslateApp.dashNoServiceMessage2} {langTranslateApp.dashNoServiceMessage3}.</p> <div class="errorUpgradeButtons"><a href="{window.culture}{langTranslateApp.subMenuContactUsLink}" class="cta callnowButton" > {langTranslateApp.subMenuContactUs} <span class="icon-ico-arrow-next"></span></a></div> </div> <div if="{showMaxLoaded && isShowMaxApplicable && dstvPremium && !noServicesLoadedOnCard}"> <div if="{!isShowmaxAdded && !primaryPackageDisconnected}"> <h2>INTRODUCING</h2> <p><span class="live-text">LIVE SPORTS</span><br><span class="add-showmax-text"><span class="add-text">Add</span> Showmax</span> <br> <span class="terms"><a href="https://s3-eu-west-1.amazonaws.com/eazy3img/account/showmax-terms.pdf" title="Terms and Conditions" target="_blank">Terms &amp; Conditions Apply </a></span></p> </div> <div if="{isShowmaxAdded && isShowmaxActive}"> <h2>WATCH SHOWMAX</h2> <p>The best shows. No interruptions.<br><span class="watch-showmax-text">Watch anywhere. No contracts.</span> <br> <span class="terms"><a href="https://s3-eu-west-1.amazonaws.com/eazy3img/account/showmax-terms.pdf" title="Terms and Conditions" target="_blank">Terms &amp; Conditions Apply </a></span></p> </div> <div if="{primaryPackageDisconnected}"> <h2>Pay/Reconnect</h2> <p>your DStv account<br><span class="to-get-text">to get <span class="showmax-word">Showmax</span>.</span> <br> <span class="terms"><a href="https://s3-eu-west-1.amazonaws.com/eazy3img/account/showmax-terms.pdf" title="Terms and Conditions" target="_blank">Terms &amp; Conditions Apply </a></span></p> </div> <div if="{isShowmaxAdded && !isShowmaxActive && !primaryPackageDisconnected}"> <h2>Pay and reconnect</h2> <p>To continue watching Showmax<br><br> <span class="terms"><a href="https://s3-eu-west-1.amazonaws.com/eazy3img/account/showmax-terms.pdf" title="Terms and Conditions" target="_blank">Terms &amp; Conditions Apply </a></span></p> </div> <a if="{!isShowmaxAdded && !primaryPackageDisconnected}" href="javascript:void(0)" onclick="{onDashActivateShowmax}" class="cta" style="font-size: 13px;padding: 0 6px 0 20px;height: 42px;line-height: 42px;width: 190px;">Activate<span class="icon-ico-arrow-next" style="font-size: 30px;line-height: 42px;">&nbsp;</span></a><a if="{isShowmaxAdded && isShowmaxActive}" href="javascript:void(0)" onclick="{onDashWatchNowShowmax}" class="cta" style="font-size: 13px;padding: 0 6px 0 20px;height: 42px;line-height: 42px;width: 190px;">Watch Now<span class="icon-ico-arrow-next" style="font-size: 30px;line-height: 42px;">&nbsp;</span></a><a if="{isShowmaxAdded && isShowmaxActive}" href="javascript:void(0)" onclick="{onDashManageShowmax}" class="cta manageBtn" style="font-size: 13px;padding: 0 6px 0 20px;height: 42px;line-height: 42px;width: 190px;">Manage<span class="icon-ico-arrow-next" style="font-size: 30px;line-height: 42px;">&nbsp;</span></a><a id="payReconnectShowmax" if="{isShowmaxAdded && !isShowmaxActive || primaryPackageDisconnected}" href="javascript:void(0)" onclick={onDashPayReconnectShowmax} class="cta" style="font-size: 13px;padding: 0 6px 0 20px;height: 42px;line-height: 42px;">{langTranslateApp.menuPay+" / "+langTranslateApp.dashReconnect}<span class="icon-ico-arrow-next" style="line-height: 42px;">&nbsp;</span></a> </div> <div if="{showMaxLoaded && isShowMaxApplicable && !dstvPremium && !noServicesLoadedOnCard}"> <div if="{!isShowmaxAdded && !primaryPackageDisconnected}"> <h2>GET SHOWMAX</h2> <p>The best shows. No interruptions.<br><span class="watch-showmax-text">{dstvApp.countrycurrency.toUpperCase()} {app.showmaxAddOnDetails.price.value} p/m</span> <br> <span class="terms"><a href="https://s3-eu-west-1.amazonaws.com/eazy3img/account/showmax-terms.pdf" title="Terms and Conditions" target="_blank">Terms &amp; Conditions Apply </a></span></p> </div> <div if="{isShowmaxAdded && isShowmaxActive}"> <h2>WATCH SHOWMAX</h2> <p>The best shows. No interruptions.<br><span class="watch-showmax-text">Watch anywhere. No contracts.</span> <br> <span class="terms"><a href="https://s3-eu-west-1.amazonaws.com/eazy3img/account/showmax-terms.pdf" title="Terms and Conditions" target="_blank">Terms &amp; Conditions Apply </a></span></p> </div> <div if="{primaryPackageDisconnected}"> <h2>Pay/Reconnect</h2> <p>your DStv account<br><span class="to-get-text">to get <span class="showmax-word">Showmax</span>.</span><br> <span class="watch-showmax-text">{dstvApp.countrycurrency.toUpperCase()} {app.showmaxAddOnDetails.price.value} p/m</span><br> <span class="terms"><a href="https://s3-eu-west-1.amazonaws.com/eazy3img/account/showmax-terms.pdf" title="Terms and Conditions" target="_blank">Terms &amp; Conditions Apply </a></span></p> </div> <div if="{isShowmaxAdded && !isShowmaxActive && !primaryPackageDisconnected}"> <h2>Pay and reconnect</h2> <p>To continue watching Showmax<br><span class="watch-showmax-text">{dstvApp.countrycurrency.toUpperCase()} {app.showmaxAddOnDetails.price.value} p/m</span><br> <span class="terms"><a href="https://s3-eu-west-1.amazonaws.com/eazy3img/account/showmax-terms.pdf" title="Terms and Conditions" target="_blank">Terms &amp; Conditions Apply </a></span></p> </div> <a if="{!isShowmaxAdded && !primaryPackageDisconnected}" href="javascript:void(0)" onclick="{onDashActivateShowmax}" class="cta" style="font-size: 13px;padding: 0 6px 0 20px;height: 42px;line-height: 42px;width: 190px;">Add Showmax<span class="icon-ico-arrow-next" style="font-size: 30px;line-height: 42px;">&nbsp;</span></a><a if="{isShowmaxAdded && isShowmaxActive}" href="javascript:void(0)" onclick="{onDashWatchNowShowmax}" class="cta" style="font-size: 13px;padding: 0 6px 0 20px;height: 42px;line-height: 42px;width: 190px;">Watch Now<span class="icon-ico-arrow-next" style="font-size: 30px;line-height: 42px;">&nbsp;</span></a><a if="{isShowmaxAdded && isShowmaxActive}" href="javascript:void(0)" onclick="{onDashManageShowmax}" class="cta manageBtn" style="font-size: 13px;padding: 0 6px 0 20px;height: 42px;line-height: 42px;width: 190px;">Manage<span class="icon-ico-arrow-next" style="font-size: 30px;line-height: 42px;">&nbsp;</span></a><a id="payReconnectShowmax" if="{(isShowmaxAdded && !isShowmaxActive) || primaryPackageDisconnected}" href="javascript:void(0)" onclick={onDashPayReconnectShowmax} class="cta" style="font-size: 13px;padding: 0 6px 0 20px;height: 42px;line-height: 42px;">{langTranslateApp.menuPay+" / "+langTranslateApp.dashReconnect}<span class="icon-ico-arrow-next" style="line-height: 42px;">&nbsp;</span></a> </div> <div if="{!isShowMaxApplicable && showMaxLoaded && !app.noServicesLoaded && !noServicesLoadedOnCard}"> <h2>{langTranslateApp.dashShowmaxGet}</h2> <p>{langTranslateApp.dashShowmaxBestShows}<br><span class="" style="font-size: small;">{langTranslateApp.dashShowmaxWatchAnywhere}</span> <br> <span class="terms"><a href="https://s3-eu-west-1.amazonaws.com/eazy3img/account/showmax-terms.pdf" title="Terms and Conditions" target="_blank">{langTranslateApp.dashShowmaxTandC}</a></span></p> <a class="cta" href={showmaxGetItNowURL} target="blank" style="font-size: 13px;padding: 0 6px 0 20px;height: 42px;line-height: 42px;width: 190px;">{langTranslateApp.dashShowmaxGetItNow}<span class="icon-ico-arrow-next" style="font-size: 30px;line-height: 42px;">&nbsp;</span></a><a class="cta" href={showmaxTrialSignUpURL} target="blank" style="background: white;color: black;font-size: 12px;padding: 0px 6px 0 20px;height: 42px;line-height: 42px;width: 190px;">{langTranslateApp.dashShowmaxTrial}<span class="icon-ico-arrow-next" style="font-size: 30px;line-height: 42px;">&nbsp;</span></a> </div> <!--<div if="{isShowmaxAdded && isShowmaxPending}"> <h2>Showmax is Pending</h2> <p>Please check after sometime...</p> </div>--> <div class="glass"><img src="/media/7593/showmax_logo_white.png" alt="ShowMax"></div> </div> </div></section><tag-showmax-atb></tag-showmax-atb><div class="modal dashboardModal dashboardPOP" id="boxOfficeModal" role="dialog"> <div class="webform container modal-dialog modal-lg feedback-dialog"> <div class="modal-content"> <button type="button" class="close btnClose" data-dismiss="modal"><i class=" icon-Close_M"></i></button> <div class="modal-body"> <tag-box-office-movies boxofficemovies={app.boxOfficeMovies} selectedBoxOfficeMove={selectedBoxOfficeMove} play={play} viewAll={true}></tag-box-office-movies> <div class="clearfix"></div> </div> </div> </div></div>','tag-test-dashboard,[riot-tag="tag-test-dashboard"],[data-is="tag-test-dashboard"]{ visibility: visible; display: block; }','',function(opts){var self=this;self.paymentUrl=dstvApp.PaymentURL+app.smartcard;self.addressField='';self.autoWidth='';site.requiredInitializeDashboard=true;self.payCTA='pay-cta'
self.paymentButtonCaption=langTranslateApp.accPay;self.boxofficeOpacity='watch-section-opacity'
self.rewardsOpacity=''
self.isShowMaxApplicable=dstvApp.BoxOfficeCountryList.includes(dstvApp.countryabbreviation);self.showEdit=false;self.showShowmaxSection=true;self.showBoxOfficeSection=!dstvApp.NoBoxOfficeCountryList.includes(dstvApp.countryabbreviation);self.showRewardSection=dstvApp.RewardCountryList.includes(dstvApp.countryabbreviation);self.packageLoaded=false;self.boxOfficeLoaded=false;self.rewardsLoaded=true;self.isPremiumCutomer=false;self.isActiveCustomer=false;self.showMaxLoaded=false;let dotcom=site.env=='PROD'?'.com':'.io';self.showmaxGetItNowURL=`https://secure.showmax${dotcom}/v133.0/website/signup`;self.showmaxTrialSignUpURL=`https://secure.showmax${dotcom}/v133.0/website/signup`
self.ptSmallFontClass=" "+dstvApp.languageAbbreviation+"-small-font";self.ptDashSmallFontClass=" "+dstvApp.languageAbbreviation+"-dash-small-font";self.IsRecurringPaymentApplicable=dstvApp.RecurringPaymentCountries.includes(dstvApp.countryabbreviation);self.watchTrailerPicture='/media/4532/watch.png';self.arrayDualCurrencyContries=[];self.arrayDualCurrencies=[];self.showmaxATBLoaded=false;self.showmaxWatchNowURL=`https://secure.showmax${dotcom}`;self.smartcardForShowmax='';self.noServicesLoadedOnCard=false;self.showRecurringOption=false;self.notDualCurrency=false;if(dstvApp.countryabbreviation=='mu')
self.notDualCurrency=true;if(!app.loggedin){riot.mount('tag-sign-in');return;}
if(dstvApp.NoOnlinePaymentCountryList.includes(dstvApp.countryabbreviation)){if(dstvApp.language.toLowerCase()=='portuguese'){self.paymentUrl=window.culture+'/formas-de-pagamento';}
else{self.paymentUrl=window.culture+'/ways-to-pay';}
self.paymentButtonCaption=langTranslateApp.dashboardHowToPay;self.autoWidth=' auto-width';}
self.update();self.on('mount',function(){for(var i=0;i<dstvApp.DualCurrenciesList.length;i++){var split=dstvApp.DualCurrenciesList[i].split("-");self.arrayDualCurrencyContries.push(split[0]);self.arrayDualCurrencies.push(split[1]);}
self.onCurrencyToggle=function(e){let currencyToggleStatus=e.currentTarget.checked;if(currencyToggleStatus!==undefined){site.factory.SetCurrency(currencyToggleStatus,dstvApp.countryabbreviation);}
self.setDualCurrencyFlag();};if(dstvApp.DualCurrency=='on'&&dstvApp.DualCurrencyCountryList.includes(dstvApp.countryabbreviation)){if(app.dualCurrencyApplicable!==undefined&&app.dualCurrencyApplicable){dstvApp.countrycurrency=self.arrayDualCurrencies[0];}
self.setDualCurrencyFlag();self.setCurrencyToggle();}
$('#siteCulture').click(function(e){e.preventDefault();return;})
$('#siteCulture').css('cursor','default');self.initializeDashboard();self.GenerateToken();self.update();setTimeout(function(){riot.update()},500)});self.setDualCurrencyFlag=function(){console.log('On setDualCurrencyFlag : After Currency Toggle');if(self.arrayDualCurrencies.includes(dstvApp.countrycurrency.toLowerCase())){app.dualCurrencyApplicable=true;window.SessionSave("app",app);}
else{app.dualCurrencyApplicable=false;window.SessionSave("app",app);}}
self.setCurrencyToggle=function(){if(dstvApp.DualCurrency=='on'&&app.dualCurrencyApplicable){console.log('Dual currency is ON');var setToggleSwitch=function(){$('#toggleSwitch').addClass('jcf-label-active');$('.jcf-checkbox').removeClass('jcf-checked').addClass('jcf-unchecked');$('.switch-input').prop('checked',false);let currencyToggleStatus=$('.switch-input').prop('checked');site.factory.SetCurrency(currencyToggleStatus,dstvApp.countryabbreviation);};setTimeout(setToggleSwitch,50);}
else{console.log('Dual currency is OFF');var setToggleSwitch=function(){$('#toggleSwitch').removeClass('jcf-label-active');$('.jcf-checkbox').removeClass('jcf-unchecked').addClass('jcf-checked');$('.switch-input').prop('checked',true);let currencyToggleStatus=$('.switch-input').prop('checked');site.factory.SetCurrency(currencyToggleStatus,dstvApp.countryabbreviation);};setTimeout(setToggleSwitch,50);}}
self.onDashboardEditDetailsClick=function(e){console.log('Fetching Details : Details...')
$('.main-top-Details-info input').next(".red").remove();$('.main-top-Details-info select').next(".red").remove();$('.contact-details-section').removeClass('active');$('.update-details-section').removeClass('active');$('.update-details-section select').attr('disabled',true);$('.contact-details-section input').attr('readonly',true);$('.update-details-section input').attr('readonly',true);if(app.customerCurrentSuburbId.length>0){if(app.customerDetails.ListOfAddress[0].PostCode!=app.customerCurrentSuburbId[0].postalCode){$('#invalidpostalCodeMsg').css({'display':'block'});}else{$('#invalidpostalCodeMsg').css({'display':'none'});}}
$('#updateDetailsModel').modal('show')
setTimeout(function(){$('#housenumber').val(app.customerPrimaryAddress[0].HouseNumber);$('#postalcode').val(app.customerPrimaryAddress[0].PostCode);$('#streetname').val(app.customerPrimaryAddress[0].Street);$('#country').val(app.customerPrimaryAddress[0].Country);$('#update-province').val(app.customerCurrentProvinceId[0].name);$('#contactname').val(app.customercontactdetails.FirstName);$('#contactupdateemail').val(app.customercontactdetails.EmailAddress);$('#contactupdatetitle').val(app.customercontactdetails.Title);$('#contactupdatemobilenumber').val(app.customercontactdetails.MobileTel);$('#contactupdatehometel').val(app.customercontactdetails.HomeTel);$('#contactupdatefaxtel').val(app.customercontactdetails.FaxTel);$('#contactupdateworktel').val(app.customercontactdetails.WorkTel);$('#contactupdatesurname').val(app.customercontactdetails.Surname);if(app.customerCurrentSuburbId.length>0){if(app.customerDetails.ListOfAddress[0].PostCode!=app.customerCurrentSuburbId[0].postalCode){$('#invalidpostalCodeMsg').css({'display':'block'});}else{$('#invalidpostalCodeMsg').css({'display':'none'});}}
riot.update();jcf.refreshAll();},100)};self.sucessGetLocation=function(data){console.log('Location : Location loaded');app.customerPrimaryAddress=_.filter(app.customerDetails.ListOfAddress,function(address){return address.IsPrimary===true;});if(app.customerPrimaryAddress&&app.customerPrimaryAddress.length==0&&app.customerDetails.ListOfAddress)
app.customerPrimaryAddress=app.customerDetails.ListOfAddress[0];else if(!app.customerDetails.ListOfAddress)
app.customerPrimaryAddress={Type:"Physical",HouseNumber:"",BuildingNumber:"",BuildingName:"",Street:"",Suburb:"",City:"",Country:dstvApp.country,PostCode:"",Province:"",PostBoxNumber:"",IsPrimary:true,Floor:"",IsBillingAddress:false};app.TempCustomerPrimaryAddress=app.customerPrimaryAddress;let customerCurrentProvinceName=app.customerPrimaryAddress[0].Province,customerCurrentsuburbName=app.customerPrimaryAddress[0].Suburb;app.locationProvinceList=_.map(data,function(province){return{id:province.id,name:province.name,cityList:province.cityList};});app.customerCurrentProvinceId=_.filter(app.locationProvinceList,function(province){return province.name.toLowerCase()===customerCurrentProvinceName.toLowerCase();});let customerCurrentCityName=app.customerPrimaryAddress[0].City;app.locationCityList=_.map(app.customerCurrentProvinceId,'cityList')[0];app.customerCurrentCityId=_.filter(app.locationCityList,function(city){return city.name.toLowerCase()===customerCurrentCityName.toLowerCase();});app.locationSuburbList=_.map(app.customerCurrentCityId,'suburbList')[0];app.customerCurrentSuburbId=_.filter(app.locationSuburbList,function(suburb){return suburb.name.toLowerCase()===customerCurrentsuburbName.toLowerCase();});};self.errorGetLocation=function(error){console.log('Location : Error in pulling location details');console.log(error);};self.GenerateToken=function(){site.factory.GetJWT().then(function(token){self.token=token;console.log('Location : Pulling location details...');let url=`${dstvApp.DSOAPIUrl}apiupdatecontactdetails/api/v1/UpdateContactDetails/GetLocations?country=${dstvApp.country}&BusinessUnit=${dstvApp.businessunit}&Channel=${dstvApp.channel}`;site.factory.Get(url,self.token,self.sucessGetLocation,self.errorGetLocation);})};self.onFixErrorClick=function(e){if(app.noServicesLoaded)
return;self.selectedErrorCode=$(e.currentTarget).attr('errorCode');sessionStorage['errorCode']=self.selectedErrorCode;riot.mount('tag-fix-errors-logged-in',{showmodal:true})};self.initializeDashboard=function(){console.log('Dashboard initialization started....')
site.trigger("showLoader")
self.payCTA=self.payCTA+self.autoWidth
if(app.customeraddressdetails){if(app.customeraddressdetails.HouseNumber){self.addressField=app.customeraddressdetails.HouseNumber;}
if(self.addressField&&app.customeraddressdetails.Street){self.addressField+=', '+app.customeraddressdetails.Street;}
else{self.addressField=app.customeraddressdetails.Street;}
if(self.addressField&&app.customeraddressdetails.Suburb){self.addressField+=', '+app.customeraddressdetails.Suburb;}
else{self.addressField=app.customeraddressdetails.Suburb;}
if(self.addressField&&app.customeraddressdetails.PostalCode){self.addressField+=', '+app.customeraddressdetails.PostalCode;}
else if(self.addressField){self.addressField=', '+app.customeraddressdetails.PostalCode;}}
console.log('Address loaded.')
self.update();console.log('Box office : Starting...')
let tokenAvailable=site.factory.GetUserTokenAndType(app.customernumber,'surname',dstvApp.country);if(!tokenAvailable){self.startBoxOfficeTokenCreation();}
else{console.log('Box office: Token already created')
self.isBoxOfficeCustomer=app.IsBOCustomer;self.LoadBoxOfficeMovies();self.FetchTopUpAmountList();}
self.update();};site.initializeDashboard=self.initializeDashboard;self.startBoxOfficeTokenCreation=site.startBoxOfficeTokenCreation=function(){console.log('Box office: Token creation started...')
var model={username:app.customerDetails.PersonalDetail.Surname,"smartCardNumber":app.smartcard,"country":dstvApp.country,"businessUnit":dstvApp.businessunit,"deviceId":"","platform":"web","version":""}
site.trigger("postuserdata",dstvApp.EazyMobileAPIURL+'v3/SignIn',"POST",model,self.onTokenCreationSucsess,self.onTokenCreationError);}
self.onTokenCreationSucsess=function(data,e){if(data&&data.statusCode==200){console.log('Box office: Token created')
data=data.data;let isBoxOfficeCustomer=data.boxOfficeAccount!=null||data.boxOfficeAccount!=undefined;self.isBoxOfficeCustomer=isBoxOfficeCustomer;site.factory.CaptureUserTokenAndType(app.customernumber,'surname',dstvApp.country,data.token,isBoxOfficeCustomer,data.boxOfficeAccount);self.LoadBoxOfficeMovies();self.FetchTopUpAmountList();}
else{self.onTokenCreationError(data);}}
self.onTokenCreationError=function(err){console.log('User token creation failed.');}
self.onBoxOfficeMovieClick=function(e){e.preventDefault();let item=e.item.item;self.watchTrailerPicture=item.thumbPrintImage;self.selectedBoxOfficeMove=item;self.update();}
self.playBoxOfficeMovie=function(e){if(self.selectedBoxOfficeMove){self.selectedBoxOfficeMove.play=true
self.ShowBoxOfficePopup();}}
self.ShowBoxOfficePopup=function(){let param={boxofficemovies:app.boxOfficeMovies,selectedBoxOfficeMove:self.selectedBoxOfficeMove,play:true}
$('#boxOfficeModal').modal('show');riot.mount('tag-box-office-movies',param)}
self.LoadBoxOfficeMovies=function(){console.log('Box office: Loading movies...')
if(!app.boxOfficeMovies){console.log('Box office: Loading movies API calling...')
boxofficeNode=dstvApp.language=='Portuguese'?'filmes':'movies';let settings={async:true,crossDomain:true,url:window.culture+`/api-services/${boxofficeNode}/ujson?children=true&select=Name,Type,YearReleased,prize,Episode,season,contentrating,coverImage,Id,summary,description,actors,genre,duration,trailerUrl,title,SubTitle,footerButtonUrl,footerButtonText,rentNowLink,additionalImages,featuredBackground&resolveMedia=coverImage,additionalImages,featuredBackground&cdv=2019-7-25-10`,method:"GET"}
$.ajax(settings).done(function(response){self.boxOfficeLoaded=true;response=JSON.parse(response);if(response.entities){response=self.GetFormattedResponse(response.entities);self.boxofficeOpacity=''
app.boxOfficeMovies=response;window.SessionSave("app",app);riot.update();self.initiBoxOfficeSlider();console.log('Box office: Loading done.')}
else{console.log('Error in loading box office movies...');}});}
else
{console.log('Box office: Movies Already loaded')
self.boxOfficeLoaded=true;self.boxofficeOpacity='';self.update();self.initiBoxOfficeSlider();self.FetchTopUpAmountList();}}
self.FetchTopUpAmountList=function(){console.log('Topup amount list loading...')
if(!(app.topUpAmountList&&app.topUpAmountList.length>0)){let tokenAvailable=site.factory.GetUserTokenAndType(app.customernumber,'surname',dstvApp.country);if(tokenAvailable){let getTopupAmountURL=dstvApp.EazyMobileAPIURL+`v1/BoxOffice/${dstvApp.country}/GetAmountValues`;let settings={async:true,crossDomain:true,url:getTopupAmountURL,method:"GET",headers:{Authorization:tokenAvailable.token}}
$.ajax(settings).done(function(response){response?self.OnTopupLoaded(response):self.OnTopupLoadedError();});}
else{console.log('Topup amount list : not loaded. Token not found')}}
else{console.log('Topup amount already loaded.')
self.update();}}
self.OnTopupLoaded=function(data){app.topUpAmountList=data.topUpAmountList;window.SessionSave("app",app);riot.update();console.log('Topup amount list loaded');}
self.performTopup=function(){riot.mount('tag-topup-modal-popup',{showmodal:true})}
self.onRent=function(){self.showRentNowPopup();}
self.showRentNowPopup=function(){this.selectedBoxOfficeMove.price=this.selectedBoxOfficeMove.price||"0";let currentMoviePrice=parseFloat(this.selectedBoxOfficeMove.price.match(/\d+/)[0]);riot.mount('tag-rentnow-modal-popup',{showmodal:true,boAccount:{},currentMoviePrice:currentMoviePrice})}
self.OnTopupLoadedError=function(data){app.topUpAmountList=[];window.SessionSave("app",app);riot.update();console.log('Topup amount list load error');}
self.GetFormattedResponse=function(res){return res.map(m=>({name:m.properties.Title,price:m.properties.Prize,thumbPrintImage:m.properties.CoverImage,actors:m.properties.Actors,additionalImages:m.properties.AdditionalImages,contentRating:m.properties.ContentRating,description:m.properties.Description,duration:m.properties.Duration,episode:m.properties.Episode,genre:m.properties.Genre,rentNowLink:m.properties.RentNowLink,season:m.properties.Season,summary:m.properties.Summary,trailerLink:m.properties.TrailerUrl,type:m.properties.Type,yearReleased:m.properties.YearReleased}));}
self.LoadShowMaxDetails=function(){console.log('Show max: Loading details...')
if(true||!app.showMaxDetails){console.log('Show max: Loading...')
app.smartcards=app.smartcards||[];app.smartcards.map(function(x){if(!self.isActiveCustomer&&x.primaryService)
self.isActiveCustomer=x.primaryService.status=="Active"&&x.primaryService.productName.includes("premium")})
self.dstvPremium=app.smartcards.some(x=>x.primaryService&&x.primaryService.productName.includes("premium"))
self.packageLoaded=true;self.update();self.loadViewSubscription();}
else
{console.log('Show max: Details Already loaded')
self.showMaxLoaded=true;if(self.dstvPremium&&self.isActiveCustomer&&(!app.showMaxDetails.isPremiumCustomer))
self.showShowmaxSection=true;self.update();}}
self.loadViewSubscription=function(){var data=app.viewSubscriptionResponse;app.showmaxStatusDetails='';self.smartcardForShowmax='';if(data&&data.length>0){self.smartcardForShowmax=app.smartcards.filter(x=>x.primaryService&&x.SerialNumber==app.smartcard);self.dstvPremium=self.smartcardForShowmax.some(x=>x.primaryService.productName.includes("premium"));self.smartcardForShowmax=self.smartcardForShowmax[0];let sc=data.filter(sc=>sc.smartcardNumber==app.smartcard)[0];if(sc){showmaxProductDetails=sc.services.filter((service)=>{return service.type=='ThirdParty'&&service.serviceName.toUpperCase().includes('SHOWMAX');});}
else{showmaxProductDetails=[];}
app.showmaxStatusDetails=showmaxProductDetails[0];}
window.SessionSave("app",app);if(self.smartcardForShowmax==undefined)
{self.noServicesLoadedOnCard=true;self.showMaxLoaded=true;self.update();return;}
let smartcardStatus=self.smartcardForShowmax.primaryService?self.smartcardForShowmax.primaryService.status.toUpperCase():null;self.disconnectedSmartcard=smartcardStatus=='DISCONNECTED'||smartcardStatus=='PENDING'||smartcardStatus=='SUSPENDED';if(self.disconnectedSmartcard){self.primaryPackageDisconnected=true;}
else{self.isShowmaxAdded=false;self.isShowmaxActive=false;}
if(showmaxProductDetails.length>0&&!self.disconnectedSmartcard){if(app.showmaxStatusDetails.status.toUpperCase()=='ACTIVE'){self.isShowmaxAdded=true;self.isShowmaxActive=true;}
else if(app.showmaxStatusDetails.status.toUpperCase()=='PENDING'){self.isShowmaxAdded=false;self.isShowmaxActive=false;}
else{self.isShowmaxAdded=true;self.isShowmaxActive=false;}}
self.update();self.loadAddonsList();}
self.loadShowmaxSubsStatus=function(){let url=dstvApp.DSOAPIUrl+`/apishowmax/api/v1/Showmax/Status?BusinessUnit=${dstvApp.businessunit}&Channel=${dstvApp.channel}&Country=${dstvApp.country}&SmartCardNumber=${app.smartcard}&CustomerNumber=${app.customernumber}`;site.factory.Get(url,self.token,self.onSubsStatusCheckSuccess,self.onSubsStatusCheckerror);}
self.loadAddonsList=function(){site.factory.GetJWT().then(function(token){self.token=token;let url=`${dstvApp.DSOChangePackageURL}`;var reqBody={"businessUnit":dstvApp.businessunit,"channel":dstvApp.channel,"country":dstvApp.country,"packageName":self.smartcardForShowmax.primaryService.serviceName};site.factory.Post(url,reqBody,self.token,self.onLoadAddonsListSuccess,self.onLoadAddonsListError);});}
self.onSubsStatusCheckSuccess=function(data){self.showMaxLoaded=true;if(data){}
self.update();}
self.onSubsStatusCheckerror=function(err){self.showMaxLoaded=true;if(err.responseJSON&&err.responseJSON.StatusCode==422){console.log(err.responseJSON.Message);}
self.update();}
self.onLoadAddonsListSuccess=function(data){self.showMaxLoaded=true;if(data){filteredAddOns=data.filter(x=>x.isAddOn===true&&x.name.toUpperCase().includes('SHOWMAX'));app.showmaxAddOnDetails=filteredAddOns[0];window.SessionSave("app",app);}
self.update();}
self.onLoadAddonsListError=function(err){self.showMaxLoaded=true;if(err.responseJSON&&err.responseJSON.StatusCode==422){console.log(err.responseJSON.Message);}
self.update();}
self.onPaymentClick=function(e){self.loadPaymentsPopup(e);}
self.initiBoxOfficeSlider=function(){self.watchTrailerPicture=app.boxOfficeMovies[0]?app.boxOfficeMovies[0].thumbPrintImage:self.watchTrailerPicture;self.selectedBoxOfficeMove=app.boxOfficeMovies[0];$('.responsive').not('.slick-initialized').slick({dots:false,nextArrow:'<span class="slick-next slick-arrow" aria-label="Next" ></span>',prevArrow:'<span class="slick-prev slick-arrow" aria-label="Previous" ></span>',infinite:true,speed:300,slidesToShow:2,adaptiveHeight:false,slidesToScroll:2,focusOnSelect:true});}
self.loadPaymentsPopup=function(e){console.log('loading payments pop-up');e.preventDefault();if(dstvApp.NoOnlinePaymentCountryList.includes(dstvApp.countryabbreviation)){site.factory.HandleHowToPay()}
else if(dstvApp.DSOPayments&&dstvApp.DSOPayments.trim().toLowerCase()=='off'){window.location.href=dstvApp.PaymentURL+app.smartcard;}
else{riot.mount('tag-payments-new');$('#paymentModal').modal('show');}}
self.ShowRecurringPayment=function(e){riot.mount('tag-payments-new',{showRecurringScreen:false,showSetUpRecurringOption:true,showOnceoffOption:false});$('#paymentModal').modal('show');}
self.onUpgrade=function(){if(app.noServicesLoaded){riot.mount('tag-model-for-showmax-upgrade',{showmodel:true})}
else{$('#changepackageModal').modal('show');$('.changePackModel').show();let sm=app.smartcards.filter(x=>x.SerialNumber==app.smartcard)
if(sm.length>0&&sm[0].primaryService){sm=sm[0].primaryService
let packageName=sm.serviceName;riot.mount('tag-change-package-new',{showmodal:true,showmaxUpgrade:true,smartcard:app.smartcard,packageName:packageName});}}self.arrayDualCurrencies=[];}
self.GetContactPageLink=function(){if(site.env=='PROD'&&dstvApp.SelfServiceEnabledCountries.includes(dstvApp.countryabbreviation)){return `https://eazy.dstv.com/${dstvApp.languageAbbreviation}/${dstvApp.countryabbreviation}/contact`}
else{return window.culture+langTranslateApp.subMenuContactUsLink;}}
self.onDashActivateShowmax=function(){riot.mount('tag-showmax-atb',{showActivate:true,openpopup:true});}
self.onDashManageShowmax=function(){console.log('Showmax : Initiating Manage section');riot.mount('tag-showmax-atb',{showManage:true,openpopup:true});}
self.onDashPayReconnectShowmax=function(){console.log('Showmax : Initiating Reconnect Showmax');let smartcardStatus=self.smartcardForShowmax.primaryService.status.toUpperCase();let smartcardStatusFlag=smartcardStatus=='DISCONNECTED'||smartcardStatus=='PENDING'||smartcardStatus=='SUSPENDED';let showmaxProductDetails=app.viewSubscriptionResponse.filter(sc=>sc.smartcardNumber==app.smartcard)[0].services.filter((service)=>{return service.type=='ThirdParty'&&service.serviceName.toUpperCase().includes('SHOWMAX');});if(smartcardStatusFlag&&showmaxProductDetails.length==0){let amount=self.AmountToPay();riot.mount('tag-payments-new',{payReconnectShowmax:true,amount:amount});$('#paymentModal').modal('show');}
else if(smartcardStatusFlag&&(showmaxProductDetails.length>0&&(showmaxProductDetails[0].status.toUpperCase()=='DISCONNECTED'||showmaxProductDetails[0].status.toUpperCase()=='SUSPENDED'))){riot.mount('tag-payments-new',{paySmartcardReconnectShowmax:true});$('#paymentModal').modal('show');}
else{riot.mount('tag-showmax-atb',{handlePayReconnect:true,openpopup:true});}}
self.onDashWatchNowShowmax=function(){console.log('Showmax : Initiating Watch now Showmax');riot.mount('tag-showmax-atb',{createShowmaxAccount:true,openpopup:true});}
self.AmountToPay=function(){if(app.dualCurrencyApplicable)
return app.paymentduedetails.properties.amountToPayEtb.value;return app.paymentduedetails.properties.amountToPay.value;}});riot.tag2('tag-dstvthanks-partner-modal-popup','<div class="modal dashboardModal" id="thanksPartnerModalPopup" role="dialog"><div class="webform container modal-dialog modal-lg feedback-dialog"><div class="modal-content"><button type="button" class="close btnClose" data-dismiss="modal"><i class=" icon-Close_M"></i></button><div class="modal-body"><div><div class="thanks-partner-logo"><img src={opts.partnerLogoURL}></div><h2>{opts.category}</h2><div class="thanks-partner-desc"><tag-raw content="{opts.desc}"></tag-raw></div></div></div></div></div></div>','tag-dstvthanks-partner-modal-popup,[riot-tag="tag-dstvthanks-partner-modal-popup"],[data-is="tag-dstvthanks-partner-modal-popup"]{ visibility: visible; } ','',function(opts){var self=this;self.on('mount',function(){if(opts.showmodal){$('#thanksPartnerModalPopup').modal('show');}})})
riot.tag2('tag-transactionhistory-modal-popup','<div class="modal dashboardPOP" id="paymentHistoryModal"> <div class="modal-dialog"> <div class="modal-content"> <!-- Modal Header --> <div class="modal-header"> <button type="button" class="close" data-dismiss="modal"><i class="icon-Close_M"></i></button> </div> <!-- Modal body --> <div class="modal-body"> <div class="main-top-payment-history-info row"> <div class="" if="{app.loggedin && app.customernumber}"> </div> <div> <div class="col-lg-12 col-sm-12 col-xs-12 col-md-12 Pay-history"> <h4 class="modal-title">{langTranslateApp.payPaymentHistory}</h4> <div class="holder transaction-history"> <div class="row pay-history-details"> <div if="{app.accounts != undefined}"> <div class="form-group"> <fieldset> <select type="text" class="form-control" onchange="{changeacc}" id="change-account" name="change-account"> <option if="{app.accounts != undefined}" each="{account, index in app.accounts}" id="account-{account.AccountNumber}" value="{account.AccountNumber}" class="custom-class">{account.AccountType+" - "+account.AccountNumber}</option> </select> </fieldset> </div> </div> <div class="Pay-history-transaction"> <div class="col-lg-4 col-md-4 col-sm-4 col-xs-4"><input type="radio" name="optradio" onclick="{changetransactioncount}" value="10" checked>10 {langTranslateApp.payTrans}</div> <div class="col-lg-4 col-md-4 col-sm-4 col-xs-4"><input type="radio" name="optradio" onclick="{changetransactioncount}" value="20">20 {langTranslateApp.payTrans}</div> <div class="col-lg-4 col-md-4 col-sm-4 col-xs-4"><input type="radio" name="optradio" onclick="{changetransactioncount}" value="30">30 {langTranslateApp.payTrans}</div> </div> <div class="col-sm-3 col-md-2"> <div if="{false}"> <div data-is="tag-select" type="select" selectoptions="{pagesize.pages}" onchangeevent="{changeacc}" cls="custom-class" label="Page Size" defaultoption="Select" value="{numberperpage}" val="{numberperpage}" name="pagesize"></div> </div> </div> </div> </div> </div> <div class="financial-table" if="{tagstate == \'loaded\'}"> <table id="tblTransactionHistory" class="table table-striped" if="{formproperties && formproperties.length && selectedaccountnumber != \'\'}"> <thead> <tr class="record1"> <th class="date-head">{langTranslateApp.payDate}</th> <th>{langTranslateApp.payDescription}</th> <th>{langTranslateApp.payTransactionNum}</th> <th align="right" width="20%" class="text-right">{langTranslateApp.payAmount}</th> </tr> </thead> <tr each="{lineitem in formproperties}" class="line-item"> <td>{site.factory.GetEazyDateFormat(lineitem.creationDate)}</td> <td>{(lineitem.transactionType)}</td> <td>{(lineitem.transactionNumber)}</td> <td align="right" if="{!app.dualCurrencyApplicable}">{dstvApp.countrycurrency.toUpperCase()} {Math.abs(lineitem.amount)}</td> <td align="right" if="{app.dualCurrencyApplicable}">{lineitem.localPrice.currency.toUpperCase()} {Math.abs(lineitem.localPrice.amount)}</td> </tr> </table> <table id="tblNoRecords" class="table table-striped" if="{formproperties !=undefined && formproperties.length == 0}"> <thead> <tr class="record1"> <th width="20%">{langTranslateApp.payDate}</th> <th>{langTranslateApp.payDescription}</th> <th>{langTranslateApp.payTransactionNum}</th> <th align="right" width="20%" class="text-right">{langTranslateApp.payAmount}</th> </tr> </thead> <tr> <td if="{selectedaccountnumber.length == 0}" colspan="3">{langTranslateApp.payNotTransact} </td> <td if="{selectedaccountnumber.length != 0}" colspan="3">{langTranslateApp.notransactions} </td> </tr> </table> <div width="" align="center"> <div class="pager" if="{formproperties && formproperties.properties && formproperties.properties[\'page\'] && parseInt(formproperties.properties[\'numberOfPages\'].value) > 1}"> <ul class="list-inline" if="{formproperties.properties && formproperties.properties[\'page\']}"> <li if="{formproperties.properties.page.value > 1}"><a href="#" if="{formproperties.properties.page.value > 1}" onclick="{pageclick}" data-topage="{selectedpage - 1}"><i class="ti ti-angle-left prev-i"></i></a></li> <li each="{p, i in page.selectFrom}"><span if="{p.value == selectedpage}">{p.value}</span><a href="#" if="{p.value != selectedpage}" onclick="{parent.pageclick}" data-topage="{p.value}">{p.value}</a></li> <li if="{formproperties.properties.numberOfPages.value > formproperties.properties.page.value}"><a href="#" onclick="{pageclick}" data-topage="{selectedpage + 1}"><i class="ti ti-angle-right next-i"></i></a></li> </ul> </div> </div> </div> </div> <div class="relative blue-loading" if="{tagstate == \'loading\'}" style="min-height: 400px;"> <div class="loading-loader loading"> <div class="col-sm-12 text-center"> <div class="spinner"></div> <div class="loading-message" style="color: #00aeee!important;">{langTranslateApp.LoadingTransactionHistory}</div> </div> </div> </div> </div> <div class="p-0" hidden> <div class="transaction-history-cont" if="{app.loggedin && latestTransaction != null}"> <div class="head p-2 pt-3 pb-0 searchbar"> <div class="download-txt relative"> <div class="row"> <div class="col-sm-8 col-xs-12 cust-col-7"> <strong class="title-text">Latest Transaction</strong> <p>An amount of <strong>{dstvApp.countrycurrency.toUpperCase() + latestTransaction.amount}</strong> was {debitedOrCredited} on <strong>{latestTransaction.creationDate.split(\'T\')[0]}</strong> for <strong>{latestTransaction.Description+"| "+latestTransaction.transactionType}</strong></p> </div> </div> <div class="align-bottom text-right"><a href="#my-account/transaction-history" class="btn btn-default btn-rounded anim-btn"><span class="anim-span"></span>View Transactions</a></div> </div> </div> </div> <div if="{!app.loggedin}" class="row"> <div class="col-md-12 text-center"> <div class="py-3" style="background-color: #00508f;"> <h5 class="mb-0" style="color: #fff;">Please <a href="{loginurl}" style="color: #fff;">login</a> to view your Transaction History</h5> </div> </div> </div> </div> <div if="{!app.loggedin}" class="row"> <div class="col-md-12 text-center"> <div class="py-3" style="background-color: #00508f;"> <h5 class="mb-0" style="color: #fff;">Please <a href="{loginurl}" style="color: #fff;">login</a> to view your Transaction History</h5> </div> </div> </div> </div> </div> </div></div>','tag-transactionhistory-modal-popup,[riot-tag="tag-transactionhistory-modal-popup"],[data-is="tag-transactionhistory-modal-popup"]{ visibility: visible; } ','',function(opts){var self=this;self.mixin("tracker");self.trackData={};self.model={};self.modalopen=false;self.selectedpage=1;self.numberperpage=10;self.transactioncount=10;self.selectedaccountnumber=app.primaryaccountnumber;self.loggedin=app.customernumber?true:false;self.PropertyConfig={};self.step='landing';self.loginurl=window.culture+"/sign-in?returnUrl=/#my-account/transaction-history";self.tagstate="loaded";self.formproperties={};self.latestTransaction=null;self.debitedOrCredited="";self.url=dstvApp.DSOAPIUrl+`/apipaymenthistory/api/v1/PaymentHistory?Country=${dstvApp.country}&BusinessUnit=${dstvApp.businessunit}&Channel=dstvafrica&CustomerNumber=${app.customernumber}&AccountNumber=${app.primaryaccountnumber}`;self.on('mount',function(){if(opts.showmodal){$('#paymentHistoryModal').modal('show');$('#change-account').val(app.primaryaccountnumber);jcf.replaceAll();}
self.search();});site.on("loggedin",function(){self.getTransactionHistory();});self.changeacc=function(e){var trackObj={};if(e.target.name=="change-account"){if(self.selectedaccountnumber===e.target.value)
return;self.selectedaccountnumber=e.target.value;trackObj.SelectedAccountNumber=self.selectedaccountnumber;}
else if(e.target.name=="page"){self.selectedpage=parseInt(e.target.value);}
else if(e.target.name=="pagesize"){self.numberperpage=parseInt(e.target.value);trackObj.pagesize=self.numberperpage;}
self.selectedpage=1;self.search();self.track("transaction-history-dropdown-change",trackObj);var userlog=app.setUserLog();userlog.action="Transaction History";userlog.subaction="View Transaction History Details";userlog.eventname="last-transactions";userlog.revenue=self.latestTransaction?self.latestTransaction.amount:0;userlog.customernumber=self.selectedaccountnumber;window.DocLog?window.DocLog(userlog):1;}
self.changetransactioncount=function(e){self.transactioncount=e.target.value;self.selectedpage=1;self.track("transaction-history-change-range",{transactioncount:self.transactioncount,accountNumber:self.selectedaccountnumber,radioChoice:self.transactioncount});self.search();}
self.getTransactionHistory=function(){if(app.customernumber){self.tagstate="loading";self.trackData.urlCalled="";self.trackData.urlCalled=self.url;site.trigger('getpostdata',self.url,'GET','application/json',"Bearer "+localStorage["JWTTokenKey"],'','','TransactionHistory',self.successInitialPostCallback,self.errorPostCallback);}
self.update();}
self.successInitialPostCallback=function(data){if(data){self.tagstate="loaded";self.formproperties=data;self.account=app.primaryaccountnumber;if(self.formproperties[0]!==undefined){self.latestTransaction=self.formproperties[0];self.debitedOrCredited=self.latestTransaction.amount<0?"credited":"debited";}
self.update();jcf.replaceAll();console.log(data);self.track("mytransactions",{call_url:self.trackData.urlCalled,account_type:self.selectedaccountnumber,page:self.page,result:"success"})}}
self.successPostCallback=function(data){if(data){self.tagstate="loaded";self.formproperties=data;self.account=app.primaryaccountnumber;self.update();self.track("mytransactions",{call_url:self.trackData.urlCalled,account_type:self.selectedaccountnumber,page:self.page,result:"success"})}}
self.errorPostCallback=function(data){if(data){self.tagstate="loaded";self.formproperties=[];console.log(data);}
self.update();console.log("error Post Callback");self.track("mytransactions",{call_url:self.trackData.urlCalled,account_type:self.selectedaccountnumber,page:(self.page&&self.page.value?self.page.value:"not known"),result:"error",message:data.Message})}
self.pageclick=function(e){e.preventDefault();self.goToPage(parseInt(e.currentTarget.dataset.topage));self.track("transaction-history-change-page-click",{page:e.currentTarget.dataset.topage});};self.goToPage=function(page){}
self.search=function(){self.tagstate="loading";let customerNumber='';if(self.selectedaccountnumber!=''&&self.selectedaccountnumber!=undefined){customerNumber=app.customernumber;}
var url=dstvApp.DSOAPIUrl+`/apipaymenthistory/api/v1/PaymentHistory?Country=${dstvApp.country}&BusinessUnit=${dstvApp.businessunit}&CustomerNumber=${customerNumber}&Channel=dstvafrica&AccountNumber=${self.selectedaccountnumber}&PageSize=${self.transactioncount}`;self.trackData.urlCalled="";self.trackData.urlCalled=url;site.trigger('getpostdata',url,'GET','application/json',"Bearer "+localStorage["JWTTokenKey"],'','','TransactionHistory',self.successPostCallback,self.errorPostCallback);self.update();}})
riot.tag2('tag-dstvthanks-rewards','<div class="slider-nav-unlock-main"> <div class="loader-highlight"></div> <section style="display:none;" id="noEligible"> <div class="noEligible-section"> <div class="noEligible-icon"><img src="/media/6630/not_eligible_rewards_icon.png"></div> <div class="error-noEligible-heading"><span>Unfortunately you are not eligible for Rewards</span></div> <div class="error-noEligible-subheading">Get access to great savings and a one-week Sport upgrade just for paying your subscription on time</div> <div> <a if="{window.culture != \'/en-zm\'}" href="javascript:void(0)" class="btn btn-darkblue noEligible-button" id="btnPayReconnect">Pay/Reconnect</a><a if="{window.culture == \'/en-zm\'}" href="{window.culture}/ways-to-pay" class="btn btn-darkblue noEligible-button" id="btnhowtopay" >How to Pay</a><a class="btn btn-darkblue noEligible-button" href="javascript:void(0)" id="btnViewRewards">View Rewards</a></div> </div> </section> <div class="slider-nav-unlock slider landing"> <div if="{!app.loggedin}" each="{item in categoryWithProducts.list}" class="thanks-not-log thanks_shadow-unlock unlock_slider_card" id="{trimAndReplace(item.categoryName)}"> <div style="display:none;" class="channel-num" id="ChannelNumber_{trimAndReplace(item.categoryName)}"><span>{item.productList.length}</span></div> <a href="" tabindex="0" id="ButtonLink_{trimAndReplace(item.categoryName)}"> <div class="card-section" id="{item.categoryID}"> <div class="card-main"> <span class="slide-img" id="LogoImage_{trimAndReplace(item.categoryName)}"><img src=""></span> <h2 class="unlock_slider_title" style="display:none;">{item.categoryName}</h2> <h2 class="unlock_slider_title_subcategory" id="SubCategory_{trimAndReplace(item.categoryName)}">REWARDS</h2> </div> <div class="wraps highlight"><span class="arrow-label thinFont" id="ButtonText_{trimAndReplace(item.categoryName)}"></span><button id="{item.categoryID}" class="categoryButton bg-gradient-45 arrow-font-color" tabindex="0"><span class="icon-ico-arrow-next"></span></button> </div> </div> </a> </div> <div if="{app.ShowAllCategories}" each="{item in categoryWithProducts.list}" class="thanks-not-log thanks_shadow-unlock unlock_slider_card" id="{trimAndReplace(item.categoryName)}"> <div style="display:none;" class="channel-num" id="ChannelNumber_{trimAndReplace(item.categoryName)}"><span>{item.productList.length}</span></div> <a href="" tabindex="0" id="ButtonLink_{trimAndReplace(item.categoryName)}"> <div class="card-section" id="{item.categoryID}"> <div class="card-main"> <span class="slide-img" id="LogoImage_{trimAndReplace(item.categoryName)}"><img src=""></span> <h2 class="unlock_slider_title" style="display:none;">{item.categoryName}</h2> <h2 class="unlock_slider_title_subcategory" id="SubCategory_{trimAndReplace(item.categoryName)}">REWARDS</h2> </div> <div class="wraps highlight"><span class="arrow-label thinFont" id="ButtonText_{trimAndReplace(item.categoryName)}"></span><button id="{item.categoryID}" class="categoryButton bg-gradient-45 arrow-font-color" tabindex="0"><span class="icon-ico-arrow-next"></span></button></div> </div> </a> </div> <div if="{app.loggedin && !app.ShowAllCategories}" each="{item in categoryWithProducts.smartCardQueryByCustomerResult}" id="{trimAndReplace(item.categoryName)}" class="thanks-loggin thanks_shadow-unlock unlock_slider_card"> <div class="channel-num" id="ChannelNumber_{trimAndReplace(item.categoryName)}"><span>{item.productList.length}</span></div> <a href="" tabindex="0" id="ButtonLink_{trimAndReplace(item.categoryName)}"> <div class="card-section" id="{item.categoryId}"> <div class="card-main"> <span class="slide-img" id="LogoImage_{trimAndReplace(item.categoryName)}"><img src=""></span> <h2 class="unlock_slider_title" style="display:none;">{item.categoryName}</h2> <h2 class="unlock_slider_title_subcategory" id="SubCategory_{trimAndReplace(item.categoryName)}">REWARDS</h2> </div> <div class="wraps highlight"><span class="arrow-label thinFont" id="ButtonText_{trimAndReplace(item.categoryName)}"></span><button id="{item.categoryId}" title="loggedin" class="categoryButton bg-gradient-45 arrow-font-color" tabindex="0"><span class="icon-ico-arrow-next"></span></button></div> </div> </a> </div> </div></div><tag-dstvthanks-partner-modal-popup></tag-dstvthanks-partner-modal-popup>','tag-dstvthanks-rewards,[riot-tag="tag-dstvthanks-rewards"],[data-is="tag-dstvthanks-rewards"]{ visibility: visible; display: block; }','',function(opts){var self=this;self.dstvThanksBaseUrl=dstvApp.ThanksAPIBaseUrl;self.categoriesLoaded=false;self.productsLoaded=false;app.selectThePackage=false;window.SessionSave("app",app);var loadAllCategoriesUrl='';var allCategoriesQueryString=`GetReward?Country=${dstvApp.country}&BusinessUnit=${dstvApp.businessunit}&Language=${dstvApp.language}&Channel=${dstvApp.channel}&CustomerSmartCard=&SessionKey=`;self.on('before-mount',function(){if(dstvApp.dstvThanksCountries!=undefined){if(!dstvApp.dstvThanksCountries.includes(window.culture)){window.location=dstvApp.DstvThanksURL;}}else{window.location=dstvApp.DstvThanksURL;}})
self.on('mount',function(){var result=site.factory.GetStorage('JWTTokenKey');if(result==null){site.factory.GetJWTToken(dstvApp.JwtTokenApiUrl,dstvApp.ReqBody,"POST",'GetJWTToken',self.onJWTTokenSuccess,self.onJWTTokenError);}
else{self.loadCategories();}
$('#btnPayReconnect').click(function(e){if(window.culture.includes('en-zm')){e.preventDefault();window.location=window.culture+"/way-to-pay";}
else
{e.preventDefault();app.loggedin=true;window.SessionSave("app",app);window.location.href=dstvApp.DashboardURL;}});$('#btnViewRewards').click(function(e){app.ShowAllCategories=true;window.SessionSave("app",app);window.location=dstvApp.DstvThanksURL;});});function SetLoginURL(){$('#loginLinkLabel span.login-icon').click(function(e){e.preventDefault();riot.mount('tag-sign-in');});}
self.onJWTTokenSuccess=function(){console.log('Token Generated...')
self.bearerToken="Bearer "+localStorage["JWTTokenKey"];self.loadCategories();}
self.onJWTTokenError=function(){}
self.trimAndReplace=function(s){return s.replace(/ /g,'').replace(/&amp;/g,'').replace(/&/g,'')}
self.loadCategories=function(){console.log('Started loading categories...')
if(!app.loggedin){loadAllCategoriesUrl=self.dstvThanksBaseUrl+allCategoriesQueryString;self.trigger("getdatabytoken",loadAllCategoriesUrl,"Bearer "+localStorage["JWTTokenKey"],self.successCallback,self.errorCallback);}
else{if(app.ShowAllCategories&&app.ShowAllCategories==true)
{loadAllCategoriesUrl=self.dstvThanksBaseUrl+allCategoriesQueryString;self.trigger("getdatabytoken",loadAllCategoriesUrl,"Bearer "+localStorage["JWTTokenKey"],self.successCallback,self.errorCallback);}
else
{var authenticationUrl=dstvApp.ThanksAPIBaseUrl+`Authenticate?Smartcardnumber=${app.smartcard.trim()}&Surname=${app.paymentduedetails.properties.surname.value.trim()}&Country=${dstvApp.country.trim()}&BusinessUnit=${dstvApp.businessunit.trim()}&Channel=${dstvApp.channel.trim()}&Language=${dstvApp.language.trim()}`;self.authenticateUser(authenticationUrl);app.ShowAllCategories=false;window.SessionSave("app",app);}}};self.authenticateUser=function(authenticationUrl){site.trigger('getpostdata',authenticationUrl,'GET','application/json',"Bearer "+localStorage["JWTTokenKey"],'','','AuthenticateUser',self.onAuthenticateSuccess,self.onAuthenticateError);}
self.onAuthenticateSuccess=function(){var loggedinCategoriesQueryString=`GetReward?Country=${dstvApp.country}&BusinessUnit=${dstvApp.businessunit}&Language=${dstvApp.language}&Channel=${dstvApp.channel}&CustomerSmartCard=${app.smartcard}&SessionKey=${dstvApp.UserSessionKey}`;loadAllCategoriesUrl=self.dstvThanksBaseUrl+loggedinCategoriesQueryString;self.trigger("getdatabytoken",loadAllCategoriesUrl,"Bearer "+localStorage["JWTTokenKey"],self.successCallback,self.errorCallback);}
self.onAuthenticateError=function(e){console.log('authentication error');$(".loader-highlight").css("display","none");$(".slider-nav-unlock-main").addClass("noneligible");$("#ButtonText_viewAllPopup").css("display","none");$(".categoryButton").css("display","none");$("#noEligible").show();}
self.on('getdatabytoken',function(url,token,callback,errorcallback){var settings={"url":url,"method":"GET","headers":{"Authorization":token},"Content-Type":"application/json"}
$.ajax(settings).done(function(response){if(response.smartCardQueryByCustomerResult){self.categoryWithProducts=response;self.categoryWithProducts.list=response.smartCardQueryByCustomerResult;app.userMobileNumber=(self.categoryWithProducts.list[0]&&self.categoryWithProducts.list[0].msisdn)||'';window.SessionSave('app',app);}
else{self.categoryWithProducts=response;}
$(".slider-nav-unlock-main").removeClass("noneligible");self.update();BindEvents();$(".loader-highlight").css("display","none");HandleCategorySelection();}).fail(function(error){$(".loader-highlight").css("display","none");$(".slider-nav-unlock-main").addClass("noneligible");$("#noEligible").show();});function BindEvents(){function initRewardsSlider(){$('.slider-nav-unlock').slick({appendArrows:'.arrows-here-unlock',dots:false,infinite:true,nextArrow:'<span class="slick-next slick-arrow arrowColor" aria-label="Next" style="transform: translateY(-50%) rotate(180deg) !important; height:30px !important; width:30px !important; line-height:30px !important; top:auto !important;"></span>',prevArrow:'<span class="slick-prev slick-arrow arrowColor" aria-label="Previous" style="transform: translateY(-50%) rotate(0deg) !important; height:30px !important; width:30px !important; line-height:30px !important; top:auto !important;"></span>',speed:800,slidesToShow:3,slidesToScroll:3,autoplay:true,autoplaySpeed:6000,responsive:[{breakpoint:1024,settings:{slidesToShow:2,slidesToScroll:2,infinite:true,}},{breakpoint:600,settings:{slidesToShow:1,slidesToScroll:1,}},{breakpoint:480,settings:{slidesToShow:1,slidesToScroll:1,}}]});}
initRewardsSlider();BindCMSData();}
function BindCMSData(){var categoryWithProdListLength='';if(app.loggedin)
{if(app.ShowAllCategories&&app.ShowAllCategories==true)
{categoryWithProdListLength=self.categoryWithProducts.list.length;}
else
{categoryWithProdListLength=self.categoryWithProducts.smartCardQueryByCustomerResult.length;}}
else
{categoryWithProdListLength=self.categoryWithProducts.list.length;}
for(let step=0;step<categoryWithProdListLength;step++){if($('.unlock_slider_title')[step].innerHTML.toUpperCase().includes(langTranslateApp.categoryTRAVEL))
{$('#LogoImage_'+langTranslateApp.categoryTravel+' img')[0].src=app.categoriesFromCms.filter(element=>element.categoryName.toUpperCase().includes(langTranslateApp.categoryTRAVEL))[0].cardImageUrl;$('#SubCategory_'+langTranslateApp.categoryTravel)[0].innerHTML=app.categoriesFromCms.filter(element=>element.categoryName.toUpperCase().includes(langTranslateApp.categoryTRAVEL))[0].subCategory;$('#ButtonLink_'+langTranslateApp.categoryTravel)[0].href=app.categoriesFromCms.filter(element=>element.categoryName.toUpperCase().includes(langTranslateApp.categoryTRAVEL))[0].buttonLink;}
if($('.unlock_slider_title')[step].innerHTML.toUpperCase().includes("SHOPPING"))
{$('#LogoImage_Shopping img')[0].src=app.categoriesFromCms.filter(element=>element.categoryName.toUpperCase().includes('SHOPPING'))[0].cardImageUrl;$('#SubCategory_Shopping')[0].innerHTML=app.categoriesFromCms.filter(element=>element.categoryName.toUpperCase().includes('SHOPPING'))[0].subCategory;$('#ButtonLink_Shopping')[0].href=app.categoriesFromCms.filter(element=>element.categoryName.toUpperCase().includes('SHOPPING'))[0].buttonLink;}
if($('.unlock_slider_title')[step].innerHTML.toUpperCase().includes("FINANCIAL"))
{$('#LogoImage_Financial img')[0].src=app.categoriesFromCms.filter(element=>element.categoryName.toUpperCase().includes('FINANCIAL'))[0].cardImageUrl;$('#SubCategory_Financial')[0].innerHTML=app.categoriesFromCms.filter(element=>element.categoryName.toUpperCase().includes('FINANCIAL'))[0].subCategory;$('#ButtonLink_Financial')[0].href=app.categoriesFromCms.filter(element=>element.categoryName.toUpperCase().includes('FINANCIAL'))[0].buttonLink;}
if($('.unlock_slider_title')[step].innerHTML.toUpperCase().includes("HOTELS"))
{$('#LogoImage_Hotels img')[0].src=app.categoriesFromCms.filter(element=>element.categoryName.toUpperCase().includes('HOTELS'))[0].cardImageUrl;$('#SubCategory_Hotels')[0].innerHTML=app.categoriesFromCms.filter(element=>element.categoryName.toUpperCase().includes('HOTELS'))[0].subCategory;$('#ButtonLink_Hotels')[0].href=app.categoriesFromCms.filter(element=>element.categoryName.toUpperCase().includes('HOTELS'))[0].buttonLink;}
if($('.unlock_slider_title')[step].innerHTML.toUpperCase().includes("EDUCATION"))
{$('#LogoImage_Education img')[0].src=app.categoriesFromCms.filter(element=>element.categoryName.toUpperCase().includes('EDUCATION'))[0].cardImageUrl;$('#SubCategory_Education')[0].innerHTML=app.categoriesFromCms.filter(element=>element.categoryName.toUpperCase().includes('EDUCATION'))[0].subCategory;$('#ButtonLink_Education')[0].href=app.categoriesFromCms.filter(element=>element.categoryName.toUpperCase().includes('EDUCATION'))[0].buttonLink;}
if($('.unlock_slider_title')[step].innerHTML.toUpperCase().includes("TRANSPORT"))
{$('#LogoImage_Transport img')[0].src=app.categoriesFromCms.filter(element=>element.categoryName.toUpperCase().includes('TRANSPORT'))[0].cardImageUrl;$('#SubCategory_Transport')[0].innerHTML=app.categoriesFromCms.filter(element=>element.categoryName.toUpperCase().includes('TRANSPORT'))[0].subCategory;$('#ButtonLink_Transport')[0].href=app.categoriesFromCms.filter(element=>element.categoryName.toUpperCase().includes('TRANSPORT'))[0].buttonLink;}
if($('.unlock_slider_title')[step].innerHTML.toUpperCase().includes(langTranslateApp.categoryHEALTH))
{$('#LogoImage_'+langTranslateApp.categoryHealth+' img')[0].src=app.categoriesFromCms.filter(element=>element.categoryName.toUpperCase().includes(langTranslateApp.categoryHEALTH))[0].cardImageUrl;$('#SubCategory_'+langTranslateApp.categoryHealth)[0].innerHTML=app.categoriesFromCms.filter(element=>element.categoryName.toUpperCase().includes(langTranslateApp.categoryHEALTH))[0].subCategory;$('#ButtonLink_'+langTranslateApp.categoryHealth)[0].href=app.categoriesFromCms.filter(element=>element.categoryName.toUpperCase().includes(langTranslateApp.categoryHEALTH))[0].buttonLink;}
if($('.unlock_slider_title')[step].innerHTML.toUpperCase().includes(langTranslateApp.categoryHOUSEHOLD))
{$('#LogoImage_'+langTranslateApp.categoryHousehold+' img')[0].src=app.categoriesFromCms.filter(element=>element.categoryName.toUpperCase().includes(langTranslateApp.categoryHOUSEHOLD))[0].cardImageUrl;$('#SubCategory_'+langTranslateApp.categoryHousehold)[0].innerHTML=app.categoriesFromCms.filter(element=>element.categoryName.toUpperCase().includes(langTranslateApp.categoryHOUSEHOLD))[0].subCategory;$('#ButtonLink_'+langTranslateApp.categoryHousehold)[0].href=app.categoriesFromCms.filter(element=>element.categoryName.toUpperCase().includes(langTranslateApp.categoryHOUSEHOLD))[0].buttonLink;}
if($('.unlock_slider_title')[step].innerHTML.toUpperCase().includes(langTranslateApp.categoryGROCERY))
{$('#LogoImage_'+langTranslateApp.categoryGrocerySuperMarket+' img')[0].src=app.categoriesFromCms.filter(element=>element.categoryName.toUpperCase().includes(langTranslateApp.categoryGROCERY))[0].cardImageUrl;$('#SubCategory_'+langTranslateApp.categoryGrocerySuperMarket)[0].innerHTML=app.categoriesFromCms.filter(element=>element.categoryName.toUpperCase().includes(langTranslateApp.categoryGROCERY))[0].subCategory;$('#ButtonLink_'+langTranslateApp.categoryGrocerySuperMarket)[0].href=app.categoriesFromCms.filter(element=>element.categoryName.toUpperCase().includes(langTranslateApp.categoryGROCERY))[0].buttonLink;}
if($('.unlock_slider_title')[step].innerHTML.toUpperCase().includes(langTranslateApp.categoryENTERTAINMENT))
{$('#LogoImage_'+langTranslateApp.categoryEntertainment+' img')[0].src=app.categoriesFromCms.filter(element=>element.categoryName.toUpperCase().includes(langTranslateApp.categoryENTERTAINMENT))[0].cardImageUrl;$('#SubCategory_'+langTranslateApp.categoryEntertainment)[0].innerHTML=app.categoriesFromCms.filter(element=>element.categoryName.toUpperCase().includes(langTranslateApp.categoryENTERTAINMENT))[0].subCategory;$('#ButtonLink_'+langTranslateApp.categoryEntertainment)[0].href=app.categoriesFromCms.filter(element=>element.categoryName.toUpperCase().includes(langTranslateApp.categoryENTERTAINMENT))[0].buttonLink;}
if($('.unlock_slider_title')[step].innerHTML.toUpperCase().includes("RESTAURANTS"))
{$('#LogoImage_RestaurantsFastFood img')[0].src=app.categoriesFromCms.filter(element=>element.categoryName.toUpperCase().includes('RESTAURANT'))[0].cardImageUrl;$('#SubCategory_RestaurantsFastFood')[0].innerHTML=app.categoriesFromCms.filter(element=>element.categoryName.toUpperCase().includes('RESTAURANT'))[0].subCategory;$('#ButtonLink_RestaurantsFastFood')[0].href=app.categoriesFromCms.filter(element=>element.categoryName.toUpperCase().includes('RESTAURANT'))[0].buttonLink;}else if($('.unlock_slider_title')[step].innerHTML.toUpperCase().includes(langTranslateApp.categoryRestaurant))
{$('#LogoImage_'+langTranslateApp.categoryRestaurantFastFood+' img')[0].src=app.categoriesFromCms.filter(element=>element.categoryName.toUpperCase().includes(langTranslateApp.categoryRestaurant))[0].cardImageUrl;$('#SubCategory_'+langTranslateApp.categoryRestaurantFastFood)[0].innerHTML=app.categoriesFromCms.filter(element=>element.categoryName.toUpperCase().includes(langTranslateApp.categoryRestaurant))[0].subCategory;$('#ButtonLink_'+langTranslateApp.categoryRestaurantFastFood)[0].href=app.categoriesFromCms.filter(element=>element.categoryName.toUpperCase().includes(langTranslateApp.categoryRestaurant))[0].buttonLink;}
if($('.unlock_slider_title')[step].innerHTML.toUpperCase().includes(langTranslateApp.categoryRETAIL))
{$('#LogoImage_'+langTranslateApp.categoryRetail+' img')[0].src=app.categoriesFromCms.filter(element=>element.categoryName.toUpperCase().includes(langTranslateApp.categoryRETAIL))[0].cardImageUrl;$('#SubCategory_'+langTranslateApp.categoryRetail)[0].innerHTML=app.categoriesFromCms.filter(element=>element.categoryName.toUpperCase().includes(langTranslateApp.categoryRETAIL))[0].subCategory;$('#ButtonLink_'+langTranslateApp.categoryRetail)[0].href=app.categoriesFromCms.filter(element=>element.categoryName.toUpperCase().includes(langTranslateApp.categoryRETAIL))[0].buttonLink;}
if($('.unlock_slider_title')[step].innerHTML.toUpperCase().includes(langTranslateApp.categoryLIFESTYLE))
{$('#LogoImage_'+langTranslateApp.categoryLifestyle+' img')[0].src=app.categoriesFromCms.filter(element=>element.categoryName.toUpperCase().includes(langTranslateApp.categoryLIFESTYLE))[0].cardImageUrl;$('#SubCategory_'+langTranslateApp.categoryLifestyle)[0].innerHTML=app.categoriesFromCms.filter(element=>element.categoryName.toUpperCase().includes(langTranslateApp.categoryLIFESTYLE))[0].subCategory;$('#ButtonLink_'+langTranslateApp.categoryLifestyle)[0].href=app.categoriesFromCms.filter(element=>element.categoryName.toUpperCase().includes(langTranslateApp.categoryLIFESTYLE))[0].buttonLink;}
if($('.unlock_slider_title')[step].innerHTML.toUpperCase().includes(langTranslateApp.categoryFINANCE))
{$('#LogoImage_'+langTranslateApp.categoryFinance+' img')[0].src=app.categoriesFromCms.filter(element=>element.categoryName.toUpperCase().includes(langTranslateApp.categoryFINANCE))[0].cardImageUrl;$('#SubCategory_'+langTranslateApp.categoryFinance)[0].innerHTML=app.categoriesFromCms.filter(element=>element.categoryName.toUpperCase().includes(langTranslateApp.categoryFINANCE))[0].subCategory;$('#ButtonLink_'+langTranslateApp.categoryFinance)[0].href=app.categoriesFromCms.filter(element=>element.categoryName.toUpperCase().includes(langTranslateApp.categoryFINANCE))[0].buttonLink;}
if($('.unlock_slider_title')[step].innerHTML.toUpperCase().startsWith(langTranslateApp.categorySPORT))
{$('#LogoImage_'+langTranslateApp.categorySport+' img')[0].src=app.categoriesFromCms.filter(element=>element.categoryName.toUpperCase().startsWith(langTranslateApp.categorySPORT))[0].cardImageUrl;$('#SubCategory_'+langTranslateApp.categorySport)[0].innerHTML=app.categoriesFromCms.filter(element=>element.categoryName.toUpperCase().startsWith(langTranslateApp.categorySPORT))[0].subCategory;$('#ButtonLink_'+langTranslateApp.categorySport)[0].href=app.categoriesFromCms.filter(element=>element.categoryName.toUpperCase().startsWith(langTranslateApp.categorySPORT))[0].buttonLink;}
if($('.unlock_slider_title')[step].innerHTML.toUpperCase().includes(langTranslateApp.categoryMOBILE))
{$('#LogoImage_'+langTranslateApp.categoryMobile+' img')[0].src=app.categoriesFromCms.filter(element=>element.categoryName.toUpperCase().includes(langTranslateApp.categoryMOBILE))[0].cardImageUrl;$('#SubCategory_'+langTranslateApp.categoryMobile)[0].innerHTML=app.categoriesFromCms.filter(element=>element.categoryName.toUpperCase().includes(langTranslateApp.categoryMOBILE))[0].subCategory;$('#ButtonLink_'+langTranslateApp.categoryMobile)[0].href=app.categoriesFromCms.filter(element=>element.categoryName.toUpperCase().includes(langTranslateApp.categoryMOBILE))[0].buttonLink;}}}
function HandleCategorySelection(){$(".card-section").click(function(){if(app.loggedin)
{if(app.ShowAllCategories&&app.ShowAllCategories==true)
{let filteredCategoryWithProducts=self.categoryWithProducts.list.filter(element=>element.categoryID==this.id)[0];app.filteredProductList=filteredCategoryWithProducts.productList;app.selectedCategory=filteredCategoryWithProducts.categoryName;renameRewardListCategoryNameHeader();window.SessionSave('app',app);riot.update();}
else
{console.log('button clicked : '+this.id);let filteredCategoryWithProducts=self.categoryWithProducts.smartCardQueryByCustomerResult.filter(element=>element.categoryId==this.id)[0];app.filteredProductList=filteredCategoryWithProducts.productList;app.selectedCategory=filteredCategoryWithProducts.categoryName;renameRewardListCategoryNameHeader();app.UserSessionKey=dstvApp.UserSessionKey;window.SessionSave('app',app);riot.update();}}
else{console.log('button clicked : '+this.id);app.filteredProductList=self.categoryWithProducts.list.filter(element=>element.categoryID==this.id)[0].productList;app.selectedCategory=self.categoryWithProducts.list.filter(element=>element.categoryID==this.id)[0].categoryName;renameRewardListCategoryNameHeader();window.SessionSave('app',app);}
app.initialThanksCountry=dstvApp.country;window.SessionSave('app',app);});};function renameRewardListCategoryNameHeader(){if(app.selectedCategory){if(app.selectedCategory.toUpperCase().includes("RESTAURANTS")){app.selectedCategory="Food"}else if(app.selectedCategory.toUpperCase().includes("HOUSEHOLD"))
{app.selectedCategory="Appliances"}else if(app.selectedCategory.toUpperCase().includes("RESTAURANT"))
{app.selectedCategory="Food"}else{}}}});});riot.tag2('tag-dstvthanks-rewards-viewall','<div class="row"><div class="" style="z-index: 9999;" if="{state == \'loading\'}"><div class="loading-loader loading"><div class="col-sm-12 text-center white"><div class="spinner black"></div><div class="loading-message">{langTranslateApp.dashLoading}...</div></div></div></div> <div class="col-sm-12"> <div if="{!app.loggedin}" each="{item in categoryWithProducts.list}" class="thanks-not-log thanks_shadow-unlock unlock_slider_card" id="{trimAndReplace(item.categoryName)}"> <div style="display:none;" class="channel-num" id="ChannelNumber_{trimAndReplace(item.categoryName)}"><span>{item.productList.length}</span></div> <a href="{window.culture}/reward-list/" tabindex="0" id="ButtonLink_{trimAndReplace(item.categoryName)}"> <div class="card-section" id="{item.categoryID}"> <div class="card-main"> <span class="slide-img" id="LogoImage_{trimAndReplace(item.categoryName)}"><img src=""></span> <h2 if="{(item.categoryName.toUpperCase().includes(\'RESTAURANT\'))&&(window.culture.includes(\'pt-\'))}" class="unlock_slider_title_subcategory" id="SubCategory_{trimAndReplace(item.categoryName)}">COMIDA</h2> <h2 class="unlock_slider_title" style="display:none;">{item.categoryName}</h2> <h2 if="{(item.categoryName.toUpperCase().includes(\'RESTAURANT\'))&&(window.culture.includes(\'en-\'))}" class="unlock_slider_title_subcategory" id="SubCategory_{trimAndReplace(item.categoryName)}">FOOD</h2> <h2 if="{item.categoryName.toUpperCase().includes(\'HOUSEHOLD\')}" class="unlock_slider_title_subcategory" id="SubCategory_{trimAndReplace(item.categoryName)}">APPLIANCES</h2> <h2 if="{item.categoryName.toUpperCase().includes(\'GROCERY\')}" class="unlock_slider_title_subcategory" id="SubCategory_{trimAndReplace(item.categoryName)}">GROCERY</h2> <h2 if="{!item.categoryName.toUpperCase().includes(\'RESTAURANT\')&&!item.categoryName.toUpperCase().includes(\'HOUSEHOLD\')&&!item.categoryName.toUpperCase().includes(\'GROCERY\')}" class="unlock_slider_title_subcategory" id="SubCategory_{trimAndReplace(item.categoryName)}">{item.categoryName.toUpperCase()}</h2></div> <div class="wraps highlight"><span class="arrow-label thinFont" id="ButtonText_{trimAndReplace(item.categoryName)}"></span> <button id="{item.categoryID}" class="categoryButton bg-gradient-45 arrow-font-color" tabindex="0"><span class="icon-ico-arrow-next"></span></button> </div> </div> </a> </div> <div if="{app.ShowAllCategories}" each="{item in categoryWithProducts.list}" class="thanks-not-log thanks_shadow-unlock unlock_slider_card" id="{trimAndReplace(item.categoryName)}"> <div style="display:none;" class="channel-num" id="ChannelNumber_{trimAndReplace(item.categoryName)}"><span>{item.productList.length}</span></div> <a href="{window.culture}/reward-list/" tabindex="0" id="ButtonLink_{trimAndReplace(item.categoryName)}"> <div class="card-section" id="{item.categoryID}"> <div class="card-main"> <span class="slide-img" id="LogoImage_{trimAndReplace(item.categoryName)}"><img src=""></span> <h2 class="unlock_slider_title" style="display:none;">{item.categoryName}</h2> <h2 if="{item.categoryName.toUpperCase().includes(\'RESTAURANT\')}" class="unlock_slider_title_subcategory" id="SubCategory_{trimAndReplace(item.categoryName)}">FOOD</h2> <h2 if="{item.categoryName.toUpperCase().includes(\'HOUSEHOLD\')}" class="unlock_slider_title_subcategory" id="SubCategory_{trimAndReplace(item.categoryName)}">APPLIANCES</h2> <h2 if="{!item.categoryName.toUpperCase().includes(\'RESTAURANT\')&&!item.categoryName.toUpperCase().includes(\'HOUSEHOLD\')}" class="unlock_slider_title_subcategory" id="SubCategory_{trimAndReplace(item.categoryName)}">{item.categoryName.toUpperCase()}</h2></div> <div class="wraps highlight"><span class="arrow-label thinFont" id="ButtonText_{trimAndReplace(item.categoryName)}"></span> <button id="{item.categoryID}" class="categoryButton bg-gradient-45 arrow-font-color" tabindex="0"><span class="icon-ico-arrow-next"></span></button> </div> </div> </a> </div> <div if="{app.loggedin && !app.ShowAllCategories}" each="{item in categoryWithProducts.smartCardQueryByCustomerResult}" id="{trimAndReplace(item.categoryName)}" class="thanks-loggin thanks_shadow-unlock unlock_slider_card"> <div class="channel-num" id="ChannelNumber_{trimAndReplace(item.categoryName)}"><span>{item.productList.length}</span></div> <a href="{window.culture}/reward-list/" tabindex="0" id="ButtonLink_{trimAndReplace(item.categoryName)}"> <div class="card-section" id="{item.categoryId}"> <div class="card-main"> <span class="slide-img" id="LogoImage_{trimAndReplace(item.categoryName)}"><img src=""></span> <h2 class="unlock_slider_title" style="display:none;">{item.categoryName}</h2> <h2 if="{item.categoryName.toUpperCase().includes(\'RESTAURANT\')}" class="unlock_slider_title_subcategory" id="SubCategory_{trimAndReplace(item.categoryName)}">FOOD</h2> <h2 if="{item.categoryName.toUpperCase().includes(\'HOUSEHOLD\')}" class="unlock_slider_title_subcategory" id="SubCategory_{trimAndReplace(item.categoryName)}">APPLIANCES</h2> <h2 if="{!item.categoryName.toUpperCase().includes(\'RESTAURANT\')&&!item.categoryName.toUpperCase().includes(\'HOUSEHOLD\')}" class="unlock_slider_title_subcategory" id="SubCategory_{trimAndReplace(item.categoryName)}">{item.categoryName.toUpperCase()}</h2></div> <div class="wraps highlight"><span class="arrow-label thinFont" id="ButtonText_{trimAndReplace(item.categoryName)}"></span> <button id="{item.categoryId}" title="loggedin" class="categoryButton bg-gradient-45 arrow-font-color" tabindex="0"><span class="icon-ico-arrow-next"></span></button> </div> </div> </a> </div> </div></div><tag-dstvthanks-partner-modal-popup></tag-dstvthanks-partner-modal-popup>','tag-dstvthanks-rewards-viewall,[riot-tag="tag-dstvthanks-rewards-viewall"],[data-is="tag-dstvthanks-rewards-viewall"]{ visibility: visible; display: block; }','',function(opts){var self=this;self.dstvThanksBaseUrl=dstvApp.ThanksAPIBaseUrl;self.categoriesLoaded=false;self.showLoader=true;self.productsLoaded=false;app.selectThePackage=false;window.SessionSave("app",app);self.state='loading'
var loadAllCategoriesUrl='';var allCategoriesQueryString=`GetReward?Country=${dstvApp.country}&BusinessUnit=${dstvApp.businessunit}&Language=${dstvApp.language}&Channel=${dstvApp.channel}&CustomerSmartCard=&SessionKey=`;self.on('mount',function(){$('#viewAllPopup').on('shown.bs.modal',function(){self.state='loading'
var result=site.factory.GetStorage('JWTTokenKey');if(result==null){site.factory.GetJWTToken(dstvApp.JwtTokenApiUrl,dstvApp.ReqBody,"POST",'GetJWTToken',self.onJWTTokenSuccess,self.onJWTTokenError);}
else{self.loadCategories();}});});self.onJWTTokenSuccess=function(){console.log('Token Generated...')
self.bearerToken="Bearer "+localStorage["JWTTokenKey"];self.loadCategories();}
self.onJWTTokenError=function(){}
self.trimAndReplace=function(s){return s.replace(/ /g,'').replace(/&amp;/g,'').replace(/&/g,'')}
self.loadCategories=function(){console.log('Reward popup : Started loading categories...')
if(!app.loggedin){loadAllCategoriesUrl=self.dstvThanksBaseUrl+allCategoriesQueryString;self.trigger("getdatabytoken",loadAllCategoriesUrl,"Bearer "+localStorage["JWTTokenKey"],self.successCallback,self.errorCallback);}
else{if(app.ShowAllCategories&&app.ShowAllCategories==true)
{loadAllCategoriesUrl=self.dstvThanksBaseUrl+allCategoriesQueryString;self.trigger("getdatabytoken",loadAllCategoriesUrl,"Bearer "+localStorage["JWTTokenKey"],self.successCallback,self.errorCallback);}
else
{var authenticationUrl=dstvApp.ThanksAPIBaseUrl+`Authenticate?Smartcardnumber=${app.smartcard.trim()}&Surname=${app.paymentduedetails.properties.surname.value.trim()}&Country=${dstvApp.country.trim()}&BusinessUnit=${dstvApp.businessunit.trim()}&Channel=${dstvApp.channel.trim()}&Language=${dstvApp.language.trim()}`;self.authenticateUser(authenticationUrl);app.ShowAllCategories=false;self.state='rewardsloaded';window.SessionSave("app",app);}}};self.authenticateUser=function(authenticationUrl){site.trigger('getpostdata',authenticationUrl,'GET','application/json',"Bearer "+localStorage["JWTTokenKey"],'','','AuthenticateUser',self.onAuthenticateSuccess,self.onAuthenticateError);}
self.onAuthenticateSuccess=function(){var loggedinCategoriesQueryString=`GetReward?Country=${dstvApp.country}&BusinessUnit=${dstvApp.businessunit}&Language=${dstvApp.language}&Channel=${dstvApp.channel}&CustomerSmartCard=${app.smartcard}&SessionKey=${dstvApp.UserSessionKey}`;loadAllCategoriesUrl=self.dstvThanksBaseUrl+loggedinCategoriesQueryString;self.trigger("getdatabytoken",loadAllCategoriesUrl,"Bearer "+localStorage["JWTTokenKey"],self.successCallback,self.errorCallback);}
self.onAuthenticateError=function(e){console.log('authentication error');$(".loader-highlight").css("display","none");$(".slider-nav-unlock-main").addClass("noneligible");$("#noEligible").show();}
self.on('getdatabytoken',function(url,token,callback,errorcallback){var settings={url:url,method:"GET",headers:{Authorization:token},"Content-Type":"application/json"}
$.ajax(settings).done(function(response){if(response.smartCardQueryByCustomerResult){self.categoryWithProducts=response;self.categoryWithProducts.list=response.smartCardQueryByCustomerResult;app.userMobileNumber=(self.categoryWithProducts.list[0]&&self.categoryWithProducts.list[0].msisdn)||'';window.SessionSave('app',app);}
else{self.categoryWithProducts=response;}
$(".slider-nav-unlock-main").removeClass("noneligible");self.state='rewardsloaded';self.update();BindCMSData();$(".loader-highlight").css("display","none");HandleCategorySelection();}).fail(function(error){$(".loader-highlight").css("display","none");$(".slider-nav-unlock-main").addClass("noneligible");$("#noEligible").show();self.state='rewardsloaded';});function BindCMSData(){var categoryWithProdListLength='';if(app.loggedin)
{if(app.ShowAllCategories&&app.ShowAllCategories==true)
{categoryWithProdListLength=self.categoryWithProducts.list.length;}
else
{categoryWithProdListLength=self.categoryWithProducts.smartCardQueryByCustomerResult.length;}}
else
{categoryWithProdListLength=self.categoryWithProducts.list.length;}
for(let step=0;step<categoryWithProdListLength;step++){if($('.unlock_slider_title')[step].innerHTML.toUpperCase().includes(langTranslateApp.categoryTRAVEL))
{$('#LogoImage_'+langTranslateApp.categoryTravel+' img')[0].src=app.categoriesFromCms.filter(element=>element.categoryName.toUpperCase().includes(langTranslateApp.categoryTRAVEL))[0].cardImageUrl;$('#SubCategory_'+langTranslateApp.categoryTravel)[0].innerHTML=app.categoriesFromCms.filter(element=>element.categoryName.toUpperCase().includes(langTranslateApp.categoryTRAVEL))[0].subCategory;$('#ButtonLink_'+langTranslateApp.categoryTravel)[0].href=app.categoriesFromCms.filter(element=>element.categoryName.toUpperCase().includes(langTranslateApp.categoryTRAVEL))[0].buttonLink;}
if($('.unlock_slider_title')[step].innerHTML.toUpperCase().includes("SHOPPING"))
{$('#LogoImage_Shopping img')[0].src=app.categoriesFromCms.filter(element=>element.categoryName.toUpperCase().includes('SHOPPING'))[0].cardImageUrl;$('#SubCategory_Shopping')[0].innerHTML=app.categoriesFromCms.filter(element=>element.categoryName.toUpperCase().includes('SHOPPING'))[0].subCategory;$('#ButtonLink_Shopping')[0].href=app.categoriesFromCms.filter(element=>element.categoryName.toUpperCase().includes('SHOPPING'))[0].buttonLink;}
if($('.unlock_slider_title')[step].innerHTML.toUpperCase().includes("FINANCIAL"))
{$('#LogoImage_Financial img')[0].src=app.categoriesFromCms.filter(element=>element.categoryName.toUpperCase().includes('FINANCIAL'))[0].cardImageUrl;$('#SubCategory_Financial')[0].innerHTML=app.categoriesFromCms.filter(element=>element.categoryName.toUpperCase().includes('FINANCIAL'))[0].subCategory;$('#ButtonLink_Financial')[0].href=app.categoriesFromCms.filter(element=>element.categoryName.toUpperCase().includes('FINANCIAL'))[0].buttonLink;}
if($('.unlock_slider_title')[step].innerHTML.toUpperCase().includes("HOTELS"))
{$('#LogoImage_Hotels img')[0].src=app.categoriesFromCms.filter(element=>element.categoryName.toUpperCase().includes('HOTELS'))[0].cardImageUrl;$('#SubCategory_Hotels')[0].innerHTML=app.categoriesFromCms.filter(element=>element.categoryName.toUpperCase().includes('HOTELS'))[0].subCategory;$('#ButtonLink_Hotels')[0].href=app.categoriesFromCms.filter(element=>element.categoryName.toUpperCase().includes('HOTELS'))[0].buttonLink;}
if($('.unlock_slider_title')[step].innerHTML.toUpperCase().includes("EDUCATION"))
{$('#LogoImage_Education img')[0].src=app.categoriesFromCms.filter(element=>element.categoryName.toUpperCase().includes('EDUCATION'))[0].cardImageUrl;$('#SubCategory_Education')[0].innerHTML=app.categoriesFromCms.filter(element=>element.categoryName.toUpperCase().includes('EDUCATION'))[0].subCategory;$('#ButtonLink_Education')[0].href=app.categoriesFromCms.filter(element=>element.categoryName.toUpperCase().includes('EDUCATION'))[0].buttonLink;}
if($('.unlock_slider_title')[step].innerHTML.toUpperCase().includes("TRANSPORT"))
{$('#LogoImage_Transport img')[0].src=app.categoriesFromCms.filter(element=>element.categoryName.toUpperCase().includes('TRANSPORT'))[0].cardImageUrl;$('#SubCategory_Transport')[0].innerHTML=app.categoriesFromCms.filter(element=>element.categoryName.toUpperCase().includes('TRANSPORT'))[0].subCategory;$('#ButtonLink_Transport')[0].href=app.categoriesFromCms.filter(element=>element.categoryName.toUpperCase().includes('TRANSPORT'))[0].buttonLink;}
if($('.unlock_slider_title')[step].innerHTML.toUpperCase().includes(langTranslateApp.categoryHEALTH))
{$('#LogoImage_'+langTranslateApp.categoryHealth+' img')[0].src=app.categoriesFromCms.filter(element=>element.categoryName.toUpperCase().includes(langTranslateApp.categoryHEALTH))[0].cardImageUrl;$('#SubCategory_'+langTranslateApp.categoryHealth)[0].innerHTML=app.categoriesFromCms.filter(element=>element.categoryName.toUpperCase().includes(langTranslateApp.categoryHEALTH))[0].subCategory;$('#ButtonLink_'+langTranslateApp.categoryHealth)[0].href=app.categoriesFromCms.filter(element=>element.categoryName.toUpperCase().includes(langTranslateApp.categoryHEALTH))[0].buttonLink;}
if($('.unlock_slider_title')[step].innerHTML.toUpperCase().includes("HOUSEHOLD"))
{$('#LogoImage_HouseholdElectronics img')[0].src=app.categoriesFromCms.filter(element=>element.categoryName.toUpperCase().includes('HOUSEHOLD'))[0].cardImageUrl;$('#SubCategory_HouseholdElectronics')[0].innerHTML=app.categoriesFromCms.filter(element=>element.categoryName.toUpperCase().includes('HOUSEHOLD'))[0].subCategory;$('#ButtonLink_HouseholdElectronics')[0].href=app.categoriesFromCms.filter(element=>element.categoryName.toUpperCase().includes('HOUSEHOLD'))[0].buttonLink;}
if($('.unlock_slider_title')[step].innerHTML.toUpperCase().includes("GROCERY"))
{$('#LogoImage_GrocerySupermarket img')[0].src=app.categoriesFromCms.filter(element=>element.categoryName.toUpperCase().includes('GROCERY'))[0].cardImageUrl;$('#SubCategory_GrocerySupermarket')[0].innerHTML=app.categoriesFromCms.filter(element=>element.categoryName.toUpperCase().includes('GROCERY'))[0].subCategory;$('#ButtonLink_GrocerySupermarket')[0].href=app.categoriesFromCms.filter(element=>element.categoryName.toUpperCase().includes('GROCERY'))[0].buttonLink;}
if($('.unlock_slider_title')[step].innerHTML.toUpperCase().includes(langTranslateApp.categoryENTERTAINMENT))
{$('#LogoImage_'+langTranslateApp.categoryEntertainment+' img')[0].src=app.categoriesFromCms.filter(element=>element.categoryName.toUpperCase().includes(langTranslateApp.categoryENTERTAINMENT))[0].cardImageUrl;$('#SubCategory_'+langTranslateApp.categoryEntertainment)[0].innerHTML=app.categoriesFromCms.filter(element=>element.categoryName.toUpperCase().includes(langTranslateApp.categoryENTERTAINMENT))[0].subCategory;$('#ButtonLink_'+langTranslateApp.categoryEntertainment)[0].href=app.categoriesFromCms.filter(element=>element.categoryName.toUpperCase().includes(langTranslateApp.categoryENTERTAINMENT))[0].buttonLink;}
if($('.unlock_slider_title')[step].innerHTML.toUpperCase().includes("RESTAURANTS"))
{$('#LogoImage_RestaurantsFastFood img')[0].src=app.categoriesFromCms.filter(element=>element.categoryName.toUpperCase().includes('RESTAURANT'))[0].cardImageUrl;$('#SubCategory_RestaurantsFastFood')[0].innerHTML=app.categoriesFromCms.filter(element=>element.categoryName.toUpperCase().includes('RESTAURANT'))[0].subCategory;$('#ButtonLink_RestaurantsFastFood')[0].href=app.categoriesFromCms.filter(element=>element.categoryName.toUpperCase().includes('RESTAURANT'))[0].buttonLink;}else if($('.unlock_slider_title')[step].innerHTML.toUpperCase().includes(langTranslateApp.categoryRestaurant))
{$('#LogoImage_'+langTranslateApp.categoryRestaurantFastFood+' img')[0].src=app.categoriesFromCms.filter(element=>element.categoryName.toUpperCase().includes(langTranslateApp.categoryRestaurant))[0].cardImageUrl;$('#SubCategory_'+langTranslateApp.categoryRestaurantFastFood)[0].innerHTML=app.categoriesFromCms.filter(element=>element.categoryName.toUpperCase().includes(langTranslateApp.categoryRestaurant))[0].subCategory;$('#ButtonLink_'+langTranslateApp.categoryRestaurantFastFood)[0].href=app.categoriesFromCms.filter(element=>element.categoryName.toUpperCase().includes(langTranslateApp.categoryRestaurant))[0].buttonLink;}
if($('.unlock_slider_title')[step].innerHTML.toUpperCase().includes(langTranslateApp.categoryRETAIL))
{$('#LogoImage_'+langTranslateApp.categoryRetail+' img')[0].src=app.categoriesFromCms.filter(element=>element.categoryName.toUpperCase().includes(langTranslateApp.categoryRETAIL))[0].cardImageUrl;$('#SubCategory_'+langTranslateApp.categoryRetail)[0].innerHTML=app.categoriesFromCms.filter(element=>element.categoryName.toUpperCase().includes(langTranslateApp.categoryRETAIL))[0].subCategory;$('#ButtonLink_'+langTranslateApp.categoryRetail)[0].href=app.categoriesFromCms.filter(element=>element.categoryName.toUpperCase().includes(langTranslateApp.categoryRETAIL))[0].buttonLink;}
if($('.unlock_slider_title')[step].innerHTML.toUpperCase().includes(langTranslateApp.categoryLIFESTYLE))
{$('#LogoImage_'+langTranslateApp.categoryLifestyle+' img')[0].src=app.categoriesFromCms.filter(element=>element.categoryName.toUpperCase().includes(langTranslateApp.categoryLIFESTYLE))[0].cardImageUrl;$('#SubCategory_'+langTranslateApp.categoryLifestyle)[0].innerHTML=app.categoriesFromCms.filter(element=>element.categoryName.toUpperCase().includes(langTranslateApp.categoryLIFESTYLE))[0].subCategory;$('#ButtonLink_'+langTranslateApp.categoryLifestyle)[0].href=app.categoriesFromCms.filter(element=>element.categoryName.toUpperCase().includes(langTranslateApp.categoryLIFESTYLE))[0].buttonLink;}
if($('.unlock_slider_title')[step].innerHTML.toUpperCase().includes(langTranslateApp.categoryFINANCE))
{$('#LogoImage_'+langTranslateApp.categoryFinance+' img')[0].src=app.categoriesFromCms.filter(element=>element.categoryName.toUpperCase().includes(langTranslateApp.categoryFINANCE))[0].cardImageUrl;$('#SubCategory_'+langTranslateApp.categoryFinance)[0].innerHTML=app.categoriesFromCms.filter(element=>element.categoryName.toUpperCase().includes(langTranslateApp.categoryFINANCE))[0].subCategory;$('#ButtonLink_'+langTranslateApp.categoryFinance)[0].href=app.categoriesFromCms.filter(element=>element.categoryName.toUpperCase().includes(langTranslateApp.categoryFINANCE))[0].buttonLink;}
if($('.unlock_slider_title')[step].innerHTML.toUpperCase().startsWith(langTranslateApp.categorySPORT))
{$('#LogoImage_'+langTranslateApp.categorySport+' img')[0].src=app.categoriesFromCms.filter(element=>element.categoryName.toUpperCase().startsWith(langTranslateApp.categorySPORT))[0].cardImageUrl;$('#SubCategory_'+langTranslateApp.categorySport)[0].innerHTML=app.categoriesFromCms.filter(element=>element.categoryName.toUpperCase().startsWith(langTranslateApp.categorySPORT))[0].subCategory;$('#ButtonLink_'+langTranslateApp.categorySport)[0].href=app.categoriesFromCms.filter(element=>element.categoryName.toUpperCase().startsWith(langTranslateApp.categorySPORT))[0].buttonLink;}
if($('.unlock_slider_title')[step].innerHTML.toUpperCase().includes(langTranslateApp.categoryMOBILE))
{$('#LogoImage_'+langTranslateApp.categoryMobile+' img')[0].src=app.categoriesFromCms.filter(element=>element.categoryName.toUpperCase().includes(langTranslateApp.categoryMOBILE))[0].cardImageUrl;$('#SubCategory_'+langTranslateApp.categoryMobile)[0].innerHTML=app.categoriesFromCms.filter(element=>element.categoryName.toUpperCase().includes(langTranslateApp.categoryMOBILE))[0].subCategory;$('#ButtonLink_'+langTranslateApp.categoryMobile)[0].href=app.categoriesFromCms.filter(element=>element.categoryName.toUpperCase().includes(langTranslateApp.categoryMOBILE))[0].buttonLink;}}}
function HandleCategorySelection(){$(".card-section").click(function(){if(app.loggedin)
{if(app.ShowAllCategories&&app.ShowAllCategories==true)
{let filteredCategoryWithProducts=self.categoryWithProducts.list.filter(element=>element.categoryID==this.id)[0];app.filteredProductList=filteredCategoryWithProducts.productList;app.selectedCategory=filteredCategoryWithProducts.categoryName;renameRewardListCategoryNameHeader();window.SessionSave('app',app);}
else
{console.log('button clicked : '+this.id);let filteredCategoryWithProducts=self.categoryWithProducts.smartCardQueryByCustomerResult.filter(element=>element.categoryId==this.id)[0];app.filteredProductList=filteredCategoryWithProducts.productList;app.selectedCategory=filteredCategoryWithProducts.categoryName;renameRewardListCategoryNameHeader();app.UserSessionKey=dstvApp.UserSessionKey;window.SessionSave('app',app);}}
else{console.log('button clicked : '+this.id);app.filteredProductList=self.categoryWithProducts.list.filter(element=>element.categoryID==this.id)[0].productList;app.selectedCategory=self.categoryWithProducts.list.filter(element=>element.categoryID==this.id)[0].categoryName;renameRewardListCategoryNameHeader();app.initialThanksCountry=dstvApp.country;window.SessionSave('app',app);}});};function renameRewardListCategoryNameHeader(){if(app.selectedCategory){if(app.selectedCategory.toUpperCase().includes("RESTAURANT")||app.selectedCategory.toUpperCase().includes("RESTAURANTS")){app.selectedCategory="Food"}
else if(app.selectedCategory.toUpperCase().includes("HOUSEHOLD"))
{app.selectedCategory="Appliances"}else{}
self.update();}}});});riot.tag2('tag-reward-list','<h2 class="reward-list-category-heading">{app.selectedCategory} {langTranslateApp.rewards}</h2><!--<span class="reward-list-category-subheading">Select package below For easy viewing </span><div class="group-category-area "> <div class="group-category-mid-sec" each="{item in app.packagesArray}" onCLick="{SelectedPackageProducts}"> <div class="group-category-name {trimAndReplacePlusCharacter(item)}" id="{item}" ><span class="font-icon-group icon-{trimAndReplacePlusCharacter(item)}"></span></div> </div></div><span class="arrows-group-package" ></span></div>--><div if="{!app.loggedin}" each="{item in app.filteredProductList}" class="thanks_shadow reward"><div class="reward-card-list-section"> <div class="reward-left-content"> <div class="trapez3"></div> <div class="top-sec"> <div class="reward-card-img"><img src="data:image/png;base64, {item.rewardPartnerLogo}"></div> <h2 class="reward-card-title {item.ruleID}"></h2> <p class="reward-subtitle">{item.rewardPartnerName}</p> </div> <div class="card-pck-icon"><span class="card-package-icon"></span><span class="terms-button"><a class="term-link" href="{window.culture}/rewards-details" id="{item.ruleID}">{langTranslateApp.rewardClaim}</a></span> </div> <span class="Expire">Expires <span class="expire">{item.rewardExpiryDays} Days</span></span> </div> <div if="{item.cardImage == \'\'}" class="reward-right-img"><div class="trapez4"></div> </div> <div if="{!item.cardImage == \'\'}" class="reward-right-img" style="background-image: url(&#39;data:image/png;base64, {item.cardImage}&#39;);"> <div class="trapez4"></div> </div> </div></div><div if="{app.ShowAllCategories}" each="{item in app.filteredProductList}" class="thanks_shadow reward loggedin-card"> <div class="reward-card-list-section"> <div class="reward-left-content"> <div class="trapez3"></div> <div class="top-sec"> <div class="reward-card-img"><img src="data:image/png;base64, {item.rewardPartnerLogo}"></div> <h2 class="reward-card-title {item.ruleID}"></h2> <p class="reward-subtitle">{item.rewardPartnerName}</p> </div> <div class="card-pck-icon"><span class="card-package-icon"></span> <span class="terms-button"><a class="term-link" href="{window.culture}/rewards-details" id="{item.ruleID}">{langTranslateApp.rewardClaim}</a></span></div> <span class="Expire">Expires <span class="expire">{item.rewardExpiryDays} Days</span></span> </div> <div if="{item.cardImage == \'\'}" class="reward-right-img"> <div class="trapez4"></div> </div> <div if="{!item.cardImage == \'\'}" class="reward-right-img" style="background-image: url(&#39;data:image/png;base64, {item.cardImage}&#39;);"> <div class="trapez4"></div> </div> </div></div><div if="{app.loggedin && !app.ShowAllCategories}" each="{item in app.filteredProductList}" class="thanks_shadow reward"> <div class="reward-card-list-section"> <div class="reward-left-content"> <div class="trapez3"></div> <div class="top-sec"> <div class="reward-card-img"><img src="data:image/png;base64, {item.rewardPartnerLogo}"></div> <h2 class="reward-card-title {item.ruleId}"></h2> <p class="reward-subtitle">{item.rewardPartnerName}</p> </div> <div class="card-pck-icon"><span class="card-package-icon"></span><span class="terms-button"><a class="term-link" href="{window.culture}/rewards-details" id="{item.ruleId}">{langTranslateApp.rewardClaim}</a></span> </div> </div> <div if="{item.cardImage == \'\'}" class="reward-right-img"> <div class="trapez4"></div> </div> <div if="{!item.cardImage == \'\'}" class="reward-right-img" style="background-image: url(&#39;data:image/png;base64, {item.cardImage}&#39;);"> <div class="trapez4"></div> </div> </div></div><div class="modal fade claim" id="claim-overlay" role="dialog"> <div class="modal-dialog login-box"> <div class="modal-content claim-content "> <div class="modal-header"> <button type="button" class="close close-link no-print" data-dismiss="modal">&times;</button> <div class="logo-section" id="vDetails"> <div class="logo-img"><img src="data:image/png;base64, {dstvApp.ClaimDetails.list[0].rewardPartnerLogo}"></div> <h3><span class="voucher-amount">{dstvApp.ClaimDetails.list[0].ruleRewardPartnerDetail}</span><br> your voucher is valid till <span class="voucher-date">{dstvApp.ClaimDetails.list[0].expiryDate}</span><br> <span class="terms-text">Cost services may occur</span></h3> <span class="sms-text">Voucher number : <strong>{dstvApp.ClaimDetails.list[0].voucherNumber}</strong></span><span class="sms-text hidden">Voucher number : <strong>{dstvApp.ClaimDetails.list[0].voucherNumber}</strong> <span class="no-print">will be sent to your mobile number <strong>{formatMobileNumberToShow(app.userMobileNumber)}</strong>.</span></span> </div> </div> <div class="modal-body"> <form> <div class="claim-fields"> <div class=""><button class="no-print hidden" type="button" id="smsVoucher" onClick={SendVoucherSms}>SMS</button><button type="button" class="print-button no-print" onClick="{PrintPage}">{saveBTNText}</button></div> </div> </form> </div> </div> </div></div><div class="modal fade sucess-popup" id="sucess-overlay" role="dialog"> <div class="modal-dialog login-box"> <div class="modal-content sucess-content "> <div class="modal-header"> <button type="button" class="close close-link" data-dismiss="modal">&times;</button> <div class="logo-section"><img src="data:image/png;base64, {dstvApp.ClaimDetails.list[0].rewardPartnerLogo}"></div> </div> <div class="modal-body"> <div class="message"> <h2>Success</h2> <h3>Voucher number <strong>{dstvApp.ClaimDetails.list[0].voucherNumber}</strong> has been sent to your cell number<br> Thank you for using <strong>DStv Thanks</strong> </h3> <a href="{window.culture}/reward-list"><button type="button">More Vouchers</button></a> </div> </div> </div> </div></div><div class="modal dashboardModal" id="rewardsTCModal" role="dialog"> <div class="webform container modal-dialog modal-lg feedback-dialog"> <div class="modal-content"> <button type="button" class="close btnClose" data-dismiss="modal"><i class=" icon-Close_M"></i></button> <div class="modal-body"> <tag-rewards-details></tag-rewards-details> <div class="clearfix"></div> </div> </div> </div></div>','tag-reward-list,[riot-tag="tag-reward-list"],[data-is="tag-reward-list"]{ visibility: visible; display: block; }','',function(opts){var self=this;self.dstvThanksBaseUrl=dstvApp.ThanksAPIBaseUrl;self.productsLoaded=false;self.saveBTNText='Save';var claimRewardUrl='';self.ClaimDetails='';self.on('mount',function(){InitialiseProductsList();SetLoginURL();HandleTermsOfUseSelection();CardTextHtmlFormatter();});function SetLoginURL(){$('#loginLinkLabel span.login-icon').click(function(e){if((!app.loggedin&&window.location.href.includes(dstvApp.DstvThanksURL))||(!app.loggedin&&window.location.href.includes('/reward-list'))){e.preventDefault();e.stopImmediatePropagation();riot.mount('tag-sign-in',{returnURL:dstvApp.DstvThanksURL});}});}
function InitialiseProductsList(){if(app.initialThanksCountry){if(!app.loggedin&&(dstvApp.country.toLowerCase()!=app.initialThanksCountry.toLowerCase())){window.location=window.location.origin+window.culture+'/dstv-thanks';}}
else{window.location=window.location.origin+window.culture+'/dstv-thanks';}}
self.PrintPage=function(){self.saveBTNText='Please wait...'
domtoimage.toJpeg(document.getElementById('vDetails'),{quality:0.99}).then(function(dataUrl){let link=document.createElement('a')
link.download=dstvApp.ClaimDetails.list[0].voucherNumber+'.jpeg'
link.href=dataUrl
link.click()
self.saveBTNText='Save';self.update();})}
function HandleClaimedTermsAndConditions(){if(dstvApp.ClaimDetails.list[0].termsandCondtions){var str=dstvApp.ClaimDetails.list[0].termsandCondtions;var html=$.parseHTML(str);if($('#parsedHtml').has('ol').length<1)
{$('.term-list-popup').append(html);}}}
function HandleTermsOfUseSelection(){$(".term-link").click(function(e){console.log('term clicked : '+this.id);var ruleId=this.id;let productToClaim=app.filteredProductList.filter((element=>((element.ruleID||element.ruleId)==ruleId)))[0];self.update();riot.mount('tag-rewards-details',{productToClaim:productToClaim});$("#rewardsTCModal").modal('show');e.preventDefault();});$(".reward-card-title a").click(function(e){console.log('claim clicked : '+this.id);var prodName=this.id.split('_')[0];var ruleId=this.id.split('_')[1];if(app.loggedin){app.productToClaim=app.filteredProductList.filter((element=>element.productName==prodName)&&(element=>element.ruleId==ruleId))[0];window.SessionSave('app',app);self.ClaimMyReward(app.productToClaim);}
else{e.preventDefault();riot.mount('tag-sign-in',{returnURL:dstvApp.DstvThanksURL});}});}
function GroupProducts(){var packagesArray=[];for(var i=0;i<app.filteredProductList.length;i++){packagesArray.push(app.filteredProductList[i].productName.toString().Replace('+ ','plus'));}
const distinct=(value,index,self)=>{return self.indexOf(value)===index;}
app.packagesArray=packagesArray.filter(distinct);window.SessionSave('app',app);if(app.packageSelectedFlag==true&&app.selectThePackage){$('.group-category-name').removeClass("selected");$('.'+app.selectThePackage).addClass('selected');self.update();}
self.update();}
self.SelectedPackageProducts=function(){app.filteredProductListByPackage=app.filteredProductList;app.packageSelectedFlag=true;var selectedPackage=this.item;console.log(selectedPackage);app.filteredProductListByPackage=app.filteredProductListByPackage.filter(element=>element.productName===selectedPackage.trim().toString());window.SessionSave("app",app);if(selectedPackage.includes('+')){selectedPackage=self.trimAndReplacePlusCharacter(selectedPackage);}
$('.group-category-name').removeClass("selected");$('.'+selectedPackage).addClass('selected');app.selectThePackage=selectedPackage;window.SessionSave("app",app);self.update();CardTextHtmlFormatter();}
self.trimAndReplacePlusCharacter=function(item){return item.replace(/ /g,'').replace('+','-plus');}
self.formatMobileNumberToShow=function(item){return item.replace(/^.{7}/g,'*****');}
function CardTextHtmlFormatter(){for(var x=0;x<app.filteredProductList.length;x++){var html=$.parseHTML(app.filteredProductList[x].cardText);var cardTextClass='';if(app.loggedin){if(app.ShowAllCategories&&app.ShowAllCategories==true)
{cardTextClass='.'+app.filteredProductList[x].ruleID;}
else
{cardTextClass='.'+app.filteredProductList[x].ruleId;}}
else{cardTextClass='.'+app.filteredProductList[x].ruleID;}
if($(cardTextClass).has('p').length<1)
{$(cardTextClass).append(html);}}}
self.linkCellNumber=function(){window.location=dstvApp.UpdateDetailsURL;}
self.SendVoucherSms=function(){var mobileNumber=app.userMobileNumber;if(mobileNumber!==undefined&&mobileNumber!==''){var voucherSmsQueryString="SendRewardbysms"+`?Country=${dstvApp.country}&BusinessUnit=${dstvApp.businessunit}&Channel=${dstvApp.channel}&Language=${dstvApp.language}`;var sendVoucherSmsUrl=dstvApp.ThanksAPIBaseUrl+voucherSmsQueryString;var reqBody={"rewardId":dstvApp.ClaimDetails.list[0].rewardId,"language":dstvApp.language,"msisdn":mobileNumber,"sessionKey":app.UserSessionKey};site.trigger('getpostdata',sendVoucherSmsUrl,'POST','application/json',"Bearer "+localStorage["JWTTokenKey"],'',reqBody,'SmsVoucher',self.onSmsVoucherSuccess,self.onSmsVoucherError);}
else{site.factory.ShowModelPopupWithCustomButtonText('error','Oops!!','Cell number not linked','We didn\'t find cell number to link this account \n Please add cell number to your account ',false,null,true,'Add Cell Number',self.linkCellNumber);return;}}
$('#smsNumber').keyup(function(e)
{if(/\D/g.test(this.value))
{this.value=this.value.replace(/\D/g,'');}});self.onSmsVoucherSuccess=function(){console.log('Voucher sent success callback');self.update();$('#smsNumber').val('');$("#sucess-overlay").modal("show");return false;}
self.onSmsVoucherError=function(){}
self.ClaimMyReward=function(productToClaim){site.factory.GetJWT().then(function(token){self.token=token;let claimRewardQueryString=`ClaimReward?RewardId=${productToClaim.rewardId}&Country=${dstvApp.country}&BusinessUnit=${dstvApp.businessunit}&Channel=${dstvApp.channel.trim()}&Language=${dstvApp.language}&Sessionkey=${app.UserSessionKey}`;let claimRewardUrl=dstvApp.ThanksAPIBaseUrl+claimRewardQueryString;site.trigger('getpostdata',claimRewardUrl,'GET','application/json',"Bearer "+self.token,'','','ClaimReward',self.onClaimSuccess,self.onClaimError);})}
self.onClaimSuccess=function(data){if(dstvApp.ClaimDetails&&dstvApp.ClaimDetails.responseMessage.toLowerCase().includes('expired'))
{console.log('Error on claim product API call');site.factory.ShowModelPopup('error','Session expired.','Redirecting you to Rewards Category Page','',false,true);window.setTimeout(function(){window.location=dstvApp.DstvThanksURL;},5000);}
else
{console.log('claim successful');HandleClaimedTermsAndConditions();self.update();$("#claim-overlay").modal("show");return false;}
site.factory.CaptureFeedback('DSTVREWARDS_'+app.customernumber);}
self.onClaimError=function(data){console.log('Error on claim product API call');if(data.responseJSON&&data.responseJSON.StatusCode==404)
{site.factory.ShowModelPopup('error','Error!',data.responseJSON.Message.split(",")[0].replace(/"/g,''),'',false,true);site.factory.CaptureFeedback('DSTVREWARDS_'+app.customernumber);}
else
{$("#claim-overlay .close-link").click();site.factory.ShowModelPopup('error','Session expired.','Redirecting you to Rewards Category Page','',false,true);window.setTimeout(function(){window.location=dstvApp.DstvThanksURL;},5000);}}
function sliderpackagegroup(){var valuegrouppack=0;if(app.packagesArray.length>1){valuegrouppack=app.packagesArray.length-1;}
$('.group-category-area').slick({appendArrows:'.arrows-group-package',infinite:true,speed:300,slidesToShow:app.packagesArray.length>=5?valuegrouppack:app.packagesArray.length,slidesToScroll:1,prevArrow:'<span class="slick-prev slick-arrow" style="display: inline-block;">←</span>',nextArrow:'<span class="slick-next slick-arrow" style="display: inline-block;">→</span>',responsive:[{breakpoint:1024,settings:{slidesToShow:1,slidesToScroll:1,infinite:true,dots:true}},{breakpoint:600,settings:{slidesToShow:2,slidesToScroll:1}},{breakpoint:480,settings:{slidesToShow:1,slidesToScroll:1}}]});}
function idchange(){var plusid=$(".card-package-icon ").attr('id');var plusids=plusid.replace(" +","-plus");$(".card-package-icon").addClass(plusids);$(".group-category-name").each(function(){var groupplusid=$(this).attr('id');var groupplusids=groupplusid.replace(" +","-plus");var testclass=$(this).find("span").addClass(groupplusids);console.log(testclass);});}});riot.tag2('tag-rewards-details','<div class="container discount-area"><div class="col-sm-8 col-sm-push-2 text-center trem-about-text-main"><div class="text-holder p-3 p-sm-2"><div class="discount-sec"><div class="col-md-5 col-sm-5 aboutTitle"><div class="img"><img style="width: 126px; height: 131px;" src="data:image/png;base64, {opts.productToClaim.rewardPartnerLogo}" alt="" data-udi="umb://media/3ee77bda38c74011939d6e3d40ce21d1">&nbsp;</div></div><div class="col-md-7 col-sm-7 aboutText" style="text-align: left;"></div><div class="col-md-7 col-sm-7 aboutText" style="text-align: left;"></div><div class="col-md-7 col-sm-7 aboutText" style="text-align: left;"></div></div></div></div></div><div class="col-md-7 col-sm-7 aboutText" style="text-align: left;" id="rwdDesc"><tag-raw content="{opts.productToClaim.rewardDescription}"></tag-raw></div><div class="container get-it-now"> <a if="{!app.ShowAllCategories}" href="javascript:void(0)" id="btnClaimReward" class="btn btn-darkblue pull-right">{claimNowCaption}</a></div><div class="termsConditions"><div class="container"><h3>{langTranslateApp.rewardTermsAndConditions}</h3> <div class="term-list-area"><tag-raw content="{opts.productToClaim.termsAndConditions}"></tag-raw></div> </div></div><div class="modal fade claim" id="claim-overlay" role="dialog"><div class="modal-dialog login-box"><div class="modal-content claim-content "><div class="modal-header"><button type="button" class="close close-link no-print" data-dismiss="modal">&times;</button><div class="logo-section"><div class="logo-img"><img src={rewardPartnerLogoURL}></div><h3><span class="voucher-amount">{ClaimDetails.list[0].ruleRewardPartnerDetail}</span><br> your voucher is valid till <span class="voucher-date">{ClaimDetails.list[0].expiryDate}</span><br> <span class="terms-text">Cost services may occur</span></h3> </div></div><div class="modal-body"><style>@media print{ .no-print, .no-print *{display: none !important;}}</style><form><div class="claim-fields"><div><button class="no-print" type="button" id="smsVoucher" onClick={SendVoucherSms} data-backdrop="static" data-keyboard="false">SMS</button><button type="button" class="print-button no-print" onClick="{PrintPage}">Save as PDF</button><span class="sms-text hidden">Voucher number : <strong>{ClaimDetails.list[0].voucherNumber}</strong> <span class="no-print">will be sent to your mobile number.</span> </span></div><div class="right" id="parsedHtml"><h3>Terms of use</h3> <div class="term-list-popup"><!--{dstvApp.ClaimDetails.termsHtmlObject}--><!--Terms and conditions are added here dynamically by Jquery--></div><div><a href="{window.culture}/dstv-thanks"><button class="no-print" type="button">View more specials</button></a></div></div></div></form></div></div></div></div><div class="modal fade sucess-popup" id="sucess-overlay" role="dialog"><div class="modal-dialog login-box"><div class="modal-content sucess-content "><div class="modal-header"><button type="button" class="close close-link" data-dismiss="modal">&times;</button><div class="logo-section"><img src={rewardPartnerLogoURL}></div></div><div class="modal-body"><div class="message"><h2>Success</h2> <h3>Voucher number <strong>{ClaimDetails.list[0].voucherNumber}</strong> has been sent to your cell number<br> Thank you for using <strong>DStv Thanks</strong> </h3> <a href="{window.culture}/reward-list"><button type="button">More Vouchers</button></a></div></div></div></div></div>','tag-rewards-details,[riot-tag="tag-rewards-details"],[data-is="tag-rewards-details"]{ visibility: visible; display: block; }','',function(opts){var self=this;self.claimNowCaption=app.loggedin?langTranslateApp.RewardGetItNow:langTranslateApp.rewardLoginToClaim;self.on('mount',function(){HandleClaimButtonClick();});function HandleClaimedTermsAndConditions(){if(self.ClaimDetails.list[0].termsandCondtions){var str=self.ClaimDetails.list[0].termsandCondtions;var html=$.parseHTML(str);if($('#parsedHtml').has('ol').length<1)
{$('.term-list-popup').append(html);}}}
function HandleClaimButtonClick(){$("#btnClaimReward").click(function(e){console.log('claim clicked : '+this.id);if(app.loggedin){self.ClaimMyReward(opts.productToClaim);}
else{e.preventDefault();$("#rewardsTCModal").modal('hide');riot.mount('tag-sign-in',{returnURL:dstvApp.DstvThanksURL});}});};var areaID='claim-overlay';self.PrintPage=function(){var printContent=document.getElementById(areaID);var WinPrint=window.open('','','width=900,height=650');WinPrint.document.write(printContent.innerHTML);WinPrint.document.close();WinPrint.focus();WinPrint.print();WinPrint.close();}
self.ClaimMyReward=function(productToClaim){site.factory.GetJWT().then(function(token){self.token=token;let claimRewardQueryString=`ClaimReward?RewardId=${productToClaim.rewardId}&Country=${dstvApp.country}&BusinessUnit=${dstvApp.businessunit}&Channel=${dstvApp.channel.trim()}&Language=${dstvApp.language}&Sessionkey=${app.UserSessionKey}`;let claimRewardUrl=dstvApp.ThanksAPIBaseUrl+claimRewardQueryString;site.trigger('getpostdata',claimRewardUrl,'GET','application/json',"Bearer "+self.token,'','','ClaimReward',self.onClaimSuccess,self.onClaimError);})}
self.onClaimSuccess=function(data){self.ClaimDetails=data;self.update();if(self.ClaimDetails&&self.ClaimDetails.responseMessage.toLowerCase().includes('expired'))
{console.log('Error on claim product API call');$("#claim-overlay .close-link").click();site.factory.ShowModelPopup('error','Session expired.','Redirecting you to Rewards Category Page','',false,true);window.setTimeout(function(){window.location=dstvApp.DstvThanksURL;},5000);}
else if(self.ClaimDetails.list&&self.ClaimDetails.list.length)
{console.log('claim successful');$("#claim-overlay .close-link").click();self.rewardPartnerLogoURL="data:image/png;base64, "+self.ClaimDetails.list[0].rewardPartnerLogo;HandleClaimedTermsAndConditions();$("#claim-overlay").modal("show");riot.update();}
else{console.log(self.ClaimDetails.responseMessage);$("#claim-overlay .close-link").click();site.factory.ShowModelPopup('error','Oops!',self.ClaimDetails.responseMessage,'This seems that you tried to claim same reward multiple time.',false,true);}
site.factory.CaptureFeedback('DSTVREWARDS_'+app.customernumber);}
self.onClaimError=function(data){console.log('Error on claim product API call');if(data.responseJSON&&data.responseJSON.StatusCode==404)
{site.factory.ShowModelPopup('error','Error!',data.responseJSON.Message.split(",")[0].replace(/"/g,''),'',false,true);site.factory.CaptureFeedback('DSTVREWARDS_'+app.customernumber);}
else
{$("#claim-overlay .close-link").click();site.factory.ShowModelPopup('error','Session expired.','Redirecting you to Rewards Category Page','',false,true);window.setTimeout(function(){window.location=dstvApp.DstvThanksURL;},5000);}}
self.SendVoucherSms=function(){var mobileNumber=self.categoryWithProducts.list[0].msisdn;if(mobileNumber){var voucherSmsQueryString="SendRewardbysms"+`?Country=${dstvApp.country}&BusinessUnit=${dstvApp.businessunit}&Channel=${dstvApp.channel}&Language=${dstvApp.language}`;var sendVoucherSmsUrl=dstvApp.ThanksAPIBaseUrl+voucherSmsQueryString;var reqBody={"rewardId":self.ClaimDetails.list[0].rewardId,"language":dstvApp.language,"msisdn":mobileNumber,"sessionKey":app.UserSessionKey};site.trigger('getpostdata',sendVoucherSmsUrl,'POST','application/json',"Bearer "+localStorage["JWTTokenKey"],'',reqBody,'SmsVoucher',self.onSmsVoucherSuccess,self.onSmsVoucherError);}}
self.onSmsVoucherSuccess=function(){console.log('Voucher sent success callback');self.update();$("#sucess-overlay").modal("show");return false;}
self.onSmsVoucherError=function(){}});riot.tag2('tag-addons-packages','<section class="pt-7 pb-0 compare-header"><div class="container"><yield></yield></div></section><section class="pb-4 pt-0"><div class="container"><div class="row pb-2 pt-5 change-package compare-packages"><div class="col-xs-12"><ul if="{model}" class="packages"><li each="{package, index in model.entities}"><div class="compare"><div><div class="package-block" onclick="{() => selectpackage(package);}"><div class="package-image img-bg" if="{package.properties.ProductImage != \'\'}" riot-style="background-image: url({package.properties.ProductImage})"></div><div class="package-image img-bg" if="{package == undefined || package.properties.ProductImage == \'\'}"></div><div class="package-name "> {package.properties.PackageName.replace(\'DStv \',\'\')} </div><div class="pricebar" style="margin-top:-7px"><div class="channels" if="{package}">{package.properties.ChannelCount} {langTranslateApp.pkgSliderChannels}</div><div class="pack-price" if="{package.properties.Price}">{dstvApp.countrycurrency.toUpperCase() + " " + package.properties.Price + package.properties.PriceLetter}</div></div><span class="icon-Tick_large check-select {\'selected\' : selected1 == package || selected2 == package} "></span></div></div></div></li></ul></div></div></div></section><section class="bg-dark compare-packs" id="comaparesection" if="{selected1 || selected2}"><div class="container"><div class="row"><div class="col-sm-6" if=""><div if="{selected1 != undefined}"><div class="package-block"><div class="package-image img-bg" if="{selected1.properties.ProductImage != \'\'}" riot-style="background-image: url({selected1.properties.ProductImage})"><div class="package-logo"><img riot-src="{selected1.properties.PackageLogo}"></div></div><div class="pricebar" style="margin-top:-7px"><div class="channels" if="{selected1}">{selected1.properties.ChannelCount} channels</div><div class="pack-price" if="{selected1.properties.Price}">{dstvApp.countrycurrency.toUpperCase() + " " + selected1.properties.Price + selected1.properties.PriceLetter}</div></div><div class="package-details"><div><tag-raw class="tag-row" content="{selected1.properties.Description}"></tag-raw></div><div if="{selected1.properties.ProductMoreLink && selected1.properties.ProductMoreLink != \'\'}"><a href="{selected1.properties.ProductMoreLink}" class="btn btn-default btn-rounded anim-btn" riot-style="background-color: {selected1.properties.PackageColor}"><span class="anim-span"></span>{langTranslateApp.comparePkgFindOutMore}</a></div></div></div></div></div><div class="col-sm-6"><div if="{selected2 != undefined}"><div class="package-block"><div class="package-image img-bg" if="{selected2.properties.ProductImage != \'\'}" riot-style="background-image: url({selected2.properties.ProductImage})"><div class="package-logo"><img riot-src="{selected2.properties.PackageLogo}"></div></div><div class="pricebar"><div class="channels" if="{selected2}">{selected2.properties.ChannelCount} {langTranslateApp.pkgSliderChannels}</div><div class="pack-price" if="{selected2.properties.Price}">{dstvApp.countrycurrency.toUpperCase() +" "+ selected2.properties.Price + selected2.properties.PriceLetter}</div></div><div class="package-details "><div class="content-comp"> <tag-raw content="{selected2.properties.Description}"></div></tag-raw><div if="{selected2.properties.ProductMoreLink && selected2.properties.ProductMoreLink != \'\'}"><a href="{selected2.properties.ProductMoreLink}" class="btn btn-default btn-rounded anim-btn" riot-style="background-color: {selected2.properties.PackageColor}"><span class="anim-span"></span>{langTranslateApp.comparePkgFindOutMore}</a></div></div></div></div></div></div><div class="text-center compare-channels-heding">{langTranslateApp.compareCh}</div><div class="text-center"><a href="#main-scroll" class="next nextbounce animatedbounce" onclick="() => slideToElement(#compare-channels);" ><span class="fa fa-angle-down"></span></a></div></div></section><section class="compare-channels mb-10" id="main-scroll" if="{selected1 || selected2}"><div class="container"><div class="row"><div class="col-sm-12"><div class="tableheadings"><table class="table" if="{selected1 || selected2}"><tr><th colspan="2">{langTranslateApp.pkgSliderChannels}</th><th class="has-channel" if="{selected1}"><span>{selected1.properties.PackageName.replace(\'DStv \',\'\')}</span></th><th class="has-channel" if="{selected2}"><span>{selected2.properties.PackageName.replace(\'DStv \',\'\')}</span></th></tr><tr class="hide-all"><td class="channel-logo"></td><td class="channel-name"></td><td class="has-channel" if="{selected1}"><span></span></td><td class="has-channel" if="{selected2}"><span></span></td></tr></table></div><div class=""><div class="accordion-area"><div class="panel-group" id="channels-group"><div class="panel panel-default" each="{genre, i in allchannelgenres.entities}"><a data-toggle="collapse" data-parent="#channels-group" href="#{genre.properties.UrlName}" class="panel-heading uppercase" aria-expanded="true">{genre.properties.GenreName}</a><div id="{genre.properties.UrlName}" class="panel-collapse collapse {\'in\' : i == 0}" aria-expanded="true" style=""><div class="panel-body"><div class="content p-xs-0"><table class="table channels-table" if="{channels && channels.entities}"><tr each="{channel in channels.entities}" if="{_.indexOf(channel.properties.ChannelGenre, parseInt(genre.properties.Id)) > -1 && _.indexOf(channel.properties.ChannelPackages, parseInt(selected1.properties.Id)) > -1}"><td class="channel-logo"><img riot-src="{channel.properties.ChannelLogo}"></td><td class="channel-name">{channel.properties.ChannelName} ({channel.properties.ChannelNumber})</td><td class="has-channel" if="{selected1}"><span class="{_.indexOf(channel.properties.ChannelPackages, parseInt(selected1.properties.Id)) > -1 ? \'icon-Tick_large\' : \'icon-Close_large not\'} "></span></td><td class="has-channel" if="{selected2}"><span class="{_.indexOf(channel.properties.ChannelPackages, parseInt(selected2.properties.Id)) > -1 ? \'icon-Tick_large\' : \'icon-Close_large not\'} "></span></td></tr></table></div></div></div></div></div></div></div></div></div></div></section><br>','tag-addons-packages,[riot-tag="tag-addons-packages"],[data-is="tag-compare-packages"]{ visibility: visible; }','',function(opts){var self=this;self.model={};self.storedData="addonpackages";self.AddonPackageCodes=["ASIA3KU","GWALLE36","FRN15E36","ASIAE36","FTAPLE","FRN7E36","FRN15E36","PRWE36","NNJ2E36"];self.on('before-mount',function(){if(self.storedData&&app[self.storedData]!=undefined){var data=app[self.storedData];self.model=data;}
else{site.trigger("setdata","/packages/ujson?descendants=Package&where=canCompare%20eq%20true&select=code,description,Name,newPrice,packageColor,Id,packageLogo,packageName,price,productImage,productDetail,description,currency,channelCount,PriceLetter,canCompare&resolvemedia=productImage,packageLogo"+window.cdv,"GET","",self.storedData,self.storedData,10);}
if(app["allchannels"]!=undefined){app.allchannels.entities.sort(function(a,b){return a.properties.ChannelNumber-b.properties.ChannelNumber});var availchannels=app.allchannels.entities.filter(item=>item.properties.ChannelPackages.length>-1);var unavailchannels=app.allchannels.entities.filter(item=>!item.properties.ChannelPackages.length);var allavailunavailchannels=availchannels.concat(unavailchannels);app.allchannels.entities=[];app.allchannels.entities=allavailunavailchannels;self.channels=app["allchannels"];}
else{site.trigger("setdata",window.culture+"/channels/ujson?descendants=Channel&select=channelName,ChannelGenre,ChannelPackages,ChannelLogo,AudioChannel,ChannelNumber&resolveToIds=ChannelGenre,ChannelPackages&resolveMedia=ChannelLogo"+window.cdv,"GET","","allchannels","allchannels",10);}
if(app["allchannelgenres"]!=undefined){self.allchannelgenres=app["allchannelgenres"];}
else{site.trigger("setdata","/channel-genres/ujson?descendants=ChannelGenre&select=Id,GenreName,UrlName"+window.cdv,"GET","","allchannelgenres","allchannelgenres",10);}});self.on('mount',function(){setTimeout(function(){self.setSameHeight('.package-image')},200);})
self.selectpackage=function(packageValue){if(self.selected1==packageValue||self.selected2==packageValue){if(self.selected1==packageValue){self.selected1=undefined;}
else{self.selected2=undefined;}}
else{if(self.selected1==undefined){self.selected1=packageValue;}
else if(self.selected1!=undefined&&self.selected2==undefined){self.selected2=packageValue;}}
self.message="";self.state="processing";self.update();if(self.selected1!=undefined&&self.selected2!=undefined){slideToElement('#comaparesection');$('.panel-group').on('shown.bs.collapse',function(){var panel=$(this).find('.in');var prevObjPos=panel.prevObject?panel.prevObject.offset().top:panel.offset().top
$('html, body').animate({scrollTop:panel.offset().top-150},500);});$('#channels-group').find('div[class="panel-collapse collapse in"]').prev('a').attr('class','panel-heading uppercase');}
$(".compare .package-block").click(function(){var src=$('.package-logo img').attr('src').split("/");var imgname=src[3];var srcimg=$.trim(imgname);var img="logo_greatwallmdpi.svg";var img1=$.trim(img);var frech_tounch="layer-2.png";var frech_tounchimg=$.trim(frech_tounch);if(srcimg!=img1){$(".package-logo img").addClass("greatwall-icon");}else{$(".package-logo img").addClass("icon");}
if(srcimg==frech_tounchimg){$(".package-logo img").addClass("frechimg");}else{$(".package-logo img").addClass("icon");}});setTimeout(function(){self.setSameHeight('.package-details')},200);setTimeout(function(){self.setSameHeight('.package-logo')},200);}
site.on(self.storedData+"-loading-success",function(data,result){if(result){self.model=data;self.update();setTimeout(function(){self.setSameHeight('.package-image')},200);}
else{window.consolelog("umbraco comparepackages data failed");}});site.on(self.storedData,function(data,result){if(result){self.model=data;self.update();setTimeout(function(){self.setSameHeight('.package-image')},200);}else{console.log("failed to get data",data);}});site.on("allchannels-loading-success",function(data,result){if(result){self.channels=data;self.update();}else{console.log("failed to get channel data",data);}});site.on("allchannelgenres"+"-loading-success",function(data,result){if(result){self.allchannelgenres=data;self.update();}else{console.log("failed to get channel genres data",data);}});self.setSameHeight=function(item){var theseItems=$(item);var maxHeight=0;$(theseItems).css("height","auto");if($(window).width()>=768){theseItems.each(function(){maxHeight=Math.max(maxHeight,$(this).outerHeight());});theseItems.css({height:maxHeight+'px'});}};});riot.tag2('tag-sign-in','<div class="modal fade dashboardModal" id="signInModalPopup" role="dialog"> <button type="button" onclick="{OnClose}" class="close btnClose" data-dismiss="modal"><i class=" icon-Close_M"></i></button> <div class="webform container modal-dialog feedback-dialog"> <div class="modal-content"> <div class="modal-body"> <div class="loginPage bodyClass"> <section id="section1" class="SignInSection1"> <div class="" id="manageAcDiv" if="{showLoginMethod}"> <h1 class="sectionTitle">{ langTranslateApp.loginHeader1 }<span class="dstvTextSpan">{ " "+langTranslateApp.loginHeader2 } </span>{ langTranslateApp.loginHeader3 }</h1> <h3 id="fastH3">{ langTranslateApp.loginSubHeader }</h3> <div class="text-center padding20">{ langTranslateApp.loginWith }</div> <div id="homeLoginButtons" class="text-center"> <div class="col-sm-6"><button type="button" class="btn btn-white anim-btn" onClick="{ShowMobileLogin}"><span class="anim-span"></span><span class="spanMobile">{ langTranslateApp.loginMobile }</span> <img class="mobSurnArrow hidden" src="/media/3929/white-arrow.png" width="25"></button></div> <div class="col-sm-6"><button type="button" class="btn btn-white anim-btn" onClick="{ShowSurnameLogin}"><span class="anim-span"></span><span class="spanSurname">{langTranslateApp.loginSurname}</span> <img class="mobSurnArrow hidden" src="/media/3930/gray-arrow.png" width="25"></button></div> </div> </div> <div if="{showLogin}" id="loginDiv"> <h1 class="sectionTitle"> <!--{ langTranslateApp.loginLogIn1 }--> </h1> <h3> <strong>{langTranslateApp.popUpLogin}</strong> {langTranslateApp.popUpToYourAccount} <!--{ langTranslateApp.loginEnterDetails }--> </h3> <div id="formLoginDiv"> <div class="form-group"> <fieldset class="Select-your-city-field"> <select id="ddlCountry" class="form-control" name="CountryDropdown" onchange="{onCountryDropdownChange}"> <option if="{allCountryCultureDetails}" each="{country, index in allCountryCultureDetails}" id="" value="{country.countryAbbreviation}-{country.countryLanguageAbbreviation}">{country.countryNameLanguage}</option> </select> </fieldset> </div> <div class="form-group"> <span class="login-info" id="snTooltip" onclick="{ShowSurnameToolTip}"></span> <fieldset class="surnameMobile-field" if="{loginBySurname}"> <div id="smartTooltip1">{ langTranslateApp.loginEnterSurname }</div> <input type="text" autocomplete="off" class="form-control input-lg sign-mobile" id="signIn_surname" name="signIn_surnameOrMobile" onkeyup="{OnKeyUp}" placeholder="{langTranslateApp.popUpSurname}" /> </fieldset> <fieldset if="{loginByMobile}"> <div id="smartTooltip1">{ langTranslateApp.loginEnterMobile }</div> <span style="font-size: 18px;font-weight: 700;">+{dstvApp.countryCode}</span><input placeholder="Mobile" type="text" autocomplete="off" style="width:80%; display:inline-block; padding-left: 2px !important;" class="form-control input-lg sign-mobile" maxlength="14" id="signIn_mobile" name="signIn_surnameOrMobile" onkeyup="{OnKeyUp}" onkeypress="{ValidateNumeric}" /> </fieldset> </div> <div class="form-group"> <span class="login-info" id="smTooltip" onclick="{ShowSmartcardToolTip}"></span> <fieldset class="smartCard-field"> <div id="smartTooltip">{ langTranslateApp.loginNumValidation }</div> <input type="text" autocomplete="on" class="form-control input-lg sign-card" onkeyup="{OnKeyUp}" onkeypress="{ValidateNumeric}" onpaste="{onPaste}" value="{smartcard}" id="signIn_smartCardNumber" name="signIn_smartCardNumber" maxlength="11" placeholder="{langTranslateApp.popUpSmartcard}" /> </fieldset> </div> <div id="signIn_error" class="sign-in-error hidden"> <i class="glyphicon glyphicon-flag"></i> <span></span> </div> <div class="form-group" style=""> <div class="" style="text-align: left;margin-left: 10px;"> <input type="checkbox" value="lsRememberMe" id="rememberMe"> <label for="rememberMe" style="font: normal normal normal 14px/19px Roboto; letter-spacing: 0px;">{ langTranslateApp.rememberMe }</label> </div> </div> <div class="resetLoginLinks" if="{false}"> <small> <a href="javascript:void(0);" onclick="{ShowForgotPassword}" class="linkBlue"> { langTranslateApp.loginForgotSmartCard }? </a></small> </div> <div class="btnDiv"> <button class="btn btn-white sign-in-varify anim-btn" data-loading-text="<i class=\'fa fa-spinner fa-spin pull-right \'></i> {langTranslateApp.loginPleaseWait}" id="btnSignInWithEazy" onclick="{OnLogin}" disabled="{!enableSignIn}"><span class="anim-span"></span><span class="spanLoginText">{ langTranslateApp.loginLogIn1 }</span><i class="fa fa-angle-right loginIcon"></i> </button> <div style="display:none;"> <div> <p>OR</p> </div> <div class="connectLoginLink"><a href="https://connect.dstv.com/registration/signin?response_type=id_token%20token&amp;redirect_uri=https://n" target="_blank" class="connect-logo"><span>Login with your connect ID</span></a></div> <fieldset class="devider hidden"> <legend class="newToDStv">{ langTranslateApp.loginNewDStv }?</legend> <a class="btn btn-blue" target="_blank" href="https://connect.dstv.com/4.1/en-ZA/Register?returnUrl=@domain"><span class="spanRegText">{ langTranslateApp.loginRegisterNow }</span><i class="fa fa-angle-right regIcon hidden"></i></a> </fieldset> </div> </div> <div class="form-group" style=""> <div class="" style="text-align: left;margin-left: 10px;"> <span class="title-head">{ langTranslateApp.termsconditionname }</span> <span class="title-links"><a href="{dstvApp.termsandcondition.tcLink}" style="font-weight: 500;" target="_blank">{langTranslateApp.tclinkHandle}</a></span></div> </div> </div> </div> <!--Forgot Smartcard section--> <div id="smFound" if="{showSmartcardFound}"> <div class="popup success"> <div class="row"> <h2>{langTranslateApp.popUpSmartcardFound}!!</h2> <h4>{langTranslateApp.popUpYourSmartcardNumbIs} </h4> <kbd>{smCardFound}</kbd><br> <div class="sm-found-copy-text">{langTranslateApp.popUpCopyPaste}</div> <div class="btnDiv"><button class="btn btn-white sign-in-varify anim-btn" id="btnSMFoundLogin" onclick="{ShowSurnameLogin}"><span class="anim-span"></span><span class="spanLoginText">{langTranslateApp.popUpTryNow}</span><i class="fa fa-play-circle loginIcon"></i> </button></div> </div> </div> </div> <div id="loginRetry" if="{showRetry}"> <h1 class="sectionTitle">Oops!</h1> <br> <h3 id="loginRetryPrompt">{langTranslateApp.loginErrorHeader}</h3> <div id="formLoginDiv"> <div class="btnDiv"><button class="btn btn-white sign-in-varify anim-btn" id="btnSignInRetry" onclick="{ShowSurnameLogin}"><span class="anim-span"></span><span class="spanLoginText">{langTranslateApp.dashboardRetry}</span><i class="fa fa-angle-right loginIcon"></i> </button></div> </div> </div> <div id="findSMRetry" if="{showFindSmartcardRetry}"> <div if="{!showAttemptedMSG}"> <h1 class="sectionTitle">{ langTranslateApp.loginSmartCardNotFound }</h1> <br><!-- <h3>{ langTranslateApp.loginSmarCardNotFoundError }</h3> --> <h4>{ langTranslateApp.loginEnterCorrectNumber }</h4> <h4> <b>You have {remainingAttempt} attempts remaining. </b></h4> <div id="formLoginDiv"> <div class="btnDiv"><button class="btn btn-white sign-in-varify anim-btn" id="btnfindSMRetry" onclick="{OnFindSMRetry}"><span class="anim-span"></span><span class="spanLoginText">{langTranslateApp.dashboardRetry}</span><i class="fa fa-angle-right loginIcon"></i> </button></div> </div> </div> <div if="{showAttemptedMSG}"> <h1 class="sectionTitle" style="font-weight: 500;">TRY AGAIN LATER!</h1> <br> <h4>The Smartcard number could not be retrieved.</h4> <h4>You have exhausted your limit of attempts (3). Please try after 30 minutes or Contact our Call Center.</h4> <div id="formLoginDiv"> <div class="btnDiv"><a class="btn btn-white sign-in-varify anim-btn" id="btnfindSMRetry" href="{window.culture}/{langTranslateApp.subMenuContactUsLink}"><span class="anim-span"></span><span class="spanLoginText">{langTranslateApp.subMenuContactUs}</span><i class="fa fa-angle-right loginIcon"></i> </a></div> </div> </div> </div> <div if="{showForgotPassword}" id="formForgotDiv"> <div class="" if="{!showAttemptedMSG}"> <h1 class="sectionTitle">{ langTranslateApp.loginRetrieveDetails }</h1> <h3 class="forgotSmartTitle">{ langTranslateApp.loginEnterYourMobile }</h3> <div class="form-group forgotInput"> <fieldset> <div id="smartTooltipF">{ langTranslateApp.loginNumValidation }!!</div> <span style="font-size: 18px;font-weight: 700;">+{dstvApp.countryCode}</span><input type="text" style="width:80%; display:inline-block;padding-left: 2px !important;" class="form-control input-lg" required maxlength="14" onkeypress="{ValidateNumeric}" id="MobileNum" placeholder="{langTranslateApp.popUpMobileNumber}" /> </fieldset> </div> <div class="btnDiv"><button class="btn btn-white anim-btn" id="btnFindSmartcard" data-loading-text="<i class=\'fa fa-spinner fa-spin pull-right \'></i> {langTranslateApp.loginPleaseWait}" onclick="{SearchForSmartcard}"><span class="anim-span"></span><span class="spanLoginText">{ langTranslateApp.loginFind } </span><i class="fa fa-angle-right loginIcon"></i></button></div> <fieldset class="devider forgot-devider"> <legend class="newToDStv">{ langTranslateApp.loginBackToLogin }</legend> <a class="btn btn-white anim-btn" onclick="{ShowSurnameLogin}" href="javascript:void(0);"><span class="anim-span"></span><span class="spanRegText">{ langTranslateApp.loginLogIn2 }</span></a> </fieldset> </div> <div if="{showAttemptedMSG}"> <h1 class="sectionTitle" style="font-weight: 500;">TRY AGAIN LATER!</h1> <br> <h3 style="font-size: 16px;margin-bottom: 10px;line-height: 30px;">You have exhausted your limit of attempts (3). Please try after 30 minutes or Contact our Call Center.</h3> <div id="formLoginDiv"> <div class="btnDiv"><a class="btn btn-white sign-in-varify anim-btn" id="btnfindSMRetry" href="{window.culture}/{langTranslateApp.subMenuContactUsLink}"><span class="anim-span"></span><span class="spanLoginText">{langTranslateApp.subMenuContactUs}</span><i class="fa fa-angle-right loginIcon"></i> </a></div> </div> </div> </div> <div id="gotvcustomer" if="{showGOtvMessage}"> <div class="popup success"> <div class="row"> <img class="gotv-logo" src="https://eazy.gotvafrica.com/images/eazy-logo.png"> <h2>Hi {GOtvCustomer}</h2> <h4>We see that you are using your GOtv IUC(smartcard) number to login, unfortunately the New GOtv website is not available. </h4> <p style="white-space: pre-line;">Redirecting to {GOtvURL}</p> <div class="btnDiv"><button class="btn btn-white sign-in-varify anim-btn" onclick="{RedirectToGOtv}" id="btnGOtv"><span class="anim-span"></span><span class="spanLoginText">Go Now</span><i class="fa fa-play-circle loginIcon"></i> </button></div> </div> </div> </div> </div> </section> </div> </div> </div></div></div>','tag-sign-in,[riot-tag="tag-sign-in"],[data-is="tag-sign-in"]{ visibility: visible; } ','',function(opts){var self=this;self.showLoginMethod=true;self.showLogin=false;self.loginBySurname=false;self.loginByMobile=false;let smartTooltip='#smartTooltip';let mobileToolTip='#smartTooltip1';let findMobileToolTip='#smartTooltipF';let signIn_mobile='#signIn_mobile';let signIn_surname='#signIn_surname';let smartcardObj='#signIn_smartCardNumber'
let btnSignInWithEazy='#btnSignInWithEazy'
let rememberMe='#rememberMe'
let mobileNum='#MobileNum';let ddlCountry='#ddlCountry';let emptystring='';self.retryButtonShown=false;self.smartcard=null;self.on('before-mount',function(){if(!(dstvApp.liveTargetCountries.includes(dstvApp.countryabbreviation)||dstvApp.SelfServiceEnabledCountries.includes(dstvApp.countryabbreviation)))
window.location=`https://eazy.dstv.com/en/${dstvApp.countryabbreviation}/account`
if(app.loggedin)
window.location=dstvApp.DashboardURL;});self.on('mount',function(){if(!self.opts.loginfromchat){$('#signInModalPopup').modal('show');}
else{$('#chatLogin  #signInModalPopup').modal('show');$('body').removeClass('modal-open')}
$(document).ready(function(){$('.sign-card').on("input",function(){$(this).val($(this).val().replace(/ /g,""));});});self.InitialSetUp();self.ShowSurnameLogin();self.GenerateJWT();self.loadCountryConfigData();self.GetCacheValuesForMe();self.update();});self.OnLogin=function(e){console.log('Login : login...')
if(self.IsValid()){$(btnSignInWithEazy).button('loading');let mobile=self.loginByMobile?$(signIn_mobile).val():emptystring;let surname=self.loginBySurname?$(signIn_surname).val():emptystring
if(/\s*$/.test(surname)){let tempSurnameMobile=surname.split(' ');if(self.IsNumeric(tempSurnameMobile[1])){surname=tempSurnameMobile.join("")}
else{surname=tempSurnameMobile[tempSurnameMobile.length-1]}}
if(self.IsNumeric(surname)){mobile=surname.trim();surname='';}
let smartcard=$(smartcardObj).val().substr(0,10);self.surnameOrMobile=$(signIn_surname).val();self.smartcardNumber=$(smartcardObj).val();let data={country:dstvApp.country,surname:surname,mobileNumber:mobile,smartCardNumber:smartcard}
let url=`${dstvApp.DSOAPIUrl}apilogin/api/v1/Login?BusinessUnit=${dstvApp.businessunit}&Channel=${dstvApp.channel}`;if(!self.token){site.factory.GetJWT().then(function(token){self.token=token;site.factory.Post(url,data,self.token,self.onLoginSuccess,self.onLoginError)})}
else
site.factory.Post(url,data,self.token,self.onLoginSuccess,self.onLoginError)}
else{e.preventDefault();e.stopImmediatePropagation()}
self.showLoader=false;}
self.setDualCurrencyFlag=function(){console.log('On setDualCurrencyFlag : Post login');let arrayDualCurrencyContries=[];let arrayDualCurrencies=[];for(var i=0;i<dstvApp.DualCurrenciesList.length;i++){var split=dstvApp.DualCurrenciesList[i].split("-");arrayDualCurrencyContries.push(split[0]);arrayDualCurrencies.push(split[1]);}
if(arrayDualCurrencies.includes(dstvApp.countrycurrency.toLowerCase())){app.dualCurrencyApplicable=true;window.SessionSave("app",app);}
else{app.dualCurrencyApplicable=false;window.SessionSave("app",app);}}
self.onLoginSuccess=function(data){console.log('Login : success')
self.firstName=data.PersonalDetail.FirstName;self.surname=data.PersonalDetail.Surname;app.customername=data.PersonalDetail.Title+' '+data.PersonalDetail.FirstName+' '+data.PersonalDetail.Surname;app.customername=app.customername.toUpperCase();if(data.BusinessUnit.toLowerCase().includes('gotv')){console.log('Login : GOtv customer')
self.GOtvCustomer=app.customername;self.GOtvURL=dstvApp.GOURL
self.HideAll();self.showGOtvMessage=true;self.update();return;}
app.loggedInBySmartcard=self.IsLoggedInBySmartcard();app.loggedin=true;app.customernumber=data.CustomerNumber;app.smartcard=self.smartcardNumber.substr(0,10);let paymentduedetails={properties:{surname:{value:self.surname},firstName:{value:self.firstName},customerNumber:{value:data.CustomerNumber}},entities:[]};app.paymentduedetails=paymentduedetails;app.customerDetails={ListOfAddress:data.ListOfAddress,ListOfEmail:(data.ListOfEmail||[]),ListOfPhoneNumber:(data.ListOfPhoneNumber||[]),PersonalDetail:data.PersonalDetail,};let emailID=app.customerDetails.ListOfEmail?app.customerDetails.ListOfEmail[0]:undefined;emailID=emailID?emailID.Email:'';let mobileNum=app.customerDetails.ListOfPhoneNumber.filter(x=>x.IsPrimary)[0];mobileNum=mobileNum?mobileNum.Number:'';let homeTel=app.customerDetails.ListOfPhoneNumber.filter(x=>x.Type=="Home")[0];homeTel=homeTel?homeTel.Number:'';let workTel=app.customerDetails.ListOfPhoneNumber.filter(x=>x.Type=="Work")[0];workTel=workTel>0?workTel.Number:'';let faxTel=app.customerDetails.ListOfPhoneNumber.filter(x=>x.Type=="Fax")[0];faxTel=faxTel>0?faxTel.Number:'';var customercontactdetails={"Title":app.customerDetails.PersonalDetail.Title,"FirstName":app.customerDetails.PersonalDetail.FirstName,"Surname":app.customerDetails.PersonalDetail.Surname,"EmailAddress":emailID,"MobileTel":mobileNum,"HomeTel":homeTel,"WorkTel":workTel,"FaxTel":faxTel};app.customercontactdetails=customercontactdetails;app.loadedcontactdetails=true;self.GetAmountToPay();self.setDualCurrencyFlag();if(self.IsRemember())
site.factory.RememberMe();else
site.factory.ClearCacheValuesForMe();}
self.onLoginError=function(err){console.log('Login : error')
$(btnSignInWithEazy).button('reset');self.ShowRetry();if(err.responseJSON&&err.responseJSON.StatusCode==500)
$("#loginRetryPrompt").html(`<span class="error-note">${langTranslateApp.genericTechnicalIssueMsg1} <u><a class="payments_errContactUs" href="${window.culture}/${langTranslateApp.subMenuContactUsLink}">${langTranslateApp.subMenuContactUs}</a></u> ${langTranslateApp.genericTechnicalIssueMsg2}</span>`);if(navigator.onLine){console.log('online');}else{document.getElementById("loginRetryPrompt").innerHTML="You appear to be offline";console.log('offline');}
self.retryButtonShown=true;}
self.GetAmountToPay=function(){console.log('Login : fetch amount to pay...')
let url=`${dstvApp.DSOAPIUrl}atp/api/v1/AmountToPay?country=${dstvApp.country}&customerNumber=${app.customernumber}&BusinessUnit=${dstvApp.businessunit}&Channel=${dstvApp.channel}`;site.factory.Get(url,self.token,self.onGetAmountToPaySuccess,self.onGetAmountToPayError)}
self.onGetAmountToPaySuccess=function(data){console.log('Login : fetch amount to pay completed')
app.paymentduedetails.properties.dueDate={value:data.DueDate.split('T')[0]};app.paymentduedetails.properties.amountToPay={value:Math.round(data.TotalAmountToPay.Value*100)/100}
if(dstvApp.DualCurrencyCountryList.includes(dstvApp.countryabbreviation))
app.paymentduedetails.properties.amountToPayEtb=data.TotalAmountToPay.LocalPrice?{value:Math.round(data.TotalAmountToPay.LocalPrice.Amount*100)/100}:null
app.paymentduedetails.properties.currencyCode={value:data.TotalAmountToPay.CurrencyCode}
if(data.Accounts){app.BOAccount=data.Accounts.filter(x=>x.AccountType=="Box Office")[0];app.IsBOCustomer=app.BOAccount&&Object.keys(app.BOAccount).length>0
app.accounts=data.Accounts.map(x=>({AccountNumber:x.AccountNumber,AccountType:x.AccountType}))
app.accountsInfo=data.Accounts;app.primaryaccountnumber=data.Accounts.filter(x=>x.IsDefault)[0].AccountNumber;}
else{app.accounts=[];app.BOAccount=[];app.IsBOCustomer=false;app.accountsInfo=[];app.primaryaccountnumber=0;}
window.SessionSave("app",app);if(!self.opts.loginfromchat){let dashboardURL=window.culture?dstvApp.DashboardURL:"\en-zm"+dstvApp.DashboardURL;window.location=opts.returnURL||dashboardURL}
else
self.liveChatLoginConfiguration();}
self.onGetAmountToPayError=function(err){console.log('Login : error while fetching amount to pay')
app.paymentduedetails.properties.dueDate={value:null};app.paymentduedetails.properties.amountToPay={value:null}
app.paymentduedetails.properties.currencyCode={value:null}
app.accounts=[];app.BOAccount=[];app.IsBOCustomer=false;app.primaryaccountnumber=0;window.SessionSave("app",app);if(!self.opts.loginfromchat){let dashboardURL=window.culture?dstvApp.DashboardURL:"\en-zm"+dstvApp.DashboardURL;window.location=opts.returnURL||dashboardURL}
else
self.liveChatLoginConfiguration();}
self.IsRemember=function(){return $(rememberMe).is(':checked')}
self.GetCacheValuesForMe=function(){var cachedData=site.factory.GetCacheValuesForMe();if(cachedData){$(signIn_surname).val(cachedData.sn);$(smartcardObj).val(cachedData.sm);$(rememberMe).prop('checked',true);$(ddlCountry).val(cachedData.cn).change()
self.onCountryDropdownChange();self.enableSignIn=true;self.EnableSignIn();jcf.refreshAll()}}
self.liveChatLoginConfiguration=function(){$('#loginLinkLabel').hide();$('#loginPopup').show();$('#loginPopupText').html(app.customername);if(window.location.pathname==window.culture||window.location.pathname==window.culture+"/")
$('#dashBoardHomeNav').css('display','none')
self.parent.configureChat();self.update();riot.update()
if(app.loggedin){$('#loginLinkLabel-NewHome span.login-icon').hide();}
else{$('#loginLinkLabel-NewHome span.login-icon').show();}}
self.RedirectToGOtv=function(){window.location=self.GOtvURL;}
self.SearchForSmartcard=function(e){console.log('Find Smartcard : Search by cell number...')
let mobile=($(mobileNum).val().trim());if(!mobile){$(findMobileToolTip).show();$(findMobileToolTip).html(langTranslateApp.loginEnterMobile)
e.stopImmediatePropagation()
return false;}
console.log('Find Smartcard : Checking number of attempts')
self.attempt=parseInt(site.factory.GetFindSmartcardAttempt());self.remainingAttempt=3-self.attempt;if(self.attempt>3){console.log('Find Smartcard : Max attempted')
self.onSearchForSmartcardError();return;}
mobile=dstvApp.countryCode+mobile;$('#btnFindSmartcard').button('loading');let url=dstvApp.APIUrl+`Customer/SearchByCellPhoneNumber?dataSource=${dstvApp.country}&cellPhoneNumber=${mobile}&vendorCode=${dstvApp.vendorcode}&language=&ipAddress=&businessUnit=${dstvApp.businessunit}`
site.factory.Post(url,null,null,self.onSearchForSmartcardSuccess,self.onSearchForSmartcardError)}
self.onSearchForSmartcardSuccess=function(data){console.log('Find Smartcard : Search by cell number completed')
console.log('Find Smartcard : Get products...')
if(data.length){let customer=data[data.length-1].CustomerNumber;var apiUrl='';apiUrl=dstvApp.APIUrl;let url=apiUrl+`Product/GetProducts?dataSource=${dstvApp.country}&customerNumber=${customer}&vendorCode=${dstvApp.vendorcode}&language=&ipAddress=&businessUnit=${dstvApp.businessunit}`
site.factory.Get(url,null,self.onGetProductsSuccess,self.onGetProductsError)}
else{self.onSearchForSmartcardError()}}
self.onSearchForSmartcardError=function(data){console.log('Find Smartcard : Not found smartcard')
site.factory.CaptureFindSmartcardAttempt(self.attempt);self.HideAll();self.showFindSmartcardRetry=true;if(self.attempt>=3)
self.showAttemptedMSG=true;self.update();}
self.onGetProductsSuccess=function(data){console.log('Find Smartcard : Get products success')
self.smCardFound=data.filter(x=>x.IsSmartCard)[0].SerialNumber;self.HideAll();self.showSmartcardFound=true;self.update();}
self.onGetProductsError=function(data){console.log('Find Smartcard : Get products error')
self.HideAll();self.showFindSmartcardRetry=true;self.update();}
self.GenerateJWT=function(){site.factory.GetJWT().then(function(token){self.token=token;})}
self.OnKeyUp=function(e){e.which==13&&self.enableSignIn?self.OnLogin():self.EnableSignIn();}
self.onPaste=function(){setTimeout(function(){$('#signIn_smartCardNumber').val($('#signIn_smartCardNumber').val().trim());},10);}
self.IsValid=function(){if(self.loginBySurname&&$(signIn_surname).val().trim()==emptystring){$(mobileToolTip).show();$(mobileToolTip).html(langTranslateApp.loginEnterSurname)
return false;}
else if(self.loginByMobile&&$(signIn_mobile).val().trim()==emptystring){$(mobileToolTip).show();$(mobileToolTip).html(langTranslateApp.loginEnterMobile)
return false;}
else if($(smartcardObj).val().trim()==emptystring){$(smartTooltip).show();$(smartTooltip).html(langTranslateApp.loginEnterSmartcardNumber);return false;}
else if(!self.IsNumeric($(smartcardObj).val())){$(smartTooltip).show();$(smartTooltip).html(langTranslateApp.loginNumValidation);$(smartcardObj).focus()
return false;}
else if($(signIn_surname).val().trim()=="0"){$(mobileToolTip).show();$(mobileToolTip).html(langTranslateApp.updateInvalidMobile)
return false;}
return true;}
self.onInputMobileEvent=function(e){console.log(e)
var isMobile=window.matchMedia("only screen and (max-width: 760px)");if(isMobile.matches){let event={key:e.key,currentTarget:e.target}
let isNumeric=self.IsNumeric(e.key);let isEnterPress=e.which==13;if(!isNumeric&&!isEnterPress){$(e.currentTarget).focus()
if(e.currentTarget.id=='signIn_mobile'){$(mobileToolTip).show();$(mobileToolTip).html(langTranslateApp.loginNumValidation);}
else if(e.currentTarget.id=='MobileNum'){$(findMobileToolTip).show();$(findMobileToolTip).html(langTranslateApp.loginNumValidation);}
else{$(smartTooltip).show();$(smartTooltip).html(langTranslateApp.loginNumValidation);}}
else if(e.currentTarget.id!='MobileNum')
self.EnableSignIn();}}
self.ValidateNumeric=function(e){let isNumeric=self.IsNumeric(e.key);let isEnterPress=e.which==13;if(!isNumeric&&!isEnterPress){e.preventDefault();$(e.currentTarget).focus()
if(e.currentTarget.id=='signIn_mobile'){$(mobileToolTip).show();$(mobileToolTip).html(langTranslateApp.loginNumValidation);}
else if(e.currentTarget.id=='MobileNum'){$(findMobileToolTip).show();$(findMobileToolTip).html(langTranslateApp.loginNumValidation);}
else{$(smartTooltip).show();$(smartTooltip).html(langTranslateApp.loginNumValidation);}}
else if(e.currentTarget.id!='MobileNum')
$(smartTooltip).hide();self.EnableSignIn();}
self.IsLoggedInBySmartcard=function(){let issmartcard=false;let sm=$(smartcardObj).val();if(sm.trim().length>3&&sm.trim().length<=9){issmartcard=false;}
if(sm.trim().length>9&&sm.trim().length<12){issmartcard=true;}
return issmartcard;}
self.ShowMobileLogin=function(){self.HideAll();self.showLogin=true;self.loginByMobile=true;self.SetTextFocus(signIn_mobile);self.update();}
self.ShowSurnameLogin=function(){self.HideAll();self.showLogin=true;self.loginBySurname=true;self.SetTextFocus(signIn_surname);self.update();$(signIn_surname).val(self.surnameOrMobile);$(smartcardObj).val(self.smartcardNumber);self.InitializeTooltip();if(self.retryButtonShown){console.log('Retry clicked');self.initialLoadDropdown();jcf.replaceAll();}
self.update();}
self.InitializeTooltip=function(){$('#snTooltip').tooltip({html:true,title:`<div style="font-size: 14px;font-weight: 400;text-align: justify;">${langTranslateApp.loginSurnameTooltip}</div>`,trigger:"hover",container:".surnameMobile-field",animation:true,delay:{show:0,hide:100}});$('#smTooltip').tooltip({html:true,title:`${langTranslateApp.loginSmartcardTooltip} <hr><ol class="text-title"><li>${langTranslateApp.loginSmartcardTooltipInstruction1} </li><li>${langTranslateApp.loginSmartcardTooltipInstruction2} </li><li> ${langTranslateApp.loginSmartcardTooltipInstruction3} </li></ol>`,trigger:"hover",container:".smartCard-field",animation:true,delay:{show:0,hide:100}});$('#snTooltip').attr('data-original-title',langTranslateApp.loginSurnameTooltip);$('#smTooltip').attr('data-original-title',`${langTranslateApp.loginSmartcardTooltip} <hr><ol class="text-title"><li>${langTranslateApp.loginSmartcardTooltipInstruction1} </li><li>${langTranslateApp.loginSmartcardTooltipInstruction2} </li><li> ${langTranslateApp.loginSmartcardTooltipInstruction3} </li></ol>`);}
self.ShowLoginMethod=function(){self.HideAll();self.showLoginMethod=true;self.showLogin=false;self.loginByMobile=false;self.loginBySurname=false;self.showForgotPassword=false;self.showRetry=false;self.update();}
self.HideAll=function(){self.showLoginMethod=false;self.showLogin=false;self.loginByMobile=false;self.loginBySurname=false;self.showForgotPassword=false;self.showRetry=false;self.showGOtvMessage=false;self.showSmartcardFound=false;self.showFindSmartcardRetry=false
self.update();}
self.ShowRetry=function(){self.showLoginMethod=false;self.showLogin=false;self.loginByMobile=false;self.loginBySurname=false;self.showForgotPassword=false;self.showRetry=true;self.update();}
self.OnFindSMRetry=function(){self.HideAll();self.showForgotPassword=true;self.update();}
self.OnRetry=function(){self.ShowLoginMethod();}
self.ShowForgotPassword=function(){self.HideAll();self.showForgotPassword=true;self.SetTextFocus(mobileNum);console.log('Find Smartcard : Checking number of attempts')
self.attempt=parseInt(site.factory.GetFindSmartcardAttempt());if(self.attempt>=3)
self.showAttemptedMSG=true;self.update();}
self.InitialSetUp=function(){$('#formLoginDiv, #loginDiv, #smartTooltip, #smartTooltip1, #section1, #formForgotDiv, #smartTooltipF').click(function(){$(smartTooltip).hide();$(mobileToolTip).hide();$(findMobileToolTip).hide();})
$('#signInModalPopup').on('hidden.bs.modal',function(){self.OnClose();})
if(window.location.href.includes(dstvApp.DstvThanksURL)){self.ShowMobileLogin();}
self.update();}
self.IsNumeric=function(str){return $.isNumeric(str)};self.EnableSignIn=function(){self.enableSignIn=$(smartcardObj).val().length>=10}
self.SetTextFocus=function(id){setTimeout(function(){$(id).focus()},500)}
self.OnClose=function(){console.log('closed log-in');if(window.location.href.includes(dstvApp.DashboardURL))
window.location=window.location.origin+window.culture
else if(self.attempt>=3)
$('#signInModalPopup').modal('hide');if(dstvApp.initialCountryAbbreviation&&dstvApp.initialLanguageAbbreviation){self.selectedCountryAbbreviation=dstvApp.initialCountryAbbreviation;self.selectedLanguageAbbreviation=dstvApp.initialLanguageAbbreviation;self.updateCountryParams();}}
self.loadCountryConfigData=function(){if(!self.countryConfigData){self.countryConfigData=dstvApp.cConfig;self.countriesList=dstvApp.liveTargetCountries.concat(dstvApp.SelfServiceEnabledCountries);self.dropdownCountryList=[];self.dropdownCountryList=removeusingSet(self.countriesList);self.countryConfigData=self.countryConfigData.filter(item=>self.dropdownCountryList.includes(item.countryabbreviation));self.allCountryCultureDetails=self.countryConfigData.map(function(item){if(!(item.languageAbbreviation=="en"&&(item.countryabbreviation=="ao"||item.countryabbreviation=="mz"))){return{countryName:item.country,countryAbbreviation:item.countryabbreviation,countryLanguageAbbreviation:item.languageAbbreviation,countryNameLanguage:item.country.toUpperCase()};}}).sort(function(a,b){return a.countryName.toLowerCase()<b.countryName.toLowerCase()?-1:1});self.allCountryCultureDetails=self.allCountryCultureDetails.filter(item=>(item!==undefined&&item!==null));function removeusingSet(arr){let outputArray=Array.from(new Set(arr));return outputArray;}
self.update();self.initialLoadDropdown();}
else{alert('something went wrong while country initialization !! please contact your service provider.')}}
self.initialLoadDropdown=function(){if(!self.retryButtonShown){dstvApp.initialCountryAbbreviation=dstvApp.countryabbreviation;dstvApp.initialLanguageAbbreviation=dstvApp.languageAbbreviation;}
self.initialCountryAbbreviation=dstvApp.countryabbreviation;self.initialLanguageAbbreviation=dstvApp.languageAbbreviation;if(self.initialCountryAbbreviation=='ao'||self.initialCountryAbbreviation=='mz'){self.selectedCountryAbbreviation=self.initialCountryAbbreviation;self.selectedLanguageAbbreviation=self.initialLanguageAbbreviation='pt';self.updateCountryParams();}
$('#ddlCountry').val(self.initialCountryAbbreviation+'-'+self.initialLanguageAbbreviation);self.update();if(!location.href.includes('dashboard'))
jcf.replaceAll();}
self.onCountryDropdownChange=function(e){let selectedItem=$(ddlCountry).val()
self.selectedCountryAbbreviation=selectedItem.split('-')[0];self.selectedLanguageAbbreviation=selectedItem.split('-')[1];self.updateCountryParams();self.InitializeTooltip();}
self.updateCountryParams=function(){if(self.countryConfigData){let filteredCountryConfigData=self.countryConfigData.filter(c=>c.countryabbreviation.includes(self.selectedCountryAbbreviation)&&(c.languageAbbreviation.toLowerCase().includes(self.selectedLanguageAbbreviation)))[0];if(filteredCountryConfigData){dstvApp.country=filteredCountryConfigData.country;dstvApp.countryCode=filteredCountryConfigData.countryCode;dstvApp.countryabbreviation=filteredCountryConfigData.countryabbreviation;dstvApp.countrycurrency=filteredCountryConfigData.countrycurrency;dstvApp.countryisocode=filteredCountryConfigData.countryisocode;dstvApp.language=filteredCountryConfigData.language;dstvApp.languageAbbreviation=filteredCountryConfigData.languageAbbreviation;dstvApp.liveChatSupport=filteredCountryConfigData.liveChatSupport;dstvApp.DashboardURL='/'+dstvApp.languageAbbreviation+'-'+dstvApp.countryabbreviation+'/dashboard';window.culture='/'+filteredCountryConfigData.languageAbbreviation+'-'+filteredCountryConfigData.countryabbreviation;window.countryAbbr=filteredCountryConfigData.languageAbbreviation+'-'+filteredCountryConfigData.countryabbreviation;window.cultureCountryAbbr=filteredCountryConfigData.countryabbreviation;sessionStorage['prevCulture']=window.culture;sessionStorage['countryCode']=filteredCountryConfigData.countryabbreviation;}}
$.ajax({url:'/scripts/languageConfig.js',async:false,dataType:'json',success:function(res){if(res){if(dstvApp.language=="English"){langTranslateApp=res[0].en;}else{langTranslateApp=res[0].pt;}}
else{alert('something went wrong while country initialization !! please contact your service provider.')}},error:function(e){console.log('Unable to read language config js')}});self.update();}
self.ShowSurnameToolTip=function(){}
self.ShowSmartcardToolTip=function(){}});riot.tag2('tag-change-package-new','<div class="modal-dialog"> <div class="modal-content changePackModel"> <!-- Modal Header --> <div class="modal-header"> <ul class="progressbar"> <li class="active plus"></li> <li></li> <li></li> </ul> <h4 class="modal-title">{langTranslateApp.currentPackage}</h4> <button type="button" class="close" data-dismiss="modal"><i class="icon-Close_M"></i></button> </div> <!-- Modal body --> <div class="modal-body"> <div class="main-top-package-info"> <div class="package-info-left col-lg-5 col-xs-5 col-sm-5 col-md-5"><span class="icon-pack icon-{dashSelectedPackageCode}"></span></div> <div class="package-info-right {dashSelectedPackageName} {dashSelectedPackageCode} col-lg-7 col-xs-7 col-sm-7 col-md-7"> <div class="backgroundimg"></div> <div class="smartcard"> {langTranslateApp.loginSmartcardNumber} <div class="number">{dashSmartCardNumber}</div> </div> </div> </div> <div class="second-top-package-info {dashSelectedPackageCode} col-lg-12 col-xs-12 col-sm-12 col-md-12 {dashSelectedPackageName}"> <div class="col-lg-4 col-xs-4 col-sm-4 col-md-4 second-top-first"> <div class="smartcard1">{langTranslateApp.dashDecoder}</div> <div class="smartcard1 decoder-name">Explora</div> <img src="/media/7655/explora-1.png"> </div> <div class="col-lg-4 col-xs-4 col-sm-4 col-md-4 second-top-second"> <div class="package-text-price ">{langTranslateApp.pkgPriceMonthly}</div> <div if="{!app.dualCurrencyApplicable}" class="package-price">{dstvApp.countrycurrency.toUpperCase()} {dashSelectedPackagePrice}</div> <div if="{app.dualCurrencyApplicable}" class="package-price">{dstvApp.countrycurrency.toUpperCase()} {dashSelectedPackageDualCurrencyPrice.amount}</div> <div class="package-text-amount price-bten">{langTranslateApp.pkgAmountAvailable}</div> <div if="{!app.dualCurrencyApplicable}" class="package-amount">{dstvApp.countrycurrency.toUpperCase()} {availableAccountBalance}</div> <div if="{app.dualCurrencyApplicable}" class="package-amount">{dstvApp.countrycurrency.toUpperCase()} {availableAccountBalanceDualCurrency}</div> </div> <div class="col-lg-4 col-xs-4 col-sm-4 col-md-4 second-top-third"> <div class="smartcardStatus">{langTranslateApp.accStatus}</div> <div class="Status-info {app.CardStatus}"><img class="icon-background-img" src="/media/8268/icon-tick.svg"><span class="icon-icon-warning"></span><span if="{dstvApp.language == \'English\'}">{app.dashSelectedPackageCardStatus}</span><span if="{dstvApp.language == \'Portuguese\' && app.dashSelectedPackageCardStatus == \'Active\'}">Activo</span><span if="{dstvApp.language == \'Portuguese\' && app.dashSelectedPackageCardStatus == \'Disconnected\'}">Desconectado</span><span if="{dstvApp.language == \'Portuguese\' && app.dashSelectedPackageCardStatus == \'Suspended\'}">Suspensa</span> </div> <div if="{isShowmaxActive}" class="addon-showmax-status"><span class="addonText">{langTranslateApp.dashAddOns}</span><span class="showmax-text">SHOWMAX</span></div> </div> </div> <div each="{currentAddOn in currentAddOns}" class="third-top-package-info {currentAddOn.CurrentPackageName} col-lg-12 col-xs-12 col-sm-12 col-md-12" if="{app.AddOnService && app.AddOnService.length > 0}"> <div class="col-lg-4 col-xs-4 col-sm-4 col-md-4 addOnPackage-info"> <div class="icon-pack icon-{currentAddOn.CurrentPackageCode}"></div> </div> <div class="col-lg-8 col-xs-8 col-sm-8 col-md-8 addOnPackage-details"> <div class="addOntext">{langTranslateApp.dashAddOns}</div> <div if="{!app.dualCurrencyApplicable}" class="addOn-info">{dstvApp.countrycurrency.toUpperCase()} {currentAddOn.CurrentAddOnPrice} p/m</div> <div if="{app.dualCurrencyApplicable}" class="addOn-info">{dstvApp.countrycurrency.toUpperCase()} {currentAddOn.DualCurrencyCurrentAddOnPrice} p/m</div> </div> </div> <div class="package-change-bottom-section"> <h2> {langTranslateApp.pkgPackagetitle}</h2> <div class="package-list"> <label each="{package in packages}" for="{package.PackageName}" class="main-packagelist-section col-lg-12 col-xs-12 col-sm-12 col-md-12"> <div if="{!app.dualCurrencyApplicable}" class="left-packagelist-section col-lg-5 col-xs-5 col-sm-5 col-md-5"><input id="{package.PackageName}" type="radio" name="selectedPackage" value="{package.PackageName}~{package.IsUpgradable}~{package.PackagePrice}" style="width: 20px; height: 21px;"><span class="icon-pack icon-{package.PackageCode}"></span> </div> <div if="{app.dualCurrencyApplicable}" class="left-packagelist-section col-lg-5 col-xs-5 col-sm-5 col-md-5"><input id="{package.PackageName}" type="radio" name="selectedPackage" value="{package.PackageName}~{package.IsUpgradable}~{package.DualCurrencyPackagePrice}" style="width: 20px; height: 21px;"><span class="icon-pack icon-{package.PackageCode}"></span> </div> <div class="right-packagelist-section {package.PackageName} col-lg-7 col-xs-7 col-sm-7 col-md-7"> <div class="smat-text">{langTranslateApp.addOnPriceTitle}</div> <div if="{!app.dualCurrencyApplicable}" class="smat-number">{dstvApp.countrycurrency.toUpperCase()} {package.PackagePrice}<span class="pricePerMonth"> p/m</span></div> <div if="{app.dualCurrencyApplicable}" class="smat-number">{dstvApp.countrycurrency.toUpperCase()} {package.DualCurrencyPackagePrice}<span class="pricePerMonth"> p/m</span></div> </div> </label> <div class="overlayBottom"> <span id="expandchangePackage"> <img src="/media/7681/icon-up-3.png" width="40px"></span></div> </div> <a class="btn anim-btn btn-default change-btn" id="packageActionButton" tabindex="-1" style="display:none;" disabled="{!enableNextButton}"><span class="anim-span"></span>{langTranslateApp.nextButtonTitle}<img src="/media/8557/icon-next.svg"></a> </div> </div> </div> <div class="" id="costSummary" style="display:none;"> <div class=""> <div class="modal-content"> <!-- Modal Header --> <div class="modal-header"> <ul class="progressbar"> <li class="active"></li> <li class="active"></li> <li class="active"></li> </ul> <h4 class="modal-title">{langTranslateApp.pkgCostSummary}</h4> <button type="button" class="close costSummaryClose" data-dismiss="modal"><i class="icon-Close_M"></i></button> </div> <!-- Modal body --> <div class="modal-body "> <div class="package-selection"> <div class="back-package"> <div class="backcard lslide" style="width: 100%; display: inline-block;"> <div class="backcard-packageItem {dashSelectedPackageName} {dashSelectedPackageCode}"> <i class="icon-pack icon-{dashSelectedPackageCode}"></i> <div if="{!app.dualCurrencyApplicable}" class="backcardprice"> <span class="price-value">{dstvApp.countrycurrency.toUpperCase()} {dashSelectedPackagePrice}</span> <a href="/get-dstv/package/details/dstv-compact-plus" class="btn-package" target="_blank" tabindex="0" style="display:none;">{langTranslateApp.knowMore}</a> </div> <div if="{app.dualCurrencyApplicable}" class="backcardprice"> <span class="price-value">{dstvApp.countrycurrency.toUpperCase()} {dashSelectedPackageDualCurrencyPrice.amount}</span> <a href="/get-dstv/package/details/dstv-compact-plus" class="btn-package" target="_blank" tabindex="0" style="display:none;">{langTranslateApp.knowMore}</a> </div> <div class="bottomBar"> <span></span> </div> <div class="backgroundimg"></div> </div> </div> </div> <img src="/media/7683/icon-back.svg" class="back-icon-img"> <div class="selected-package"> <div class="backcard lslide"> <div class="backcard-packageItem {selectedPackageCode}"> <i class="icon-pack icon-{selectedPackageCode}"></i> <div class="backcardprice"> <span class="price-value">{dstvApp.countrycurrency.toUpperCase()} {newPackagePrice}</span> <a href="/get-dstv/package/details/dstv-compact-plus" class="btn-package" target="_blank" tabindex="0" style="display:none;">{langTranslateApp.knowMore}</a> </div> <div class="bottomBar"><span if="{!showmaxATBUpgrade && !isShowmaxActive}">{langTranslateApp.selectedPackage}</span> <span if="{showmaxATBUpgrade || isShowmaxActive}" class="showmaxplus-icon"><img src="/media/10051/showmax-logo.svg"></span> </div> <div class="backgroundimg"></div> </div> </div> </div> </div> <div class="cost-details row"> <div class="details-info col-lg-12 col-xs-12 col-sm-12 col-md-12"> <div class="details-info-text col-lg-6 col-xs-6 col-sm-6 col-md-6">{app.newSelectedPackageName} {langTranslateApp.pkgMonthlyCostTitle}</div> <div class="details-info-price col-lg-6 col-xs-6 col-sm-6 col-md-6">{dstvApp.countrycurrency.toUpperCase()} {newPackagePrice}</div> </div> <div if="{showmaxATBUpgrade || isShowmaxActive}" class="details-info col-lg-12 col-xs-12 col-sm-12 col-md-12"> <div class="details-info-text showmaxwordDetails col-lg-6 col-xs-6 col-sm-6 col-md-6">Showmax</div> <div class="details-info-price showmaxPricedetails col-lg-6 col-xs-6 col-sm-6 col-md-6">{dstvApp.countrycurrency.toUpperCase()} {filteredShowmaxAddOn.price.value}</div> </div> <div class="details-info col-lg-12 col-xs-12 col-sm-12 col-md-12"> <div class="details-info-text col-lg-6 col-xs-6 col-sm-6 col-md-6">{langTranslateApp.pkgChangeEstimatedCost}</div> <div if="{!app.dualCurrencyApplicable}" class="details-info-price col-lg-6 col-xs-6 col-sm-6 col-md-6">{dstvApp.countrycurrency.toUpperCase()} {dueAmount}</div> <div if="{app.dualCurrencyApplicable}" class="details-info-price col-lg-6 col-xs-6 col-sm-6 col-md-6">{DualCurrency.toUpperCase()} {DualCurrencydueAmount}</div> </div> </div> <div class="summery-details "> <p>{langTranslateApp.pkgChangeInstruction}</p> <div class="cost-btn"><button type="button" class="pay-btn-cost" id="btnChangePackagePay" onclick="{ProcessPayment}">{paymentButtonCaption}</button></div> </div> </div> </div> </div> </div> <div class="modal-content" id="errorMessageModal" style="display:none;"> <div class="modal-header"><button type="button" class="close" data-dismiss="modal"><i class="icon-Close_M"></i></button></div> <div class="modal-body"> <div class="alert-msg"> <div class=""><span if="{!app.deadlineTime}" class="icon-icon-warning"></span><span if="{!app.deadlineTime}" class="error-wrong-msg">{langTranslateApp.pkgErrorMessageTitle}</span><span if="{!app.deadlineTime}" class="error-note">{langTranslateApp.pkgErrorMessageDescription}</span><span if="{app.deadlineTime}" class="response-icon"></span><br><span if="{app.deadlineTime}" class="error-wrong-msg">{langTranslateApp.pkgErrorMessageDescription}</span><a href="javascript:void(0)" onclick="{onErrorClose}" class="btn anim-btn btn-default ok-btn close" data-dismiss="modal">{langTranslateApp.menuClose}</a></div> </div> </div> </div> <div class="modal-content " id="successMessageModal" style="display:none;"> <div class="modal-header"><button type="button" class="close" data-dismiss="modal"><i class="icon-Close_M"></i></button></div> <div class="modal-body"> <div class="alert-msg-success"> <div class=""> <span class="icon-icon-tick"></span><span class="pay-success-msg">{langTranslateApp.pkgSuccessMessageTitle}</span> <div class="backcard-packageItem {selectedPackageCode}"> <i class="icon-pack icon-{selectedPackageCode}"></i> <div class="backcardprice"><span class="price-value">{dstvApp.countrycurrency.toUpperCase()} {newPackagePrice}</span></div> <div class="bottomBar">{langTranslateApp.pkgNewPackageTitle}</div> <div class="backgroundimg"></div> </div> <div class="date-area"> <div class="date-sec"><span class="date-text">{langTranslateApp.pkgEffectiveDateTitle}</span><span class="date-no">{pkgEffectiveDate}</span></div> </div> <a if="{!showmaxChangePackageSuccess}" class="btn anim-btn btn-default view-chg-btn close" data-dismiss="modal" onclick="{goToDashboardUrl}"> {langTranslateApp.pkgViewChangesTitle}</a> <div class="success-showmax-msg-btn" if="{showmaxChangePackageSuccess}"> <a class="btn anim-btn btn-default btn-show-active" href="javascript:void(0)" onclick="{onAddShowmax}">Add Showmax</a> </div> </div> </div> </div> </div> <div class="modal-content " id="notificationMeg" style="display:none;"> <div class="modal-header"><button type="button" class="close" data-dismiss="modal"><i class=" icon-Close_M"></i></button></div> <div class="modal-body"> <div class="notify-area"> <div class="notify-sec"><span class="icon-icon-warning icon-notify"></span><span class="msg-text-notify">{langTranslateApp.pkgNotificationTitle}</span><span class="notify-msg">{langTranslateApp.pkgSRQNotificationMessage}</span></div> <div class="notify-close-btn"><a class="btn anim-btn btn-default notify-close" data-dismiss="modal">Close</a></div> </div> </div> </div> <div class="modal-content " id="repeatRequestMsg" style="display:none;"> <div class="modal-header"><button type="button" class="close" data-dismiss="modal"><i class=" icon-Close_M"></i></button></div> <div class="modal-body"> <div class="notify-area"> <div class="notify-sec"><span class="icon-icon-warning icon-notify"></span><span class="msg-text-notify">{langTranslateApp.pkgNotificationTitle}</span><span class="notify-msg">{langTranslateApp.pkgRepeatedRequestMessage}</span></div> <div class="notify-close-btn"><a class="btn anim-btn btn-default notify-close" data-dismiss="modal">Close</a></div> </div> </div> </div> <div id="upgradeDowngradeWarning" style="display:none;"> <div class="modal-content " > <div class="modal-header"><button type="button" class="close" data-dismiss="modal"><i class=" icon-Close_M"></i></button></div> <div class="modal-body"> <div class="container-fluid main-section downgradeSection"> <div class="popup showmaxPopup"> <img src="/media/10049/layer1-2x.png" class="showmax-icon"> <h2 class="activesuccessheading">{langTranslateApp.showmaxBilling}</h2> <img src="/media/10056/billing-icon.svg" class="icon-downgrade"> <div class="downgradeInfo"><span>{langTranslateApp.showmaxDowngradingMessage}<br> {langTranslateApp.showmaxCostMessage}</span></div> <div class="downgradeQues"><span>{langTranslateApp.showmaxDowngradeMessage}</span></div> <div class="showmaxInfoArea"> <a href="javascript:void(0)" onclick={onCancelShowmax}><span class="backicon"><span class="backword">{langTranslateApp.showmaxCancelButton}</span><img src="/media/10057/bill-showmax-icon.svg"></span></a> <a href="javascript:void(0)" onclick={onChangePackage}><span class="cancle-icon"><span class="confirmword">{langTranslateApp.showmaxContinueDowngrade}</span><span class="downarrow"></span></span></a> </div> </div> </div> </div> </div> </div> <div id="cpoverlay"> <div class="cv-spinner"> <span class="cpspinner"></span> </div> </div></div>','tag-change-package-new,[riot-tag="tag-change-package-new"],[data-is="tag-change-package-new"]{ visibility: visible; } ','',function(opts){var self=this;let upgradePackageUrl=`${dstvApp.DSOUpgradePackageURL}`;let downgradePackageUrl=`${dstvApp.DSODowngradePackageURL}`;let retryQuotesUrl=`${dstvApp.DSORetryQuotesURL}`;self.newWin='';self.paymentButtonCaption=langTranslateApp.pkgProceedToPay;self.showmaxChangePackageSuccess=false;self.enableNextButton=true;var selectedPackageValue='';var selectedPackage='';var isUpgradeCheck='';self.isShowmaxActive=false;self.on('before-mount',function(){})
self.on('mount',function(){if(self.opts.showmaxATBUpgrade||opts.showmaxATBUpgrade){self.showmaxATBUpgrade=true;$('#showmaxModel').modal('hide');$(".dashboard-page").addClass('modal-open');}
if(!opts.showmodal&&opts.showAlert){$('.changePackModel').hide();$('#errorMessageModal').modal('show');self.update();}
if(opts.showmodal){$("#cpoverlay").fadeIn(300);setTimeout(function(){site.factory.GetJWT().then(function(token){self.token=token;self.dashSelectedPackageCode=app.dashSelectedPackageName?app.dashSelectedPackageName.split('-')[0].trim():app.ProductCode;self.dashSelectedPackageName=app.dashSelectedPackageName?app.dashSelectedPackageName.split('-')[1].trim():app.currentPackageFullName;self.dashSmartCardNumber=app.dashSelectedSmartCard?app.dashSelectedSmartCard:app.smartcard;self.dashSelectedPackageDetails=app.smartcards.filter(sc=>sc.SerialNumber==self.dashSmartCardNumber).filter(ps=>ps.primaryService.productCode==self.dashSelectedPackageCode);self.dashSelectedPackagePrice=self.dashSelectedPackageDetails[0].primaryService.price;self.dashSelectedPackageDualCurrencyPrice=self.dashSelectedPackageDetails[0].primaryService.localPrice;self.filteredAddOnServiceList=app.viewSubscriptionResponse.filter(sc=>sc.smartcardNumber==self.dashSmartCardNumber)[0].services.filter((service)=>{return!service.serviceName.toUpperCase().includes('SHOWMAX')&&(service.type=='Addon'||service.description.includes('Add-on')||service.description.includes('add-on'));});if(self.filteredAddOnServiceList&&self.filteredAddOnServiceList.length>0){self.CurrentAddOnsList=self.filteredAddOnServiceList.filter(d=>d.status='Active')
self.currentAddOns=self.CurrentAddOnsList.map((currentAddOn)=>{return{CurrentPackageCode:currentAddOn.serviceName.split(' ')[0],CurrentPackageName:currentAddOn.serviceName,CurrentAddOnPrice:currentAddOn.price,AddOnDualCurrency:currentAddOn.localPrice?currentAddOn.localPrice.currency:null,DualCurrencyCurrentAddOnPrice:currentAddOn.localPrice?currentAddOn.localPrice.amount:null}})}
if(app.loggedin){let url=`${dstvApp.DSOChangePackageURL}`;var reqBody={"businessUnit":dstvApp.businessunit,"channel":dstvApp.channel,"country":dstvApp.country,"packageName":app.dashSelectedPackageName};if((opts.smartcard&&opts.packageName)||opts.showmaxATBUpgrade){self.dashSelectedPackageCode=opts.packageName.split('-')[0].trim();self.dashSelectedPackageName=opts.packageName.split('-')[1].trim();self.dashSmartCardNumber=opts.smartcard;reqBody.packageName=opts.packageName;}
site.trigger('getpostdata',url,'POST','application/json',"Bearer "+self.token,'',reqBody,'',self.onChangePackageSuccess,self.onChangePackageError);}})},3000);if(app.accountsInfo&&app.accountsInfo[0]&&app.accountsInfo[0].AccountBalance){self.availableAccountBalance=app.accountsInfo.filter(d=>d.AccountType=='DStvRes')[0].AccountBalance.Value;if(dstvApp.DualCurrency=='on'&&dstvApp.DualCurrencyCountryList.includes(dstvApp.countryabbreviation))
self.availableAccountBalanceDualCurrency=app.accountsInfo.filter(d=>d.AccountType=='DStvRes')[0].AccountBalance.LocalPrice.Amount.toString();}
else{self.availableAccountBalance='NA';}
$(document).ready(function(){$('<div class="overlayBottom"> <span id="expandchangePackage" style="display:none;"> <img src="/media/7681/icon-up-3.png" width="30px"></span></div>').insertAfter(".span.main-packagelist-section:last-of-type");$('#expandchangePackage').click(function(){$('.package-list').toggleClass('fullHeight');$('#changepackageModal').animate({scrollTop:$(document).height()},'slow');});});$('#packageActionButton').click(function(e){if(!self.enableNextButton)
return;$("#cpoverlay").fadeIn(300);selectedPackageValue=$("input[name='selectedPackage']:checked").val();selectedPackage=selectedPackageValue.split('~')[0].trim();isUpgradeCheck=selectedPackageValue.split('~')[1].trim();self.newPackagePrice=selectedPackageValue.split('~')[2].trim();self.currency=dstvApp.countrycurrency.toUpperCase();self.selectedPackageCode=selectedPackage.split('-')[0].trim();app.newSelectedPackageName=selectedPackage.split('-')[1].trim();app.currentSelectedPackage=selectedPackage;window.SessionSave('app',app);self.update();let isPremium=self.selectedPackageCode.includes('PR')&&!self.selectedPackageCode.includes('PREPRTS')&&!self.selectedPackageCode.includes('PRWPRTSE36')
self.showmaxProductDetails=app.viewSubscriptionResponse.filter(sc=>sc.smartcardNumber==self.dashSmartCardNumber)[0].services.filter((service)=>{return service.type=='ThirdParty'&&service.serviceName.toUpperCase().includes('SHOWMAX');});if(self.showmaxProductDetails&&self.showmaxProductDetails.length>0&&self.showmaxProductDetails[0].status.toUpperCase()=='ACTIVE'&&!isPremium&&isUpgradeCheck!=='true'){$("#cpoverlay").fadeOut(300);$('.changePackModel').hide();self.update();$('#upgradeDowngradeWarning').modal('show');}
else{self.onChangePackage();}});}});self.onChangePackage=function(){$('#upgradeDowngradeWarning').modal('hide');$('.changePackModel').show();$('#changepackageModal').modal('show');$("#cpoverlay").fadeIn(300);self.reqBodyUpgradeDowngrade={"businessUnit":dstvApp.businessunit,"channel":dstvApp.channel,"country":dstvApp.country,"smartCardNumber":self.dashSmartCardNumber,"customerNumber":app.customernumber,"toPackageName":selectedPackage};app.packageUpgradeDowngradeReq=self.reqBodyUpgradeDowngrade;window.SessionSave('app',app);if(isUpgradeCheck==='true'){site.trigger('getpostdata',upgradePackageUrl,'POST','application/json',"Bearer "+self.token,'',self.reqBodyUpgradeDowngrade,'',self.onUpgradeDowngradeSuccess,self.onUpgradeDowngradeError);}
else{site.trigger('getpostdata',downgradePackageUrl,'POST','application/json',"Bearer "+self.token,'',self.reqBodyUpgradeDowngrade,'',self.onUpgradeDowngradeSuccess,self.onUpgradeDowngradeError);}
self.enableNextButton=false;self.update();}
self.onChangePackageSuccess=function(data){console.log('Package : Call Change Package API Success')
filteredPackages=data.filter(d=>d.isAddOn===false);self.filteredShowmaxAddOn=data.filter(d=>d.isAddOn===true&&d.name.toUpperCase().includes('SHOWMAX'));if(self.filteredShowmaxAddOn&&self.filteredShowmaxAddOn.length>0){self.filteredShowmaxAddOn=self.filteredShowmaxAddOn[0];}
self.packages=filteredPackages.map((package)=>{return{PackageCode:package.name.split(' ')[0],PackageName:package.name,IsUpgradable:package.isUpgrade.toString(),PackageCurrency:package.price.currency,PackagePrice:package.price.value,DualCurrencyPackageCurrency:package.localPrice?package.localPrice.currency:null,DualCurrencyPackagePrice:package.localPrice?package.localPrice.amount:null,}})
if(opts.showmaxUpgrade||self.showmaxATBUpgrade||opts.showmaxATBUpgrade){self.packages=self.packages.filter(x=>x.PackageName.includes('PR')).filter(x=>!x.PackageName.includes('PREPRTS')).filter(x=>!x.PackageName.includes('PRWPRTSE36'));}
self.showmaxProductDetails=app.viewSubscriptionResponse.filter(sc=>sc.smartcardNumber==self.dashSmartCardNumber)[0].services.filter((service)=>{return service.type=='ThirdParty'&&service.serviceName.toUpperCase().includes('SHOWMAX');});if(self.showmaxProductDetails&&self.showmaxProductDetails.length>0){self.showmaxProductDetails=self.showmaxProductDetails[0];if(self.showmaxProductDetails.status.toUpperCase()=='ACTIVE'){self.isShowmaxActive=true;}}
self.packagesCount=self.packages.length;if(self.packagesCount>2){$("#expandchangePackage").show();}else{$('.package-list').css('height','auto');}
self.update();$("#cpoverlay").fadeOut(300);var isRadioChecked=$("input:radio[name='selectedPackage']").is(":checked");$('input:radio[name="selectedPackage"]').click(function(){var isRadioChecked=$("input:radio[name='selectedPackage']").is(":checked")
if(isRadioChecked){$('#packageActionButton').show();$('.progressbar li:nth-child(2)').addClass("active");$('html,body .changepackageModal').animate({scrollTop:$(".changepackageModal #packageActionButton").offset().top},'slow');}});if(self.packagesCount>0&&(opts.showmaxUpgrade||self.showmaxATBUpgrade||opts.showmaxATBUpgrade)){$('input:radio[name="selectedPackage"]')[0].click();}
self.update();}
self.onChangePackageError=function(err){console.log('Change Pacakge : error while changing the package')
$("#cpoverlay").fadeOut(300);window.SessionSave("app",app);$('.changePackModel').hide();$('#errorMessageModal').modal('show');if(err.responseJSON&&ShowGenericError(err.responseJSON.StatusCode)){$(".error-note").html(`${langTranslateApp.genericTechnicalIssueMsg1} <u><a class="payments_errContactUs" href="${window.culture}/${langTranslateApp.subMenuContactUsLink}">${langTranslateApp.subMenuContactUs}</a></u> ${langTranslateApp.genericTechnicalIssueMsg2}`);}
function ShowGenericError(errStatusCode){return errStatusCode==500||errStatusCode==400||errStatusCode==412||errStatusCode==424;}}
self.onUpgradeDowngradeSuccess=function(data){console.log('Package : Call Upgrade/Downgrade API Success')
if(data){if(data.effectiveDate==null){self.pkgEffectiveDate=self.formatEffectiveDate(new Date());}
else{self.pkgEffectiveDate=self.formatEffectiveDate(new Date(data.effectiveDate));}}
$("#cpoverlay").fadeOut(300);$('.changePackModel').hide();$('#costSummary').hide();$('#successMessageModal').show();if($('.modal.dashboardPOP.in')){$(".dashboard-page").addClass('modal-open');}
if(self.showmaxATBUpgrade||opts.showmaxATBUpgrade){self.showmaxChangePackageSuccess=true;}
else{site.factory.CaptureFeedback('DSTVCHANGEPACKAGE_'+app.customernumber);}
riot.mount('tag-dashboard-package-section');self.update();}
self.onUpgradeDowngradeError=function(err){console.log('Upgrade/Downgrade Pacakge : error while upgrading/downgrading the package')
$("#cpoverlay").fadeOut(300);if(err.responseJSON.StatusCode==424){var reqBodyRetryQuotes={"businessUnit":dstvApp.businessunit,"channel":dstvApp.channel,"country":dstvApp.country,"smartCardNumber":app.SmartCardNumber,"products":[app.dashSelectedPackageName,app.currentSelectedPackage]};site.trigger('getpostdata',retryQuotesUrl,'POST','application/json',"Bearer "+self.token,'',reqBodyRetryQuotes,'',self.onRetryQuotesSuccess,self.onRetryQuotesError);$('#costSummary').hide();$('.changePackModel').hide();$('#errorMessageModal').modal('show');$(".error-note").html(`${langTranslateApp.genericTechnicalIssueMsg1} <u><a class="payments_errContactUs" href="${window.culture}/${langTranslateApp.subMenuContactUsLink}">${langTranslateApp.subMenuContactUs}</a></u> ${langTranslateApp.genericTechnicalIssueMsg2}`);}
else if(err.responseJSON.StatusCode==402){var res=err.responseJSON.Message.split('\\');res=JSON.parse(res);self.dueAmount=res.Payment.Amount;self.currency=res.Payment.Currency;self.DualCurrency=res.LocalCurrency?res.LocalCurrency.Currency:null;self.DualCurrencydueAmount=res.LocalCurrency?res.LocalCurrency.Amount:null;self.message=res.ResponseMessage;if(self.isShowmaxActive||opts.showmaxATBUpgrade){self.onGetNewShowmaxPrice();}
self.update();$('.changePackModel').hide();$('#costSummary').show();$(".dashboard-page").addClass('modal-open');}
else if(err.responseJSON.StatusCode==417){$('#costSummary').hide();$('.changePackModel').hide();$('#notificationMeg').modal('show');if(site.env=='QA')
site.factory.CaptureFeedback('DSTVCHANGEPACKAGE_'+app.customernumber);}
else if(err.responseJSON.StatusCode==208){$('#costSummary').hide();$('.changePackModel').hide();$('#repeatRequestMsg').modal('show');if(site.env=='QA')
site.factory.CaptureFeedback('DSTVCHANGEPACKAGE_'+app.customernumber);}
else{console.log(err.responseJSON.Message);$('#costSummary').hide();$('.changePackModel').hide();$('#errorMessageModal').modal('show');if(err.responseJSON&&ShowGenericError(err.responseJSON.StatusCode)){$(".error-note").html(`${langTranslateApp.genericTechnicalIssueMsg1} <u><a class="payments_errContactUs" href="${window.culture}/${langTranslateApp.subMenuContactUsLink}">${langTranslateApp.subMenuContactUs}</a></u> ${langTranslateApp.genericTechnicalIssueMsg2}`);}
function ShowGenericError(errStatusCode){return errStatusCode==500||errStatusCode==400||errStatusCode==412||errStatusCode==424;}
if(!app.deadlineTime){let delay=5*60*1000;self.date=new Date();app.deadlineTime=self.date.setTime(self.date.getTime()+delay);window.SessionSave("app",app);}
if(site.env=='QA')
site.factory.CaptureFeedback('DSTVCHANGEPACKAGE_'+app.customernumber);}}
self.onRetryQuotesSuccess=function(data){console.log('Package : Call Retry Quotes API Success')
if(data){self.pkgEffectiveDate=self.formatEffectiveDate(new Date(data.effectiveDate));}
self.update();$("#cpoverlay").fadeOut(300);$('.changePackModel').hide();$('#costSummary').hide();$('#successMessageModal').show();}
self.onRetryQuotesError=function(err){console.log('Retry Quotes  : error while retrying Quotes ')
$("#cpoverlay").fadeOut(300);if(err.responseJSON.StatusCode==402){var res=err.responseJSON.Message.split('\\');res=JSON.parse(res);self.dueAmount=res.Payment.Amount;self.currency=res.Payment.Currency;self.DualCurrency=res.PaymentInLocalCurrency.Currency;self.DualCurrencydueAmount=res.PaymentInLocalCurrency.Amount;self.message=res.ResponseMessage;self.update();$('.changePackModel').hide();$('#costSummary').show();$(".dashboard-page").addClass('modal-open');}
else{console.log(err.responseJSON.Message);$('#costSummary').hide();$('.changePackModel').hide();$('#errorMessageModal').modal('show');if(err.responseJSON&&ShowGenericError(err.responseJSON.StatusCode)){$(".error-note").html(`${langTranslateApp.genericTechnicalIssueMsg1} <u><a class="payments_errContactUs" href="${window.culture}/${langTranslateApp.subMenuContactUsLink}">${langTranslateApp.subMenuContactUs}</a></u> ${langTranslateApp.genericTechnicalIssueMsg2}`);}
function ShowGenericError(errStatusCode){return errStatusCode==500||errStatusCode==400||errStatusCode==412||errStatusCode==424;}}}
self.formatEffectiveDate=function formatDate(date){var monthNames=["January","February","March","April","May","June","July","August","September","October","November","December"];var day=date.getDate();var monthIndex=date.getMonth();var year=date.getFullYear();return day+' '+monthNames[monthIndex]+' '+year;}
self.goToDashboardUrl=function(e){if(app.loggedin)
window.location=dstvApp.DashboardURL;}
self.update();self.ProcessPayment=function(){if(dstvApp.NoOnlinePaymentCountryList.includes(dstvApp.countryabbreviation)){site.factory.HandleHowToPay();}
else{$("#cpoverlay").fadeIn(300);if(self.showmaxATBUpgrade||opts.showmaxATBUpgrade){$('#changepackageModal').modal('hide');riot.mount('tag-payments-new',{showmaxChangePackagePayment:true,amount:self.dueAmount});}
else{$('#changepackageModal').modal('hide');riot.mount('tag-payments-new',{changePackagePayment:true,amount:self.dueAmount});}}}
self.processPaymentVSC=function(){var smartQuoteRequest={BasketId:0,BoxOffice:false,BusinessUnit:dstvApp.businessunit,City:"",Country:dstvApp.country,CustomerNumber:app.customernumber,DeviceNumber:"",InterfaceType:"DStv Facebook and Mobi",ProductUserKey:self.selectedPackageCode,QuotePeriod:1,InvoicePeriod:1};var apiUrl='';if(site.env=='QA'){apiUrl=dstvApp.ProxyAPIUrl;}
else{apiUrl=dstvApp.APIUrl;}
$.post(apiUrl+"Retail/GetSmartQuote?vendorCode="+dstvApp.vendorcode+"&language="+dstvApp.language+"&ipAddress="+"123",smartQuoteRequest,function(QuoteRes,status,xhr){console.log("SmartByProd",QuoteRes);console.log("SmartQuoteRequest",smartQuoteRequest);var totalAmount=QuoteRes.Quote.ProductsTotalAmount;var balanceDue=Math.abs(QuoteRes.Quote.BalanceDue);var smartcardNumberPay=sessionStorage.getItem("smartcardNumberPay");var paymentUrl=dstvApp.PaymentBaseUrl+dstvApp.countryisocode+'/'+dstvApp.languageAbbreviation+'/payment/'+app.smartcard+'/'+QuoteRes.BasketId;if(dstvApp.NoOnlinePaymentCountryList.includes(dstvApp.countryabbreviation)){paymentUrl=window.culture+'/ways-to-pay';}
var controllerUrl=dstvApp.PaymentBaseUrl+dstvApp.countryisocode+'/'+dstvApp.languageAbbreviation+'/ProcessPaymentDSOChangePackage/'+app.smartcard;$.ajax({url:controllerUrl,type:'POST',data:{amountToPay:self.dueAmount.toFixed(),smartcard:app.SmartCardNumber,basketId:QuoteRes.BasketId},beforeSend:function(){},complete:function(){$("#cpoverlay").fadeOut(300);},success:function(response){console.log(response);$("#cpoverlay").fadeOut(300);window.location=response.redirecturl;},error:function(response){console.log(response);}});});}
self.loadIframeAndProcessPayment=function(){self.newWin=window.open('','_blank');let html='';if(dstvApp.languageAbbreviation=='pt')
html+="<html><head></head><body><div>Por favor, espere...</div></body></html>";else
html+="<html><head></head><body><div>Please Wait...</div></body></html>";self.newWin.document.write(html);riot.mount('tag-payments-new');$("#cpoverlay").fadeIn(300);let dueAmount=self.dueAmount;let currency=dstvApp.countrycurrency;let toPackageProductCode=app.currentSelectedPackage.split('-')[0].trim();if(dstvApp.DualCurrency=='on'&&dstvApp.DualCurrencyCountryList.includes(dstvApp.countryabbreviation)){currency=dstvApp.DualCurrencyPaymentCurrency.filter(x=>x.country==dstvApp.countryabbreviation)[0].currency;}
let account=app.accounts.filter(x=>x.AccountType=="DStvRes");let accNumber=account[0]?account[0].AccountNumber:null;var reqBodyPaymentService={"country":dstvApp.country,"businessUnit":dstvApp.businessunit,"channel":dstvApp.channel,"currency":currency,"customerNumber":app.customernumber,"smartCardNumber":app.dashSelectedSmartCard,"firstName":app.customerDetails.PersonalDetail.FirstName,"name":app.customerDetails.PersonalDetail.Surname,"accountNumber":accNumber,"amount":dueAmount,"productUserKey":toPackageProductCode,"paymentType":"DstvPayment","backUrl":"","successReturnURL":"","failureReturnURL":"","bypassPaymentSuite":true,"LanguageCode":dstvApp.languageAbbreviation};site.trigger('getpostdata',dstvApp.DSOPaymentServiceURL,'POST','application/json',"Bearer "+self.token,'',reqBodyPaymentService,'',self.onPaymentProcessSuccess,self.onPaymentProcessError);}
self.onPaymentProcessSuccess=function(data){console.log('Payment process successful');$('#changepackageModal').modal('hide');$('#paymentModal').modal('show');$("#cpoverlay").fadeOut(300);if(data){let dppRedirectUrl=data.redirectUrl;$('#paymentPage').hide();$('#paymentModal').modal('hide');self.newWin.location=dppRedirectUrl;}
else{$("#paymentsoverlay").fadeOut(300);console.log('error after successful DSOPaymentServiceURL call');}}
self.onPaymentProcessError=function(err){$("#cpoverlay").fadeOut(300);$('.changePackModel').hide();$('#costSummary').hide();$('#errorMessageModal').modal('show');console.log('Error on DSO Payment process');let html="";if(dstvApp.languageAbbreviation=='pt')
html+="<html><head></head><body><div>Algo deu errado!</div></body></html>";else
html+="<html><head></head><body><div>Something went wrong!</div></body></html>";self.newWin.document.write(html);}
self.onErrorClose=function(){$('#errorMessageModal').modal('hide');}
if(dstvApp.NoOnlinePaymentCountryList.includes(dstvApp.countryabbreviation)){self.paymentButtonCaption=langTranslateApp.dashboardHowToPay;}
self.onCancelShowmax=function(){$('#changepackageModal').modal('hide');riot.mount('tag-showmax-atb',{changePackageCancelShowmax:true,openpopup:true});}
self.onAddShowmax=function(){$('#changepackageModal').modal('hide');riot.mount('tag-showmax-atb',{changePackageAddShowmax:true,openpopup:true});}
self.onGetNewShowmaxPrice=function(){$("#cpoverlay").fadeIn(300);let url=`${dstvApp.DSOChangePackageURL}`;var reqBody={"businessUnit":dstvApp.businessunit,"channel":dstvApp.channel,"country":dstvApp.country,"packageName":selectedPackage};site.trigger('getpostdata',url,'POST','application/json',"Bearer "+self.token,'',reqBody,'',self.onChangePackageSuccess,self.onChangePackageError);}});riot.tag2('tag-addons-new','<div class="modal-dialog"> <div class="modal-content addOnPacakgeModal"> <!-- Modal Header --> <div class="modal-header"> <ul class="progressbar"> <li class="active plus"></li> <li></li> <li></li> </ul> <h4 class="modal-title">{langTranslateApp.currentPackage}</h4> <button type="button" class="close" data-dismiss="modal"><i class="icon-Close_M"></i></button> </div> <!-- Modal body --> <div class="modal-body"> <div class="main-top-package-info"> <div class="package-info-left col-lg-5 col-xs-5 col-sm-5 col-md-5"><span class="icon-pack icon-{dashSelectedPackageCode}"></span></div> <div class="package-info-right {dashSelectedPackageCode} {dashSelectedPackageName} col-lg-7 col-xs-7 col-sm-7 col-md-7"> <div class="backgroundimg"></div> <div class="smartcard"> {langTranslateApp.loginSmartcardNumber} <div class="number">{dashSmartCardNumber}</div> </div> </div> </div> <div class="second-top-package-info {dashSelectedPackageCode} {dashSelectedPackageName} col-lg-12 col-xs-12 col-sm-12 col-md-12"> <div class="col-lg-4 col-xs-4 col-sm-4 col-md-4 second-top-first"> <div class="smartcard1">{langTranslateApp.dashDecoder}</div> <div class="smartcard1 decoder-name">Explora</div> <img src="/media/7655/explora-1.png"> </div> <div class="col-lg-4 col-xs-4 col-sm-4 col-md-4 second-top-second"> <div class="package-text-price">{langTranslateApp.pkgPriceMonthly}</div> <div if="{!app.dualCurrencyApplicable}" class="package-price">{dstvApp.countrycurrency.toUpperCase()} {dashSelectedPackagePrice}</div> <div if="{app.dualCurrencyApplicable}" class="package-price">{dstvApp.countrycurrency.toUpperCase()} {dashSelectedPackageDualCurrencyPrice.amount}</div> <div class="package-text-amount price-bten">{langTranslateApp.pkgAmountAvailable}</div> <div if="{!app.dualCurrencyApplicable}" class="package-amount">{dstvApp.countrycurrency.toUpperCase()} {availableAccountBalance}</div> <div if="{app.dualCurrencyApplicable}" class="package-amount">{dstvApp.countrycurrency.toUpperCase()} {availableAccountBalanceDualCurrency}</div> </div> <div class="col-lg-4 col-xs-4 col-sm-4 col-md-4 second-top-third"> <div class="smartcardStatus">{langTranslateApp.accStatus}</div> <div class="Status-info {app.CardStatus}"><img class="icon-background-img" src="/media/8268/icon-tick.svg"><span class="icon-icon-warning"></span><span if="{dstvApp.language == \'English\'}">{app.dashSelectedPackageCardStatus}</span><span if="{dstvApp.language == \'Portuguese\' && app.dashSelectedPackageCardStatus == \'Active\'}">Activo</span><span if="{dstvApp.language == \'Portuguese\' && app.dashSelectedPackageCardStatus == \'Disconnected\'}">Desconectado</span><span if="{dstvApp.language == \'Portuguese\' && app.dashSelectedPackageCardStatus == \'Suspended\'}">Suspensa</span></div> <div if="{isShowmaxActive}" class="addon-showmax-status"><span class="addonText">{langTranslateApp.dashAddOns}</span><span class="showmax-text">SHOWMAX</span></div> </div> </div> <div each="{currentAddOn in currentAddOns}" class="third-top-package-info {currentAddOn.CurrentPackageName} col-lg-12 col-xs-12 col-sm-12 col-md-12" if="{app.AddOnService && app.AddOnService.length > 0}"> <div class="col-lg-4 col-xs-4 col-sm-4 col-md-4 addOnPackage-info"> <div class="icon-pack icon-{currentAddOn.CurrentPackageCode}"></div> </div> <div class="col-lg-8 col-xs-8 col-sm-8 col-md-8 addOnPackage-details"> <div class="addOntext">{langTranslateApp.dashAddOns}</div> <div if="{!app.dualCurrencyApplicable}" class="addOn-info">{dstvApp.countrycurrency.toUpperCase()} {currentAddOn.CurrentAddOnPrice} p/m</div> <div if="{app.dualCurrencyApplicable}" class="addOn-info">{currentAddOn.AddOnDualCurrency.toUpperCase()} {currentAddOn.DualCurrencyCurrentAddOnPrice} p/m</div> </div> </div> <div class="package-change-bottom-section"> <h2 if="{filteredAddOns.length > 0}">{langTranslateApp.pkgAvailableAddOnsTitle}</h2> <h2 if="{filteredAddOns.length == 0}">{langTranslateApp.pkgNoAddOnsTitle}</h2> <div class="package-list"> <label each="{addOn in addOns}" for="{addOn.PackageName}" class="main-packagelist-section col-lg-12 col-xs-12 col-sm-12 col-md-12"> <div if="{!app.dualCurrencyApplicable}" class="left-packagelist-section col-lg-5 col-xs-5 col-sm-5 col-md-5"> <input id="{addOn.PackageName}" type="radio" name="selectedPackage" value="{addOn.PackageName}~{addOn.AddOnPrice}" style="width: 20px; height: 21px;"><span class="icon-pack icon-{addOn.PackageCode}"></span> </div> <div if="{app.dualCurrencyApplicable}" class="left-packagelist-section col-lg-5 col-xs-5 col-sm-5 col-md-5"> <input id="{addOn.PackageName}" type="radio" name="selectedPackage" value="{addOn.PackageName}~{addOn.DualCurrencyCurrentAddOnPrice}" style="width: 20px; height: 21px;"><span class="icon-pack icon-{addOn.PackageCode}"></span> </div> <div class="right-packagelist-section {addOn.PackageName} col-lg-7 col-xs-7 col-sm-7 col-md-7"> <div class="smat-text">{langTranslateApp.addOnPriceTitle}</div> <div if="{!app.dualCurrencyApplicable}" class="smat-number">{dstvApp.countrycurrency.toUpperCase()} {addOn.AddOnPrice} <span class="pricePerMonth"> p/m</span></div> <div if="{app.dualCurrencyApplicable}" class="smat-number">{dstvApp.countrycurrency.toUpperCase()} {addOn.DualCurrencyCurrentAddOnPrice}<span class="pricePerMonth"> p/m</span></div> </div> </label> <div class="overlayBottom"> <span id="expandaddonslist" style="display:none;"> <img src="/media/7681/icon-up-3.png" width="40px"></span></div> </div> <a class="btn anim-btn btn-default change-btn" id="addOnActionButton" tabindex="-1" style="display:none;" disabled="{!enableNextButton}"><span class="anim-span"></span>{langTranslateApp.nextButtonTitle}<img src="/media/8557/icon-next.svg"></a> </div> </div> </div> <div class="" id="costSummaryAddon" style="display:none;"> <div class=""> <div class="modal-content"> <!-- Modal Header --> <div class="modal-header"> <ul class="progressbar"> <li class="active"></li> <li class="active"></li> <li class="active"></li> </ul> <h4 class="modal-title">{langTranslateApp.pkgCostSummary}</h4> <button type="button" class="close" data-dismiss="modal"><i class="icon-Close_M"></i></button> </div> <!-- Modal body --> <div class="modal-body "> <div class="package-selection"> <div class="back-package"> <div class="backcard lslide" style="width: 100%; display: inline-block;"> <div class="backcard-packageItem {dashSelectedPackageCode}"> <i class="icon-pack icon-{dashSelectedPackageCode}"></i> <div if="{!app.dualCurrencyApplicable}" class="backcardprice"> <span class="price-value">{dstvApp.countrycurrency.toUpperCase()} {dashSelectedPackagePrice}</span> <a href="/get-dstv/package/details/dstv-compact-plus" class="btn-package" target="_blank" tabindex="0">{langTranslateApp.knowMore}</a> </div> <div if="{app.dualCurrencyApplicable}" class="backcardprice"> <span class="price-value">{dstvApp.countrycurrency.toUpperCase()} {dashSelectedPackageDualCurrencyPrice.amount}</span> <a href="/get-dstv/package/details/dstv-compact-plus" class="btn-package" target="_blank" tabindex="0">{langTranslateApp.knowMore}</a> </div> <div class="bottomBar"> <span></span> </div> <div class="backgroundimg"></div> </div> </div> </div> <img src="/media/7683/icon-back.svg" class="addon-icon-img"> <div class="selected-package"> <div class="backcard lslide"> <div class="backcard-packageItem {selectedPackageCode}"> <i class="icon-pack icon-{selectedPackageCode}"></i> <div class="backcardprice"> <span class="price-value">{dstvApp.countrycurrency.toUpperCase()} {newAddOnPrice}</span> </div> <div class="bottomBar"><span>{langTranslateApp.selectedPackage}</span></div> <div class="backgroundimg"></div> </div> </div> </div> </div> <div class="bottom-section-addon"> <div class="cost-details row"> <div class="details-info col-lg-12 col-xs-12 col-sm-12 col-md-12"> <div class="details-info-text col-lg-6 col-xs-6 col-sm-6 col-md-6"> {selectedPackageName}</div> <div class="details-info-price col-lg-6 col-xs-6 col-sm-6 col-md-6">{dstvApp.countrycurrency.toUpperCase()} {newAddOnPrice}</div> </div> <div class="details-info col-lg-12 col-xs-12 col-sm-12 col-md-12"> <div class="details-info-text col-lg-6 col-xs-6 col-sm-6 col-md-6"> {langTranslateApp.pkgChangeEstimatedCost}</div> <div if="{!app.dualCurrencyApplicable}" class="details-info-price col-lg-6 col-xs-6 col-sm-6 col-md-6">{dstvApp.countrycurrency.toUpperCase()} {dueAmount}</div> <div if="{app.dualCurrencyApplicable}" class="details-info-price col-lg-6 col-xs-6 col-sm-6 col-md-6">{dstvApp.countrycurrency.toUpperCase()} {DualCurrencydueAmount}</div> </div> </div> <div class="summery-details "> <p>{langTranslateApp.pkgChangeInstruction}</p> <div class="cost-btn"> <button type="button" class="pay-btn-cost" onclick="{ProcessPayment}">{paymentButtonCaption}</button> </div> </div> <div class="overlayBottom"> <span id="expandchangeaddon"> <img src="/media/7681/icon-up-3.png" width="40px"></span></div> </div> </div> </div> </div> </div> <div class="modal-content " id="errorMessageModalAddOn" style="display:none;"> <div class="modal-headers"> <button type="button" class="close" data-dismiss="modal"><i class="icon-Close_M"></i></button> </div> <div class="modal-body"> <div class="alert-msg"> <div class=""><span if="{!app.deadlineTime}" class="icon-icon-warning"></span><span if="{!app.deadlineTime}" class="error-wrong-msg">{langTranslateApp.pkgErrorMessageTitle}</span><span if="{!app.deadlineTime}" class="error-note">{langTranslateApp.pkgErrorMessageDescription}</span><span if="{app.deadlineTime}" class="response-icon"></span><br><span if="{app.deadlineTime}" class="error-wrong-msg">{langTranslateApp.pkgErrorMessageDescription}</span><a class="btn anim-btn btn-default ok-btn close" data-dismiss="modal">{langTranslateApp.menuClose}</a></div> </div> </div> </div> <div class="modal-content " id="successMessageModalAddOn" style="display:none;"> <div class="modal-headers"> <button type="button" class="close" data-dismiss="modal"><i class="icon-Close_M"></i></button> </div> <div class="modal-body"> <div class="alert-msg-success"> <div class=""> <span class="icon-icon-tick"></span><span class="pay-success-msg">{langTranslateApp.pkgSuccessMessageTitle}</span> <div class="backcard-packageItem {selectedPackageCode}"> <i class="icon-pack icon-{selectedPackageCode}"></i> <div class="backcardprice"><span class="price-value">{dstvApp.countrycurrency.toUpperCase()} {newAddOnPrice}</span></div> <div class="bottomBar"> {langTranslateApp.pkgNewPackageTitle}</div> <div class="backgroundimg" ></div> </div> <div class="date-area"> <div class="date-sec"><span class="date-text">{langTranslateApp.pkgEffectiveDateTitle}</span><span class="date-no">{pkgEffectiveDate}</span></div> </div> <a class="btn anim-btn btn-default view-chg-btn close" data-dismiss="modal" onclick="{goToDashboardUrl}"> {langTranslateApp.pkgViewChangesTitle}</a> </div> </div> </div> </div> <div class="modal-content " id="repeatRequestMsg" style="display:none;"> <div class="modal-header"> <button type="button" class="close" data-dismiss="modal"><i class=" icon-Close_M"></i></button> </div> <div class="modal-body"> <div class="notify-area"> <div class="notify-sec"><span class="icon-icon-warning icon-notify"></span><span class="msg-text-notify">{langTranslateApp.pkgNotificationTitle}</span><span class="notify-msg">{langTranslateApp.pkgRepeatedRequestMessage}</span></div> <div class="notify-close-btn"><a class="btn anim-btn btn-default notify-close" data-dismiss="modal">Close</a></div> </div> </div> </div> <div id="addonoverlay"> <div class="cv-spinner"> <span class="cpspinner"></span> </div> </div></div>','tag-addons-new,[riot-tag="tag-addons-new"],[data-is="tag-addons-new"]{ visibility: visible; } ','',function(opts){var self=this;let linkAddOnUrl=`${dstvApp.DSOLinkAddOnsURL}`;let retryQuotesUrl=`${dstvApp.DSORetryQuotesURL}`;self.newWin='';self.paymentButtonCaption=langTranslateApp.pkgProceedToPay;self.isShowmaxActive=false;self.isShowMaxApplicable=dstvApp.BoxOfficeCountryList.includes(dstvApp.countryabbreviation);self.enableNextButton=true;self.on('mount',function(){if(!opts.showmodal&&opts.showAlert){$('.addOnPacakgeModal').hide();$('#errorMessageModalAddOn').show();self.update();}
if(opts.showmodal){$("#addonoverlay").fadeIn(300);setTimeout(function(){site.factory.GetJWT().then(function(token){self.token=token;self.dashSelectedPackageCode=app.dashSelectedPackageName?app.dashSelectedPackageName.split('-')[0].trim():app.ProductCode;self.dashSelectedPackageName=app.dashSelectedPackageName?app.dashSelectedPackageName.split('-')[1].trim():app.currentPackageFullName;self.dashSmartCardNumber=app.dashSelectedSmartCard?app.dashSelectedSmartCard:app.smartcard;self.dashSelectedPackageDetails=app.smartcards.filter(sc=>sc.SerialNumber==self.dashSmartCardNumber).filter(ps=>ps.primaryService.productCode==self.dashSelectedPackageCode);self.dashSelectedPackagePrice=self.dashSelectedPackageDetails[0].primaryService.price;self.dashSelectedPackageDualCurrencyPrice=self.dashSelectedPackageDetails[0].primaryService.localPrice;self.filteredAddOnServiceList=app.viewSubscriptionResponse.filter(sc=>sc.smartcardNumber==self.dashSmartCardNumber)[0].services.filter((service)=>{return!service.serviceName.toUpperCase().includes('SHOWMAX')&&(service.type=='Addon'||service.description.includes('Add-on')||service.description.includes('add-on'));});if(self.filteredAddOnServiceList&&self.filteredAddOnServiceList.length>0){self.CurrentAddOnsList=self.filteredAddOnServiceList.filter(d=>d.status='Active')
self.currentAddOns=self.CurrentAddOnsList.map((currentAddOn)=>{return{CurrentPackageCode:currentAddOn.serviceName.split(' ')[0],CurrentPackageName:currentAddOn.serviceName,CurrentAddOnPrice:currentAddOn.price,AddOnDualCurrency:currentAddOn.localPrice?currentAddOn.localPrice.currency:null,DualCurrencyCurrentAddOnPrice:currentAddOn.localPrice?currentAddOn.localPrice.amount:null}})}
if(app.loggedin){let url=`${dstvApp.DSOChangePackageURL}`;var reqBody={"businessUnit":dstvApp.businessunit,"channel":dstvApp.channel,"country":dstvApp.country,"packageName":app.dashSelectedPackageName};site.trigger('getpostdata',url,'POST','application/json',"Bearer "+self.token,'',reqBody,'',self.onChangePackageSuccess,self.onChangePackageError);}})},1000);$(document).ready(function(){$('#expandaddonslist').click(function(){$('.package-list').toggleClass('fullHeight');$('#addOnPackageModal').animate({scrollTop:$(document).height()},'slow');});$('#expandchangeaddon').click(function(){$('.bottom-section-addon').toggleClass('fullHeight');});});if(app.accountsInfo&&app.accountsInfo[0]&&app.accountsInfo[0].AccountBalance){self.availableAccountBalance=app.accountsInfo.filter(d=>d.AccountType=='DStvRes')[0].AccountBalance.Value;if(dstvApp.DualCurrency=='on'&&dstvApp.DualCurrencyCountryList.includes(dstvApp.countryabbreviation))
self.availableAccountBalanceDualCurrency=app.accountsInfo.filter(d=>d.AccountType=='DStvRes')[0].AccountBalance.LocalPrice.Amount.toString();}
else{self.availableAccountBalance='NA';}
$('#addOnActionButton').click(function(e){if(!self.enableNextButton)
return;$("#addonoverlay").fadeIn(300);var selectedPackageValue=$("input[name='selectedPackage']:checked").val();var selectedPackage=selectedPackageValue.split('~')[0].trim();self.newAddOnPrice=selectedPackageValue.split('~')[1].trim();self.currency=dstvApp.countrycurrency.toUpperCase();if(selectedPackage.toUpperCase().includes('SHOWMAX')){self.selectedPackageName=selectedPackage;self.isShowmaxActive=true;$('#addOnPackageModal').modal('hide');riot.mount('tag-showmax-atb',{activateShowmaxAddOn:true,openpopup:true});return;}
self.selectedPackageCode=selectedPackage.split('-')[0].trim();self.selectedPackageName=selectedPackage.split('-')[1].trim();app.currentSelectedAddOn=selectedPackage;window.SessionSave('app',app);var reqBodyLinkAddOn={"businessUnit":dstvApp.businessunit,"channel":dstvApp.channel,"country":dstvApp.country,"smartCardNumber":self.dashSmartCardNumber,"customerNumber":app.customernumber,"addOnProducts":[selectedPackage]};site.trigger('getpostdata',linkAddOnUrl,'POST','application/json',"Bearer "+self.token,'',reqBodyLinkAddOn,'',self.onLinkAddOnSuccess,self.onLinkAddOnError);self.enableNextButton=false;self.update();});}});self.GenerateJWT=function(){site.factory.GetJWT().then(function(token){self.token=token;})}
self.onChangePackageSuccess=function(data){console.log('Package : Call Change Package API Success');filteredAddOns=data.filter(d=>d.isAddOn===true);let showmaxProductDetails=app.viewSubscriptionResponse.filter(sc=>sc.smartcardNumber==self.dashSmartCardNumber)[0].services.filter((service)=>{return service.type=='ThirdParty'&&service.serviceName.toUpperCase().includes('SHOWMAX');});if(showmaxProductDetails&&showmaxProductDetails.length>0&&showmaxProductDetails[0].status.toUpperCase()=='ACTIVE'){self.isShowmaxActive=true;}
if(self.isShowmaxActive||!self.isShowMaxApplicable){filteredAddOns=filteredAddOns.filter(d=>!d.name.toUpperCase().includes('SHOWMAX'));}
self.filteredAddOnServiceList=app.viewSubscriptionResponse.filter(sc=>sc.smartcardNumber==self.dashSmartCardNumber)[0].services.filter((service)=>{return!service.serviceName.toUpperCase().includes('SHOWMAX')&&(service.type=='Addon'||service.description.includes('Add-on')||service.description.includes('add-on'))&&(service.status.toUpperCase()=='ACTIVE');});if(filteredAddOns.length>0&&self.filteredAddOnServiceList&&self.filteredAddOnServiceList.length>0){$.each(self.filteredAddOnServiceList,function(i,item){filteredAddOns=filteredAddOns.filter(d=>d.id!=self.filteredAddOnServiceList[i].serviceId);});}
self.addOns=filteredAddOns.map((addOn)=>{return{PackageCode:addOn.name.split(' ')[0],PackageName:addOn.name,AddOnCurrency:addOn.price.currency,AddOnPrice:addOn.price.value,AddOnDualCurrency:addOn.localPrice?addOn.localPrice.currency:null,DualCurrencyCurrentAddOnPrice:addOn.localPrice?addOn.localPrice.amount:null}})
self.addOnsCount=filteredAddOns.length;if(self.addOnsCount>2){$("#expandaddonslist").show();}else{$('.package-list').css('height','auto');}
$("#addonoverlay").fadeOut(300);self.update();var isRadioChecked=$("input:radio[name='selectedPackage']").is(":checked");$('input:radio[name="selectedPackage"]').click(function(){var isRadioChecked=$("input:radio[name='selectedPackage']").is(":checked")
if(isRadioChecked){$('#addOnActionButton').show();$('.progressbar li:nth-child(2)').addClass("active");}});}
self.onChangePackageError=function(err){console.log('Change Pacakge : error while changing the package');$("#addonoverlay").fadeOut(300);window.SessionSave("app",app);}
self.onLinkAddOnSuccess=function(data){console.log('Add On : Call LinkAddOn API Success');$("#addonoverlay").fadeOut(300);if(data){if(data.effectiveDate==null){self.pkgEffectiveDate=self.formatEffectiveDate(new Date());}
else{self.pkgEffectiveDate=self.formatEffectiveDate(new Date(data.effectiveDate));}}
self.update();$('#costSummaryAddon').hide();$('.addOnPacakgeModal').hide();$('#successMessageModalAddOn').show();site.factory.CaptureFeedback('DSTVCHANGEPACKAGE_'+app.customernumber);}
self.onLinkAddOnError=function(err){console.log('Link Add On : error while linking Add On to your package');$("#addonoverlay").fadeOut(300);if(err.responseJSON.StatusCode==424){var reqBodyRetryQuotes={"businessUnit":dstvApp.businessunit,"channel":dstvApp.channel,"country":dstvApp.country,"smartCardNumber":app.SmartCardNumber,"products":[app.dashSelectedPackageName,app.currentSelectedAddOn]};site.trigger('getpostdata',retryQuotesUrl,'POST','application/json',"Bearer "+self.token,'',reqBodyRetryQuotes,'',self.onRetryQuotesSuccess,self.onRetryQuotesError);$('#costSummaryAddon').hide();$('.addOnPacakgeModal').hide();$('#errorMessageModalAddOn').show();$(".error-note").html(`${langTranslateApp.genericTechnicalIssueMsg1} <u><a class="payments_errContactUs" href="${window.culture}/${langTranslateApp.subMenuContactUsLink}">${langTranslateApp.subMenuContactUs}</a></u> ${langTranslateApp.genericTechnicalIssueMsg2}`);}
else if(err.responseJSON.StatusCode==402){var res=err.responseJSON.Message.split('\\');res=JSON.parse(res);self.dueAmount=res.Payment.Amount;self.currency=res.Payment.Currency;self.DualCurrency=res.LocalCurrency?res.LocalCurrency.Currency:null;self.DualCurrencydueAmount=res.LocalCurrency?res.LocalCurrency.Amount:null;self.message=res.ResponseMessage;self.update();$('.addOnPacakgeModal').hide();$('#costSummaryAddon').show();}
else if(err.responseJSON.StatusCode==208){$('#costSummaryAddon').hide();$('.addOnPacakgeModal').hide();$('#repeatRequestMsg').modal('show');if(site.env=='QA')
site.factory.CaptureFeedback('DSTVCHANGEPACKAGE_'+app.customernumber);}
else{console.log(err.responseJSON.Message);$('#costSummaryAddon').hide();$('.addOnPacakgeModal').hide();$('#errorMessageModalAddOn').show();if(err.responseJSON&&ShowGenericError(err.responseJSON.StatusCode)){$(".error-note").html(`${langTranslateApp.genericTechnicalIssueMsg1} <u><a class="payments_errContactUs" href="${window.culture}/${langTranslateApp.subMenuContactUsLink}">${langTranslateApp.subMenuContactUs}</a></u> ${langTranslateApp.genericTechnicalIssueMsg2}`);}
function ShowGenericError(errStatusCode){return errStatusCode==500||errStatusCode==400||errStatusCode==412||errStatusCode==424;}
if(!app.deadlineTime){let delay=5*60*1000;self.date=new Date();app.deadlineTime=self.date.setTime(self.date.getTime()+delay);window.SessionSave("app",app);}
if(site.env=='QA')
site.factory.CaptureFeedback('DSTVCHANGEPACKAGE_'+app.customernumber);}}
self.onRetryQuotesSuccess=function(data){console.log('Add On : Call Retry Quotes API Success')
if(data){self.pkgEffectiveDate=self.formatEffectiveDate(new Date(data.effectiveDate));}
self.update();$("#cpoverlay").fadeOut(300);$('.addOnPacakgeModal').hide();$('#costSummaryAddon').hide();$('#successMessageModalAddOn').show();}
self.onRetryQuotesError=function(err){console.log('Retry Quotes  : error while retrying Quotes ')
$("#cpoverlay").fadeOut(300);if(err.responseJSON.StatusCode==402){var res=err.responseJSON.Message.split('\\');res=JSON.parse(res);self.dueAmount=res.Payment.Amount;self.currency=res.Payment.Currency;self.DualCurrency=res.PaymentInLocalCurrency?res.PaymentInLocalCurrency.Currency:null;self.DualCurrencydueAmount=res.PaymentInLocalCurrency?res.PaymentInLocalCurrency.Amount:null;self.message=res.ResponseMessage;self.update();$('.addOnPacakgeModal').hide();$('#costSummaryAddon').show();}
else{console.log(err.responseJSON.Message);$('#costSummaryAddon').hide();$('.addOnPacakgeModal').hide();$('#errorMessageModalAddOn').show();if(err.responseJSON&&ShowGenericError(err.responseJSON.StatusCode)){$(".error-note").html(`${langTranslateApp.genericTechnicalIssueMsg1} <u><a class="payments_errContactUs" href="${window.culture}/${langTranslateApp.subMenuContactUsLink}">${langTranslateApp.subMenuContactUs}</a></u> ${langTranslateApp.genericTechnicalIssueMsg2}`);}
function ShowGenericError(errStatusCode){return errStatusCode==500||errStatusCode==400||errStatusCode==412||errStatusCode==424;}}}
self.formatEffectiveDate=function formatDate(date){var monthNames=["January","February","March","April","May","June","July","August","September","October","November","December"];var day=date.getDate();var monthIndex=date.getMonth();var year=date.getFullYear();return day+' '+monthNames[monthIndex]+' '+year;}
self.goToDashboardUrl=function(e){if(app.loggedin)
window.location=dstvApp.DashboardURL;}
self.update();self.ProcessPayment=function(){if(dstvApp.NoOnlinePaymentCountryList.includes(dstvApp.countryabbreviation)){site.factory.HandleHowToPay();}
else{$("#cpoverlay").fadeIn(300);$('#addOnPackageModal').modal('hide');riot.mount('tag-payments-new',{changePackagePayment:true,amount:self.dueAmount});}}
self.loadIframeAndProcessPayment=function(){self.newWin=window.open('','_blank');let html="";if(dstvApp.languageAbbreviation=='pt')
html+="<html><head></head><body><div>Por favor, espere...</div></body></html>";else
html+="<html><head></head><body><div>Please Wait...</div></body></html>";self.newWin.document.write(html);riot.mount('tag-payments-new');$("#addonoverlay").fadeIn(300);let dueAmount=self.dueAmount;let currency=dstvApp.countrycurrency;let toAddOnProductCode=app.currentSelectedAddOn.split('-')[0].trim();if(dstvApp.DualCurrency=='on'&&dstvApp.DualCurrencyCountryList.includes(dstvApp.countryabbreviation)){currency=dstvApp.DualCurrencyPaymentCurrency.filter(x=>x.country==dstvApp.countryabbreviation)[0].currency;}
let account=app.accounts.filter(x=>x.AccountType=="DStvRes");let accNumber=account[0]?account[0].AccountNumber:null;var reqBodyPaymentService={"country":dstvApp.country,"businessUnit":dstvApp.businessunit,"channel":dstvApp.channel,"currency":currency,"customerNumber":app.customernumber,"smartCardNumber":app.dashSelectedSmartCard,"firstName":app.customerDetails.PersonalDetail.FirstName,"name":app.customerDetails.PersonalDetail.Surname,"accountNumber":accNumber,"amount":dueAmount,"productUserKey":toAddOnProductCode,"paymentType":"DstvPayment","backUrl":"","successReturnURL":"","failureReturnURL":"","bypassPaymentSuite":true,"LanguageCode":dstvApp.languageAbbreviation};site.trigger('getpostdata',dstvApp.DSOPaymentServiceURL,'POST','application/json',"Bearer "+self.token,'',reqBodyPaymentService,'',self.onPaymentProcessSuccess,self.onPaymentProcessError);}
self.onPaymentProcessSuccess=function(data){console.log('Payment process successful');$('#addOnPackageModal').modal('hide');$('#paymentModal').modal('show');$("#addonoverlay").fadeOut(300);if(data){let dppRedirectUrl=data.redirectUrl;$('#paymentPage').hide();$('#paymentModal').modal('hide');self.newWin.location=dppRedirectUrl;}
else{$("#paymentsoverlay").fadeOut(300);console.log('error after successful DSOPaymentServiceURL call');}}
self.onPaymentProcessError=function(err){$("#addonoverlay").fadeOut(300);$('.changePackModel').hide();$('#errorMessageModalAddOn').modal('show');console.log('Error on DSO Payment process');let html="";if(dstvApp.languageAbbreviation=='pt')
html+="<html><head></head><body><div>Algo deu errado!</div></body></html>";else
html+="<html><head></head><body><div>Something went wrong!</div></body></html>";self.newWin.document.write(html);}
self.processPaymentVSC=function(){var smartQuoteRequest={BasketId:0,BoxOffice:false,BusinessUnit:dstvApp.businessunit,City:"",Country:dstvApp.country,CustomerNumber:app.customernumber,DeviceNumber:"",InterfaceType:"DStv Facebook and Mobi",ProductUserKey:self.selectedPackageCode,QuotePeriod:1,InvoicePeriod:1};var apiUrl='';if(site.env=='QA'){apiUrl=dstvApp.ProxyAPIUrl;}
else{apiUrl=dstvApp.APIUrl;}
$.post(apiUrl+"Retail/GetSmartQuote?vendorCode="+dstvApp.vendorcode+"&language="+dstvApp.language+"&ipAddress="+"123",smartQuoteRequest,function(QuoteRes,status,xhr){console.log("SmartByProd",QuoteRes);console.log("SmartQuoteRequest",smartQuoteRequest);var totalAmount=QuoteRes.Quote.ProductsTotalAmount;var balanceDue=Math.abs(QuoteRes.Quote.BalanceDue);var smartcardNumberPay=sessionStorage.getItem("smartcardNumberPay");var paymentUrl=dstvApp.PaymentBaseUrl+dstvApp.countryisocode+'/'+dstvApp.languageAbbreviation+'/payment/'+app.smartcard+'/'+QuoteRes.BasketId;if(dstvApp.NoOnlinePaymentCountryList.includes(dstvApp.countryabbreviation)){paymentUrl=window.culture+'/ways-to-pay';}
var controllerUrl=dstvApp.PaymentBaseUrl+dstvApp.countryisocode+'/'+dstvApp.languageAbbreviation+'/ProcessPaymentDSOChangePackage/'+app.smartcard;$.ajax({url:controllerUrl,type:'POST',data:{amountToPay:self.dueAmount.toFixed(),smartcard:app.SmartCardNumber,basketId:QuoteRes.BasketId},beforeSend:function(){$("#addonoverlay").fadeIn(300);},complete:function(){$("#addonoverlay").fadeOut(300);},success:function(response){console.log(response);window.location=response.redirecturl;},error:function(response){console.log(response);}});});}
self.onErrorClose=function(){$('#errorMessageModalAddOn').modal('hide');}
if(dstvApp.NoOnlinePaymentCountryList.includes(dstvApp.countryabbreviation)){self.paymentButtonCaption=langTranslateApp.dashboardHowToPay;}});riot.tag2('tag-payments-new','<div class="modal-dialog"> <div id="paymentsModal" class="modal-content"> <div class="modal-header"><button type="button" class="close" data-dismiss="modal"><i class=" icon-Close_M"></i> </button></div> <div class="modal-body"> <iframe id="dppiframe" src="" allow="payment" height="auto" width="100%" style="display: none; min-height:500px; background-color: white;"></iframe> <div id="payment-main-section" if="{!showRecurringScreen && !showTerminatedBouquetScreen && !showAwarenessMsg}"> <div class="main-top-payment-info row" style="display: block" ;> <div class="col-lg-4 pay-btn-section col-sm-12" style="display:none;"> <span class="btn anim-btn btn-default payletf-btn" tabindex="-1"><span class="anim-span"></span>{langTranslateApp.payMyAccount}</span> <span class="btn anim-btn btn-default secondpayletf-btn" tabindex="-1"><span class="anim-span"></span>{langTranslateApp.payForSomeone}</span></div> <div class="col-lg-12 custom-details-sec second-sec-slider payFORU col-sm-12" id="paymentPage"> <h4 class="modal-title">{langTranslateApp.paymentSuite.toUpperCase()}</h4> <div class="custom-details-sec-desk"> <div class="custom-fields-sec col-lg-6"> <div class="customer-info-section"> <div class="form-group"> <fieldset> <legend id="accountholderLegend">{langTranslateApp.accountHolder}</legend> <input type="text" autocomplete="off" class="form-control input-lg " id="" name="signIn_smartCardNumber" maxlength="10" value="{app.customername}" readonly> </fieldset> </div> <div class="form-group"> <fieldset> <legend id="smartnumberLegend">{langTranslateApp.smartcard}</legend> <input type="text" autocomplete="off" class="form-control input-lg " id="" name="signIn_smartCardNumber" maxlength="10" value="{app.smartcard}" readonly> </fieldset> </div> </div> <div class="form-group edit_amount"> <div class="edit-iner-section"> <span class="countryCode">{dstvApp.countrycurrency.toUpperCase()}</span> <label id="editamountLegend">{langTranslateApp.editAmount}</label><input type="text" autocomplete="off" class="form-control input-lg focus" id="editableAmount" name="signIn_smartCardNumber" maxlength="10" placeholder={AmountToPay()} value={AmountToPay()} onkeyup="{OnKeyUp}" style="color: #888;" readonly><span class="edit-payment-icon"><img src="/media/8611/edit-icon.svg"></span> <div class="error-payment-msg"><span if="{showErrorMsg}" style="color: red;">{errorMsg}</span></div> </div> </div> </div> <div class="amount-details-sec col-lg-6"> <div class="customer-info-section second-sec "> <div> <span class="custom-country-info">{dstvApp.countrycurrency.toUpperCase()}</span></div> <div if="{!app.dualCurrencyApplicable}"> <span class="custom-country-amount-info">{AmountToPay()}</span></div> <div if="{app.dualCurrencyApplicable}"> <span class="custom-country-amount-info">{app.paymentduedetails.properties.amountToPayEtb.value}</span></div> <div> <span class="custom-country-decriptive-info">{langTranslateApp.totalAmountToPay}</span></div> </div> <div class="customer-info-section pay-now-decription"><input type="button" id="paybtn-dashboard" class="paynowBtn-partial" disabled="{disablePayNow}" onclick={validateEditedAmount} value={paymentButtonCaption} /> </div> </div> <button id="redirectToDpp" type="button" style="display: none">Redirect to DPP</button> </div> </div> <div class="col-lg-8 custom-details-sec second-sec-slider payForOther col-sm-12" style="display:none;"> <h4 class="modal-title">PAYMENT SUITE</h4> <div class="customer-info-section"> <div class="form-group"> <fieldset> <legend id="countryLegend">Country</legend> <select type="text" class="form-control " id="african-countries"> <option value="angola">Angola</option> <option value="benin">Benin</option> <option value="botswana">Botswana</option> <option value="burkina Faso">Burkina Faso</option> <option value="burundi">Burundi</option> <option value="cameroon">Cameroon</option> <option value="cape-verde">Cape Verde</option> <option value="central-african-republic">Central African Republic</option> <option value="chad">Chad</option> <option value="comoros">Comoros</option> <option value="congo-brazzaville">Congo - Brazzaville</option> <option value="congo-kinshasa">Congo - Kinshasa</option> <option value="ivory-coast">Côte d’Ivoire</option> <option value="djibouti">Djibouti</option> <option value="egypt">Egypt</option> <option value="equatorial-guinea">Equatorial Guinea</option> <option value="eritrea">Eritrea</option> <option value="ethiopia">Ethiopia</option> <option value="gabon">Gabon</option> <option value="gambia">Gambia</option> <option value="ghana">Ghana</option> <option value="guinea">Guinea</option> <option value="guinea-bissau">Guinea-Bissau</option> <option value="kenya">Kenya</option> <option value="lesotho">Lesotho</option> <option value="liberia">Liberia</option> <option value="libya">Libya</option> <option value="madagascar">Madagascar</option> <option value="malawi">Malawi</option> <option value="mali">Mali</option> <option value="mauritania">Mauritania</option> <option value="mauritius">Mauritius</option> <option value="mayotte">Mayotte</option> <option value="morocco">Morocco</option> <option value="mozambique">Mozambique</option> <option value="namibia">Namibia</option> <option value="niger">Niger</option> <option value="nigeria">Nigeria</option> <option value="rwanda">Rwanda</option> <option value="reunion">Réunion</option> <option value="saint-helena">Saint Helena</option> <option value="senegal">Senegal</option> <option value="seychelles">Seychelles</option> <option value="sierra-leone">Sierra Leone</option> <option value="somalia">Somalia</option> <option value="south-africa">South Africa</option> <option value="sudan">Sudan</option> <option value="south-sudan">Sudan</option> <option value="swaziland">Swaziland</option> <option value="Sao-tome-príncipe">São Tomé and Príncipe</option> <option value="tanzania">Tanzania</option> <option value="togo">Togo</option> <option value="uganda">Uganda</option> <option value="zambia">Zambia</option> <option value="zimbabwe">Zimbabwe</option> </select> </fieldset> </div> <div class="form-group"> <fieldset> <legend id="accountholderLegend">Account holder</legend> <input type="text" autocomplete="off" class="form-control input-lg " id="" name="signIn_smartCardNumber" maxlength="10"> </fieldset> </div> <div class="form-group"> <fieldset> <legend id="smartnumberLegend">Smartcard number</legend> <input type="text" autocomplete="off" class="form-control input-lg " id="" name="signIn_smartCardNumber" maxlength="10"> </fieldset> </div> </div> <div class="payment-smartcardError"> <span class="error-icon-pay"><img src="/media/8165/icon-fix-errors-1.svg"></span> <span class="error-text-pay">You have entered the wrong smart card number please try again.</span></div> <div class="form-group edit_amount"><label id="editamountLegend">Edit Amount</label><input type="text" autocomplete="off" class="form-control input-lg " id="" name="signIn_smartCardNumber" maxlength="10"> <span class="edit-payment-icon"><img src="/media/8611/edit-icon.svg"></span></div> <div class="customer-info-section second-sec"> <div> <span class="custom-country-info">NGN</span></div> <div> <span class="custom-country-amount-info">3832</span></div> <div> <span class="custom-country-decriptive-info">Total amount to pay</span></div> </div> <div class="customer-info-section pay-now-decription"> <span class="custom-country-pay-now-info">Pay Now</span></div> </div> <div class="alert-msg" id="errorMessage"> <div class=""><span class="icon-icon-warning"></span> <span class="error-wrong-msg">{langTranslateApp.paymentErrorMessageTitle}</span> <span if="{!genericError}" class="error-note">{langTranslateApp.paymentErrorMessageDescription}</span> <span if="{genericError}" class="error-note">{langTranslateApp.genericTechnicalIssueMsg1} <u><a class="payments_errContactUs" href="{window.culture}/{langTranslateApp.subMenuContactUsLink}">{langTranslateApp.subMenuContactUs}</a></u> {langTranslateApp.genericTechnicalIssueMsg2}</span> <a href="javascript:void(0)" onclick="{onErrorClose}" class="btn anim-btn btn-default ok-btn close" data-dismiss="modal">{langTranslateApp.menuClose}</a> </div> </div> </div> <h5 class="payment-heading" if="{paymentStatus.show}">{langTranslateApp.awareness3dHeaderText1} <b>{paymentStatus.heading.toLowerCase()}</b></h5> <div class="response-end {paymentStatus.class}" if="{paymentStatus.show}"> <div class="icon-img-common"></div> <div class="AwarenessInfoArea {paymentStatus.class}" style="padding: 20px;"> <!--<img if="{showmaxIconVisible}" src="/media/10051/showmax-logo.svg" class="paymentstatus-showmax-icon"> <img src="/media/10053/success-tick.svg" class="icon-success" if="{showmaxPaymentStatus}"> <h5 if="{!showmaxPaymentStatus}">{paymentStatus.heading}</h5>--> <span if="{paymentStatus.class == \'pending\'}" class="awareness-top-text"><b>{langTranslateApp.paymentsMsg1}</b></span> <span if="{paymentStatus.class == \'pending\'}" class="awareness-top-text">{langTranslateApp.paymentsMsg6} <b>{langTranslateApp.paymentsMsg7}</b></span> <span if="{paymentStatus.class == \'success\'}" class="awareness-top-text"><b>{langTranslateApp.paymentsMsg1} </b>{langTranslateApp.paymentsMsg2}</span> <span if="{paymentStatus.class == \'success\'}">{langTranslateApp.paymentsMsg3} <b>{langTranslateApp.paymentsMsg4}</b></span> <span if="{paymentStatus.class == \'failed\'}" class="awareness-top-text">{langTranslateApp.paymentsMsg8} <b>{langTranslateApp.paymentsMsg9} </b>{langTranslateApp.paymentsMsg10}</span> <p if="{paymentStatus.class == \'failed\'}" class="processing">{paymentStatus.message}</p> <span if="{paymentStatus.class == \'success\' || paymentStatus.class == \'pending\'}" class="awareness-sub-text">{langTranslateApp.paymentsMsg5}</span> <!--<p if="{showmaxPaymentStatus && showMessage}" class="showmax-message" style="padding-top:15px;">Thank you for activating Showmax.</p>--> <p if="{showmaxPaymentStatus && showMessage}" class="showmax-message longmessage">To finish Showmax setup, please create or sign in to a Showmax account.</p> <div class="dppinnerwrap details {paymentStatus.class}"> <div class="batched"> <div class="field-title">{langTranslateApp.paymentsTransactionId}</div> <div class="field-value">{paymentStatus.transactionId}</div> <div class="field-title" if="{paymentStatus.amountDue}">{langTranslateApp.paymentsAmount}</div> <div class="field-value" if="{paymentStatus.amountDue}">{paymentStatus.currency} &nbsp; {paymentStatus.amountDue}</div> <div class="field-title">{langTranslateApp.paymentsStatus}</div> <div class="field-value status">{(paymentStatus.status=="Undefined" || paymentStatus.status=="undefined") ? langTranslateApp.inComplete : paymentStatus.heading}</div> <div class="field-title">{langTranslateApp.paymentsDate}</div> <div class="field-value date">{paymentStatus.date}</div> <div class="field-title" if="{localPrice && dstvApp.DualCurrencyCountryList.includes(dstvApp.countryabbreviation)}">{langTranslateApp.localPaymentsAmount}</div> <div class="field-value" if="{localPrice && dstvApp.DualCurrencyCountryList.includes(dstvApp.countryabbreviation)}">{paymentStatus.localCurrency} &nbsp; {paymentStatus.localAmountDue}</div> </div> </div> </div> <button class="awareness-activate-btn {paymentStatus.class}" id="Cancel" if="{paymentStatus.class != \'success\'}" onClick="{closePaymentDialog}" style="margin-right: 15px;"><span class="anim-span"></span><i class="fa fa-long-arrow-left" style="float: left; line-height: 25px; font-size: larger;"></i><span>{langTranslateApp.updateCancel}</span></button> <button class="awareness-activate-btn {paymentStatus.class}" id="Done" if="{paymentStatus.class == \'success\'}" onClick="{closePaymentDialog}"><span class="anim-span"></span><span>{langTranslateApp.updateDone.toUpperCase()}</span><span class="arrowNow" style="color:#000;"></span></button> <button class="btn btn-white anim-btn payment-status-btn showmax-payment-status-btn" id="Done" if="{showmaxPaymentStatusReconnect}" onClick="{onAddShowmax}"><span class="anim-span"></span><span style="color:#fff;">{langTranslateApp.addShowmax}</span><span class="arrowNow" style="color:#fff;"></span></button> <!--<button class="btn btn-white anim-btn payment-status-btn showmax-payment-status-btn" id="" if="{smartcardPaymentSuccess}" onClick="{onReconnectShowmax}"><span class="anim-span"></span><span style="color:#fff;">Reconnect Showmax</span><span class="arrowNow" style="color:#fff;"></span></button>--> <button class="btn btn-white anim-btn payment-status-btn showmax-payment-status-btn " id="Done" if="{showmaxPaymentStatus}" onClick="{onAddShowmax}"><span class="anim-span"></span><span style="color:#fff;">Continue to Showmax</span><span class="arrowNow" style="color:#fff;"></span></button> <button class="awareness-activate-btn {paymentStatus.class}" id="Refresh" if="{paymentStatus.class == \'pending\'}" onClick="{getPaymentStatus}"><span class="anim-span"></span><span if="{!fetchingPaymentStatus}"><span> {langTranslateApp.payRefresh}</span> <i class="fa fa-repeat" style="float: right; line-height: 25px; font-size: larger;"></i></span><span if="{fetchingPaymentStatus}"><span> {langTranslateApp.payRefreshing}</span><i class="fa fa-repeat fa-spin" style="float: right; line-height: 25px; font-size: larger;"></i></span></button> <button class="awareness-activate-btn {paymentStatus.class}" id="Refresh" if="{paymentStatus.class == \'failed\'}" onClick="{onRetry}"><span class="anim-span"></span><span if="{!fetchingPaymentStatus}"><span> {langTranslateApp.paymentsRetry.toUpperCase()}</span> <i class="fa fa-repeat" style="float: right; line-height: 25px; font-size: larger;"></i></span></button> </div> </div> <div if="{showAwarenessMsg}" class="AwarenessSection" id="awarenessPopup"> <div class="container-fluid main-section awareness"> <div class="top-info-awareness">{langTranslateApp.awareness3dHeaderText1} <b>{langTranslateApp.awareness3dHeaderText2}</b> </div> <div class="popup AwarenessPopup"> <img src="/media/11063/payment-awareness.svg" class="awareness-icon"> <div class="AwarenessInfoArea"> <span class="awareness-top-text"><b>{langTranslateApp.awareness3dMsg1} </b>{langTranslateApp.awareness3dMsg2} <b>{langTranslateApp.awareness3dMsg3} </b>{langTranslateApp.awareness3dMsg4} <b>{langTranslateApp.awareness3dMsg5}</b></span> <span class="awareness-sub-text">{langTranslateApp.awareness3dMsg6}</span></div> <div class="awareness-activate-btn payment security"><a class="payment security" href="javascript:void(0)" onclick="{processPayment}">{langTranslateApp.paymentsContinue} <span class="arrowNow"></span></a></div> </div> </div> </div> <div id="paymentsoverlay" class="row"> <div class="cv-spinner"> <span class="cpspinner"></span></div> </div> <div class="recurring-intro" if="{showRecurringScreen && !showTerminatedBouquetScreen && !showAwarenessMsg}"> <div class="col-md-6 main-image"><img src="/media/9289/payu-main.png" alt="PayU Recurring Payment"></div> <div class="col-md-6 main-text"> <h1 class="sectionTitle"></h1> <p>Introduces</p> <h2>Recurring Payments</h2> <div style="text-align: center;margin-bottom: 10px;font-size: 22px;"><span style="margin-right: 10px;">With</span><img src="/media/9519/payu.png" style="width: 100px;"></div> <p if="{showSetUpRecurringOption}"><button onclick={SetupReccuringPayment}>Setup Recurring Payments</button></p> <p if="{showOnceoffOption}"><button onclick={SetupReccuringPayment}>Make Onceoff Payment</button></p> </div> </div> <div class=" " id="terminatedBouquet" if="{showTerminatedBouquetScreen}"> <div class="bouquet-content"> <div class="popup bouquet"> <div class="row"> <div class="main-text"> <h4 class="bouquetsubheading"> We have discontinued some of our packages.</h4> <span class="bouquettext">Please change your package from below to continue your viewing experience.</span> <div class="bouquet-img"><img src="/media/9771/bouquet_termination.png"><a class="bouquetbutton"><button href="javascript(void);" onclick={loadChangePackage}>Change Package <span class="icon-icon-next"> </span></button></a></div> </div> </div> </div> </div> </div> </div> </div></div></div>','tag-payments-new,[riot-tag="tag-payments-new"],[data-is="tag-payments-new"]{ visibility: visible; } ','',function(opts){var self=this;self.smartcard=app.smartcard;self.paymentButtonCaption=langTranslateApp.subMenuPayNow;self.showSetUpRecurringOption=opts.showSetUpRecurringOption==undefined?true:opts.showSetUpRecurringOption;self.showOnceoffOption=opts.showOnceoffOption==undefined?true:opts.showOnceoffOption;var amountDue='';var editedAmount='';var amountToProcess='';self.newWin='';self.paymentStatus={};self.disablePayNow=false;self.genericError=false;self.showErrorMsg=false;self.buttonCaption='Watch Now';self.showAwarenessMsg=false;self.isPaymentCompleted=false;self.on('before-mount',function(){self.GenerateJWT();});self.on('mount',function(){if(dstvApp.DualCurrencyCountryList.includes(dstvApp.countryabbreviation)){self.fetchConversionFactor();}
self.OnKeyUp()
$('#errorMessage').hide();self.paymentStatus.show=false;if(app.showTerminatedBouquetScreen){self.showTerminatedBouquetScreen=true;self.showRecurringScreen=false;self.update();}
else if(self.opts.showRecurringScreen){self.showRecurringScreen=true;self.update();}
else if(opts.showmaxPayment||opts.showmaxChangePackagePayment||opts.changePackagePayment||opts.boxOfficePayment||opts.payReconnectShowmax){amountToProcess=opts.amount;$('#paymentModal').modal('show');$('#paymentPage').hide();self.showAwarenessPopup();}
$('.edit-payment-icon').click(function(){if($('#editableAmount').val()==""||$('#editableAmount').val()==null){return false;}
else{$('#editableAmount').prop('readonly',false);$('#editableAmount').focus();}});$("#editableAmount").keypress(function(e){var amount='';var isParsed=false;if((this.value).indexOf('.')>-1){amount=this.value;}
else{amount=parseFloat(this.value).toFixed(4);isParsed=true;}
if(app.dualCurrencyApplicable&&dstvApp.countryabbreviation=='et'&&e.which==46){return false;}
else if((e.which!=8&&e.which!=0&&e.which!=46&&this.value.trim()==""&&(e.which<48||e.which>57))||(e.which!=8&&e.which!=0&&e.which!=46&&this.value.trim()!==""&&(e.which<48||e.which>57))){return false;}
var number=amount.split('.');if(number.length>1&&e.which==46&&!isParsed){return false;}
if(amount=="NaN"&&this.value!=""){return false;}
if((amount.indexOf('.')!=-1)&&(amount.substring(amount.indexOf('.')).length>2)&&($(this)[0].selectionStart>=amount.length-2))
{return false;}
return true;});$('#dppiframe').load(function(){$("#paymentsoverlay").fadeOut(300);});$('#paymentModal').on('hidden.bs.modal',function(){console.log('Payment Suit: On closing...')
if(self.tokenGenerated&&self.isPaymentCompleted){site.factory.CaptureFeedback('DSTVPAYNOW_'+app.customernumber);self.tokenGenerated=false;self.GetAmountToPay();}})});self.GenerateJWT=function(){site.factory.GetJWT().then(function(token){self.token=token;});}
self.fetchConversionFactor=function(){site.factory.GetJWT().then(function(token){self.token=token;$("#paymentsoverlay").fadeIn(300);let converCurrencyUrl=dstvApp.DSOAPIUrl+`/apicurrency/api/v1/Currency?Country=${dstvApp.country}&ToCurrency=ETB`;site.factory.Get(converCurrencyUrl,'',self.onFetchConversionFactorSuccess,self.onFetchConversionFactorError)});}
self.onFetchConversionFactorSuccess=function(data){console.log('Payments New : On Currency conversion success');$("#paymentsoverlay").fadeOut(300);self.conversionFactor=data.conversionFactor;}
self.onFetchConversionFactorError=function(err){console.log('Payments New : On Currency conversion error');$("#paymentsoverlay").fadeOut(300);$('#paymentPage').hide();$('#errorMessage').show();}
self.AmountToPay=function(){if(app.dualCurrencyApplicable)
return(app.paymentduedetails.properties.amountToPayEtb.value<0||app.paymentduedetails.properties.amountToPayEtb.value==null)?0:app.paymentduedetails.properties.amountToPayEtb.value;return(app.paymentduedetails.properties.amountToPay.value<0||app.paymentduedetails.properties.amountToPay.value==null)?0:app.paymentduedetails.properties.amountToPay.value;}
self.OnKeyUp=function(){self.disablePayNow=self.GetTextboxAmount()<=0?true:false;self.update();}
self.GetTextboxAmount=function(){return $("#editableAmount").val();}
self.IsRecurringPaymentApplicable=function(){return dstvApp.RecurringPaymentCountries.includes(dstvApp.countryabbreviation);}
self.validateEditedAmount=function Pay(){let paymentCurrency=dstvApp.countrycurrency;if(dstvApp.DualCurrencyCountryList.includes(dstvApp.countryabbreviation)){paymentCurrency=dstvApp.DualCurrencyPaymentCurrency.filter(x=>x.country==dstvApp.countryabbreviation)[0].currency;}
if(paymentCurrency.toLowerCase().trim()!==dstvApp.countrycurrency.toLowerCase().trim()){amountDue=app.paymentduedetails.properties.amountToPayEtb.value?app.paymentduedetails.properties.amountToPayEtb.value:0;}
else{amountDue=app.paymentduedetails.properties.amountToPay.value?app.paymentduedetails.properties.amountToPay.value:0;}
editedAmount=parseFloat($('#editableAmount')[0].value);if(isNaN(editedAmount.toFixed())){return false;}
if(editedAmount.toFixed(2)!==amountDue.toFixed(2)){let paymentCurrency=dstvApp.countrycurrency;if(dstvApp.DualCurrencyCountryList.includes(dstvApp.countryabbreviation)){paymentCurrency=dstvApp.DualCurrencyPaymentCurrency.filter(x=>x.country==dstvApp.countryabbreviation)[0].currency;}
if(paymentCurrency.toLowerCase().trim()!==dstvApp.countrycurrency.toLowerCase().trim()){amountToProcess=editedAmount.toFixed(2);self.isAmountEdited=true;self.convertCurrencyAndPay();}
else{amountToProcess=editedAmount.toFixed(2);self.isAmountEdited=true;if(amountToProcess<1){self.showErrorMsg=true;self.errorMsg=langTranslateApp.paymentsMoreThanOneMsg+' '+paymentCurrency.toUpperCase();return false;}
else{self.showErrorMsg=false;}
self.update();self.checkForRecurringPayment();}}
else{amountDue=app.paymentduedetails.properties.amountToPay.value;amountToProcess=amountDue.toFixed(2);self.checkForRecurringPayment();}}
self.checkForRecurringPayment=function(){if(self.IsRecurringPaymentApplicable()){self.showRecurringScreen=true;self.update();}
else
self.showAwarenessPopup();}
self.showAwarenessPopup=function(){self.showRecurringScreen=false;self.showAwarenessMsg=true;self.update();}
self.SetupReccuringPayment=function(){if(!self.isAmountEdited)
amountToProcess=app.paymentduedetails.properties.amountToPay.value;self.showAwarenessPopup();}
self.convertCurrencyAndPay=function(){let currency=dstvApp.countrycurrency;if(dstvApp.countryabbreviation=='et'){currency='USD';}
if(self.conversionFactor){amountToProcess=parseFloat(amountToProcess*self.conversionFactor).toFixed(2);if(amountToProcess<1){self.errorMsg=langTranslateApp.paymentsMoreThanOneMsg+' '+currency;self.showErrorMsg=true;return false;}
else{self.showErrorMsg=false;}
self.update();self.checkForRecurringPayment();}}
self.processPayment=function(){site.factory.GetJWT().then(function(token){self.newWin=window.open('','_blank');let html="";let msg="Please wait..."
if(dstvApp.languageAbbreviation=='pt')
msg='Por favor, espere...'
html=`<html><head></head><body><div style="text-align: center;"><div style=" box-shadow: 0px 0px 6px grey; padding: 50px; display: block;"><img src="https://www.dstvafrica.com/media/3862/preloader_21.gif" style=" margin-bottom: 10px;"><br><div>${msg}</div></div> </div></body></html>`;self.newWin.document.write(html);let currency=dstvApp.countrycurrency;if(dstvApp.DualCurrency=='on'&&dstvApp.DualCurrencyCountryList.includes(dstvApp.countryabbreviation)){currency=dstvApp.DualCurrencyPaymentCurrency.filter(x=>x.country==dstvApp.countryabbreviation)[0].currency;}
$("#paymentsoverlay").fadeIn(300);$("#paymentsoverlay").css('display','content')
let paymentType='DstvPayment';let prodUserKey='';if(opts.showmaxPayment){paymentType='ShowmaxPayment';prodUserKey=app.showmaxAddOnDetails.name;}
else if(opts.boxOfficePayment){paymentType='BoxOffice';}
let account='';if(opts.boxOfficePayment){account=app.accounts.filter(x=>x.AccountType=="Box Office");}
else{account=app.accounts.filter(x=>x.AccountType=="DStvRes");}
let accNumber=account[0]?account[0].AccountNumber:null;self.reqBodyPaymentService={"country":dstvApp.country,"businessUnit":dstvApp.businessunit,"channel":dstvApp.channel,"currency":currency,"customerNumber":app.customernumber,"smartCardNumber":app.smartcard,"firstName":app.customerDetails.PersonalDetail.FirstName,"name":app.customerDetails.PersonalDetail.Surname,"accountNumber":accNumber,"amount":amountToProcess,"productUserKey":prodUserKey,"paymentType":paymentType,"backUrl":"","successReturnURL":"","failureReturnURL":"","bypassPaymentSuite":true,"LanguageCode":dstvApp.languageAbbreviation};site.trigger('getpostdata',dstvApp.DSOPaymentServiceURL,'POST','application/json',"Bearer "+self.token,'',self.reqBodyPaymentService,'',self.onPaymentProcessSuccess,self.onPaymentProcessError);});}
self.onPaymentProcessSuccess=function(data){console.log('Payment Suit: Payment process successful');self.tokenGenerated=true;if(data){self.showRecurringScreen=false;self.showAwarenessMsg=false;self.update();let dppRedirectUrl=data.redirectUrl;$('#errorMessage').hide();$('#paymentPage').hide();self.newWin.location=dppRedirectUrl;self.transactionId=data.transactionId;setTimeout(()=>{self.getPaymentStatus()},1000)}
else{console.log('Payment Suit: Error after successful DSOPaymentServiceURL call');}}
self.onPaymentProcessError=function(err){self.tokenGenerated=true;self.showRecurringScreen=false;self.showAwarenessMsg=false;self.update();$('#changepackageModal').modal('hide');$('#showmaxModel').modal('hide');$('#paymentModal').modal('show');$("#paymentsoverlay").fadeOut(300);$('#paymentPage').hide();$('#errorMessage').show();console.log('Error on DSO Payment process');let html="";let msg="Something went wrong!"
if(dstvApp.languageAbbreviation=='pt')
msg='Algo deu errado!'
if(err.responseJSON&&err.responseJSON.StatusCode==500){self.genericError=true;self.update();}
html=`<html><head></head><body><div style="text-align: center;background: #190303d1;color: white;"><div style=" box-shadow: 0px 0px 6px grey; padding: 50px; display: block;"><img src="https://www.dstvafrica.com/media/4674/error-icon.png" style="margin-bottom: 20px;"><br><div>${msg}</div></div></div></body></html>`
self.newWin.document.body.innerHTML=''
self.newWin.document.write(html);}
self.getPaymentStatus=function(){console.log('Payment Status : Fetching payment status...');if(!self.isPaymentSuiteOpen()){console.log('Payment Status : Payment suite is closed.');return;}
let url=`${dstvApp.DSOPaymentServiceURL}?Country=${dstvApp.country}&BusinessUnit=${dstvApp.businessunit}&Channel=${dstvApp.channel}&TransactionId=${self.transactionId}`;self.fetchingPaymentStatus=true;self.update();site.factory.Get(url,self.token,self.onGetPaymentStatusSuccess,self.onGetPaymentStatusError);}
self.onGetPaymentStatusSuccess=function(d){console.log('Payment Status : '+d.status);console.log('Payment Status : Fetching completed');self.isPaymentCompleted="success"==d.status.toLowerCase();self.fetchingPaymentStatus=false;self.paymentStatus.message=d.message;self.paymentStatus.status=d.status;self.paymentStatus.date=site.factory.GetEazyDateFormat(d.date);self.paymentStatus.amountDue=d.amountDue;self.paymentStatus.currency=dstvApp.countrycurrency.toUpperCase();self.paymentStatus.transactionId=d.transactionId;self.showmaxPaymentStatusReconnect=false;self.showmaxPaymentStatus=false;self.showmaxIconVisible=false;self.showMessage=false;self.localPrice=d.localPrice;self.statusMsg='';if(dstvApp.countryabbreviation=='et'){self.paymentStatus.currency='USD';}
if(self.localPrice){self.paymentStatus.localCurrency=self.localPrice.currency.toUpperCase();self.paymentStatus.localAmountDue=self.localPrice.amount;}
d.status=d.status.toLowerCase();if((d.status!='undefined'&&d.status!='in_progress')||self.newWin.closed){$("#paymentsoverlay").fadeOut(300);$('#paymentPage').hide();self.paymentStatus.show=true
self.update();}
if(d.status=='success'){self.paymentStatus.class="success";self.paymentStatus.heading=langTranslateApp.paymentsSuccessStatusMsg;self.newWin.close();if(opts.payReconnectShowmax||opts.showmaxChangePackagePayment){self.showmaxPaymentStatusReconnect=true;}
if(opts.showmaxPayment||opts.paySmartcardReconnectShowmax){self.showmaxPaymentStatus=true;self.showmaxIconVisible=true;}
if(opts.showmaxPayment){self.showMessage=true;self.buttonCaption='Create Profile';}
else{self.showMessage=false;}
self.update();}
else if(d.status=='pending'){self.paymentStatus.class="pending";self.paymentStatus.heading=langTranslateApp.paymentsPendingStatusMsg;if(opts.payReconnectShowmax||opts.showmaxChangePackagePayment||opts.showmaxPayment){self.showmaxIconVisible=true;}}
else{self.paymentStatus.class="failed";self.paymentStatus.heading=langTranslateApp.paymentsFailedStatusMsg;self.showmaxPaymentError=true;if(d.status=='failure')
self.newWin.close();if(opts.payReconnectShowmax||opts.showmaxChangePackagePayment||opts.showmaxPayment){self.showmaxIconVisible=true;}}
self.update();if(!self.newWin.closed&&(d.status=='pending'||d.status=='undefined'||d.status=='in_progress'))
setTimeout(function(){console.log('Payment Status : Retrying started...');self.getPaymentStatus(d.transactionId);},4000)}
self.onGetPaymentStatusError=function(error){console.log('Payment Status : Error while fetching payment status');console.log(error);self.fetchingPaymentStatus=false;self.update();}
self.GetAmountToPay=function(){console.log('Fetch Amount to Pay : fetch amount to pay...')
let url=`${dstvApp.DSOAPIUrl}atp/api/v1/AmountToPay?country=${dstvApp.country}&customerNumber=${app.customernumber}&BusinessUnit=${dstvApp.businessunit}&Channel=${dstvApp.channel}`;site.factory.Get(url,self.token,self.onGetAmountToPaySuccess,self.onGetAmountToPayError)}
self.onGetAmountToPaySuccess=function(data){console.log('Fetch Amount to Pay : fetch amount to pay completed')
app.paymentduedetails.properties.dueDate={value:data.DueDate.split('T')[0]};app.paymentduedetails.properties.amountToPay={value:Math.round(data.TotalAmountToPay.Value*100)/100}
app.paymentduedetails.properties.currencyCode={value:data.TotalAmountToPay.CurrencyCode}
app.BOAccount=data.Accounts.filter(x=>x.AccountType=="Box Office")[0];app.IsBOCustomer=app.BOAccount&&Object.keys(app.BOAccount).length>0
app.accounts=data.Accounts.map(x=>({AccountNumber:x.AccountNumber,AccountType:x.AccountType}))
app.accountsInfo=data.Accounts;app.primaryaccountnumber=data.Accounts.filter(x=>x.IsDefault)[0].AccountNumber;window.SessionSave("app",app);self.update();}
self.onGetAmountToPayError=function(err){console.log('Fetch Amount to Pay : error while fetching amount to pay')}
self.loadChangePackage=function(){if(app.noServicesLoaded){riot.mount('tag-model-for-showmax-upgrade',{showmodel:true})}else{$('#paymentModal').modal('hide');$('#changepackageModal').modal('show');$('.changePackModel').show();let packageName=app.smartcards.filter(x=>x.SerialNumber==app.smartcard)[0].primaryService?app.smartcards.filter(x=>x.SerialNumber==app.smartcard)[0].primaryService.serviceName:null;riot.mount('tag-change-package-new',{showmodal:true,smartcard:app.smartcard,packageName:packageName});}}
self.closePaymentDialog=function(){$('#errorMessage').hide();$('#paymentPage').hide();$('#paymentModal').modal('hide');window.location.reload();}
self.onRetry=function(){if(self.showmaxPaymentError){self.newWin.close();self.newWin='';self.processPayment();}
else
self.showPaymentSuite();}
self.showPaymentSuite=function(){$("#paymentsoverlay").fadeOut(300);$('#paymentPage').show();self.paymentStatus.show=false;self.update();}
self.isPaymentSuiteOpen=function(){return $('#paymentsModal').is(':visible');}
self.onAddShowmax=function(){$('#paymentModal').modal('hide');if(opts.showmaxPayment){riot.mount('tag-showmax-atb',{paySuccessCreateAccount:true,openpopup:true});}
else{riot.mount('tag-showmax-atb',{paySuccessAddShowmax:true,openpopup:true});}}
self.onReconnectShowmax=function(){$('#paymentModal').modal('hide');riot.mount('tag-showmax-atb',{paySuccessReconnectShowmax:true,openpopup:true});}});riot.tag2('tag-dstvthanks-partners','<section class="partnerCards"><div class="loader-highlight-partners" if="{loading}"></div> <div class="container"> <section class="about_thanks_responsive slider second-slider"><div each="{item in partners.list}"><div class="thanks_shadow"> <div class="channel-text"> <div class="mid-sec"> <h2>{item.cmsCategoryName}</h2> <div style="width:100%;clear:both;display:block;"></div> <div class="about-slider-img"> <img src="{item.rewardPartnerLogo}" ></div> <div class="partnerCards-des">{item.rewardPartnerShortText}</div> <input type="hidden" value="{item.rewardPartnerText}"> </div> <div class="btnreadmore"> <a href="javascript:void(0)" class="btnPartnerReadMore" onclick="{partnerReadMore}">{langTranslateApp.partnersReadMore.toUpperCase()}</a></div> </div> </div></div> </section> <span class="arrows-here"></span> </div></section>','tag-dstvthanks-partners,[riot-tag="tag-dstvthanks-partners"],[data-is="tag-dstvthanks-partners"]{ visibility: visible; display: block; }','',function(opts){var self=this;self.token='';self.loading=true;self.on('mount',function(){site.factory.GetJWT().then(function(token){self.token=token;self.loadPartners();self.update();});});self.loadPartners=function(){console.log('Reward Partner: Loading started...')
let url=`${dstvApp.DSOAPIUrl}apidstvthanks/api/v1/GetPartnerDetails?Country=${dstvApp.country}&BusinessUnit=${dstvApp.businessunit}&Channel=${dstvApp.channel}&Language=${dstvApp.language}`;site.factory.Get(url,self.token,self.successCallback,self.errorCallback);}
self.successCallback=function(data){console.log('Reward Partner: Loading completed')
self.loading=false;self.partners=data;self.modifyPartnerSliderData();self.update();self.initRewardsSlider();}
self.errorCallback=function(data){self.loading=false;self.update();console.log('Reward Partner: Loading failed')
console.log(data)}
self.modifyPartnerSliderData=function(){for(var i=0;i<self.partners.list.length;i++){try{let partnerCategoryName=self.partners.list[i].categoryName.split(' ')[0];self.partners.list[i].cmsCategoryName=app.categoriesFromCms.filter(x=>x.categoryName.toUpperCase().includes(partnerCategoryName.toUpperCase()))[0].subCategory;if(dstvApp.languageAbbreviation=='pt')
self.partners.list[i].cmsCategoryName=self.decodeHtml(self.partners.list[i].cmsCategoryName);}
catch(e){console.log('Error on modifying Partner Data Object');}}}
self.decodeHtml=function(str){return str.replace(/&#([0-9]{1,3});/gi,function(match,num){return String.fromCharCode(parseInt(num));});}
self.initRewardsSlider=function(){$('.about_thanks_responsive').slick({appendArrows:'.arrows-here',dots:false,infinite:true,nextArrow:'<span class="slick-next slick-arrow" style="display: inline-block;">→</span>',prevArrow:'<span class="slick-prev slick-arrow" style="display: inline-block;">←</span>',speed:300,slidesToShow:3,slidesToScroll:3,responsive:[{breakpoint:1024,settings:{slidesToShow:2,slidesToScroll:2,infinite:true,}},{breakpoint:600,settings:{slidesToShow:1,slidesToScroll:1,}},{breakpoint:480,settings:{slidesToShow:1,slidesToScroll:1,}}]});}
self.partnerReadMore=function(e){e.preventDefault();let partnerLogoURL=e.currentTarget.parentElement.parentElement.getElementsByTagName('img')[0].src;let category=e.currentTarget.parentElement.parentElement.getElementsByTagName('h2')[0].textContent;let desc=e.currentTarget.parentElement.parentElement.getElementsByTagName('input')[0].value;riot.mount('tag-dstvthanks-partner-modal-popup',{showmodal:true,partnerLogoURL:partnerLogoURL,category:category,desc:desc});}});riot.tag2('tag-showmax-atb','<div class="modal dashboardModal dashboardPOP " id="showmaxModel" role="dialog"> <div class="modal-dialog"> <div class="modal-content"> <button type="button" class="close btnClose" data-dismiss="modal"><i class=" icon-Close_M"></i></button> <div class="modal-body"> <div id="showmaxoverlay"> <div class="cv-spinner"> <span class="showmaxspinner"></span> </div> </div> <div class="container-fluid main-section activate-section" if="{freeShowmaxSection}"> <div class="popup showmaxPopup"> <img src="/media/10049/layer1-2x.png" class="showmax-icon"> <div class="showmaxInfoArea"> <span class="top-text"><span class="showmax-color">Add</span> Showmax</span> <span class="sub-text"> You are currently on <span class="currentPackagename">{smartcardForShowmax.primaryService.description}.</span><br>Get <span class="showmax-color">Showmax On Us!</span><br> Activate your account NOW.</span> </div> <div class="showmax-activate-btn"><a class="btn-show-active" href="javascript:void(0)" onclick={onActivateShowmax}>Activate Now <span class="arrowNow"></span></a></div> </div> </div> <div class="container-fluid main-section activate-success" if="{showmaxActivated}"> <div class="popup showmaxPopup"> <img src="/media/10049/layer1-2x.png" class="showmax-icon"> <h2 class="activesuccessheading">Almost done</h2> <!--<img src="/media/10053/success-tick.svg" class="icon-success">--> <div class="showmaxInfoArea"><!--<span class="sub-top-text">Thank you for activating Showmax.</span>--><span if="{showPendingMessage}" class="sub-additional-text">{statusMessage}</span><br><span class="sub-mid-text">To finish Showmax setup, please create or sign in to a Showmax account.</span> </div> <div class="showmax-activate-btn"><a class="btn-show-active" href="javascript:void(0)" onclick={onCreateShowmaxAccount}>Continue to Showmax <span class="arrowNow"></span></a> </div> </div> </div> <div class="container-fluid main-section payment-success" if="{showmaxActivationPaymentSuccess}"> <div class="popup showmaxPopup"> <img src="/media/10049/layer1-2x.png" class="showmax-icon"> <h2 class="activesuccessheading">Payment Successful</h2> <img src="/media/10053/success-tick.svg" class="icon-success"> <div class="showmaxInfoArea"> <span class="sub-top-text">Enjoy your Showmax</span> <span class="sub-mid-text"> Stay entertained by streaming your favourite shows and movies.</span> </div> <div class="paymentSccessInfoDetails"> <div class="paylabelValue"><span class="leftTextLabel transactionIdLabel">Transaction ID: </span><span class="rightTextValue transactionIdValue">31828199</span></div> <div class="paylabelValue"><span class="leftTextLabel DateLabel"> Date: </span><span class="rightTextValue DateValue">01-Nov-2019</span></div> <div class="paylabelValue"><span class="leftTextLabel StatusLabel"> Status: </span><span class="rightTextValue StatusValue">Successful</span></div> <div class="paylabelValue"><span class="leftTextLabel AmountLabel"> Amount: </span><span class="rightTextValue AmountValue">1709.0</span></div> </div> <div class="showmax-activate-btn"><a class="btn-show-active" href="">Close <span class="arrowNow"></span></a></div> </div> </div> <div class="container-fluid main-section cancellationSucessful" if="{showmaxCancelled}"> <div class="popup showmaxPopup"> <img src="/media/10049/layer1-2x.png" class="showmax-icon"> <h2 class="activesuccessheading">Cancellation Successful</h2> <img src="/media/10053/success-tick.svg" class="icon-success"> <div class="showmaxInfoArea"> <span class="sub-top-text">You no longer have Showmax</span> <span class="sub-mid-text"> We are sad to see you go, please let us know why you chose to leave and we hope to see you back soon.</span> </div> <div class="showmax-activate-btn"><a class="btn-show-active" href="javascript:void(0)" onclick={onShowmaxATBFeedback}>Give Us Feedback<span class="arrowNow"></span></a></div> </div> </div> <div class="container-fluid main-section feedbackReceived" if="{showmaxFeedbackReceived}"> <div class="popup showmaxPopup"> <img src="/media/10049/layer1-2x.png" class="showmax-icon"> <h2 class="activesuccessheading">Feedback Received</h2> <img src="/media/10053/success-tick.svg" class="icon-success"> <div class="showmaxInfoArea"> <span class="sub-top-text">Thank you for the feedback</span> <span class="sub-mid-text">We’ll be getting one of our agents to review your feedback and give feedback.</span> </div> <div class="showmax-activate-btn"><a class="btn-show-active" href="">Close<span class="arrowNow"></span></a></div> </div> </div> <div class="upgradeShowmaxSection" if="{showmaxUpgradeSection}"> <div class="container-fluid main-section upgradeShowmax"> <div class="popup showmaxPopup"> <img src="/media/10049/layer1-2x.png" class="showmax-icon"> <div class="showmaxInfoArea"> <span class="top-text"><span class="showmax-color">Upgrade</span> to DStv Premium</span> <span class="sub-text"> You are currently on <span class="currentPackagename">{smartcardForShowmax.primaryService.description}.</span><br> Get <span class="showmax-color">Showmax On Us!</span><br>Upgrade to DStv Premium NOW.</span> </div> <div class="showmax-activate-btn"><a class="btn-show-active upgrade-now " href="javascript:void(0)" onclick={onUpgradeShowmaxATB}>Upgrade Now <span class="arrowNow"></span></a></div> </div> </div> <div class="container-fluid main-section addShowmax"> <div class="popup showmaxPopup"> <div class="showmaxInfoArea"> <span class="sub-text">Add <span class="showmax-color">Showmax for {dstvApp.countrycurrency.toUpperCase()} {app.showmaxAddOnDetails.price.value}</span></span> </div> <div class="showmax-activate-btn"><a class="btn-show-active" href="javascript:void(0)" onclick={onActivateShowmax}>Add to bill <span class="arrowNow"></span></a></div> </div> </div> <div class="container-fluid main-section tryShowmax"> <div class="popup showmaxPopup"> <div class="showmaxInfoArea"> <span class="sub-text"> Try Showmax<span class="showmax-color"> for free</span></span> </div> <div class="showmax-activate-btn"><a class="btn-show-active" href={showmaxTrialSignUpURL} target="blank">Try Today <span class="arrowNow"></span></a></div> </div> </div> </div> <div class="container-fluid main-section cancelShowmaxConfirm" if="{showmaxConfirmCancel}"> <div class="popup showmaxPopup"> <img src="/media/10049/layer1-2x.png" class="showmax-icon"> <h2 class="activesuccessheading">Cancel Showmax</h2> <img src="/media/10052/cancle-img.svg" class="cancel-img"> <div class="cancelSectiontext"><span class="sub-text first-text-cancle"> You are about to cancel Showmax.</span><span class="sub-text"> You will be missing out on amazing <b>local and <br>international series</b> and <b>movies on demand.</b></span> </div> <div class="showmaxInfoArea"> <a href="javascript:void(0)" onclick={onBack}><span class="backicon"><span class="arrowNow"></span><span class="backword">Back</span></span></a> <a href="javascript:void(0)" onclick={onConfirmedCancelShowmax}><span class="Confirm-Btn"><span class="confirmword"> Confirm</span><span class="arrowNow"></span></span></a> </div> </div> </div> <div class="container-fluid main-section ErrorMassage" if="{showmaxGenericError}"> <div class="popup showmaxPopup"> <img src="/media/10049/layer1-2x.png" class="showmax-icon"> <h2 class="activesuccessheading">Oh no! Something <br> went wrong</h2> <img src="/media/10052/cancle-img.svg" class="icon-downgrade"> <p if="{pendingMessage}" class="errorShowmaxMessage">{message}</p> <div class="showmaxInfoArea"> <a href="javascript:void(0)" onclick={onCancel}><span class="backicon" data-dismiss="modal"><span class="backword" data-dismiss="modal">Cancel</span><span class="crossarrow"></span></span></a><a href="javascript:void(0)" onclick={onTryAgain}> <span class="cancle-icon"><span class="confirmword">Try Again</span><img src="/media/10054/try-icon.svg"></span></a> </div> </div> </div> <div class="ShowmaxPackagePopup" if="{showmaxManage}"> <h4 class="modal-title">{langTranslateApp.currentPackage}</h4> <div class="main-top-package-info"> <div class="package-info-left col-lg-5 col-xs-5 col-sm-5 col-md-5"><span class="icon-pack icon-{smartcardForShowmax.primaryService.productCode}"></span></div> <div class="package-info-right {smartcardForShowmax.primaryService.serviceName.split(\'-\')[1].trim()} {smartcardForShowmax.primaryService.productCode} col-lg-7 col-xs-7 col-sm-7 col-md-7"> <div class="backgroundimg"></div> <div class="smartcard"> {langTranslateApp.loginSmartcardNumber} <div class="number">{smartcardForShowmax.SerialNumber}</div> </div> </div> </div> <div class="second-top-package-info col-lg-12 col-xs-12 col-sm-12 col-md-12 {smartcardForShowmax.primaryService.serviceName.split(\'-\')[1].trim()} {smartcardForShowmax.primaryService.productCode}"> <div class="col-lg-4 col-xs-4 col-sm-4 col-md-4 second-top-first"> <div class="smartcard1">{langTranslateApp.dashDecoder}</div> <div class="smartcard1 decoder-name">Explora</div> <img src="/media/7655/explora-1.png"> </div> <div class="col-lg-4 col-xs-4 col-sm-4 col-md-4 second-top-second"> <div class="package-text-price ">{langTranslateApp.pkgPriceMonthly}</div> <div if="{!app.dualCurrencyApplicable}" class="package-price">{dstvApp.countrycurrency.toUpperCase()} {smartcardForShowmaxPrice}</div> <div if="{app.dualCurrencyApplicable}" class="package-price">{dstvApp.countrycurrency.toUpperCase()} {smartcardForShowmaxDualCurrencyPrice}</div> <div class="package-text-amount price-bten">{langTranslateApp.pkgAmountAvailable}</div> <div if="{!app.dualCurrencyApplicable}" class="package-amount">{dstvApp.countrycurrency.toUpperCase()} {availableAccountBalance}</div> <div if="{app.dualCurrencyApplicable}" class="package-amount">{dstvApp.countrycurrency.toUpperCase()} {availableAccountBalanceDualCurrency}</div> </div> <div class="col-lg-4 col-xs-4 col-sm-4 col-md-4 second-top-third"> <div class="smartcardStatus">{langTranslateApp.accStatus}</div> <div class="Status-info {app.CardStatus}"><img class="icon-background-img" src="/media/8268/icon-tick.svg"><span class="icon-icon-warning"></span><span if="{dstvApp.language == \'English\'}">{smartcardForShowmax.primaryService.status}</span><span if="{dstvApp.language == \'Portuguese\' && app.dashSelectedPackageCardStatus == \'Active\'}">Activo</span><span if="{dstvApp.language == \'Portuguese\' && app.dashSelectedPackageCardStatus == \'Disconnected\'}">Desconectado</span><span if="{dstvApp.language == \'Portuguese\' && app.dashSelectedPackageCardStatus == \'Suspended\'}">Suspensa</span> </div> <div class="addon-showmax-status"><span class="addonText">Add-Ons</span><span class="showmax-text">SHOWMAX</span></div> </div> </div> <div class="package-change-bottom-section"> <h2> Manage </h2> <label class="main-packagelist-section showmaxPackageSection col-lg-12 col-xs-12 col-sm-12 col-md-12"> <div class="left-packagelist-section col-lg-5 col-xs-5 col-sm-5 col-md-5"> <span class="icon-pack icon-showmax"></span> </div> <div class="right-packagelist-section showmaxRightSection col-lg-7 col-xs-7 col-sm-7 col-md-7"> <div class="smat-text">{langTranslateApp.pkgPriceMonthly}</div> <div class="smat-number">{dstvApp.countrycurrency.toUpperCase()} <span class="pricePerMonth"> {app.showmaxAddOnDetails.price.value} p/m</span></div> </div> <div class="showmax-price-section"> <div class="payment-showmax-right"> <a href="javascript:void(0)" onclick={onCancelShowmax}><span class="cancel-showmax"><span class="cancel-icon"><img src="/media/10050/showmax-cancle.svg"></span>Cancel Showmax</span></a> </div> </div> </label> </div> </div> <div class="container-fluid main-section cost-summary" if="{costSummaryShowmax}"> <div class="popup showmaxPopup"> <div class="package-selection showmax-package-cost" style=""> <div class="back-package"> <div class="backcard lslide" style="width: 100%; display: inline-block;"> <div class="backcard-packageItem {smartcardForShowmaxName} {smartcardForShowmaxCode}"> <i class="icon-pack icon-{smartcardForShowmaxCode}"></i> <div class="backgroundimg"> </div> </div> </div> </div> <img src="/media/7683/icon-back.svg" class="back-icon-img"> <div class="selected-package"> <div class="backcard lslide" style=""> <div class="backcard-packageItem " style=""> <div class="backcardprice"> <span class="showmax-package-image"><img src="/media/10058/layer1-2.svg" style="width: 90%;"> </span></div> <div class="bottomBar"> <span></span> </div> </div> </div> </div> </div> <h4 class="modal-title">{langTranslateApp.pkgCostSummary}</h4> <div class="cost-details row"> <div class="details-info col-lg-12 col-xs-12 col-sm-12 col-md-12"> <div class="details-info-text col-lg-6 col-xs-6 col-sm-6 col-md-6 "> SHOWMAX {langTranslateApp.pkgMonthlyCostTitle}</div> <div class="details-info-price col-lg-6 col-xs-6 col-sm-6 col-md-6">{dstvApp.countrycurrency.toUpperCase()} {showmaxPrice}</div> </div> <div class="details-info col-lg-12 col-xs-12 col-sm-12 col-md-12"> <div class="details-info-text col-lg-6 col-xs-6 col-sm-6 col-md-6"> {langTranslateApp.pkgChangeEstimatedCost} </div> <div if="{!app.dualCurrencyApplicable}" class="details-info-price col-lg-6 col-xs-6 col-sm-6 col-md-6">{dstvApp.countrycurrency.toUpperCase()} {dueAmount}</div> <div if="{app.dualCurrencyApplicable}" class="details-info-price col-lg-6 col-xs-6 col-sm-6 col-md-6">{DualCurrency.toUpperCase()} {DualCurrencydueAmount}</div> </div> </div> <div class="showmaxInfoArea"> <div class="cost-btn"> <button type="button" class="pay-btn-cost" id="btnShowmaxPay" onclick="{onProcessPayment}">{langTranslateApp.subMenuPayNow}</button> </div> </div> </div> </div> </div> </div> </div></div>','tag-showmax-atb,[riot-tag="tag-showmax-atb"],[data-is="tag-showmax-atb"]{ visibility: visible; display: block; }','',function(opts){var self=this;self.token='';self.loading=true;self.freeShowmaxSection=false;self.showmaxUpgradeSection=false;self.showmaxActivated=false;self.showmaxActivationPaymentSuccess=false;self.showmaxCancelled=false;self.showmaxFeedbackReceived=false;self.showmaxConfirmCancel=false;self.showmaxGenericError=false;self.showmaxManage=false;self.showmaxDowngradeWarning=false;let dotcom=site.env=='PROD'?'.com':'.io';self.showmaxGetItNowURL=`https://secure.showmax${dotcom}/v133.0/website/signup`;self.showmaxTrialSignUpURL=`https://secure.showmax${dotcom}/v133.0/website/signup`;self.showmaxFreeTrail=`https://secure.showmax${dotcom}`;self.isShowmaxAvailable=false;self.costSummaryShowmax=false;self.payReconnect=false;self.showPendingMessage=false;self.pendingMessage=false;if(app.smartcards&&app.smartcards.length>0){self.smartcardForShowmax=app.smartcards.filter(x=>x.primaryService&&x.SerialNumber==app.smartcard);self.dstvPremium=self.smartcardForShowmax.some(x=>x.primaryService.productName.includes("premium"));self.smartcardForShowmax=self.smartcardForShowmax[0];if(self.smartcardForShowmax){self.smartcardForShowmaxName=self.smartcardForShowmax.primaryService.serviceName.split('-')[1].trim();self.smartcardForShowmaxCode=self.smartcardForShowmax.primaryService.productCode;self.smartcardForShowmaxPrice=self.smartcardForShowmax.primaryService.price;self.smartcardForShowmaxDualCurrencyPrice=self.smartcardForShowmax.primaryService.localPrice;}}
self.on('mount',function(){if(self.opts.openpopup){console.log('Showmax ATB : In Mount...');site.factory.GetJWT().then(function(token){self.token=token;self.initiateShowmaxATB();self.update();});$("#showmaxModel").on("hidden.bs.modal",function(){if(self.PackageReloadRequired)
location.reload();})}});self.initiateShowmaxATB=function(){if(app.accountsInfo&&app.accountsInfo[0]&&app.accountsInfo[0].AccountBalance){self.availableAccountBalance=app.accountsInfo.filter(d=>d.AccountType=='DStvRes')[0].AccountBalance.Value;if(dstvApp.DualCurrency=='on'&&dstvApp.DualCurrencyCountryList.includes(dstvApp.countryabbreviation))
self.availableAccountBalanceDualCurrency=app.accountsInfo.filter(d=>d.AccountType=='DStvRes')[0].AccountBalance.LocalPrice.Amount.toString();}
else{self.availableAccountBalance='NA';}
if(opts.showActivate){$('#showmaxModel').modal('show');if(self.dstvPremium){self.freeShowmaxSection=true;self.showmaxUpgradeSection=false;}
else{self.freeShowmaxSection=false;self.showmaxUpgradeSection=true;}}
if(opts.showManage){$('#showmaxModel').modal('show');self.showmaxManage=true;}
if(opts.showPackagePaymentSuccess){$('#showmaxModel').modal('show');self.showmaxActivationPaymentSuccess=true;}
if(opts.handlePayReconnect||opts.paySuccessReconnectShowmax){$('#showmaxModel').modal('show');self.onShowmaxReconnect();}
if(opts.createShowmaxAccount||opts.paySuccessCreateAccount){self.onCreateShowmaxAccount();}
if(opts.changePackageCancelShowmax){$('#showmaxModel').modal('show');self.showmaxConfirmCancel=true;}
if(opts.changePackageAddShowmax||opts.activateShowmaxAddOn||opts.paySuccessAddShowmax){$('#showmaxModel').modal('show');self.onActivateShowmax();}
self.update();}
self.onActivateShowmax=function(){console.log('Showmax : Initiating activation');$("#showmaxoverlay").fadeIn(300);self.reqBody={"businessUnit":dstvApp.businessunit,"channel":dstvApp.channel,"country":dstvApp.country,"smartCardNumber":self.smartcardForShowmax.SerialNumber,"customerNumber":app.customernumber,"currentPackageName":self.smartcardForShowmax.primaryService.serviceName}
if(opts.paySuccessAddShowmax&&app.packageUpgradeDowngradeReq){self.reqBody.currentPackageName=app.packageUpgradeDowngradeReq.toPackageName;}
self.url=dstvApp.DSOAPIUrl+`/apishowmax/api/v1/Showmax/Capture`;site.factory.Post(self.url,self.reqBody,self.token,self.onCaptureSuccess,self.onCaptureError);}
self.onCaptureSuccess=function(data){$("#showmaxoverlay").fadeOut(300);self.showmaxGenericError=false;self.showmaxActivationPaymentSuccess=false;self.showmaxUpgradeSection=false;self.freeShowmaxSection=false;if(data&&data.StatusCode==208){self.showmaxActivated=true;self.showPendingMessage=true;self.statusMessage=data.Message;}
else{self.showmaxActivated=true;}
self.update();self.GetAmountToPayAndSubscription();}
self.onCaptureError=function(err){$("#showmaxoverlay").fadeOut(300);self.showmaxActivationPaymentSuccess=false;self.showmaxUpgradeSection=false;self.showmaxGenericError=false;self.captureError=true;if(err.responseJSON&&err.responseJSON.StatusCode==402){var res=err.responseJSON.Message.split('\\');res=JSON.parse(res);self.dueAmount=res.Payment.Amount;self.currency=res.Payment.Currency;self.message=res.ResponseMessage;self.showmaxPrice=app.showmaxAddOnDetails?(app.showmaxAddOnDetails.price?app.showmaxAddOnDetails.price.value:null):null;self.getViewSubscriptionData();self.freeShowmaxSection=false;self.costSummaryShowmax=true;self.update();}
else if(err.responseJSON&&err.responseJSON.StatusCode==400){console.log(err.responseJSON.Message);self.freeShowmaxSection=false;self.showmaxGenericError=true;}
else if(err.responseJSON&&err.responseJSON.StatusCode==422){console.log(err.responseJSON.Message);self.message=err.responseJSON.Message;if(err.responseJSON.Message.toLowerCase().includes('agreement')){self.message='You already have showmax activated in the linked smartcard. Please login with the smartcard with active showmax to manage showmax.';}
self.pendingMessage=true;self.freeShowmaxSection=false;self.showmaxGenericError=true;}
else if(err.responseJSON&&err.responseJSON.StatusCode==428){console.log(err.responseJSON.Message);self.freeShowmaxSection=false;self.onShowmaxReconnect();}
else{self.freeShowmaxSection=false;self.showmaxGenericError=true;}
self.update();}
self.onCancelShowmax=function(){self.showmaxManage=false;self.showmaxConfirmCancel=true;}
self.onConfirmedCancelShowmax=function(){console.log('Showmax ATB : Initiating Showmax Cancellation');$("#showmaxoverlay").fadeIn(300);self.reqBody={"businessUnit":dstvApp.businessunit,"channel":dstvApp.channel,"country":dstvApp.country,"smartCardNumber":self.smartcardForShowmax.SerialNumber,"customerNumber":app.customernumber,"packageName":app.showmaxAddOnDetails.name}
self.url=dstvApp.DSOAPIUrl+`/apishowmax/api/v1/Showmax/Cancel`;site.factory.Post(self.url,self.reqBody,self.token,self.onCancelSuccess,self.onCancelError);}
self.onCancelSuccess=function(data){console.log('Showmax ATB : On Cancel Success');self.showmaxGenericError=false;$("#showmaxoverlay").fadeOut(300);if(data&&data.statusCode==200){self.showmaxConfirmCancel=false;self.showmaxCancelled=true;}
else{}
self.update();self.GetAmountToPayAndSubscription();}
self.onCancelError=function(err){console.log('Showmax ATB : On Cancel Error');$("#showmaxoverlay").fadeOut(300);self.showmaxConfirmCancel=false;self.showmaxGenericError=true;self.cancelError=true;self.update();}
self.onShowmaxReconnect=function(){console.log('Showmax : Initiating Showmax Reconnect');self.payReconnect=true;$("#showmaxoverlay").fadeIn(300);site.factory.GetJWT().then(function(token){self.reqBody={"businessUnit":dstvApp.businessunit,"channel":dstvApp.channel,"country":dstvApp.country,"smartCardNumber":self.smartcardForShowmax.SerialNumber,"customerNumber":app.customernumber,"packageName":self.smartcardForShowmax.primaryService.serviceName}
self.url=dstvApp.DSOAPIUrl+`/apishowmax/api/v1/Showmax/Reconnect`;site.factory.Post(self.url,self.reqBody,self.token,self.onReconnectSuccess,self.onReconnectError);});}
self.onReconnectSuccess=function(data){console.log('Showmax ATB : On Reconnect Success');$("#showmaxoverlay").fadeOut(300);self.showmaxGenericError=false;self.showmaxActivated=true;self.update();self.GetAmountToPayAndSubscription();}
self.onReconnectError=function(err){console.log('Showmax ATB : On Reconnect Error');$("#showmaxoverlay").fadeOut(300);self.reconnectError=true;self.showmaxGenericError=false;if(err.responseJSON.StatusCode==422){console.log(err.responseJSON.Message);self.showmaxGenericError=true;}
else if(err.responseJSON.StatusCode==402){var res=err.responseJSON.Message.split('\\');res=JSON.parse(res);self.dueAmount=res.Payment.Amount;self.currency=res.Payment.Currency;self.DualCurrency=res.LocalCurrency?res.LocalCurrency.Currency:null;self.DualCurrencydueAmount=res.LocalCurrency?res.LocalCurrency.Amount:null;self.message=res.ResponseMessage;self.showmaxPrice=app.showmaxAddOnDetails?(app.showmaxAddOnDetails.price?app.showmaxAddOnDetails.price.value:null):null;self.costSummaryShowmax=true;self.update();}
else{self.showmaxGenericError=true;}
self.update();}
self.onUpgradeShowmaxATB=function(){let packageName=app.smartcards.filter(x=>x.SerialNumber==app.smartcard)[0].primaryService?app.smartcards.filter(x=>x.SerialNumber==app.smartcard)[0].primaryService.serviceName:null;$('#changepackageModal').modal('show');$('.changePackModel').show();$('.btn-show-active.upgrade-now ').click(function(){$(".dashboard-page").addClass('modal-open');});riot.mount('tag-change-package-new',{showmodal:true,showmaxATBUpgrade:true,smartcard:app.smartcard,packageName:packageName});}
self.onDashManageShowmax=function(){console.log('Showmax : Initiating Manage section');$('#showmaxModel').modal('show');self.showmaxManage=true;}
self.onShowmaxATBFeedback=function(){site.factory.CaptureFeedback('DSTVSHOWMAX_EN'+app.customernumber);self.showmaxCancelled=false;self.PackageReloadRequired=false;$('#showmaxModel').modal('hide');self.update();}
self.onCreateShowmaxAccount=function(){console.log('Showmax : Initiating Showmax Create Account');self.newWin=window.open('','_blank');let html="";let msg="Please wait..."
if(dstvApp.languageAbbreviation=='pt')
msg='Por favor, espere...'
html=`<html><head></head><body><div style="text-align: center;"><div style=" box-shadow: 0px 0px 6px grey; padding: 50px; display: block;"><img src="https://www.dstvafrica.com/media/3862/preloader_21.gif" style=" margin-bottom: 10px;"><br><div>${msg}</div></div> </div></body></html>`;self.newWin.document.write(html);$("#showmaxoverlay").fadeIn(300);let reqBody={"businessUnit":dstvApp.businessunit,"channel":dstvApp.channel,"country":dstvApp.country,"smartCardNumber":self.smartcardForShowmax.SerialNumber,"customerNumber":app.customernumber}
let url=dstvApp.DSOAPIUrl+`/apishowmax/api/v1/Showmax/GetOrCreateSubscription`;site.factory.Post(url,reqBody,self.token,self.onCreateAccountSuccess,self.onCreateAccountError);}
self.onCreateAccountSuccess=function(data){console.log('Showmax : On Showmax Create Account Success');$("#showmaxoverlay").fadeOut(300);self.showmaxGenericError=false;if(data){let redirectUrl=data.redirectUrl;self.newWin.location=redirectUrl;if(!opts.createShowmaxAccount){window.location.reload();}}}
self.onCreateAccountError=function(err){console.log('Showmax : On Showmax Create Account Error');$("#showmaxoverlay").fadeOut(300);self.showmaxActivated=false;self.createAccError=true;self.showmaxGenericError=true;self.update();let html="";let msg="Something went wrong!"
if(dstvApp.languageAbbreviation=='pt')
msg='Algo deu errado!'
html=`<html><head></head><body><div style="text-align: center;background: #190303d1;color: white;"><div style=" box-shadow: 0px 0px 6px grey; padding: 50px; display: block;"><img src="https://www.dstvafrica.com/media/4674/error-icon.png" style="margin-bottom: 20px;"><br><div>${msg}</div></div></div></body></html>`
self.newWin.document.body.innerHTML=''
self.newWin.document.write(html);}
self.onProcessPayment=function(){$('#showmaxModel').modal('hide');riot.mount('tag-payments-new',{showmaxPayment:true,amount:self.dueAmount});}
self.onBack=function(){if(opts.changePackageCancelShowmax){self.showmaxConfirmCancel=false;$('#changepackageModal').modal('show');}
else{self.showmaxConfirmCancel=false;self.showmaxManage=true;}
self.update();}
self.onCancel=function(){}
self.onTryAgain=function(){if(self.captureError||self.cancelError||self.reconnectError){console.log('Showmax : Initiating activation on Try Again');$("#showmaxoverlay").fadeIn(300);site.factory.Post(self.url,self.reqBody,self.token,self.onCaptureSuccess,self.onCaptureError);}
else if(self.createAccError){self.onCreateShowmaxAccount();}}
self.GetAmountToPayAndSubscription=function(){self.PackageReloadRequired=true;console.log('Fetch Amount to Pay : fetch amount to pay...')
let url=`${dstvApp.DSOAPIUrl}atp/api/v1/AmountToPay?country=${dstvApp.country}&customerNumber=${app.customernumber}&BusinessUnit=${dstvApp.businessunit}&Channel=${dstvApp.channel}`;site.factory.Get(url,self.token,self.onGetAmountToPaySuccess,self.onGetAmountToPayError)}
self.onGetAmountToPaySuccess=function(data){console.log('Fetch Amount to Pay : fetch amount to pay completed')
app.paymentduedetails.properties.dueDate={value:data.DueDate.split('T')[0]};app.paymentduedetails.properties.amountToPay={value:Math.round(data.TotalAmountToPay.Value*100)/100}
app.paymentduedetails.properties.currencyCode={value:data.TotalAmountToPay.CurrencyCode}
app.BOAccount=data.Accounts.filter(x=>x.AccountType=="Box Office")[0];app.IsBOCustomer=app.BOAccount&&Object.keys(app.BOAccount).length>0
app.accounts=data.Accounts.map(x=>({AccountNumber:x.AccountNumber,AccountType:x.AccountType}))
app.accountsInfo=data.Accounts;app.primaryaccountnumber=data.Accounts.filter(x=>x.IsDefault)[0].AccountNumber;window.SessionSave("app",app);self.update();}
self.onGetAmountToPayError=function(err){console.log('Fetch Amount to Pay : error while fetching amount to pay')}
self.getViewSubscriptionData=function(){$("#showmaxoverlay").fadeIn(300);let url=dstvApp.DSOAPIUrl+`/apiviewsubscription/api/v1/Subscription?country=${dstvApp.country}&customerNumber=${app.customernumber}&BusinessUnit=${dstvApp.businessunit}&Channel=${dstvApp.channel}`
site.factory.Get(url,self.token,self.viewSubscriptionSuccess,self.viewSubscriptionError);}
self.viewSubscriptionSuccess=function(data){$("#showmaxoverlay").fadeOut(300);app.viewSubscriptionResponse=data;self.packageLoaded=true;self.packages=data.map((package)=>{if(package.isPrimarySc){app.viewingDaysLeft=package.viewingDaysLeft}
if(package.services!==null){if(package.services.length>1)
package.services=package.services.sort(function(x,y){return x.psnr-y.psnr})
primaryService=package.services.filter((service)=>{serviceName=service.serviceName.split('-');if(service.serviceName.includes('-')){serviceName=service.serviceName.split('-');}
else if(service.serviceName.toUpperCase().includes('SHOWMAX')){serviceName[0]=service.serviceName.toUpperCase().trim().substring(0,7).trim();serviceName[1]=service.serviceName.toUpperCase().trim().substring(15,7).trim();}
service.productCode=serviceName[0].trim();let pckNameArray=packageName=serviceName[1].toLowerCase().replace('dstv','').trim().split(' ')
service.productName=pckNameArray[0];if(serviceName[1].includes('+')){service.productName=pckNameArray[0].trim().substr(0,pckNameArray[0].trim().indexOf(' '))+'-'+pckNameArray[1].trim().substr(0,pckNameArray[1].trim().indexOf(' '));}
service.productName+=packageName[1]=='plus'?'plus':'';service.productName=service.productName.replace("'","");service.hideAddonLinkClass=service.status=="Active"?'':' visibility-hidden';currentPackageFullName=service.serviceName;return service.type=='Principal'});if(primaryService.length>1)
primaryService=primaryService.filter((service)=>{return service.status=='Active'})
primaryService=primaryService[0];if(primaryService!=undefined||primaryService!=null){app.CardStatus=primaryService.status;app.MonthlyPrice=primaryService.price;app.ProductCode=primaryService.productCode;app.currentPackageFullName=primaryService.serviceName;if(dstvApp.DualCurrencyCountryList.includes(dstvApp.countryabbreviation))
app.MonthlyPriceDualCurrency=primaryService.localPrice?primaryService.localPrice.amount:null;}
addonServiceList=package.services.filter((service)=>{return(service.type=='Addon'||service.description.includes('Add-on')||service.description.includes('add-on'))&&service.status=='Active'});addonService=package.services.filter((service)=>{return service.type=='Addon'||service.description.includes('Add-on')||service.description.includes('add-on')})[0];addonService=addonService&&addonService.status=='Active'?(addonService.serviceName||addonService.description):'N/A';app.AddOnService=addonService;app.SmartCardNumber=package.smartcardNumber;window.SessionSave("app",app);}
return{SerialNumber:package.smartcardNumber,SmartcardName:package.smartcardName,primaryService:primaryService,addonService:addonService,Status:package.Status,psnr:package.psnr,serviceId:package.serviceId,isPrimarySmartcard:package.isPrimarySc,isXtraView:package.isXtraView};})
app.smartcards=self.packages;window.SessionSave("app",app);self.updatePackageData();}
self.updatePackageData=function(){if(app.smartcards&&app.smartcards.length>0){self.smartcardForShowmax=app.smartcards.filter(x=>x.primaryService&&x.SerialNumber==app.smartcard);self.dstvPremium=self.smartcardForShowmax.some(x=>x.primaryService.productName.includes("premium"));self.smartcardForShowmax=self.smartcardForShowmax[0];if(self.smartcardForShowmax){self.smartcardForShowmaxName=self.smartcardForShowmax.primaryService.serviceName.split('-')[1].trim();self.smartcardForShowmaxCode=self.smartcardForShowmax.primaryService.productCode;self.smartcardForShowmaxPrice=self.smartcardForShowmax.primaryService.price;self.smartcardForShowmaxDualCurrencyPrice=self.smartcardForShowmax.primaryService.localPrice;}
self.update();}}
self.viewSubscriptionError=function(err){$("#showmaxoverlay").fadeOut(300);}});